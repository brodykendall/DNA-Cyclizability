---
title: "Modeling"
author: "Brody Kendall"
date: "1/20/2023"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(tidyverse)
dat = readRDS("data/Created/processed_tiling_newC0.rds")
# y = dat$C0_new
y = dat$C0
dat_test = readRDS("data/Created/processed_tiling_test_newC0.rds")
# y_test = dat_test$C0_new
y_test = dat_test$C0
dat_random = readRDS("data/Created/processed_random_newC0.rds")
# y_random = dat_random$C0_new
y_random = dat_random$C0
dat_random_test = readRDS("data/Created/processed_random_test_newC0.rds")
# y_random_test = dat_random_test$C0_new
y_random_test = dat_random_test$C0
dat_random_all = rbind(dat_random, dat_random_test)
y_random_all = c(y_random, y_random_test)
dat_chrV = readRDS("data/Created/processed_chrV_newC0.rds")
# y_chrV = dat_chrV$C0_new
y_chrV = dat_chrV$C0
dat_chrV_test = readRDS("data/Created/processed_chrV_test_newC0.rds")
# y_chrV_test = dat_chrV_test$C0_new
y_chrV_test = dat_chrV_test$C0
dat_chrV_all = rbind(dat_chrV, dat_chrV_test)
y_chrV_all = c(y_chrV, y_chrV_test)
dat_yeast = readRDS("data/Created/processed_yeast_newC0.rds")
# y_yeast = dat_yeast$C0_new
y_yeast = dat_yeast$C0
dat_yeast_test = readRDS("data/Created/processed_yeast_test_newC0.rds")
# y_yeast_test = dat_yeast_test$C0_new
y_yeast_test = dat_yeast_test$C0
dat_yeast_all = rbind(dat_yeast, dat_yeast_test)
y_yeast_all = c(y_yeast, y_yeast_test)
```

# Inputs: Position Specific Nucleotides Only

```{r}
library(Matrix)
library(glmnet)
ps1 <- paste0("X", 1:50, "mono")
```

## No interaction terms

### Simple Linear Model

```{r}
dat_ps1 = dat %>% select(all_of(ps1), C0_new)
ps1_lm = lm(C0_new~., data=dat_ps1)

cor(ps1_lm$fitted.values, y)
# 0.132587

dat_test_ps1 = dat_test %>% select(all_of(ps1), C0_new)
ps1_lm_pred = predict(ps1_lm, dat_test_ps1)
cor(ps1_lm_pred, y_test)
# 0.1301951

mean((ps1_lm_pred - y_test)^2)
# 0.2369202
```

We get test prediction correlation of 0.1301951 and MSE of 0.2369202

### LightGBM (tree-based) Model

```{r}
library(lightgbm)
source("scripts/functions/lgbm-helper-functions.R")
set.seed(50)
dat_ps1.lgb_train_set = dat_ps1 %>%
  select(-C0_new)
dat_ps1.lgb_train_rules = lgb.convert_with_rules(data = dat_ps1.lgb_train_set)
dat_ps1.lgb_train_data = lgb.Dataset(data = as.matrix(dat_ps1.lgb_train_rules$data),
                                    label = dat_ps1$C0_new,
                                    categorical_feature = handle_categorical(colnames(dat_ps1.lgb_train_rules$data)))
dat_ps1.lgb_test_set = dat_test_ps1 %>%
  select(-C0_new)
dat_ps1.lgb_test_matrix = as.matrix(lgb.convert_with_rules(data = dat_ps1.lgb_test_set, rules = dat_ps1.lgb_train_rules$rules)$data)
dat_ps1.lgb_test_data = lgb.Dataset(data = dat_ps1.lgb_test_matrix,
                                   label = dat_test_ps1$C0_new,
                                   categorical_feature = handle_categorical(colnames(dat_ps1.lgb_test_matrix)))
dat_ps1.lgb_obj = lightgbm(data = dat_ps1.lgb_train_data,
                          params = list(learning_rate = c(0.1),
                                        objective = c("regression"),
                                        min_data_in_leaf = 100,
                                        max_depth = c(5),
                                        num_leaves = c(1000),
                                        lambda_l2 = c(1),
                                        boosting = c("gbdt")),
                          valids = list(valid = dat_ps1.lgb_test_data),
                          nrounds = 4000,
                          early_stopping_rounds = 50)

dat_ps1.lgb_train_pred = predict(dat_ps1.lgb_obj, data = as.matrix(dat_ps1.lgb_train_rules$data))
cor(dat_ps1.lgb_train_pred, y, method="pearson")
# 0.8879021 (nrounds = 1907)

dat_ps1.lgb_test_pred = predict(dat_ps1.lgb_obj, data = dat_ps1.lgb_test_matrix)

cor(dat_ps1.lgb_test_pred, y_test, method="pearson")
# 0.6280779 (nrounds = 1907)

mean((dat_ps1.lgb_test_pred - y_test)^2)
# 0.146652 (nrounds = 1907)
```

We get test prediction correlation of 0.6280779 and MSE of 0.146652

```{r}
dat_ps1.feature_importance = as.data.frame(lgb.importance(dat_ps1.lgb_obj)) %>%
  mutate(Feature = fct_rev(fct_inorder(Feature))) %>%
  dplyr::slice(1:50) %>%
  ggplot(aes(x = Feature, y = Gain)) +
  geom_col(fill = "dodgerblue") +
  coord_flip() +
  theme_bw()
dat_ps1.feature_importance
```



## Include all interaction terms

```{r}
model_cols_all_int.1 <- c(ps1)
X_all_int.1 = dat %>%
  select(all_of(model_cols_all_int.1))

x_all_int.1 = sparse.model.matrix(~.^2, data=X_all_int.1)

set.seed(50)
la.model_all_int.1 = cv.glmnet(x_all_int.1, y, alpha=1, family="gaussian")
ri.model_all_int.1 = cv.glmnet(x_all_int.1, y, alpha=0, family="gaussian")

la.all_int_best_lambda.1 = la.model_all_int.1$lambda.min
la.all_int_best_lambda.1
ri.all_int_best_lambda.1 = ri.model_all_int.1$lambda.min
ri.all_int_best_lambda.1

la.model_all_int.train_pred.1 = predict(la.model_all_int.1, newx = x_all_int.1, s=la.all_int_best_lambda.1)
ri.model_all_int.train_pred.1 = predict(ri.model_all_int.1, newx = x_all_int.1, s=ri.all_int_best_lambda.1)

cor(la.model_all_int.train_pred.1, y, method="pearson")
# 0.7017725 (slight improvement from 0.6970752)
mean((la.model_all_int.train_pred.1 - y)^2)
# 0.1245816
cor(ri.model_all_int.train_pred.1, y, method="pearson")
# 0.7072601 (slight improvement from 0.7022866)
mean((ri.model_all_int.train_pred.1 - y)^2)
# 0.1227843

X_all_int_test.1 = dat_test %>%
  select(all_of(model_cols_all_int.1))
x_all_int_test.1 = sparse.model.matrix(~.^2, data=X_all_int_test.1)

# Predict values for test dataset:
la.model_all_int.pred.1 = predict(la.model_all_int.1, newx = x_all_int_test.1, s=la.all_int_best_lambda.1)
ri.model_all_int.pred.1 = predict(ri.model_all_int.1, newx = x_all_int_test.1, s=ri.all_int_best_lambda.1)

# Prediction accuracy with test data:
cor(la.model_all_int.pred.1, y_test, method="pearson")
# 0.5986235 (slight improvement from 0.5913363)
mean((la.model_all_int.pred.1 - y_test)^2)
# 0.1548255

cor(ri.model_all_int.pred.1, y_test, method="pearson")
# 0.5908111 (slight improvement from 0.5830442)
mean((ri.model_all_int.pred.1 - y_test)^2)
# 0.1572308
```

We get test prediction correlation of 0.5986235 and MSE of 0.1548255 with lasso
We get test prediction correlation of 0.5908111 and MSE of 0.1572308 with ridge

# Inputs: Position Specific Nucleotides + Markov Ratio

```{r}
library(Matrix)
library(glmnet)
ps1 <- paste0("X", 1:50, "mono")
```

## No interation terms

```{r}
dat_ps1_2 = dat %>% select(all_of(ps1), ratio_score_2nd, C0_new)
ps1_2_lm = lm(C0_new~., data=dat_ps1_2)

cor(ps1_2_lm$fitted.values, y)
# 0.4059174

dat_test_ps1_2 = dat_test %>% select(all_of(ps1), ratio_score_2nd, C0_new)
ps1_2_lm_pred = predict(ps1_2_lm, dat_test_ps1_2)
cor(ps1_2_lm_pred, y_test)
# 0.5194594

mean((ps1_2_lm_pred - y_test)^2)
# 0.1805045
```

We get test prediction correlation of 0.5194594 and MSE of 0.1805045

## Include all interaction terms

```{r}
model_cols_all_int_inc_ratio.1 <- c(ps1, "ratio_score_2nd")
X_all_int_inc_ratio.1 = dat %>%
  select(all_of(model_cols_all_int_inc_ratio.1))

x_all_int_inc_ratio.1 = sparse.model.matrix(~(.-ratio_score_2nd)^2 + ratio_score_2nd, data=X_all_int_inc_ratio.1)

set.seed(50)
la.model_all_int_inc_ratio.1 = cv.glmnet(x_all_int_inc_ratio.1, y, alpha=1, family="gaussian")
ri.model_all_int_inc_ratio.1 = cv.glmnet(x_all_int_inc_ratio.1, y, alpha=0, family="gaussian")

la.all_int_inc_ratio_best_lambda.1 = la.model_all_int_inc_ratio.1$lambda.min
la.all_int_inc_ratio_best_lambda.1
ri.all_int_inc_ratio_best_lambda.1 = ri.model_all_int_inc_ratio.1$lambda.min
ri.all_int_inc_ratio_best_lambda.1

# Predict values for train dataset:
la.model_all_int_inc_ratio.train_pred.1 = predict(la.model_all_int_inc_ratio.1, newx = x_all_int_inc_ratio.1, s=la.all_int_inc_ratio_best_lambda.1)
ri.model_all_int_inc_ratio.train_pred.1 = predict(ri.model_all_int_inc_ratio.1, newx = x_all_int_inc_ratio.1, s=ri.all_int_inc_ratio_best_lambda.1)

# Prediction accuracy with train data:
cor(la.model_all_int_inc_ratio.train_pred.1, y, method="pearson")
# 0.7068451 (slight improvement from 0.7020738)
mean((la.model_all_int_inc_ratio.train_pred.1 - y)^2)
# 0.1224163
cor(ri.model_all_int_inc_ratio.train_pred.1, y, method="pearson")
# 0.7113047 (0.7059261)
mean((ri.model_all_int_inc_ratio.train_pred.1 - y)^2)
# 0.1216027

# Prepare test data:
X_all_int_inc_ratio_test.1 = dat_test %>%
  select(all_of(model_cols_all_int_inc_ratio.1))

x_all_int_inc_ratio_test.1 = sparse.model.matrix(~(.-ratio_score_2nd)^2 + ratio_score_2nd, data=X_all_int_inc_ratio_test.1)

# Predict values for test dataset:
la.model_all_int_inc_ratio.pred.1 = predict(la.model_all_int_inc_ratio.1, newx = x_all_int_inc_ratio_test.1, s=la.all_int_inc_ratio_best_lambda.1)
ri.model_all_int_inc_ratio.pred.1 = predict(ri.model_all_int_inc_ratio.1, newx = x_all_int_inc_ratio_test.1, s=ri.all_int_inc_ratio_best_lambda.1)

# Prediction accuracy with test data:
cor(la.model_all_int_inc_ratio.pred.1, y_test, method="pearson")
# 0.6554737 (slight improvement from 0.6498516)
mean((la.model_all_int_inc_ratio.pred.1 - y_test)^2)
# 0.1456545
cor(ri.model_all_int_inc_ratio.pred.1, y_test, method="pearson")
# 0.6552911 (0.6499146)
mean((ri.model_all_int_inc_ratio.pred.1 - y_test)^2)
# 0.1402518
```

We get test prediction correlation of 0.6554737 and MSE of 0.1456545 with lasso
We get test prediction correlation of 0.6552911 and MSE of 0.1402518 with ridge

# Inputs: Position Specific Dinucleotides

```{r}
library(Matrix)
library(glmnet)
ps2 <- paste0("X", 1:49, "di")
```

## No interaction terms

### Simple Linear Model

```{r}
dat_ps2 = dat %>% select(all_of(ps2), C0_new)
ps2_lm = lm(C0_new~., data=dat_ps2)

cor(ps2_lm$fitted.values, y)
# 0.3769176

dat_test_ps2 = dat_test %>% select(all_of(ps2), C0_new)
ps2_lm_pred = predict(ps2_lm, dat_test_ps2)
cor(ps2_lm_pred, y_test)
# 0.3690218

mean((ps2_lm_pred - y_test)^2)
# 0.2082426
```

We get test prediction correlation of 0.3690218 and MSE of 0.2082426

### LightGBM (tree-based) Model

```{r}
library(lightgbm)
source("scripts/functions/lgbm-helper-functions.R")
set.seed(50)
dat_ps2.lgb_train_set = dat_ps2 %>%
  select(-C0_new)
dat_ps2.lgb_train_rules = lgb.convert_with_rules(data = dat_ps2.lgb_train_set)
dat_ps2.lgb_train_data = lgb.Dataset(data = as.matrix(dat_ps2.lgb_train_rules$data),
                                    label = dat_ps2$C0_new,
                                    categorical_feature = handle_categorical(colnames(dat_ps2.lgb_train_rules$data)))
dat_ps2.lgb_test_set = dat_test_ps2 %>%
  select(-C0_new)
dat_ps2.lgb_test_matrix = as.matrix(lgb.convert_with_rules(data = dat_ps2.lgb_test_set, rules = dat_ps2.lgb_train_rules$rules)$data)
dat_ps2.lgb_test_data = lgb.Dataset(data = dat_ps2.lgb_test_matrix,
                                   label = dat_test_ps2$C0_new,
                                   categorical_feature = handle_categorical(colnames(dat_ps2.lgb_test_matrix)))
dat_ps2.lgb_obj = lightgbm(data = dat_ps2.lgb_train_data,
                          params = list(learning_rate = c(0.1),
                                        objective = c("regression"),
                                        min_data_in_leaf = 100,
                                        max_depth = c(5),
                                        num_leaves = c(1000),
                                        lambda_l2 = c(1),
                                        boosting = c("gbdt")),
                          valids = list(valid = dat_ps2.lgb_test_data),
                          nrounds = 4000,
                          early_stopping_rounds = 50)

dat_ps2.lgb_train_pred = predict(dat_ps2.lgb_obj, data = as.matrix(dat_ps2.lgb_train_rules$data))
cor(dat_ps2.lgb_train_pred, y, method="pearson")
# 0.9920752 (nrounds = 2584)

dat_ps2.lgb_test_pred = predict(dat_ps2.lgb_obj, data = dat_ps2.lgb_test_matrix)

cor(dat_ps2.lgb_test_pred, y_test, method="pearson")
# 0.6840554 (nrounds = 2584)

mean((dat_ps2.lgb_test_pred - y_test)^2)
# 0.1304277 (nrounds = 2584)
```

We get test prediction correlation of 0.6840554 and MSE of 0.1304277

```{r}
dat_ps2.feature_importance = as.data.frame(lgb.importance(dat_ps2.lgb_obj)) %>%
  mutate(Feature = fct_rev(fct_inorder(Feature))) %>%
  dplyr::slice(1:50) %>%
  ggplot(aes(x = Feature, y = Gain)) +
  geom_col(fill = "dodgerblue") +
  coord_flip() +
  theme_bw()
dat_ps2.feature_importance
```




## Include all interaction terms

```{r}
model_cols_all_int.2 <- c(ps2)
X_all_int.2 = dat %>%
  select(all_of(model_cols_all_int.2))

x_all_int.2 = sparse.model.matrix(~.^2, data=X_all_int.2)

set.seed(50)
la.model_all_int.2 = cv.glmnet(x_all_int.2, y, alpha=1, family="gaussian")
ri.model_all_int.2 = cv.glmnet(x_all_int.2, y, alpha=0, family="gaussian")

la.all_int_best_lambda.2 = la.model_all_int.2$lambda.min
la.all_int_best_lambda.2
ri.all_int_best_lambda.2 = ri.model_all_int.2$lambda.min
ri.all_int_best_lambda.2

la.model_all_int.train_pred.2 = predict(la.model_all_int.2, newx = x_all_int.2, s=la.all_int_best_lambda.2)
ri.model_all_int.train_pred.2 = predict(ri.model_all_int.2, newx = x_all_int.2, s=ri.all_int_best_lambda.2)

cor(la.model_all_int.train_pred.2, y, method="pearson")
# 0.7714706 (slight improvement from 0.7645926)
mean((la.model_all_int.train_pred.2 - y)^2)
# 0.1171045
cor(ri.model_all_int.train_pred.2, y, method="pearson")
# 0.9053632 (slight improvement from 0.9038084)
mean((ri.model_all_int.train_pred.2 - y)^2)
# 0.06832114

X_all_int_test.2 = dat_test %>%
  select(all_of(model_cols_all_int.2))

x_all_int_test.2 = sparse.model.matrix(~.^2, data=X_all_int_test.2)

la.model_all_int.pred.2 = predict(la.model_all_int.2, newx = x_all_int_test.2, s=la.all_int_best_lambda.2)
ri.model_all_int.pred.2 = predict(ri.model_all_int.2, newx = x_all_int_test.2, s=ri.all_int_best_lambda.2)

cor(la.model_all_int.pred.2, y_test, method="pearson")
# 0.4695747 (slight improvement from 0.4583323)
mean((la.model_all_int.pred.2 - y_test)^2)
# 0.1878998

cor(ri.model_all_int.pred.2, y_test, method="pearson")
# 0.5116327 (slight improvement from 0.5013422)
mean((ri.model_all_int.pred.2 - y_test)^2)
# 0.1783115
```

We get test prediction correlation of 0.4695747 and MSE of 0.1878998 with lasso
We get test prediction correlation of 0.5116327 and MSE of 0.1783115 with ridge

# Inputs: Position Specific Dinucleotides + Markov Ratio

```{r}
library(Matrix)
library(glmnet)
ps2 <- paste0("X", 1:49, "di")
```

## No interation terms

```{r}
dat_ps2_2 = dat %>% select(all_of(ps2), ratio_score_2nd, C0_new)
ps2_2_lm = lm(C0_new~., data=dat_ps2_2)

cor(ps2_2_lm$fitted.values, y)
# 0.4138534

dat_test_ps2_2 = dat_test %>% select(all_of(ps2), ratio_score_2nd, C0_new)
ps2_2_lm_pred = predict(ps2_2_lm, dat_test_ps2_2)
cor(ps2_2_lm_pred, y_test)
# 0.5249731

mean((ps2_2_lm_pred - y_test)^2)
# 0.1774299
```

We get test prediction correlation of 0.5249731 and MSE of 0.1774299

## Include all interaction terms

```{r}
model_cols_all_int_inc_ratio.2 <- c(ps2, "ratio_score_2nd")
X_all_int_inc_ratio.2 = dat %>%
  select(all_of(model_cols_all_int_inc_ratio.2))

x_all_int_inc_ratio.2 = sparse.model.matrix(~(.-ratio_score_2nd)^2 + ratio_score_2nd, data=X_all_int_inc_ratio.2)

set.seed(50)
la.model_all_int_inc_ratio.2 = cv.glmnet(x_all_int_inc_ratio.2, y, alpha=1, family="gaussian")
ri.model_all_int_inc_ratio.2 = cv.glmnet(x_all_int_inc_ratio.2, y, alpha=0, family="gaussian")

la.all_int_inc_ratio_best_lambda.2 = la.model_all_int_inc_ratio.2$lambda.min
la.all_int_inc_ratio_best_lambda.2
ri.all_int_inc_ratio_best_lambda.2 = ri.model_all_int_inc_ratio.2$lambda.min
ri.all_int_inc_ratio_best_lambda.2

la.model_all_int_inc_ratio.train_pred.2 = predict(la.model_all_int_inc_ratio.2, newx = x_all_int_inc_ratio.2, s=la.all_int_inc_ratio_best_lambda.2)
ri.model_all_int_inc_ratio.train_pred.2 = predict(ri.model_all_int_inc_ratio.2, newx = x_all_int_inc_ratio.2, s=ri.all_int_inc_ratio_best_lambda.2)

cor(la.model_all_int_inc_ratio.train_pred.2, y, method="pearson")
# 0.7293333 (0.7215706)
mean((la.model_all_int_inc_ratio.train_pred.2 - y)^2)
# 0.1247482
cor(ri.model_all_int_inc_ratio.train_pred.2, y, method="pearson")
# 0.894879 (0.8939136)
mean((ri.model_all_int_inc_ratio.train_pred.2 - y)^2)
# 0.07486977

X_all_int_inc_ratio_test.2 = dat_test %>%
  select(all_of(model_cols_all_int_inc_ratio.2))

x_all_int_inc_ratio_test.2 = sparse.model.matrix(~(.-ratio_score_2nd)^2 + ratio_score_2nd, data=X_all_int_inc_ratio_test.2)

la.model_all_int_inc_ratio.pred.2 = predict(la.model_all_int_inc_ratio.2, newx = x_all_int_inc_ratio_test.2, s=la.all_int_inc_ratio_best_lambda.2)
ri.model_all_int_inc_ratio.pred.2 = predict(ri.model_all_int_inc_ratio.2, newx = x_all_int_inc_ratio_test.2, s=ri.all_int_inc_ratio_best_lambda.2)

cor(la.model_all_int_inc_ratio.pred.2, y_test, method="pearson")
# 0.5794277 (0.5746391)
mean((la.model_all_int_inc_ratio.pred.2 - y_test)^2)
# 0.1642573
cor(ri.model_all_int_inc_ratio.pred.2, y_test, method="pearson")
# 0.5237301 (0.5138724)
mean((ri.model_all_int_inc_ratio.pred.2 - y_test)^2)
# 0.1759241
```

We get test prediction correlation of 0.5794277 and MSE of 0.1642573 with lasso
We get test prediction correlation of 0.5237301 and MSE of 0.1759241 with ridge

# Inputs: Position Specific Nucleotides and Dinucleotides

```{r}
ps1 <- paste0("X", 1:50, "mono")
ps2 <- paste0("X", 1:49, "di")
```

## No interaction terms

### Simple Linear Model

```{r}
dat_ps12 = dat %>% select(all_of(ps1), all_of(ps2), C0_new)
ps12_lm = lm(C0_new~., data=dat_ps12)

cor(ps12_lm$fitted.values, y)
# 0.3769176

dat_test_ps12 = dat_test %>% select(all_of(ps1), all_of(ps2), C0_new)
ps12_lm_pred = predict(ps12_lm, dat_test_ps12)
cor(ps12_lm_pred, y_test)
# 0.3690218

mean((ps12_lm_pred - y_test)^2)
# 0.2082426
```

We get test prediction correlation of 0.3690218 and MSE of 0.2082426

### LightGBM (tree-based) Model

```{r}
library(lightgbm)
source("scripts/functions/lgbm-helper-functions.R")
set.seed(50)
dat_ps12.lgb_train_set = dat_ps12 %>%
  select(-C0_new)
dat_ps12.lgb_train_rules = lgb.convert_with_rules(data = dat_ps12.lgb_train_set)
dat_ps12.lgb_train_data = lgb.Dataset(data = as.matrix(dat_ps12.lgb_train_rules$data),
                                    label = dat_ps12$C0_new,
                                    categorical_feature = handle_categorical(colnames(dat_ps12.lgb_train_rules$data)))
dat_ps12.lgb_test_set = dat_test_ps12 %>%
  select(-C0_new)
dat_ps12.lgb_test_matrix = as.matrix(lgb.convert_with_rules(data = dat_ps12.lgb_test_set, rules = dat_ps12.lgb_train_rules$rules)$data)
dat_ps12.lgb_test_data = lgb.Dataset(data = dat_ps12.lgb_test_matrix,
                                   label = dat_test_ps12$C0_new,
                                   categorical_feature = handle_categorical(colnames(dat_ps12.lgb_test_matrix)))
dat_ps12.lgb_obj = lightgbm(data = dat_ps12.lgb_train_data,
                          params = list(learning_rate = c(0.1),
                                        objective = c("regression"),
                                        min_data_in_leaf = 100,
                                        max_depth = c(5),
                                        num_leaves = c(1000),
                                        lambda_l2 = c(1),
                                        boosting = c("gbdt")),
                          valids = list(valid = dat_ps12.lgb_test_data),
                          nrounds = 4000,
                          early_stopping_rounds = 50)

dat_ps12.lgb_train_pred = predict(dat_ps12.lgb_obj, data = as.matrix(dat_ps12.lgb_train_rules$data))
cor(dat_ps12.lgb_train_pred, y, method="pearson")
# 0.9920752 (nrounds = 2584)

dat_ps12.lgb_test_pred = predict(dat_ps12.lgb_obj, data = dat_ps12.lgb_test_matrix)

cor(dat_ps12.lgb_test_pred, y_test, method="pearson")
# 0.6840554 (nrounds = 2584)

mean((dat_ps12.lgb_test_pred - y_test)^2)
# 0.1304277 (nrounds = 2584)
```

We get test prediction correlation of 0.6840554 and MSE of 0.1304277

```{r}
dat_ps12.feature_importance = as.data.frame(lgb.importance(dat_ps12.lgb_obj)) %>%
  mutate(Feature = fct_rev(fct_inorder(Feature))) %>%
  dplyr::slice(1:50) %>%
  ggplot(aes(x = Feature, y = Gain)) +
  geom_col(fill = "dodgerblue") +
  coord_flip() +
  theme_bw()
dat_ps12.feature_importance
```


# Inputs: Position Specific Nucleotides and Dinucleotides + Markov Ratio

```{r}
ps1 <- paste0("X", 1:50, "mono")
ps2 <- paste0("X", 1:49, "di")
```

## No interation terms

```{r}
dat_ps12_2 = dat %>% select(all_of(ps1), all_of(ps2), ratio_score_2nd, C0_new)
ps12_2_lm = lm(C0_new~., data=dat_ps12_2)

cor(ps12_2_lm$fitted.values, y)
# 0.4138534

dat_test_ps12_2 = dat_test %>% select(all_of(ps1), all_of(ps2), ratio_score_2nd, C0_new)
ps12_2_lm_pred = predict(ps12_2_lm, dat_test_ps12_2)
cor(ps12_2_lm_pred, y_test)
# 0.5249731

mean((ps12_2_lm_pred - y_test)^2)
# 0.1774299
```

We get test prediction correlation of 0.5249731 and MSE of 0.1774299

# Inputs: Position Specific Trinucleotides

```{r}
library(Matrix)
library(glmnet)
ps3 <- paste0("X", 1:48, "tri")
```

## No interaction terms

### Simple Linear Model

```{r}
dat_ps3 = dat %>% select(all_of(ps3), C0_new)
ps3_lm = lm(C0_new~., data=dat_ps3)

cor(ps3_lm$fitted.values, y)
# 0.4301098

dat_test_ps3 = dat_test %>% select(all_of(ps3), C0_new)
ps3_lm_pred = predict(ps3_lm, dat_test_ps3)
cor(ps3_lm_pred, y_test)
# 0.37473

mean((ps3_lm_pred - y_test)^2)
# 0.2082062
```

We get test prediction correlation of 0.37473 and MSE of 0.2082062

### LightGBM (tree-based) Model

```{r}
library(lightgbm)
source("scripts/functions/lgbm-helper-functions.R")
set.seed(50)
dat_ps3.lgb_train_set = dat_ps3 %>%
  select(-C0_new)
dat_ps3.lgb_train_rules = lgb.convert_with_rules(data = dat_ps3.lgb_train_set)
dat_ps3.lgb_train_data = lgb.Dataset(data = as.matrix(dat_ps3.lgb_train_rules$data),
                                    label = dat_ps3$C0_new,
                                    categorical_feature = handle_categorical(colnames(dat_ps3.lgb_train_rules$data)))
dat_ps3.lgb_test_set = dat_test_ps3 %>%
  select(-C0_new)
dat_ps3.lgb_test_matrix = as.matrix(lgb.convert_with_rules(data = dat_ps3.lgb_test_set, rules = dat_ps3.lgb_train_rules$rules)$data)
dat_ps3.lgb_test_data = lgb.Dataset(data = dat_ps3.lgb_test_matrix,
                                   label = dat_test_ps3$C0_new,
                                   categorical_feature = handle_categorical(colnames(dat_ps3.lgb_test_matrix)))
dat_ps3.lgb_obj = lightgbm(data = dat_ps3.lgb_train_data,
                          params = list(learning_rate = c(0.1),
                                        objective = c("regression"),
                                        min_data_in_leaf = 100,
                                        max_depth = c(5),
                                        num_leaves = c(1000),
                                        lambda_l2 = c(1),
                                        boosting = c("gbdt")),
                          valids = list(valid = dat_ps3.lgb_test_data),
                          nrounds = 4000,
                          early_stopping_rounds = 50)

dat_ps3.lgb_train_pred = predict(dat_ps3.lgb_obj, data = as.matrix(dat_ps3.lgb_train_rules$data))
cor(dat_ps3.lgb_train_pred, y, method="pearson")
# 0.9999845 (nrounds = 3026)

dat_ps3.lgb_test_pred = predict(dat_ps3.lgb_obj, data = dat_ps3.lgb_test_matrix)

cor(dat_ps3.lgb_test_pred, y_test, method="pearson")
# 0.5968244 (nrounds = 3026)

mean((dat_ps3.lgb_test_pred - y_test)^2)
# 0.1574803 (nrounds = 3026)
```

We get test prediction correlation of 0.5968244 and MSE of 0.1574803

```{r}
dat_ps3.feature_importance = as.data.frame(lgb.importance(dat_ps3.lgb_obj)) %>%
  mutate(Feature = fct_rev(fct_inorder(Feature))) %>%
  dplyr::slice(1:50) %>%
  ggplot(aes(x = Feature, y = Gain)) +
  geom_col(fill = "dodgerblue") +
  coord_flip() +
  theme_bw()
dat_ps3.feature_importance
```



# Inputs: Counts of nucleotides

```{r}
nucleotides <- c("A", "C", "G", "T")
```

```{r}
dat_mono = dat%>%
  select(all_of(nucleotides), C0_new)

mono = lm(C0_new~., data=dat_mono)
cor(mono$fitted.values, dat_mono$C0_new)
# 0.04273139

dat_test_mono = dat_test%>%
  select(all_of(nucleotides), C0_new)
mono_pred = predict(mono, dat_test_mono)

cor(mono_pred, dat_test_mono$C0_new)
# 0.02784285

mean((mono_pred - dat_test_mono$C0_new)^2)
# 0.2408731
```

We get test prediction correlation of 0.02784285 and MSE of 0.2408731


# Inputs: Counts of dinucleotides

```{r}
nucleotides <- c("A", "C", "G", "T")
dinucleotides <- gtools::permutations(n = 4, r = 2, v = nucleotides,
                                      repeats.allowed = TRUE) %>%
  apply(1, paste, collapse = "")
```

## Simple Linear Model

```{r}
dat_di = dat%>%
  select(all_of(dinucleotides), C0_new)

di = lm(C0_new~., data=dat_di)
cor(di$fitted.values, dat_di$C0_new)
# 0.3340565

dat_test_di = dat_test%>%
  select(all_of(dinucleotides), C0_new)
di_pred = predict(di, dat_test_di)

cor(di_pred, dat_test_di$C0_new)
# 0.3395826

mean((di_pred - dat_test_di$C0_new)^2)
# 0.2132197
```

We get test prediction correlation of 0.3395826 and MSE of 0.2132197

## LightGBM (tree-based) Model

```{r}
library(lightgbm)
source("scripts/functions/lgbm-helper-functions.R")
set.seed(50)
dat_di.lgb_train_set = dat_di %>%
  select(-C0_new)
dat_di.lgb_train_rules = lgb.convert_with_rules(data = dat_di.lgb_train_set)
dat_di.lgb_train_data = lgb.Dataset(data = as.matrix(dat_di.lgb_train_rules$data),
                                    label = dat_di$C0_new,
                                    categorical_feature = handle_categorical(colnames(dat_di.lgb_train_rules$data)))
dat_di.lgb_test_set = dat_test_di %>%
  select(-C0_new)
dat_di.lgb_test_matrix = as.matrix(lgb.convert_with_rules(data = dat_di.lgb_test_set, rules = dat_di.lgb_train_rules$rules)$data)
dat_di.lgb_test_data = lgb.Dataset(data = dat_di.lgb_test_matrix,
                                   label = dat_test_di$C0_new,
                                   categorical_feature = handle_categorical(colnames(dat_di.lgb_test_matrix)))
dat_di.lgb_obj = lightgbm(data = dat_di.lgb_train_data,
                          params = list(learning_rate = c(0.1),
                                        objective = c("regression"),
                                        min_data_in_leaf = 100,
                                        max_depth = c(5),
                                        num_leaves = c(1000),
                                        lambda_l2 = c(1),
                                        boosting = c("gbdt")),
                          valids = list(valid = dat_di.lgb_test_data),
                          nrounds = 4000,
                          early_stopping_rounds = 50)

dat_di.lgb_train_pred = predict(dat_di.lgb_obj, data = as.matrix(dat_di.lgb_train_rules$data))
cor(dat_di.lgb_train_pred, y, method="pearson")
# 0.4578734 (nrounds = 404)

dat_di.lgb_test_pred = predict(dat_di.lgb_obj, data = dat_di.lgb_test_matrix)

cor(dat_di.lgb_test_pred, y_test, method="pearson")
# 0.3722143 (nrounds = 404)

mean((dat_di.lgb_test_pred - y_test)^2)
# 0.2076723 (nrounds = 404)
```

We get test prediction correlation of 0.3722143 and MSE of 0.2076723

```{r}
dat_di.feature_importance = as.data.frame(lgb.importance(dat_di.lgb_obj)) %>%
  mutate(Feature = fct_rev(fct_inorder(Feature))) %>%
  dplyr::slice(1:50) %>%
  ggplot(aes(x = Feature, y = Gain)) +
  geom_col(fill = "dodgerblue") +
  coord_flip() +
  theme_bw()
dat_di.feature_importance
```


# Inputs: Counts of trinucleotides

```{r}
nucleotides <- c("A", "C", "G", "T")
dinucleotides <- gtools::permutations(n = 4, r = 2, v = nucleotides,
                                      repeats.allowed = TRUE) %>%
  apply(1, paste, collapse = "")
trinucleotides <- gtools::permutations(n = 4, r = 3, v = nucleotides,
                                       repeats.allowed = TRUE) %>%
  apply(1, paste, collapse = "")
```

## Simple Linear Model

```{r}
dat_tri = dat%>%
  select(all_of(trinucleotides), C0_new)

tri = lm(C0_new~., data=dat_tri)
cor(tri$fitted.values, dat_tri$C0_new)
# 0.362168

dat_test_tri = dat_test%>%
  select(all_of(trinucleotides), C0_new)
tri_pred = predict(tri, dat_test_tri)

cor(tri_pred, dat_test_tri$C0_new)
# 0.3632816

mean((tri_pred - dat_test_tri$C0_new)^2)
# 0.2092263
```

We get test prediction correlation of 0.3632816 and MSE of 0.2092263

## LightGBM (tree-based) Model

```{r}
library(lightgbm)
source("scripts/functions/lgbm-helper-functions.R")
set.seed(50)
dat_tri.lgb_train_set = dat_tri %>%
  select(-C0_new)
dat_tri.lgb_train_rules = lgb.convert_with_rules(data = dat_tri.lgb_train_set)
dat_tri.lgb_train_data = lgb.Dataset(data = as.matrix(dat_tri.lgb_train_rules$data),
                                     label = dat_tri$C0_new,
                                     categorical_feature = handle_categorical(colnames(dat_tri.lgb_train_rules$data)))
dat_tri.lgb_test_set = dat_test_tri %>%
  select(-C0_new)
dat_tri.lgb_test_matrix = as.matrix(lgb.convert_with_rules(data = dat_tri.lgb_test_set, rules = dat_tri.lgb_train_rules$rules)$data)
dat_tri.lgb_test_data = lgb.Dataset(data = dat_tri.lgb_test_matrix,
                                    label = dat_test_tri$C0_new,
                                    categorical_feature = handle_categorical(colnames(dat_tri.lgb_test_matrix)))
dat_tri.lgb_obj = lightgbm(data = dat_tri.lgb_train_data,
                           params = list(learning_rate = c(0.1),
                                         objective = c("regression"),
                                         min_data_in_leaf = 100,
                                         max_depth = c(5),
                                         num_leaves = c(1000),
                                         lambda_l2 = c(1),
                                         boosting = c("gbdt")),
                           valids = list(valid = dat_tri.lgb_test_data),
                           nrounds = 4000,
                           early_stopping_rounds = 50)

dat_tri.lgb_train_pred = predict(dat_tri.lgb_obj, data = as.matrix(dat_tri.lgb_train_rules$data))
cor(dat_tri.lgb_train_pred, y, method="pearson")
# 0.8119311 (nrounds = 3761)

dat_tri.lgb_test_pred = predict(dat_tri.lgb_obj, data = dat_tri.lgb_test_matrix)

cor(dat_tri.lgb_test_pred, y_test, method="pearson")
# 0.5426888 (nrounds = 3761)

mean((dat_tri.lgb_test_pred - y_test)^2)
# 0.170055 (nrounds = 3761)
```

We get test prediction correlation of 0.5426888 and MSE of 0.170055

```{r}
dat_tri.feature_importance = as.data.frame(lgb.importance(dat_tri.lgb_obj)) %>%
  mutate(Feature = fct_rev(fct_inorder(Feature))) %>%
  dplyr::slice(1:50) %>%
  ggplot(aes(x = Feature, y = Gain)) +
  geom_col(fill = "dodgerblue") +
  coord_flip() +
  theme_bw()
dat_tri.feature_importance
```


# Inputs: Counts of di/trinucleotides

```{r}
nucleotides <- c("A", "C", "G", "T")
dinucleotides <- gtools::permutations(n = 4, r = 2, v = nucleotides,
                                      repeats.allowed = TRUE) %>%
  apply(1, paste, collapse = "")
trinucleotides <- gtools::permutations(n = 4, r = 3, v = nucleotides,
                                       repeats.allowed = TRUE) %>%
  apply(1, paste, collapse = "")
```

```{r}
dat_dtri = dat%>%
  select(all_of(dinucleotides), all_of(trinucleotides), C0_new)

dtri = lm(C0_new~., data=dat_dtri)
cor(dtri$fitted.values, y)
# 0.363766

dat_test_dtri = dat_test%>%
  select(all_of(dinucleotides), all_of(trinucleotides), C0_new)
dtri_pred = predict(dtri, dat_test_dtri)

cor(dtri_pred, dat_test_dtri$C0_new)
# 0.3631282

mean((dtri_pred - dat_test_dtri$C0_new)^2)
# 0.2092592
```

We get test prediction correlation of 0.3631282 and MSE of 0.2092592


# Inputs: Counts of nucleotides and di/trinucleotides

```{r}
nucleotides <- c("A", "C", "G", "T")
dinucleotides <- gtools::permutations(n = 4, r = 2, v = nucleotides,
                                      repeats.allowed = TRUE) %>%
  apply(1, paste, collapse = "")
trinucleotides <- gtools::permutations(n = 4, r = 3, v = nucleotides,
                                       repeats.allowed = TRUE) %>%
  apply(1, paste, collapse = "")
```

```{r}
dat_mdtri = dat%>%
  select(all_of(nucleotides), all_of(dinucleotides), all_of(trinucleotides), C0_new)

mdtri = lm(C0_new~., data=dat_mdtri)
cor(mdtri$fitted.values, y)
# 0.363766

dat_test_mdtri = dat_test%>%
  select(all_of(nucleotides), all_of(dinucleotides), all_of(trinucleotides), C0_new)
mdtri_pred = predict(mdtri, dat_test_mdtri)

cor(mdtri_pred, dat_test_mdtri$C0_new)
# 0.3631282

mean((mdtri_pred - dat_test_mdtri$C0_new)^2)
# 0.2092592
```

We get test prediction correlation of 0.3631282 and MSE of 0.2092592

# Inputs: Position Specific Nucleotides and Tri/Tetra/Pentanucleotides + Counts of nucleotides and di/trinucleotides + Markov Ratio

```{r}
library(Matrix)
library(glmnet)
ps1 <- paste0("X", 1:50, "mono")
ps3 <- paste0("X", 1:48, "tri")
ps4 <- paste0("X", 1:47, "tetra")
ps5 <- paste0("X", 1:46, "penta")
nucleotides <- c("A", "C", "G", "T")
dinucleotides <- gtools::permutations(n = 4, r = 2, v = nucleotides,
                                      repeats.allowed = TRUE) %>%
  apply(1, paste, collapse = "")
trinucleotides <- gtools::permutations(n = 4, r = 3, v = nucleotides,
                                       repeats.allowed = TRUE) %>%
  apply(1, paste, collapse = "")
```

## No interaction terms

```{r}
model_cols_no_int_inc_ratio_all_ps.1 <- c(ps1, ps3, ps4, ps5, nucleotides, dinucleotides, 
                                          trinucleotides, "ratio_score_2nd")
X_no_int_inc_ratio_all_ps.1 = dat %>%
  select(all_of(model_cols_no_int_inc_ratio_all_ps.1))

x_no_int_inc_ratio_all_ps.1 = sparse.model.matrix(~., data=X_no_int_inc_ratio_all_ps.1)

set.seed(50)
la.model_no_int_inc_ratio_all_ps.1 = cv.glmnet(x_no_int_inc_ratio_all_ps.1, y,
                                               alpha=1, family="gaussian")

la.no_int_inc_ratio_all_ps_best_lambda.1 = la.model_no_int_inc_ratio_all_ps.1$lambda.min
la.no_int_inc_ratio_all_ps_best_lambda.1

la.model_no_int_inc_ratio_all_ps.train_pred.1 = predict(la.model_no_int_inc_ratio_all_ps.1, 
                                                        newx = x_no_int_inc_ratio_all_ps.1, 
                                                        s=la.no_int_inc_ratio_all_ps_best_lambda.1)

cor(la.model_no_int_inc_ratio_all_ps.train_pred.1, y, method="pearson")
# 0.4730046
mean((la.model_no_int_inc_ratio_all_ps.train_pred.1 - y)^2)
# 0.1891091

# Prepare test data:
X_no_int_inc_ratio_all_ps_test.1 = dat_test %>%
  select(all_of(model_cols_no_int_inc_ratio_all_ps.1))

x_no_int_inc_ratio_all_ps_test.1 = sparse.model.matrix(~., data=X_no_int_inc_ratio_all_ps_test.1)

# Predict values for test dataset:
la.model_no_int_inc_ratio_all_ps.pred.1 = predict(la.model_no_int_inc_ratio_all_ps.1, 
                                                  newx = x_no_int_inc_ratio_all_ps_test.1,
                                                  s=la.no_int_inc_ratio_all_ps_best_lambda.1)

cor(la.model_no_int_inc_ratio_all_ps.pred.1, y_test, method="pearson")
# 0.5305865
mean((la.model_no_int_inc_ratio_all_ps.pred.1 - y_test)^2)
# 0.175821
```

We get test prediction correlation of 0.5305865 and MSE of 0.175821 with lasso

## Include interaction terms for position specific nucleotides

```{r}
model_cols_all_int_inc_ratio_all_ps.1 <- c(ps1, ps3, ps4, ps5, nucleotides, dinucleotides, 
                                           trinucleotides, "ratio_score_2nd")
X_all_int_inc_ratio_all_ps.1 = dat %>%
  select(all_of(model_cols_all_int_inc_ratio_all_ps.1))

f_all_int_inc_ratio_all_ps.1 <- as.formula(paste0("~(", paste(ps1, collapse = " + "), 
                                                  ")^2 + (. - ", paste(ps1, collapse = " - "), ")"))
x_all_int_inc_ratio_all_ps.1 = sparse.model.matrix(f_all_int_inc_ratio_all_ps.1, 
                                                   data=X_all_int_inc_ratio_all_ps.1)

set.seed(50)
la.model_all_int_inc_ratio_all_ps.1 = cv.glmnet(x_all_int_inc_ratio_all_ps.1, y,
                                                alpha=1, family="gaussian")

la.all_int_inc_ratio_all_ps_best_lambda.1 = la.model_all_int_inc_ratio_all_ps.1$lambda.min
la.all_int_inc_ratio_all_ps_best_lambda.1

la.model_all_int_inc_ratio_all_ps.train_pred.1 = predict(la.model_all_int_inc_ratio_all_ps.1, 
                                                         newx = x_all_int_inc_ratio_all_ps.1, 
                                                         s=la.all_int_inc_ratio_all_ps_best_lambda.1)

cor(la.model_all_int_inc_ratio_all_ps.train_pred.1, y, method="pearson")
# 0.6991822 (slight improvement from 0.692659)
mean((la.model_all_int_inc_ratio_all_ps.train_pred.1 - y)^2)
# 0.1314707

# Prepare test data:
X_all_int_inc_ratio_all_ps_test.1 = dat_test %>%
  select(all_of(model_cols_all_int_inc_ratio_all_ps.1))

x_all_int_inc_ratio_all_ps_test.1 = sparse.model.matrix(f_all_int_inc_ratio_all_ps.1, data=X_all_int_inc_ratio_all_ps_test.1)

# Predict values for test dataset:
la.model_all_int_inc_ratio_all_ps.pred.1 = predict(la.model_all_int_inc_ratio_all_ps.1, 
                                                   newx = x_all_int_inc_ratio_all_ps_test.1,
                                                   s=la.all_int_inc_ratio_all_ps_best_lambda.1)

cor(la.model_all_int_inc_ratio_all_ps.pred.1, y_test, method="pearson")
# 0.6015859 (slight improvement from  0.5943428)
mean((la.model_all_int_inc_ratio_all_ps.pred.1 - y_test)^2)
# 0.1576486
```

We get test prediction correlation of 0.6015859 and MSE of 0.1576486 with lasso


# Inputs: Fourier Features Based on A/T Nucleotides Calculated from scratch

```{r}
library(Matrix)
library(glmnet)
Xone_AT_fourier_cos = readRDS("data/Created/tiling_Xone_AT_fourier_cos.rds")
Xone_AT_fourier_sin = readRDS("data/Created/tiling_Xone_AT_fourier_sin.rds")
Xone_AT_fourier_cos_test = readRDS("data/Created/tiling_Xone_AT_fourier_cos_test.rds")
Xone_AT_fourier_sin_test = readRDS("data/Created/tiling_Xone_AT_fourier_sin_test.rds")
```

## Raw Fourier features

```{r}
X_fourier.2 = bind_cols(Xone_AT_fourier_cos, Xone_AT_fourier_sin)
x_fourier.2 = sparse.model.matrix(~ ., data=X_fourier.2)

set.seed(50)
la.model_fourier.2 = cv.glmnet(x_fourier.2, y, alpha=1, family="gaussian")
ri.model_fourier.2 = cv.glmnet(x_fourier.2, y, alpha=0, family="gaussian")

la.fourier_best_lambda.2 = la.model_fourier.2$lambda.min
la.fourier_best_lambda.2
ri.fourier_best_lambda.2 = ri.model_fourier.2$lambda.min
ri.fourier_best_lambda.2

la.model_fourier.train_pred.2 = predict(la.model_fourier.2, 
                                        newx = x_fourier.2, 
                                        s=la.fourier_best_lambda.2)
ri.model_fourier.train_pred.2 = predict(ri.model_fourier.2, 
                                        newx = x_fourier.2, 
                                        s=ri.fourier_best_lambda.2)

cor(la.model_fourier.train_pred.2, y, method="pearson")
# 0.1146785
mean((la.model_fourier.train_pred.2 - y)^2)
# 0.2391771

cor(ri.model_fourier.train_pred.2, y, method="pearson")
# 0.1155312
mean((ri.model_fourier.train_pred.2 - y)^2)
# 0.2391184

X_fourier_test.2 = bind_cols(Xone_AT_fourier_cos_test, Xone_AT_fourier_sin_test)
x_fourier_test.2 = sparse.model.matrix(~., data=X_fourier_test.2)

la.model_fourier.pred.2 = predict(la.model_fourier.2, 
                                  newx = x_fourier_test.2, 
                                  s=la.fourier_best_lambda.2)
ri.model_fourier.pred.2 = predict(ri.model_fourier.2, 
                                  newx = x_fourier_test.2, 
                                  s=ri.fourier_best_lambda.2)

cor(la.model_fourier.pred.2, y_test, method="pearson")
# 0.1162562
mean((la.model_fourier.pred.2 - y_test)^2)
# 0.2377697
cor(ri.model_fourier.pred.2, y_test, method="pearson")
# 0.1188419
mean((ri.model_fourier.pred.2 - y_test)^2)
# 0.2376161
```

We get test prediction correlation of 0.1162562 and MSE of 0.2377697 with lasso
We get test prediction correlation of 0.1188419 and MSE of 0.2376161 with ridge

## Absolute value of Fourier features

```{r}
X_fourier_abs.1 = bind_cols(abs(Xone_AT_fourier_cos), abs(Xone_AT_fourier_sin))
x_fourier_abs.1 = sparse.model.matrix(~ ., data=X_fourier_abs.1)

set.seed(50)
la.model_fourier_abs.1 = cv.glmnet(x_fourier_abs.1, y, alpha=1, family="gaussian")
ri.model_fourier_abs.1 = cv.glmnet(x_fourier_abs.1, y, alpha=0, family="gaussian")

la.fourier_abs_best_lambda.1 = la.model_fourier_abs.1$lambda.min
la.fourier_abs_best_lambda.1
ri.fourier_abs_best_lambda.1 = ri.model_fourier_abs.1$lambda.min
ri.fourier_abs_best_lambda.1

la.model_fourier_abs.train_pred.1 = predict(la.model_fourier_abs.1, 
                                            newx = x_fourier_abs.1, 
                                            s=la.fourier_abs_best_lambda.1)
ri.model_fourier_abs.train_pred.1 = predict(ri.model_fourier_abs.1, 
                                            newx = x_fourier_abs.1, 
                                            s=ri.fourier_abs_best_lambda.1)

cor(la.model_fourier_abs.train_pred.1, y, method="pearson")
# 0.4084353
mean((la.model_fourier_abs.train_pred.1 - y)^2)
# 0.2019211

cor(ri.model_fourier_abs.train_pred.1, y, method="pearson")
# 0.4085696
mean((ri.model_fourier_abs.train_pred.1 - y)^2)
# 0.2019028

X_fourier_abs_test.1 = bind_cols(abs(Xone_AT_fourier_cos_test), abs(Xone_AT_fourier_sin_test))
x_fourier_abs_test.1 = sparse.model.matrix(~., data=X_fourier_abs_test.1)

la.model_fourier_abs.pred.1 = predict(la.model_fourier_abs.1, 
                                      newx = x_fourier_abs_test.1, 
                                      s=la.fourier_abs_best_lambda.1)
ri.model_fourier_abs.pred.1 = predict(ri.model_fourier_abs.1, 
                                      newx = x_fourier_abs_test.1, 
                                      s=ri.fourier_abs_best_lambda.1)

cor(la.model_fourier_abs.pred.1, y_test, method="pearson")
# 0.40332
mean((la.model_fourier_abs.pred.1 - y_test)^2)
# 0.2018051
cor(ri.model_fourier_abs.pred.1, y_test, method="pearson")
# 0.4035686
mean((ri.model_fourier_abs.pred.1 - y_test)^2)
# 0.201757
```

We get test prediction correlation of 0.40332 and MSE of 0.2018051 with lasso
We get test prediction correlation of 0.4035686 and MSE of 0.201757 with ridge

## Squared value of Fourier features

```{r}
X_fourier_sq.1 = bind_cols(Xone_AT_fourier_cos^2, Xone_AT_fourier_sin^2)
x_fourier_sq.1 = sparse.model.matrix(~ ., data=X_fourier_sq.1)

set.seed(50)
la.model_fourier_sq.1 = cv.glmnet(x_fourier_sq.1, y, alpha=1, family="gaussian")
ri.model_fourier_sq.1 = cv.glmnet(x_fourier_sq.1, y, alpha=0, family="gaussian")

la.fourier_sq_best_lambda.1 = la.model_fourier_sq.1$lambda.min
la.fourier_sq_best_lambda.1
ri.fourier_sq_best_lambda.1 = ri.model_fourier_sq.1$lambda.min
ri.fourier_sq_best_lambda.1

la.model_fourier_sq.train_pred.1 = predict(la.model_fourier_sq.1, 
                                           newx = x_fourier_sq.1, 
                                           s=la.fourier_sq_best_lambda.1)
ri.model_fourier_sq.train_pred.1 = predict(ri.model_fourier_sq.1, 
                                           newx = x_fourier_sq.1, 
                                           s=ri.fourier_sq_best_lambda.1)

cor(la.model_fourier_sq.train_pred.1, y, method="pearson")
# 0.4234747
mean((la.model_fourier_sq.train_pred.1 - y)^2)
# 0.1988889
cor(ri.model_fourier_sq.train_pred.1, y, method="pearson")
# 0.4235729
mean((ri.model_fourier_sq.train_pred.1 - y)^2)
# 0.1988786

X_fourier_sq_test.1 = bind_cols(Xone_AT_fourier_cos_test^2, Xone_AT_fourier_sin_test^2)
x_fourier_sq_test.1 = sparse.model.matrix(~., data=X_fourier_sq_test.1)

la.model_fourier_sq.pred.1 = predict(la.model_fourier_sq.1, 
                                     newx = x_fourier_sq_test.1, 
                                     s=la.fourier_sq_best_lambda.1)
ri.model_fourier_sq.pred.1 = predict(ri.model_fourier_sq.1, 
                                     newx = x_fourier_sq_test.1, 
                                     s=ri.fourier_sq_best_lambda.1)

cor(la.model_fourier_sq.pred.1, y_test, method="pearson")
# 0.4201116
mean((la.model_fourier_sq.pred.1 - y_test)^2)
# 0.1984746
cor(ri.model_fourier_sq.pred.1, y_test, method="pearson")
# 0.4202228
mean((ri.model_fourier_sq.pred.1 - y_test)^2)
# 0.1984632
```

We get test prediction correlation of 0.4201116 and MSE of 0.1984746 with lasso
We get test prediction correlation of 0.4202228 and MSE of 0.1984632 with ridge

# Inputs: Fourier Features Based on A/T Nucleotides Calculated using fft

```{r}
library(Matrix)
library(glmnet)
Xone_AorT_fourier_cos = readRDS("data/Created/tiling_Xone_AorT_fourier_cos.rds")
Xone_AorT_fourier_sin = readRDS("data/Created/tiling_Xone_AorT_fourier_sin.rds")
Xone_AorT_fourier_cos_test = readRDS("data/Created/tiling_Xone_AorT_fourier_cos_test.rds")
Xone_AorT_fourier_sin_test = readRDS("data/Created/tiling_Xone_AorT_fourier_sin_test.rds")
```


## Raw Fourier features

```{r}
X_fourier.3 = bind_cols(Xone_AorT_fourier_cos, Xone_AorT_fourier_sin)
x_fourier.3 = sparse.model.matrix(~ ., data=X_fourier.3)

set.seed(50)
la.model_fourier.3 = cv.glmnet(x_fourier.3, y, alpha=1, family="gaussian")
ri.model_fourier.3 = cv.glmnet(x_fourier.3, y, alpha=0, family="gaussian")

la.fourier_best_lambda.3 = la.model_fourier.3$lambda.min
la.fourier_best_lambda.3
ri.fourier_best_lambda.3 = ri.model_fourier.3$lambda.min
ri.fourier_best_lambda.3

la.model_fourier.train_pred.3 = predict(la.model_fourier.3, 
                                        newx = x_fourier.3, 
                                        s=la.fourier_best_lambda.3)
ri.model_fourier.train_pred.3 = predict(ri.model_fourier.3, 
                                        newx = x_fourier.3, 
                                        s=ri.fourier_best_lambda.3)

cor(la.model_fourier.train_pred.3, y, method="pearson")
# 0.1146784
mean((la.model_fourier.train_pred.3 - y)^2)
# 0.2391771

cor(ri.model_fourier.train_pred.3, y, method="pearson")
# 0.1155244
mean((ri.model_fourier.train_pred.3 - y)^2)
# 0.2391197

X_fourier_test.3 = bind_cols(Xone_AorT_fourier_cos_test, Xone_AorT_fourier_sin_test)
x_fourier_test.3 = sparse.model.matrix(~., data=X_fourier_test.3)

la.model_fourier.pred.3 = predict(la.model_fourier.3, 
                                  newx = x_fourier_test.3, 
                                  s=la.fourier_best_lambda.3)
ri.model_fourier.pred.3 = predict(ri.model_fourier.3, 
                                  newx = x_fourier_test.3, 
                                  s=ri.fourier_best_lambda.3)

cor(la.model_fourier.pred.3, y_test, method="pearson")
# 0.1162559
mean((la.model_fourier.pred.3 - y_test)^2)
# 0.2377697
cor(ri.model_fourier.pred.3, y_test, method="pearson")
# 0.1185719
mean((ri.model_fourier.pred.3 - y_test)^2)
# 0.2376319
```

We get test prediction correlation of 0.1162559 and MSE of 0.2377697 with lasso
We get test prediction correlation of 0.1185719 and MSE of 0.2376319 with ridge

## Absolute value of Fourier features

```{r}
X_fourier_abs.2 = bind_cols(abs(Xone_AorT_fourier_cos), abs(Xone_AorT_fourier_sin))
x_fourier_abs.2 = sparse.model.matrix(~ ., data=X_fourier_abs.2)

set.seed(50)
la.model_fourier_abs.2 = cv.glmnet(x_fourier_abs.2, y, alpha=1, family="gaussian")
ri.model_fourier_abs.2 = cv.glmnet(x_fourier_abs.2, y, alpha=0, family="gaussian")

la.fourier_best_lambda_abs.2 = la.model_fourier_abs.2$lambda.min
la.fourier_best_lambda_abs.2
ri.fourier_best_lambda_abs.2 = ri.model_fourier_abs.2$lambda.min
ri.fourier_best_lambda_abs.2

la.model_fourier.train_pred_abs.2 = predict(la.model_fourier_abs.2, 
                                            newx = x_fourier_abs.2, 
                                            s=la.fourier_best_lambda_abs.2)
ri.model_fourier.train_pred_abs.2 = predict(ri.model_fourier_abs.2, 
                                            newx = x_fourier_abs.2, 
                                            s=ri.fourier_best_lambda_abs.2)

cor(la.model_fourier.train_pred_abs.2, y, method="pearson")
# 0.4084006
mean((la.model_fourier.train_pred_abs.2 - y)^2)
# 0.201928

cor(ri.model_fourier.train_pred_abs.2, y, method="pearson")
# 0.4085217
mean((ri.model_fourier.train_pred_abs.2 - y)^2)
# 0.2019438

X_fourier_test_abs.2 = bind_cols(abs(Xone_AorT_fourier_cos_test), abs(Xone_AorT_fourier_sin_test))
x_fourier_test_abs.2 = sparse.model.matrix(~., data=X_fourier_test_abs.2)

la.model_fourier.pred_abs.2 = predict(la.model_fourier_abs.2, 
                                      newx = x_fourier_test_abs.2, 
                                      s=la.fourier_best_lambda_abs.2)
ri.model_fourier.pred_abs.2 = predict(ri.model_fourier_abs.2, 
                                      newx = x_fourier_test_abs.2, 
                                      s=ri.fourier_best_lambda_abs.2)

cor(la.model_fourier.pred_abs.2, y_test, method="pearson")
# 0.4032428
mean((la.model_fourier.pred_abs.2 - y_test)^2)
# 0.2018203
cor(ri.model_fourier.pred_abs.2, y_test, method="pearson")
# 0.4035022
mean((ri.model_fourier.pred_abs.2 - y_test)^2)
# 0.2017867
```

We get test prediction correlation of 0.4032428 and MSE of 0.2018203 with lasso
We get test prediction correlation of 0.4035022 and MSE of 0.2017867 with ridge

## Squared value of Fourier features

```{r}
X_fourier_sq.2 = bind_cols((Xone_AorT_fourier_cos)^2, (Xone_AorT_fourier_sin)^2)
x_fourier_sq.2 = sparse.model.matrix(~ ., data=X_fourier_sq.2)

set.seed(50)
la.model_fourier_sq.2 = cv.glmnet(x_fourier_sq.2, y, alpha=1, family="gaussian")
ri.model_fourier_sq.2 = cv.glmnet(x_fourier_sq.2, y, alpha=0, family="gaussian")

la.fourier_best_lambda_sq.2 = la.model_fourier_sq.2$lambda.min
la.fourier_best_lambda_sq.2
ri.fourier_best_lambda_sq.2 = ri.model_fourier_sq.2$lambda.min
ri.fourier_best_lambda_sq.2

la.model_fourier.train_pred_sq.2 = predict(la.model_fourier_sq.2, 
                                           newx = x_fourier_sq.2, 
                                           s=la.fourier_best_lambda_sq.2)
ri.model_fourier.train_pred_sq.2 = predict(ri.model_fourier_sq.2, 
                                           newx = x_fourier_sq.2, 
                                           s=ri.fourier_best_lambda_sq.2)

cor(la.model_fourier.train_pred_sq.2, y, method="pearson")
# 0.423428
mean((la.model_fourier.train_pred_sq.2 - y)^2)
# 0.1988985

cor(ri.model_fourier.train_pred_sq.2, y, method="pearson")
# 0.4235019
mean((ri.model_fourier.train_pred_sq.2 - y)^2)
# 0.1989283

X_fourier_test_sq.2 = bind_cols((Xone_AorT_fourier_cos_test)^2, (Xone_AorT_fourier_sin_test)^2)
x_fourier_test_sq.2 = sparse.model.matrix(~., data=X_fourier_test_sq.2)

la.model_fourier.pred_sq.2 = predict(la.model_fourier_sq.2, 
                                     newx = x_fourier_test_sq.2, 
                                     s=la.fourier_best_lambda_sq.2)
ri.model_fourier.pred_sq.2 = predict(ri.model_fourier_sq.2, 
                                     newx = x_fourier_test_sq.2, 
                                     s=ri.fourier_best_lambda_sq.2)

cor(la.model_fourier.pred_sq.2, y_test, method="pearson")
# 0.41997
mean((la.model_fourier.pred_sq.2 - y_test)^2)
# 0.1985032
cor(ri.model_fourier.pred_sq.2, y_test, method="pearson")
# 0.4200214
mean((ri.model_fourier.pred_sq.2 - y_test)^2)
# 0.1985405
```

We get test prediction correlation of 0.41997 and MSE of 0.1985032 with lasso
We get test prediction correlation of 0.4200214 and MSE of 0.1985405 with ridge



# Inputs: Fourier Features Based on AA/TT/AT/TA Dinucleotides Calculated from scratch

```{r}
library(Matrix)
library(glmnet)
Xtwo_AT_fourier_cos = readRDS("data/Created/tiling_Xtwo_AT_fourier_cos.rds")
Xtwo_AT_fourier_sin = readRDS("data/Created/tiling_Xtwo_AT_fourier_sin.rds")
Xtwo_AT_fourier_cos_test = readRDS("data/Created/tiling_Xtwo_AT_fourier_cos_test.rds")
Xtwo_AT_fourier_sin_test = readRDS("data/Created/tiling_Xtwo_AT_fourier_sin_test.rds")
```


## Raw Fourier features

```{r}
X_fourier2.2 = bind_cols(Xtwo_AT_fourier_cos, Xtwo_AT_fourier_sin)
x_fourier2.2 = sparse.model.matrix(~ ., data=X_fourier2.2)

set.seed(50)
la.model_fourier2.2 = cv.glmnet(x_fourier2.2, y, alpha=1, family="gaussian")
ri.model_fourier2.2 = cv.glmnet(x_fourier2.2, y, alpha=0, family="gaussian")

la.fourier2_best_lambda.2 = la.model_fourier2.2$lambda.min
la.fourier2_best_lambda.2
ri.fourier2_best_lambda.2 = ri.model_fourier2.2$lambda.min
ri.fourier2_best_lambda.2

la.model_fourier2.train_pred.2 = predict(la.model_fourier2.2, 
                                         newx = x_fourier2.2, 
                                         s=la.fourier2_best_lambda.2)
ri.model_fourier2.train_pred.2 = predict(ri.model_fourier2.2, 
                                         newx = x_fourier2.2, 
                                         s=ri.fourier2_best_lambda.2)

cor(la.model_fourier2.train_pred.2, y, method="pearson")
# 0.110074
mean((la.model_fourier2.train_pred.2 - y)^2)
# 0.2394296
cor(ri.model_fourier2.train_pred.2, y, method="pearson")
# 0.1115613
mean((ri.model_fourier2.train_pred.2 - y)^2)
# 0.239333

X_fourier2_test.2 = bind_cols(Xtwo_AT_fourier_cos_test, Xtwo_AT_fourier_sin_test)
x_fourier2_test.2 = sparse.model.matrix(~., data=X_fourier2_test.2)

la.model_fourier2.pred.2 = predict(la.model_fourier2.2, 
                                   newx = x_fourier2_test.2, 
                                   s=la.fourier2_best_lambda.2)
ri.model_fourier2.pred.2 = predict(ri.model_fourier2.2, 
                                   newx = x_fourier2_test.2, 
                                   s=ri.fourier2_best_lambda.2)

cor(la.model_fourier2.pred.2, y_test, method="pearson")
# 0.1124897
mean((la.model_fourier2.pred.2 - y_test)^2)
# 0.2379841
cor(ri.model_fourier2.pred.2, y_test, method="pearson")
# 0.1119977
mean((ri.model_fourier2.pred.2 - y_test)^2)
# 0.2379848
```

We get test prediction correlation of 0.1124897 and MSE of 0.2379841 with lasso
We get test prediction correlation of 0.1119977 and MSE of 0.2379848 with ridge



## Absolute value of Fourier features

```{r}
X_fourier2_abs.1 = bind_cols(abs(Xtwo_AT_fourier_cos), abs(Xtwo_AT_fourier_sin))
x_fourier2_abs.1 = sparse.model.matrix(~ ., data=X_fourier2_abs.1)

set.seed(50)
la.model_fourier2_abs.1 = cv.glmnet(x_fourier2_abs.1, y, alpha=1, family="gaussian")
ri.model_fourier2_abs.1 = cv.glmnet(x_fourier2_abs.1, y, alpha=0, family="gaussian")

la.fourier2_abs_best_lambda.1 = la.model_fourier2_abs.1$lambda.min
la.fourier2_abs_best_lambda.1
ri.fourier2_abs_best_lambda.1 = ri.model_fourier2_abs.1$lambda.min
ri.fourier2_abs_best_lambda.1

la.model_fourier2_abs.train_pred.1 = predict(la.model_fourier2_abs.1, 
                                             newx = x_fourier2_abs.1, 
                                             s=la.fourier2_abs_best_lambda.1)
ri.model_fourier2_abs.train_pred.1 = predict(ri.model_fourier2_abs.1, 
                                             newx = x_fourier2_abs.1, 
                                             s=ri.fourier2_abs_best_lambda.1)

cor(la.model_fourier2_abs.train_pred.1, y, method="pearson")
# 0.4061569
mean((la.model_fourier2_abs.train_pred.1 - y)^2)
# 0.2023689
cor(ri.model_fourier2_abs.train_pred.1, y, method="pearson")
# 0.4061795
mean((ri.model_fourier2_abs.train_pred.1 - y)^2)
# 0.2023737

X_fourier2_abs_test.1 = bind_cols(abs(Xtwo_AT_fourier_cos_test), abs(Xtwo_AT_fourier_sin_test))
x_fourier2_abs_test.1 = sparse.model.matrix(~., data=X_fourier2_abs_test.1)

la.model_fourier2_abs.pred.1 = predict(la.model_fourier2_abs.1, 
                                       newx = x_fourier2_abs_test.1, 
                                       s=la.fourier2_abs_best_lambda.1)
ri.model_fourier2_abs.pred.1 = predict(ri.model_fourier2_abs.1, 
                                       newx = x_fourier2_abs_test.1, 
                                       s=ri.fourier2_abs_best_lambda.1)

cor(la.model_fourier2_abs.pred.1, y_test, method="pearson")
# 0.4036736
mean((la.model_fourier2_abs.pred.1 - y_test)^2)
# 0.2017437
cor(ri.model_fourier2_abs.pred.1, y_test, method="pearson")
# 0.4037786
mean((ri.model_fourier2_abs.pred.1 - y_test)^2)
# 0.2017296
```

We get test prediction correlation of 0.4036736 and MSE of 0.2017437 with lasso
We get test prediction correlation of 0.4037786 and MSE of 0.2017296 with ridge



## Squared value of Fourier features

```{r}
X_fourier2_sq.1 = bind_cols(Xtwo_AT_fourier_cos^2, Xtwo_AT_fourier_sin^2)
x_fourier2_sq.1 = sparse.model.matrix(~ ., data=X_fourier2_sq.1)

set.seed(50)
la.model_fourier2_sq.1 = cv.glmnet(x_fourier2_sq.1, y, alpha=1, family="gaussian")
ri.model_fourier2_sq.1 = cv.glmnet(x_fourier2_sq.1, y, alpha=0, family="gaussian")

la.fourier2_sq_best_lambda.1 = la.model_fourier2_sq.1$lambda.min
la.fourier2_sq_best_lambda.1
ri.fourier2_sq_best_lambda.1 = ri.model_fourier2_sq.1$lambda.min
ri.fourier2_sq_best_lambda.1

la.model_fourier2_sq.train_pred.1 = predict(la.model_fourier2_sq.1, 
                                            newx = x_fourier2_sq.1, 
                                            s=la.fourier2_sq_best_lambda.1)
ri.model_fourier2_sq.train_pred.1 = predict(ri.model_fourier2_sq.1, 
                                            newx = x_fourier2_sq.1, 
                                            s=ri.fourier2_sq_best_lambda.1)

cor(la.model_fourier2_sq.train_pred.1, y, method="pearson")
# 0.4305025
mean((la.model_fourier2_sq.train_pred.1 - y)^2)
# 0.1974321
cor(ri.model_fourier2_sq.train_pred.1, y, method="pearson")
# 0.4305111
mean((ri.model_fourier2_sq.train_pred.1 - y)^2)
# 0.1974421

X_fourier2_sq_test.1 = bind_cols(Xtwo_AT_fourier_cos_test^2, Xtwo_AT_fourier_sin_test^2)
x_fourier2_sq_test.1 = sparse.model.matrix(~., data=X_fourier2_sq_test.1)

la.model_fourier2_sq.pred.1 = predict(la.model_fourier2_sq.1, 
                                      newx = x_fourier2_sq_test.1, 
                                      s=la.fourier2_sq_best_lambda.1)
ri.model_fourier2_sq.pred.1 = predict(ri.model_fourier2_sq.1, 
                                      newx = x_fourier2_sq_test.1, 
                                      s=ri.fourier2_sq_best_lambda.1)

cor(la.model_fourier2_sq.pred.1, y_test, method="pearson")
# 0.4287438
mean((la.model_fourier2_sq.pred.1 - y_test)^2)
# 0.1967128
cor(ri.model_fourier2_sq.pred.1, y_test, method="pearson")
# 0.4286883
mean((ri.model_fourier2_sq.pred.1 - y_test)^2)
# 0.1967455
```

We get test prediction correlation of 0.4287438 and MSE of 0.1967128 with lasso
We get test prediction correlation of 0.4286883 and MSE of 0.1967455 with ridge


# Inputs: Fourier Features Based on AA/TT/AT/TA Dinucleotides Calculated using fft

```{r}
library(Matrix)
library(glmnet)
Xtwo_AorT_fourier_cos = readRDS("data/Created/tiling_Xtwo_AorT_fourier_cos.rds")
Xtwo_AorT_fourier_sin = readRDS("data/Created/tiling_Xtwo_AorT_fourier_sin.rds")
Xtwo_AorT_fourier_cos_test = readRDS("data/Created/tiling_Xtwo_AorT_fourier_cos_test.rds")
Xtwo_AorT_fourier_sin_test = readRDS("data/Created/tiling_Xtwo_AorT_fourier_sin_test.rds")
```


## Raw Fourier features

```{r}
X_fourier2.3 = bind_cols(Xtwo_AorT_fourier_cos, Xtwo_AorT_fourier_sin)
x_fourier2.3 = sparse.model.matrix(~ ., data=X_fourier2.3)

set.seed(50)
la.model_fourier2.3 = cv.glmnet(x_fourier2.3, y, alpha=1, family="gaussian")
ri.model_fourier2.3 = cv.glmnet(x_fourier2.3, y, alpha=0, family="gaussian")

la.fourier2_best_lambda.3 = la.model_fourier2.3$lambda.min
la.fourier2_best_lambda.3
ri.fourier2_best_lambda.3 = ri.model_fourier2.3$lambda.min
ri.fourier2_best_lambda.3

la.model_fourier2.train_pred.3 = predict(la.model_fourier2.3, 
                                         newx = x_fourier2.3, 
                                         s=la.fourier2_best_lambda.3)
ri.model_fourier2.train_pred.3 = predict(ri.model_fourier2.3, 
                                         newx = x_fourier2.3, 
                                         s=ri.fourier2_best_lambda.3)

cor(la.model_fourier2.train_pred.3, y, method="pearson")
# 0.110823
mean((la.model_fourier2.train_pred.3 - y)^2)
# 0.2393868

cor(ri.model_fourier2.train_pred.3, y, method="pearson")
# 0.1116294
mean((ri.model_fourier2.train_pred.3 - y)^2)
# 0.2393356

X_fourier2_test.3 = bind_cols(Xtwo_AorT_fourier_cos_test, Xtwo_AorT_fourier_sin_test)
x_fourier2_test.3 = sparse.model.matrix(~., data=X_fourier2_test.3)

la.model_fourier2.pred.3 = predict(la.model_fourier2.3, 
                                   newx = x_fourier2_test.3, 
                                   s=la.fourier2_best_lambda.3)
ri.model_fourier2.pred.3 = predict(ri.model_fourier2.3, 
                                   newx = x_fourier2_test.3, 
                                   s=ri.fourier2_best_lambda.3)

cor(la.model_fourier2.pred.3, y_test, method="pearson")
# 0.1103641
mean((la.model_fourier2.pred.3 - y_test)^2)
# 0.2380832
cor(ri.model_fourier2.pred.3, y_test, method="pearson")
# 0.1112867
mean((ri.model_fourier2.pred.3 - y_test)^2)
# 0.2380273
```

We get test prediction correlation of 0.1103641 and MSE of 0.2380832 with lasso
We get test prediction correlation of 0.1112867 and MSE of 0.2380273 with ridge



## Absolute value of Fourier features

```{r}
X_fourier2_abs.2 = bind_cols(abs(Xtwo_AorT_fourier_cos), abs(Xtwo_AorT_fourier_sin))
x_fourier2_abs.2 = sparse.model.matrix(~ ., data=X_fourier2_abs.2)

set.seed(50)
la.model_fourier2_abs.2 = cv.glmnet(x_fourier2_abs.2, y, alpha=1, family="gaussian")
ri.model_fourier2_abs.2 = cv.glmnet(x_fourier2_abs.2, y, alpha=0, family="gaussian")

la.fourier2_best_lambda_abs.2 = la.model_fourier2_abs.2$lambda.min
la.fourier2_best_lambda_abs.2
ri.fourier2_best_lambda_abs.2 = ri.model_fourier2_abs.2$lambda.min
ri.fourier2_best_lambda_abs.2

la.model_fourier2.train_pred_abs.2 = predict(la.model_fourier2_abs.2, 
                                             newx = x_fourier2_abs.2, 
                                             s=la.fourier2_best_lambda_abs.2)
ri.model_fourier2.train_pred_abs.2 = predict(ri.model_fourier2_abs.2, 
                                             newx = x_fourier2_abs.2, 
                                             s=ri.fourier2_best_lambda_abs.2)

cor(la.model_fourier2.train_pred_abs.2, y, method="pearson")
# 0.3613794
mean((la.model_fourier2.train_pred_abs.2 - y)^2)
# 0.2106985

cor(ri.model_fourier2.train_pred_abs.2, y, method="pearson")
# 0.361372
mean((ri.model_fourier2.train_pred_abs.2 - y)^2)
# 0.2107264

X_fourier2_test_abs.2 = bind_cols(abs(Xtwo_AorT_fourier_cos_test), abs(Xtwo_AorT_fourier_sin_test))
x_fourier2_test_abs.2 = sparse.model.matrix(~., data=X_fourier2_test_abs.2)

la.model_fourier2.pred_abs.2 = predict(la.model_fourier2_abs.2, 
                                       newx = x_fourier2_test_abs.2, 
                                       s=la.fourier2_best_lambda_abs.2)
ri.model_fourier2.pred_abs.2 = predict(ri.model_fourier2_abs.2, 
                                       newx = x_fourier2_test_abs.2, 
                                       s=ri.fourier2_best_lambda_abs.2)

cor(la.model_fourier2.pred_abs.2, y_test, method="pearson")
# 0.3633861
mean((la.model_fourier2.pred_abs.2 - y_test)^2)
# 0.209195
cor(ri.model_fourier2.pred_abs.2, y_test, method="pearson")
# 0.3639682
mean((ri.model_fourier2.pred_abs.2 - y_test)^2)
# 0.209139
```

We get test prediction correlation of 0.3633861 and MSE of 0.209195 with lasso
We get test prediction correlation of 0.3639682 and MSE of 0.209139 with ridge



## Squared value of Fourier features

```{r}
X_fourier2_sq.2 = bind_cols((Xtwo_AorT_fourier_cos)^2, (Xtwo_AorT_fourier_sin)^2)
x_fourier2_sq.2 = sparse.model.matrix(~ ., data=X_fourier2_sq.2)

set.seed(50)
la.model_fourier2_sq.2 = cv.glmnet(x_fourier2_sq.2, y, alpha=1, family="gaussian")
ri.model_fourier2_sq.2 = cv.glmnet(x_fourier2_sq.2, y, alpha=0, family="gaussian")

la.fourier2_best_lambda_sq.2 = la.model_fourier2_sq.2$lambda.min
la.fourier2_best_lambda_sq.2
ri.fourier2_best_lambda_sq.2 = ri.model_fourier2_sq.2$lambda.min
ri.fourier2_best_lambda_sq.2

la.model_fourier2.train_pred_sq.2 = predict(la.model_fourier2_sq.2, 
                                            newx = x_fourier2_sq.2, 
                                            s=la.fourier2_best_lambda_sq.2)
ri.model_fourier2.train_pred_sq.2 = predict(ri.model_fourier2_sq.2, 
                                            newx = x_fourier2_sq.2, 
                                            s=ri.fourier2_best_lambda_sq.2)

cor(la.model_fourier2.train_pred_sq.2, y, method="pearson")
# 0.3837294
mean((la.model_fourier2.train_pred_sq.2 - y)^2)
# 0.2066618

cor(ri.model_fourier2.train_pred_sq.2, y, method="pearson")
# 0.383687
mean((ri.model_fourier2.train_pred_sq.2 - y)^2)
# 0.2067029

X_fourier2_test_sq.2 = bind_cols((Xtwo_AorT_fourier_cos_test)^2, (Xtwo_AorT_fourier_sin_test)^2)
x_fourier2_test_sq.2 = sparse.model.matrix(~., data=X_fourier2_test_sq.2)

la.model_fourier2.pred_sq.2 = predict(la.model_fourier2_sq.2, 
                                      newx = x_fourier2_test_sq.2, 
                                      s=la.fourier2_best_lambda_sq.2)
ri.model_fourier2.pred_sq.2 = predict(ri.model_fourier2_sq.2, 
                                      newx = x_fourier2_test_sq.2, 
                                      s=ri.fourier2_best_lambda_sq.2)

cor(la.model_fourier2.pred_sq.2, y_test, method="pearson")
# 0.3870524
mean((la.model_fourier2.pred_sq.2 - y_test)^2)
# 0.2049228
cor(ri.model_fourier2.pred_sq.2, y_test, method="pearson")
# 0.3872555
mean((ri.model_fourier2.pred_sq.2 - y_test)^2)
# 0.2049602
```

We get test prediction correlation of 0.3870524 and MSE of 0.2049228 with lasso
We get test prediction correlation of 0.3872555 and MSE of 0.2049602 with ridge


# Inputs: Amplitude of Fourier Features Based on AA/TT/AT/TA Dinucleotides Calculated from scratch

```{r}
library(Matrix)
library(glmnet)
Xtwo_AT_fourier_amp = readRDS("data/Created/tiling_Xtwo_AT_fourier_amp.rds")
Xtwo_AT_fourier_amp_test = readRDS("data/Created/tiling_Xtwo_AT_fourier_amp_test.rds")
```

```{r}
X_fourier2_amp.1 = data.frame(Xtwo_AT_fourier_amp)
x_fourier2_amp.1 = sparse.model.matrix(~ ., data=X_fourier2_amp.1)

set.seed(50)
la.model_fourier2_amp.1 = cv.glmnet(x_fourier2_amp.1, y, alpha=1, family="gaussian")
ri.model_fourier2_amp.1 = cv.glmnet(x_fourier2_amp.1, y, alpha=0, family="gaussian")

la.fourier2_amp_best_lambda.1 = la.model_fourier2_amp.1$lambda.min
la.fourier2_amp_best_lambda.1
ri.fourier2_amp_best_lambda.1 = ri.model_fourier2_amp.1$lambda.min
ri.fourier2_amp_best_lambda.1

la.model_fourier2_amp.train_pred.1 = predict(la.model_fourier2_amp.1, 
                                             newx = x_fourier2_amp.1, 
                                             s=la.fourier2_amp_best_lambda.1)
ri.model_fourier2_amp.train_pred.1 = predict(ri.model_fourier2_amp.1, 
                                             newx = x_fourier2_amp.1, 
                                             s=ri.fourier2_amp_best_lambda.1)

cor(la.model_fourier2_amp.train_pred.1, y, method="pearson")
# 0.4057796
mean((la.model_fourier2_amp.train_pred.1 - y)^2)
# 0.2024428
cor(ri.model_fourier2_amp.train_pred.1, y, method="pearson")
# 0.4057867
mean((ri.model_fourier2_amp.train_pred.1 - y)^2)
# 0.2024551

X_fourier2_amp_test.1 = data.frame(Xtwo_AT_fourier_amp_test)
x_fourier2_amp_test.1 = sparse.model.matrix(~., data=X_fourier2_amp_test.1)

la.model_fourier2_amp.pred.1 = predict(la.model_fourier2_amp.1, 
                                       newx = x_fourier2_amp_test.1, 
                                       s=la.fourier2_amp_best_lambda.1)
ri.model_fourier2_amp.pred.1 = predict(ri.model_fourier2_amp.1, 
                                       newx = x_fourier2_amp_test.1, 
                                       s=ri.fourier2_amp_best_lambda.1)

cor(la.model_fourier2_amp.pred.1, y_test, method="pearson")
# 0.4037738
mean((la.model_fourier2_amp.pred.1 - y_test)^2)
# 0.2017186
cor(ri.model_fourier2_amp.pred.1, y_test, method="pearson")
# 0.4038415
mean((ri.model_fourier2_amp.pred.1 - y_test)^2)
# 0.2017113
```

We get test prediction correlation of 0.4037738 and MSE of 0.2017186 with lasso
We get test prediction correlation of 0.4038415 and MSE of 0.2017113 with ridge

# Inputs: Fourier Features Based on all Dinucleotides Calculated using fft

```{r}
fourier_di_cos = readRDS("data/Created/tiling_fourier_di_cos.rds")
fourier_di_sin = readRDS("data/Created/tiling_fourier_di_sin.rds")
fourier_di_cos_test = readRDS("data/Created/tiling_fourier_di_cos_test.rds")
fourier_di_sin_test = readRDS("data/Created/tiling_fourier_di_sin_test.rds")
```

## Raw Fourier features

```{r}
dat_fourier_di = cbind(fourier_di_cos, fourier_di_sin, dat %>% select(C0_new))

fourier_di_lm = lm(C0_new~., data=dat_fourier_di)
cor(fourier_di_lm$fitted.values, y)
# 0.3769176

dat_test_fourier_di = cbind(fourier_di_cos_test, fourier_di_sin_test, dat_test %>% select(C0_new))

fourier_di_pred = predict(fourier_di_lm, dat_test_fourier_di)

cor(fourier_di_pred, y_test)
# 0.3690218

mean((fourier_di_pred - y_test)^2)
# 0.2082426
```

We get test prediction correlation of 0.3690218 and MSE of 0.2082426



## Absolute value of Fourier features

```{r}
dat_fourier_di2 = cbind(abs(fourier_di_cos), abs(fourier_di_sin), 
                        dat %>% select(C0_new))

fourier_di2_lm = lm(C0_new~., data=dat_fourier_di2)
cor(fourier_di2_lm$fitted.values, y)
# 0.4380776

dat_test_fourier_di2 = cbind(abs(fourier_di_cos_test), abs(fourier_di_sin_test), 
                             dat_test %>% select(C0_new))

fourier_di2_pred = predict(fourier_di2_lm, dat_test_fourier_di2)

cor(fourier_di2_pred, y_test)
# 0.421811

mean((fourier_di2_pred - y_test)^2)
# 0.1982054
```

We get test prediction correlation of 0.421811 and MSE of 0.1982054



## Squared value of Fourier features

### Simple Linear Model

```{r}
dat_fourier_di3 = cbind((fourier_di_cos)^2, (fourier_di_sin)^2, 
                        dat %>% select(C0_new))

fourier_di3_lm = lm(C0_new~., data=dat_fourier_di3)
cor(fourier_di3_lm$fitted.values, y)
# 0.4550086

dat_test_fourier_di3 = cbind((fourier_di_cos_test)^2, (fourier_di_sin_test)^2, 
                             dat_test %>% select(C0_new))

fourier_di3_pred = predict(fourier_di3_lm, dat_test_fourier_di3)

cor(fourier_di3_pred, y_test)
# 0.4437479

mean((fourier_di3_pred - y_test)^2)
# 0.193609
```

We get test prediction correlation of 0.4437479 and MSE of 0.193609

### LightGBM (tree-based) Model

```{r}
library(lightgbm)
source("scripts/functions/lgbm-helper-functions.R")
set.seed(50)
dat_fourier_di3.lgb_train_set = dat_fourier_di3 %>%
  select(-C0_new)
dat_fourier_di3.lgb_train_rules = lgb.convert_with_rules(data = dat_fourier_di3.lgb_train_set)
dat_fourier_di3.lgb_train_data = lgb.Dataset(data = as.matrix(dat_fourier_di3.lgb_train_rules$data),
                                             label = dat_fourier_di3$C0_new,
                                             categorical_feature = handle_categorical(colnames(dat_fourier_di3.lgb_train_rules$data)))
dat_fourier_di3.lgb_test_set = dat_test_fourier_di3 %>%
  select(-C0_new)
dat_fourier_di3.lgb_test_matrix = as.matrix(lgb.convert_with_rules(data = dat_fourier_di3.lgb_test_set, rules = dat_fourier_di3.lgb_train_rules$rules)$data)
dat_fourier_di3.lgb_test_data = lgb.Dataset(data = dat_fourier_di3.lgb_test_matrix,
                                            label = dat_test_fourier_di3$C0_new,
                                            categorical_feature = handle_categorical(colnames(dat_fourier_di3.lgb_test_matrix)))
dat_fourier_di3.lgb_obj = lightgbm(data = dat_fourier_di3.lgb_train_data,
                                   params = list(learning_rate = c(0.1),
                                                 objective = c("regression"),
                                                 min_data_in_leaf = 100,
                                                 max_depth = c(5),
                                                 num_leaves = c(1000),
                                                 lambda_l2 = c(1),
                                                 boosting = c("gbdt")),
                                   valids = list(valid = dat_fourier_di3.lgb_test_data),
                                   nrounds = 4000,
                                   early_stopping_rounds = 50)

dat_fourier_di3.lgb_train_pred = predict(dat_fourier_di3.lgb_obj, data = as.matrix(dat_fourier_di3.lgb_train_rules$data))
cor(dat_fourier_di3.lgb_train_pred, y, method="pearson")
# 0.7537701 (nrounds = 563)

dat_fourier_di3.lgb_test_pred = predict(dat_fourier_di3.lgb_obj, data = dat_fourier_di3.lgb_test_matrix)

cor(dat_fourier_di3.lgb_test_pred, y_test, method="pearson")
# 0.4901658 (nrounds = 563)

mean((dat_fourier_di3.lgb_test_pred - y_test)^2)
# 0.1831652 (nrounds = 563)
```

We get test prediction correlation of 0.4901658 and MSE of 0.1831652

```{r}
dat_fourier_di3.feature_importance = as.data.frame(lgb.importance(dat_fourier_di3.lgb_obj)) %>%
  mutate(Feature = fct_rev(fct_inorder(Feature))) %>%
  dplyr::slice(1:50) %>%
  ggplot(aes(x = Feature, y = Gain)) +
  geom_col(fill = "dodgerblue") +
  coord_flip() +
  theme_bw()
dat_fourier_di3.feature_importance
```




# Inputs: Fourier Features Based on all Dinucleotides with h=6 (period 9.8) Calculated using fft

```{r}
fourier_di_cos = readRDS("data/Created/tiling_fourier_di_cos.rds")
fourier_di_sin = readRDS("data/Created/tiling_fourier_di_sin.rds")
fourier_di_cos_test = readRDS("data/Created/tiling_fourier_di_cos_test.rds")
fourier_di_sin_test = readRDS("data/Created/tiling_fourier_di_sin_test.rds")

fourier_di_cos_6 = as.data.frame(fourier_di_cos) %>% select(ends_with("_6"))
fourier_di_sin_6 = as.data.frame(fourier_di_sin) %>% select(ends_with("_6"))
fourier_di_cos_6_test = as.data.frame(fourier_di_cos_test) %>% select(ends_with("_6"))
fourier_di_sin_6_test = as.data.frame(fourier_di_sin_test) %>% select(ends_with("_6"))
```

## Squared value of Fourier features

### Simple Linear Model

```{r}
dat_fourier_6 = cbind((fourier_di_cos_6)^2, (fourier_di_sin_6)^2, 
                      dat %>% select(C0_new))

fourier_6_lm = lm(C0_new~., data=dat_fourier_6)
cor(fourier_6_lm$fitted.values, y)
# 0.2747204

dat_test_fourier_6 = cbind((fourier_di_cos_6_test)^2, (fourier_di_sin_6_test)^2, 
                           dat_test %>% select(C0_new))

fourier_6_pred = predict(fourier_6_lm, dat_test_fourier_6)

cor(fourier_6_pred, y_test)
# 0.2768375

mean((fourier_6_pred - y_test)^2)
# 0.2225345
```

We get test prediction correlation of 0.2768375 and MSE of 0.2225345

### LightGBM (tree-based) Model

```{r}
library(lightgbm)
source("scripts/functions/lgbm-helper-functions.R")
set.seed(50)
dat_fourier_6.lgb_train_set = dat_fourier_6 %>%
  select(-C0_new)
dat_fourier_6.lgb_train_rules = lgb.convert_with_rules(data = dat_fourier_6.lgb_train_set)
dat_fourier_6.lgb_train_data = lgb.Dataset(data = as.matrix(dat_fourier_6.lgb_train_rules$data),
                                           label = dat_fourier_6$C0_new,
                                           categorical_feature = handle_categorical(colnames(dat_fourier_6.lgb_train_rules$data)))
dat_fourier_6.lgb_test_set = dat_test_fourier_6 %>%
  select(-C0_new)
dat_fourier_6.lgb_test_matrix = as.matrix(lgb.convert_with_rules(data = dat_fourier_6.lgb_test_set, rules = dat_fourier_6.lgb_train_rules$rules)$data)
dat_fourier_6.lgb_test_data = lgb.Dataset(data = dat_fourier_6.lgb_test_matrix,
                                          label = dat_test_fourier_6$C0_new,
                                          categorical_feature = handle_categorical(colnames(dat_fourier_6.lgb_test_matrix)))
dat_fourier_6.lgb_obj = lightgbm(data = dat_fourier_6.lgb_train_data,
                                 params = list(learning_rate = c(0.1),
                                               objective = c("regression"),
                                               min_data_in_leaf = 100,
                                               max_depth = c(5),
                                               num_leaves = c(1000),
                                               lambda_l2 = c(1),
                                               boosting = c("gbdt")),
                                 valids = list(valid = dat_fourier_6.lgb_test_data),
                                 nrounds = 2000,
                                 early_stopping_rounds = 50)

dat_fourier_6.lgb_train_pred = predict(dat_fourier_6.lgb_obj, data = as.matrix(dat_fourier_6.lgb_train_rules$data))
cor(dat_fourier_6.lgb_train_pred, y, method="pearson")
# 0.4982452 (nrounds = 253)


dat_fourier_6.lgb_test_pred = predict(dat_fourier_6.lgb_obj, data = dat_fourier_6.lgb_test_matrix)

cor(dat_fourier_6.lgb_test_pred, y_test, method="pearson")
# 0.3543143 (nrounds = 253)

mean((dat_fourier_6.lgb_test_pred - y_test)^2)
# 0.2107601 (nrounds = 253)
```

We get test prediction correlation of 0.3543143 and MSE of 0.2107601

```{r}
dat_fourier_6.feature_importance = as.data.frame(lgb.importance(dat_fourier_6.lgb_obj)) %>%
  mutate(Feature = fct_rev(fct_inorder(Feature))) %>%
  dplyr::slice(1:50) %>%
  ggplot(aes(x = Feature, y = Gain)) +
  geom_col(fill = "dodgerblue") +
  coord_flip() +
  theme_bw()
dat_fourier_6.feature_importance
```

# Inputs: Modulus of Difference of Fourier Features Based on all Dinucleotides with h=6 (period 9.8) Calculated using fft

```{r}
fourier_6_mod = readRDS("data/Created/tiling_fourier_6_mod.rds")
fourier_6_mod_test = readRDS("data/Created/tiling_fourier_6_mod_test.rds")
```

## Raw Fourier features

```{r}
dat_fourier_6_mod = cbind(fourier_6_mod, dat %>% select(C0_new))

fourier_6_mod_lm = lm(C0_new~., data=dat_fourier_6_mod)
cor(fourier_6_mod_lm$fitted.values, y)
# 0.4191367

dat_test_fourier_6_mod = cbind(fourier_6_mod_test, dat_test %>% select(C0_new))

fourier_6_mod_pred = predict(fourier_6_mod_lm, dat_test_fourier_6_mod)

cor(fourier_6_mod_pred, y_test)
# 0.4183326

mean((fourier_6_mod_pred - y_test)^2)
# 0.1988365
```

We get test prediction correlation of 0.4183326 and MSE of 0.1988365



## Squared value of Fourier features

### Simple Linear Model

```{r}
dat_fourier_6_mod2 = cbind((fourier_6_mod)^2, dat %>% select(C0_new))

fourier_6_mod2_lm = lm(C0_new~., data=dat_fourier_6_mod2)
cor(fourier_6_mod2_lm$fitted.values, y)
# 0.4710778

dat_test_fourier_6_mod2 = cbind((fourier_6_mod_test)^2, dat_test %>% select(C0_new))

fourier_6_mod2_pred = predict(fourier_6_mod2_lm, dat_test_fourier_6_mod2)

cor(fourier_6_mod2_pred, y_test)
# 0.4744723

mean((fourier_6_mod2_pred - y_test)^2)
# 0.1867489
```

We get test prediction correlation of 0.4744723 and MSE of 0.1867489

### LightGBM (tree-based) Model

```{r}
library(lightgbm)
source("scripts/functions/lgbm-helper-functions.R")
set.seed(50)
dat_fourier_6_mod2.lgb_train_set = dat_fourier_6_mod2 %>%
  select(-C0_new)
dat_fourier_6_mod2.lgb_train_rules = lgb.convert_with_rules(data = dat_fourier_6_mod2.lgb_train_set)
dat_fourier_6_mod2.lgb_train_data = lgb.Dataset(data = as.matrix(dat_fourier_6_mod2.lgb_train_rules$data),
                                                label = dat_fourier_6_mod2$C0_new,
                                                categorical_feature = handle_categorical(colnames(dat_fourier_6_mod2.lgb_train_rules$data)))
dat_fourier_6_mod2.lgb_test_set = dat_test_fourier_6_mod2 %>%
  select(-C0_new)
dat_fourier_6_mod2.lgb_test_matrix = as.matrix(lgb.convert_with_rules(data = dat_fourier_6_mod2.lgb_test_set, rules = dat_fourier_6_mod2.lgb_train_rules$rules)$data)
dat_fourier_6_mod2.lgb_test_data = lgb.Dataset(data = dat_fourier_6_mod2.lgb_test_matrix,
                                               label = dat_test_fourier_6_mod2$C0_new,
                                               categorical_feature = handle_categorical(colnames(dat_fourier_6_mod2.lgb_test_matrix)))
dat_fourier_6_mod2.lgb_obj = lightgbm(data = dat_fourier_6_mod2.lgb_train_data,
                                      params = list(learning_rate = c(0.1),
                                                    objective = c("regression"),
                                                    min_data_in_leaf = 100,
                                                    max_depth = c(5),
                                                    num_leaves = c(1000),
                                                    lambda_l2 = c(1),
                                                    boosting = c("gbdt")),
                                      valids = list(valid = dat_fourier_6_mod2.lgb_test_data),
                                      nrounds = 8000,
                                      early_stopping_rounds = 50)

dat_fourier_6_mod2.lgb_train_pred = predict(dat_fourier_6_mod2.lgb_obj, data = as.matrix(dat_fourier_6_mod2.lgb_train_rules$data))
cor(dat_fourier_6_mod2.lgb_train_pred, y, method="pearson")
# 0.7530788 (nrounds = 739)

dat_fourier_6_mod2.lgb_test_pred = predict(dat_fourier_6_mod2.lgb_obj, data = dat_fourier_6_mod2.lgb_test_matrix)

cor(dat_fourier_6_mod2.lgb_test_pred, y_test, method="pearson")
# 0.5041069 (nrounds = 739)

mean((dat_fourier_6_mod2.lgb_test_pred - y_test)^2)
# 0.1797759 (nrounds = 739)
```

We get test prediction correlation of 0.5041069 and MSE of 0.1797759

```{r}
dat_fourier_6_mod2.feature_importance = as.data.frame(lgb.importance(dat_fourier_6_mod2.lgb_obj)) %>%
  mutate(Feature = fct_rev(fct_inorder(Feature))) %>%
  dplyr::slice(1:50) %>%
  ggplot(aes(x = Feature, y = Gain)) +
  geom_col(fill = "dodgerblue") +
  coord_flip() +
  theme_bw()
dat_fourier_6_mod2.feature_importance
```


# Inputs: Fourier Features Based on AA/TT/AT/TA Dinucleotides + Modulus of Difference of Fourier Features Based on all Dinucleotides with h=6 (period 9.8) Calculated using fft

```{r}
Xtwo_AorT_fourier_cos = readRDS("data/Created/tiling_Xtwo_AorT_fourier_cos.rds")
Xtwo_AorT_fourier_sin = readRDS("data/Created/tiling_Xtwo_AorT_fourier_sin.rds")
Xtwo_AorT_fourier_cos_test = readRDS("data/Created/tiling_Xtwo_AorT_fourier_cos_test.rds")
Xtwo_AorT_fourier_sin_test = readRDS("data/Created/tiling_Xtwo_AorT_fourier_sin_test.rds")

fourier_6_mod = readRDS("data/Created/tiling_fourier_6_mod.rds")
fourier_6_mod_test = readRDS("data/Created/tiling_fourier_6_mod_test.rds")
```

## Squared value of Fourier features

### Simple Linear Model

```{r}
dat_fourier_6_mod5 = cbind((Xtwo_AorT_fourier_cos)^2, (Xtwo_AorT_fourier_sin)^2, 
                           (fourier_6_mod)^2, dat %>% select(C0_new))

fourier_6_mod5_lm = lm(C0_new~., data=dat_fourier_6_mod5)
cor(fourier_6_mod5_lm$fitted.values, y)
# 0.4898862

dat_test_fourier_6_mod5 = cbind((Xtwo_AorT_fourier_cos_test)^2, (Xtwo_AorT_fourier_sin_test)^2, 
                                (fourier_6_mod_test)^2, dat_test %>% select(C0_new))

fourier_6_mod5_pred = predict(fourier_6_mod5_lm, dat_test_fourier_6_mod5)

cor(fourier_6_mod5_pred, y_test)
# 0.4954588

mean((fourier_6_mod5_pred - y_test)^2)
# 0.1818444
```

We get test prediction correlation of 0.4954588 and MSE of 0.1818444

### LightGBM (tree-based) Model

```{r}
library(lightgbm)
source("scripts/functions/lgbm-helper-functions.R")
set.seed(50)
dat_fourier_6_mod5.lgb_train_set = dat_fourier_6_mod5 %>%
  select(-C0_new)
dat_fourier_6_mod5.lgb_train_rules = lgb.convert_with_rules(data = dat_fourier_6_mod5.lgb_train_set)
dat_fourier_6_mod5.lgb_train_data = lgb.Dataset(data = as.matrix(dat_fourier_6_mod5.lgb_train_rules$data),
                                                label = dat_fourier_6_mod5$C0_new,
                                                categorical_feature = handle_categorical(colnames(dat_fourier_6_mod5.lgb_train_rules$data)))
dat_fourier_6_mod5.lgb_test_set = dat_test_fourier_6_mod5 %>%
  select(-C0_new)
dat_fourier_6_mod5.lgb_test_matrix = as.matrix(lgb.convert_with_rules(data = dat_fourier_6_mod5.lgb_test_set, rules = dat_fourier_6_mod5.lgb_train_rules$rules)$data)
dat_fourier_6_mod5.lgb_test_data = lgb.Dataset(data = dat_fourier_6_mod5.lgb_test_matrix,
                                               label = dat_test_fourier_6_mod5$C0_new,
                                               categorical_feature = handle_categorical(colnames(dat_fourier_6_mod5.lgb_test_matrix)))
dat_fourier_6_mod5.lgb_obj = lightgbm(data = dat_fourier_6_mod5.lgb_train_data,
                                      params = list(learning_rate = c(0.1),
                                                    objective = c("regression"),
                                                    min_data_in_leaf = 100,
                                                    max_depth = c(5),
                                                    num_leaves = c(1000),
                                                    lambda_l2 = c(1),
                                                    boosting = c("gbdt")),
                                      valids = list(valid = dat_fourier_6_mod5.lgb_test_data),
                                      nrounds = 8000,
                                      early_stopping_rounds = 50)

dat_fourier_6_mod5.lgb_train_pred = predict(dat_fourier_6_mod5.lgb_obj, data = as.matrix(dat_fourier_6_mod5.lgb_train_rules$data))
cor(dat_fourier_6_mod5.lgb_train_pred, y, method="pearson")
# 0.8376311 (nrounds = 1162)

dat_fourier_6_mod5.lgb_test_pred = predict(dat_fourier_6_mod5.lgb_obj, data = dat_fourier_6_mod5.lgb_test_matrix)

cor(dat_fourier_6_mod5.lgb_test_pred, y_test, method="pearson")
# 0.5191258 (nrounds = 1162)

mean((dat_fourier_6_mod5.lgb_test_pred - y_test)^2)
# 0.1761474 (nrounds = 1162)
```

We get test prediction correlation of 0.5191258 and MSE of 0.1761474

```{r}
dat_fourier_6_mod5.feature_importance = as.data.frame(lgb.importance(dat_fourier_6_mod5.lgb_obj)) %>%
  mutate(Feature = fct_rev(fct_inorder(Feature))) %>%
  dplyr::slice(1:50) %>%
  ggplot(aes(x = Feature, y = Gain)) +
  geom_col(fill = "dodgerblue") +
  coord_flip() +
  theme_bw()
dat_fourier_6_mod5.feature_importance
```



# Inputs: Fourier Features Based on all Dinucleotides + Modulus of Difference of Fourier Features Based on all Dinucleotides with h=6 (period 9.8) Calculated using fft

```{r}
fourier_di_cos = readRDS("data/Created/tiling_fourier_di_cos.rds")
fourier_di_sin = readRDS("data/Created/tiling_fourier_di_sin.rds")
fourier_di_cos_test = readRDS("data/Created/tiling_fourier_di_cos_test.rds")
fourier_di_sin_test = readRDS("data/Created/tiling_fourier_di_sin_test.rds")

fourier_6_mod = readRDS("data/Created/tiling_fourier_6_mod.rds")
fourier_6_mod_test = readRDS("data/Created/tiling_fourier_6_mod_test.rds")
```

## Squared value of Fourier features

### Simple Linear Model

```{r}
dat_fourier_6_mod3 = cbind((fourier_di_cos)^2, (fourier_di_sin)^2, 
                           (fourier_6_mod)^2, dat %>% select(C0_new))

fourier_6_mod3_lm = lm(C0_new~., data=dat_fourier_6_mod3)
cor(fourier_6_mod3_lm$fitted.values, y)
# 0.5936523

dat_test_fourier_6_mod3 = cbind((fourier_di_cos_test)^2, (fourier_di_sin_test)^2, 
                                (fourier_6_mod_test)^2, dat_test %>% select(C0_new))

fourier_6_mod3_pred = predict(fourier_6_mod3_lm, dat_test_fourier_6_mod3)

cor(fourier_6_mod3_pred, y_test)
# 0.5900922

mean((fourier_6_mod3_pred - y_test)^2)
# 0.1571031
```

We get test prediction correlation of 0.5900922 and MSE of 0.1571031

### LightGBM (tree-based) Model

```{r}
library(lightgbm)
source("scripts/functions/lgbm-helper-functions.R")
set.seed(50)
dat_fourier_6_mod3.lgb_train_set = dat_fourier_6_mod3 %>%
  select(-C0_new)
dat_fourier_6_mod3.lgb_train_rules = lgb.convert_with_rules(data = dat_fourier_6_mod3.lgb_train_set)
dat_fourier_6_mod3.lgb_train_data = lgb.Dataset(data = as.matrix(dat_fourier_6_mod3.lgb_train_rules$data),
                                                label = dat_fourier_6_mod3$C0_new,
                                                categorical_feature = handle_categorical(colnames(dat_fourier_6_mod3.lgb_train_rules$data)))
dat_fourier_6_mod3.lgb_test_set = dat_test_fourier_6_mod3 %>%
  select(-C0_new)
dat_fourier_6_mod3.lgb_test_matrix = as.matrix(lgb.convert_with_rules(data = dat_fourier_6_mod3.lgb_test_set, rules = dat_fourier_6_mod3.lgb_train_rules$rules)$data)
dat_fourier_6_mod3.lgb_test_data = lgb.Dataset(data = dat_fourier_6_mod3.lgb_test_matrix,
                                               label = dat_test_fourier_6_mod3$C0_new,
                                               categorical_feature = handle_categorical(colnames(dat_fourier_6_mod3.lgb_test_matrix)))
dat_fourier_6_mod3.lgb_obj = lightgbm(data = dat_fourier_6_mod3.lgb_train_data,
                                      params = list(learning_rate = c(0.1),
                                                    objective = c("regression"),
                                                    min_data_in_leaf = 100,
                                                    max_depth = c(5),
                                                    num_leaves = c(1000),
                                                    lambda_l2 = c(1),
                                                    boosting = c("gbdt")),
                                      valids = list(valid = dat_fourier_6_mod3.lgb_test_data),
                                      nrounds = 2000,
                                      early_stopping_rounds = 50)

dat_fourier_6_mod3.lgb_train_pred = predict(dat_fourier_6_mod3.lgb_obj, data = as.matrix(dat_fourier_6_mod3.lgb_train_rules$data))
cor(dat_fourier_6_mod3.lgb_train_pred, y, method="pearson")
# 0.8411759 (nrounds = 780)


dat_fourier_6_mod3.lgb_test_pred = predict(dat_fourier_6_mod3.lgb_obj, data = dat_fourier_6_mod3.lgb_test_matrix)

cor(dat_fourier_6_mod3.lgb_test_pred, y_test, method="pearson")
# 0.5949926 (nrounds = 780)

mean((dat_fourier_6_mod3.lgb_test_pred - y_test)^2)
# 0.1557094 (nrounds = 780)
```

We get test prediction correlation of 0.5949926 and MSE of 0.1557094

```{r}
dat_fourier_6_mod3.feature_importance = as.data.frame(lgb.importance(dat_fourier_6_mod3.lgb_obj)) %>%
  mutate(Feature = fct_rev(fct_inorder(Feature))) %>%
  dplyr::slice(1:50) %>%
  ggplot(aes(x = Feature, y = Gain)) +
  geom_col(fill = "dodgerblue") +
  coord_flip() +
  theme_bw()
dat_fourier_6_mod3.feature_importance
```

# Inputs: Fourier Features Based on all Dinucleotides with h=6 (period 9.8) + Modulus of Difference of Fourier Features Based on all Dinucleotides with h=6 (period 9.8) Calculated using fft

```{r}
fourier_di_cos = readRDS("data/Created/tiling_fourier_di_cos.rds")
fourier_di_sin = readRDS("data/Created/tiling_fourier_di_sin.rds")
fourier_di_cos_test = readRDS("data/Created/tiling_fourier_di_cos_test.rds")
fourier_di_sin_test = readRDS("data/Created/tiling_fourier_di_sin_test.rds")

fourier_di_cos_6 = as.data.frame(fourier_di_cos) %>% select(ends_with("_6"))
fourier_di_sin_6 = as.data.frame(fourier_di_sin) %>% select(ends_with("_6"))
fourier_di_cos_6_test = as.data.frame(fourier_di_cos_test) %>% select(ends_with("_6"))
fourier_di_sin_6_test = as.data.frame(fourier_di_sin_test) %>% select(ends_with("_6"))

fourier_6_mod = readRDS("data/Created/tiling_fourier_6_mod.rds")
fourier_6_mod_test = readRDS("data/Created/tiling_fourier_6_mod_test.rds")
```

## Squared value of Fourier features

### Simple Linear Model

```{r}
dat_fourier_6_mod4 = cbind((fourier_di_cos_6)^2, (fourier_di_sin_6)^2, 
                           (fourier_6_mod)^2, dat %>% select(C0_new))

fourier_6_mod4_lm = lm(C0_new~., data=dat_fourier_6_mod4)
cor(fourier_6_mod4_lm$fitted.values, y)
# 0.4748986

dat_test_fourier_6_mod4 = cbind((fourier_di_cos_6_test)^2, (fourier_di_sin_6_test)^2, 
                                (fourier_6_mod_test)^2, dat_test %>% select(C0_new))

fourier_6_mod4_pred = predict(fourier_6_mod4_lm, dat_test_fourier_6_mod4)

cor(fourier_6_mod4_pred, y_test)
# 0.4789547

mean((fourier_6_mod4_pred - y_test)^2)
# 0.1857191
```

We get test prediction correlation of 0.4789547 and MSE of 0.1857191

### LightGBM (tree-based) Model

```{r}
library(lightgbm)
source("scripts/functions/lgbm-helper-functions.R")
set.seed(50)
dat_fourier_6_mod4.lgb_train_set = dat_fourier_6_mod4 %>%
  select(-C0_new)
dat_fourier_6_mod4.lgb_train_rules = lgb.convert_with_rules(data = dat_fourier_6_mod4.lgb_train_set)
dat_fourier_6_mod4.lgb_train_data = lgb.Dataset(data = as.matrix(dat_fourier_6_mod4.lgb_train_rules$data),
                                                label = dat_fourier_6_mod4$C0_new,
                                                categorical_feature = handle_categorical(colnames(dat_fourier_6_mod4.lgb_train_rules$data)))
dat_fourier_6_mod4.lgb_test_set = dat_test_fourier_6_mod4 %>%
  select(-C0_new)
dat_fourier_6_mod4.lgb_test_matrix = as.matrix(lgb.convert_with_rules(data = dat_fourier_6_mod4.lgb_test_set, rules = dat_fourier_6_mod4.lgb_train_rules$rules)$data)
dat_fourier_6_mod4.lgb_test_data = lgb.Dataset(data = dat_fourier_6_mod4.lgb_test_matrix,
                                               label = dat_test_fourier_6_mod4$C0_new,
                                               categorical_feature = handle_categorical(colnames(dat_fourier_6_mod4.lgb_test_matrix)))
dat_fourier_6_mod4.lgb_obj = lightgbm(data = dat_fourier_6_mod4.lgb_train_data,
                                      params = list(learning_rate = c(0.1),
                                                    objective = c("regression"),
                                                    min_data_in_leaf = 100,
                                                    max_depth = c(5),
                                                    num_leaves = c(1000),
                                                    lambda_l2 = c(1),
                                                    boosting = c("gbdt")),
                                      valids = list(valid = dat_fourier_6_mod4.lgb_test_data),
                                      nrounds = 2000,
                                      early_stopping_rounds = 50)

dat_fourier_6_mod4.lgb_train_pred = predict(dat_fourier_6_mod4.lgb_obj, data = as.matrix(dat_fourier_6_mod4.lgb_train_rules$data))
cor(dat_fourier_6_mod4.lgb_train_pred, y, method="pearson")
# 0.7617758 (nrounds = 735)


dat_fourier_6_mod4.lgb_test_pred = predict(dat_fourier_6_mod4.lgb_obj, data = dat_fourier_6_mod4.lgb_test_matrix)

cor(dat_fourier_6_mod4.lgb_test_pred, y_test, method="pearson")
# 0.5070387 (nrounds = 735)

mean((dat_fourier_6_mod4.lgb_test_pred - y_test)^2)
# 0.1790499 (nrounds = 735)
```

We get test prediction correlation of 0.5070387 and MSE of 0.1790499

```{r}
dat_fourier_6_mod4.feature_importance = as.data.frame(lgb.importance(dat_fourier_6_mod4.lgb_obj)) %>%
  mutate(Feature = fct_rev(fct_inorder(Feature))) %>%
  dplyr::slice(1:50) %>%
  ggplot(aes(x = Feature, y = Gain)) +
  geom_col(fill = "dodgerblue") +
  coord_flip() +
  theme_bw()
dat_fourier_6_mod4.feature_importance
```




# Inputs: Fourier Features Based on A/T Nucleotides and AA/TT/AT/TA Dinucleotides Calculated from scratch

```{r}
library(Matrix)
library(glmnet)
Xone_AT_fourier_cos = readRDS("data/Created/tiling_Xone_AT_fourier_cos.rds")
Xone_AT_fourier_sin = readRDS("data/Created/tiling_Xone_AT_fourier_sin.rds")
Xone_AT_fourier_cos_test = readRDS("data/Created/tiling_Xone_AT_fourier_cos_test.rds")
Xone_AT_fourier_sin_test = readRDS("data/Created/tiling_Xone_AT_fourier_sin_test.rds")

Xtwo_AT_fourier_cos = readRDS("data/Created/tiling_Xtwo_AT_fourier_cos.rds")
Xtwo_AT_fourier_sin = readRDS("data/Created/tiling_Xtwo_AT_fourier_sin.rds")
Xtwo_AT_fourier_cos_test = readRDS("data/Created/tiling_Xtwo_AT_fourier_cos_test.rds")
Xtwo_AT_fourier_sin_test = readRDS("data/Created/tiling_Xtwo_AT_fourier_sin_test.rds")
```

## Squared value of Fourier features

```{r}
X_fourier12_sq.1 = bind_cols(Xone_AT_fourier_cos^2, Xone_AT_fourier_sin^2,
                             Xtwo_AT_fourier_cos^2, Xtwo_AT_fourier_sin^2)
x_fourier12_sq.1 = sparse.model.matrix(~ ., data=X_fourier12_sq.1)

set.seed(50)
la.model_fourier12_sq.1 = cv.glmnet(x_fourier12_sq.1, y, alpha=1, family="gaussian")
ri.model_fourier12_sq.1 = cv.glmnet(x_fourier12_sq.1, y, alpha=0, family="gaussian")

la.fourier12_sq_best_lambda.1 = la.model_fourier12_sq.1$lambda.min
la.fourier12_sq_best_lambda.1
ri.fourier12_sq_best_lambda.1 = ri.model_fourier12_sq.1$lambda.min
ri.fourier12_sq_best_lambda.1

la.model_fourier12_sq.train_pred.1 = predict(la.model_fourier12_sq.1, 
                                             newx = x_fourier12_sq.1, 
                                             s=la.fourier12_sq_best_lambda.1)
ri.model_fourier12_sq.train_pred.1 = predict(ri.model_fourier12_sq.1, 
                                             newx = x_fourier12_sq.1, 
                                             s=ri.fourier12_sq_best_lambda.1)

cor(la.model_fourier12_sq.train_pred.1, y, method="pearson")
# 0.4532962
mean((la.model_fourier12_sq.train_pred.1 - y)^2)
# 0.1925498
cor(ri.model_fourier12_sq.train_pred.1, y, method="pearson")
# 0.4530013
mean((ri.model_fourier12_sq.train_pred.1 - y)^2)
# 0.1926202

X_fourier12_sq_test.1 = bind_cols(Xone_AT_fourier_cos_test^2, Xone_AT_fourier_sin_test^2, 
                                  Xtwo_AT_fourier_cos_test^2, Xtwo_AT_fourier_sin_test^2)
x_fourier12_sq_test.1 = sparse.model.matrix(~., data=X_fourier12_sq_test.1)

la.model_fourier12_sq.pred.1 = predict(la.model_fourier12_sq.1, 
                                       newx = x_fourier12_sq_test.1, 
                                       s=la.fourier12_sq_best_lambda.1)
ri.model_fourier12_sq.pred.1 = predict(ri.model_fourier12_sq.1, 
                                       newx = x_fourier12_sq_test.1, 
                                       s=ri.fourier12_sq_best_lambda.1)

cor(la.model_fourier12_sq.pred.1, y_test, method="pearson")
# 0.450254
mean((la.model_fourier12_sq.pred.1 - y_test)^2)
# 0.1921492
cor(ri.model_fourier12_sq.pred.1, y_test, method="pearson")
# 0.4500889
mean((ri.model_fourier12_sq.pred.1 - y_test)^2)
# 0.1921934
```

We get test prediction correlation of 0.450254 and MSE of 0.1921492 with lasso
We get test prediction correlation of 0.4500889 and MSE of 0.1921934 with ridge




# Inputs: Fourier Features Based on CC/GG/CG/GC Dinucleotides Calculated from scrach


```{r}
library(Matrix)
library(glmnet)
Xtwo_CG_fourier_cos = readRDS("data/Created/tiling_Xtwo_CG_fourier_cos.rds")
Xtwo_CG_fourier_sin = readRDS("data/Created/tiling_Xtwo_CG_fourier_sin.rds")
Xtwo_CG_fourier_cos_test = readRDS("data/Created/tiling_Xtwo_CG_fourier_cos_test.rds")
Xtwo_CG_fourier_sin_test = readRDS("data/Created/tiling_Xtwo_CG_fourier_sin_test.rds")
```


## Raw Fourier features

```{r}
X_fourier2CG.2 = bind_cols(Xtwo_CG_fourier_cos, Xtwo_CG_fourier_sin)
x_fourier2CG.2 = sparse.model.matrix(~ ., data=X_fourier2CG.2)

set.seed(50)
la.model_fourier2CG.2 = cv.glmnet(x_fourier2CG.2, y, alpha=1, family="gaussian")
ri.model_fourier2CG.2 = cv.glmnet(x_fourier2CG.2, y, alpha=0, family="gaussian")

la.fourier2CG_best_lambda.2 = la.model_fourier2CG.2$lambda.min
la.fourier2CG_best_lambda.2
ri.fourier2CG_best_lambda.2 = ri.model_fourier2CG.2$lambda.min
ri.fourier2CG_best_lambda.2

la.model_fourier2CG.train_pred.2 = predict(la.model_fourier2CG.2, 
                                           newx = x_fourier2CG.2, 
                                           s=la.fourier2CG_best_lambda.2)
ri.model_fourier2CG.train_pred.2 = predict(ri.model_fourier2CG.2, 
                                           newx = x_fourier2CG.2, 
                                           s=ri.fourier2CG_best_lambda.2)

cor(la.model_fourier2CG.train_pred.2, y, method="pearson")
# 0.1115645
mean((la.model_fourier2CG.train_pred.2 - y)^2)
# 0.2393303
cor(ri.model_fourier2CG.train_pred.2, y, method="pearson")
# 0.1115222
mean((ri.model_fourier2CG.train_pred.2 - y)^2)
# 0.2393351

X_fourier2CG_test.2 = bind_cols(Xtwo_CG_fourier_cos_test, Xtwo_CG_fourier_sin_test)
x_fourier2CG_test.2 = sparse.model.matrix(~., data=X_fourier2CG_test.2)

la.model_fourier2CG.pred.2 = predict(la.model_fourier2CG.2, 
                                     newx = x_fourier2CG_test.2, 
                                     s=la.fourier2CG_best_lambda.2)
ri.model_fourier2CG.pred.2 = predict(ri.model_fourier2CG.2, 
                                     newx = x_fourier2CG_test.2, 
                                     s=ri.fourier2CG_best_lambda.2)

cor(la.model_fourier2CG.pred.2, y_test, method="pearson")
# 0.1123103
mean((la.model_fourier2CG.pred.2 - y_test)^2)
# 0.2379656
cor(ri.model_fourier2CG.pred.2, y_test, method="pearson")
# 0.1126235
mean((ri.model_fourier2CG.pred.2 - y_test)^2)
# 0.2379517
```

We get test prediction correlation of 0.1123103 and MSE of 0.2379656 with lasso
We get test prediction correlation of 0.1126235 and MSE of 0.2379517 with ridge



## Absolute value of Fourier features

```{r}
X_fourier2CG_abs.1 = bind_cols(abs(Xtwo_CG_fourier_cos), abs(Xtwo_CG_fourier_sin))
x_fourier2CG_abs.1 = sparse.model.matrix(~ ., data=X_fourier2CG_abs.1)

set.seed(50)
la.model_fourier2CG_abs.1 = cv.glmnet(x_fourier2CG_abs.1, y, alpha=1, family="gaussian")
ri.model_fourier2CG_abs.1 = cv.glmnet(x_fourier2CG_abs.1, y, alpha=0, family="gaussian")

la.fourier2CG_abs_best_lambda.1 = la.model_fourier2CG_abs.1$lambda.min
la.fourier2CG_abs_best_lambda.1
ri.fourier2CG_abs_best_lambda.1 = ri.model_fourier2CG_abs.1$lambda.min
ri.fourier2CG_abs_best_lambda.1

la.model_fourier2CG_abs.train_pred.1 = predict(la.model_fourier2CG_abs.1, 
                                               newx = x_fourier2CG_abs.1, 
                                               s=la.fourier2CG_abs_best_lambda.1)
ri.model_fourier2CG_abs.train_pred.1 = predict(ri.model_fourier2CG_abs.1, 
                                               newx = x_fourier2CG_abs.1, 
                                               s=ri.fourier2CG_abs_best_lambda.1)

cor(la.model_fourier2CG_abs.train_pred.1, y, method="pearson")
# 0.2206126
mean((la.model_fourier2CG_abs.train_pred.1 - y)^2)
# 0.2305563
cor(ri.model_fourier2CG_abs.train_pred.1, y, method="pearson")
# 0.2209021
mean((ri.model_fourier2CG_abs.train_pred.1 - y)^2)
# 0.2305226

X_fourier2CG_abs_test.1 = bind_cols(abs(Xtwo_CG_fourier_cos_test), abs(Xtwo_CG_fourier_sin_test))
x_fourier2CG_abs_test.1 = sparse.model.matrix(~., data=X_fourier2CG_abs_test.1)

la.model_fourier2CG_abs.pred.1 = predict(la.model_fourier2CG_abs.1, 
                                         newx = x_fourier2CG_abs_test.1, 
                                         s=la.fourier2CG_abs_best_lambda.1)
ri.model_fourier2CG_abs.pred.1 = predict(ri.model_fourier2CG_abs.1, 
                                         newx = x_fourier2CG_abs_test.1, 
                                         s=ri.fourier2CG_abs_best_lambda.1)

cor(la.model_fourier2CG_abs.pred.1, y_test, method="pearson")
# 0.2189688
mean((la.model_fourier2CG_abs.pred.1 - y_test)^2)
# 0.2294518
cor(ri.model_fourier2CG_abs.pred.1, y_test, method="pearson")
# 0.218732
mean((ri.model_fourier2CG_abs.pred.1 - y_test)^2)
# 0.2294748
```

We get test prediction correlation of 0.2189688 and MSE of 0.2294518 with lasso
We get test prediction correlation of 0.218732 and MSE of 0.2294748 with ridge



## Squared value of Fourier features

```{r}
X_fourier2CG_sq.1 = bind_cols(Xtwo_CG_fourier_cos^2, Xtwo_CG_fourier_sin^2)
x_fourier2CG_sq.1 = sparse.model.matrix(~ ., data=X_fourier2CG_sq.1)

set.seed(50)
la.model_fourier2CG_sq.1 = cv.glmnet(x_fourier2CG_sq.1, y, alpha=1, family="gaussian")
ri.model_fourier2CG_sq.1 = cv.glmnet(x_fourier2CG_sq.1, y, alpha=0, family="gaussian")

la.fourier2CG_sq_best_lambda.1 = la.model_fourier2CG_sq.1$lambda.min
la.fourier2CG_sq_best_lambda.1
ri.fourier2CG_sq_best_lambda.1 = ri.model_fourier2CG_sq.1$lambda.min
ri.fourier2CG_sq_best_lambda.1

la.model_fourier2CG_sq.train_pred.1 = predict(la.model_fourier2CG_sq.1, 
                                              newx = x_fourier2CG_sq.1, 
                                              s=la.fourier2CG_sq_best_lambda.1)
ri.model_fourier2CG_sq.train_pred.1 = predict(ri.model_fourier2CG_sq.1, 
                                              newx = x_fourier2CG_sq.1, 
                                              s=ri.fourier2CG_sq_best_lambda.1)

cor(la.model_fourier2CG_sq.train_pred.1, y, method="pearson")
# 0.2196291
mean((la.model_fourier2CG_sq.train_pred.1 - y)^2)
# 0.2306599
cor(ri.model_fourier2CG_sq.train_pred.1, y, method="pearson")
# 0.2198619
mean((ri.model_fourier2CG_sq.train_pred.1 - y)^2)
# 0.2306339

X_fourier2CG_sq_test.1 = bind_cols(Xtwo_CG_fourier_cos_test^2, Xtwo_CG_fourier_sin_test^2)
x_fourier2CG_sq_test.1 = sparse.model.matrix(~., data=X_fourier2CG_sq_test.1)

la.model_fourier2CG_sq.pred.1 = predict(la.model_fourier2CG_sq.1, 
                                        newx = x_fourier2CG_sq_test.1, 
                                        s=la.fourier2CG_sq_best_lambda.1)
ri.model_fourier2CG_sq.pred.1 = predict(ri.model_fourier2CG_sq.1, 
                                        newx = x_fourier2CG_sq_test.1, 
                                        s=ri.fourier2CG_sq_best_lambda.1)

cor(la.model_fourier2CG_sq.pred.1, y_test, method="pearson")
# 0.2159643
mean((la.model_fourier2CG_sq.pred.1 - y_test)^2)
# 0.2297677
cor(ri.model_fourier2CG_sq.pred.1, y_test, method="pearson")
# 0.2155257
mean((ri.model_fourier2CG_sq.pred.1 - y_test)^2)
# 0.2298113
```

We get test prediction correlation of 0.2159643 and MSE of 0.2297677 with lasso
We get test prediction correlation of 0.2155257 and MSE of 0.2298113 with ridge




# Inputs: Amplitude of Fourier Features Based on CC/GG/CG/GC Dinucleotides Calculated from scratch

```{r}
library(Matrix)
library(glmnet)
Xtwo_CG_fourier_amp = readRDS("data/Created/tiling_Xtwo_CG_fourier_amp.rds")
Xtwo_CG_fourier_amp_test = readRDS("data/Created/tiling_Xtwo_CG_fourier_amp_test.rds")
```

```{r}
X_fourier2CG_amp.1 = data.frame(Xtwo_CG_fourier_amp)
x_fourier2CG_amp.1 = sparse.model.matrix(~ ., data=X_fourier2CG_amp.1)

set.seed(50)
la.model_fourier2CG_amp.1 = cv.glmnet(x_fourier2CG_amp.1, y, alpha=1, family="gaussian")
ri.model_fourier2CG_amp.1 = cv.glmnet(x_fourier2CG_amp.1, y, alpha=0, family="gaussian")

la.fourier2CG_amp_best_lambda.1 = la.model_fourier2CG_amp.1$lambda.min
la.fourier2CG_amp_best_lambda.1
ri.fourier2CG_amp_best_lambda.1 = ri.model_fourier2CG_amp.1$lambda.min
ri.fourier2CG_amp_best_lambda.1

la.model_fourier2CG_amp.train_pred.1 = predict(la.model_fourier2CG_amp.1, 
                                               newx = x_fourier2CG_amp.1, 
                                               s=la.fourier2CG_amp_best_lambda.1)
ri.model_fourier2CG_amp.train_pred.1 = predict(ri.model_fourier2CG_amp.1, 
                                               newx = x_fourier2CG_amp.1, 
                                               s=ri.fourier2CG_amp_best_lambda.1)

cor(la.model_fourier2CG_amp.train_pred.1, y, method="pearson")
# 0.2231556
mean((la.model_fourier2CG_amp.train_pred.1 - y)^2)
# 0.2302804
cor(ri.model_fourier2CG_amp.train_pred.1, y, method="pearson")
# 0.2232736
mean((ri.model_fourier2CG_amp.train_pred.1 - y)^2)
# 0.2302671

X_fourier2CG_amp_test.1 = data.frame(Xtwo_CG_fourier_amp_test)
x_fourier2CG_amp_test.1 = sparse.model.matrix(~., data=X_fourier2CG_amp_test.1)

la.model_fourier2CG_amp.pred.1 = predict(la.model_fourier2CG_amp.1, 
                                         newx = x_fourier2CG_amp_test.1, 
                                         s=la.fourier2CG_amp_best_lambda.1)
ri.model_fourier2CG_amp.pred.1 = predict(ri.model_fourier2CG_amp.1, 
                                         newx = x_fourier2CG_amp_test.1, 
                                         s=ri.fourier2CG_amp_best_lambda.1)

cor(la.model_fourier2CG_amp.pred.1, y_test, method="pearson")
# 0.2180064
mean((la.model_fourier2CG_amp.pred.1 - y_test)^2)
# 0.2295522
cor(ri.model_fourier2CG_amp.pred.1, y_test, method="pearson")
# 0.2179029
mean((ri.model_fourier2CG_amp.pred.1 - y_test)^2)
# 0.2295636
```

We get test prediction correlation of 0.2180064 and MSE of 0.2295522 with lasso
We get test prediction correlation of 0.2179029 and MSE of 0.2295636 with ridge


# Inputs: Fourier Features Based on AA/TT/AT/TA and CC/GG/CG/GC Dinucleotides Calculated from scratch


```{r}
library(Matrix)
library(glmnet)
Xtwo_AT_fourier_cos = readRDS("data/Created/tiling_Xtwo_AT_fourier_cos.rds")
Xtwo_AT_fourier_sin = readRDS("data/Created/tiling_Xtwo_AT_fourier_sin.rds")
Xtwo_AT_fourier_cos_test = readRDS("data/Created/tiling_Xtwo_AT_fourier_cos_test.rds")
Xtwo_AT_fourier_sin_test = readRDS("data/Created/tiling_Xtwo_AT_fourier_sin_test.rds")

Xtwo_CG_fourier_cos = readRDS("data/Created/tiling_Xtwo_CG_fourier_cos.rds")
Xtwo_CG_fourier_sin = readRDS("data/Created/tiling_Xtwo_CG_fourier_sin.rds")
Xtwo_CG_fourier_cos_test = readRDS("data/Created/tiling_Xtwo_CG_fourier_cos_test.rds")
Xtwo_CG_fourier_sin_test = readRDS("data/Created/tiling_Xtwo_CG_fourier_sin_test.rds")
```

## Squared value of Fourier features

```{r}
X_fourier2AT_CG_sq.1 = bind_cols(Xtwo_AT_fourier_cos^2, Xtwo_AT_fourier_sin^2,
                                 Xtwo_CG_fourier_cos^2, Xtwo_CG_fourier_sin^2)
x_fourier2AT_CG_sq.1 = sparse.model.matrix(~ ., data=X_fourier2AT_CG_sq.1)

set.seed(50)
la.model_fourier2AT_CG_sq.1 = cv.glmnet(x_fourier2AT_CG_sq.1, y, alpha=1, family="gaussian")
ri.model_fourier2AT_CG_sq.1 = cv.glmnet(x_fourier2AT_CG_sq.1, y, alpha=0, family="gaussian")

la.fourier2AT_CG_sq_best_lambda.1 = la.model_fourier2AT_CG_sq.1$lambda.min
la.fourier2AT_CG_sq_best_lambda.1
ri.fourier2AT_CG_sq_best_lambda.1 = ri.model_fourier2AT_CG_sq.1$lambda.min
ri.fourier2AT_CG_sq_best_lambda.1

la.model_fourier2AT_CG_sq.train_pred.1 = predict(la.model_fourier2AT_CG_sq.1, 
                                                 newx = x_fourier2AT_CG_sq.1, 
                                                 s=la.fourier2AT_CG_sq_best_lambda.1)
ri.model_fourier2AT_CG_sq.train_pred.1 = predict(ri.model_fourier2AT_CG_sq.1, 
                                                 newx = x_fourier2AT_CG_sq.1, 
                                                 s=ri.fourier2AT_CG_sq_best_lambda.1)

cor(la.model_fourier2AT_CG_sq.train_pred.1, y, method="pearson")
# 0.4495899
mean((la.model_fourier2AT_CG_sq.train_pred.1 - y)^2)
# 0.1933616
cor(ri.model_fourier2AT_CG_sq.train_pred.1, y, method="pearson")
# 0.4496172
mean((ri.model_fourier2AT_CG_sq.train_pred.1 - y)^2)
# 0.1933666

X_fourier2AT_CG_sq_test.1 = bind_cols(Xtwo_AT_fourier_cos_test^2, Xtwo_AT_fourier_sin_test^2,
                                      Xtwo_CG_fourier_cos_test^2, Xtwo_CG_fourier_sin_test^2)
x_fourier2AT_CG_sq_test.1 = sparse.model.matrix(~., data=X_fourier2AT_CG_sq_test.1)

la.model_fourier2AT_CG_sq.pred.1 = predict(la.model_fourier2AT_CG_sq.1, 
                                           newx = x_fourier2AT_CG_sq_test.1, 
                                           s=la.fourier2AT_CG_sq_best_lambda.1)
ri.model_fourier2AT_CG_sq.pred.1 = predict(ri.model_fourier2AT_CG_sq.1, 
                                           newx = x_fourier2AT_CG_sq_test.1, 
                                           s=ri.fourier2AT_CG_sq_best_lambda.1)

cor(la.model_fourier2AT_CG_sq.pred.1, y_test, method="pearson")
# 0.4458001
mean((la.model_fourier2AT_CG_sq.pred.1 - y_test)^2)
# 0.1931124
cor(ri.model_fourier2AT_CG_sq.pred.1, y_test, method="pearson")
# 0.4457966
mean((ri.model_fourier2AT_CG_sq.pred.1 - y_test)^2)
# 0.1931252
```

We get test prediction correlation of 0.4458001 and MSE of 0.1931124 with lasso
We get test prediction correlation of 0.4457966 and MSE of 0.1931252 with ridge


# Inputs: Fourier antiphase feature Based on AA/TT/AT/TA and CC/GG/CG/GC Dinucleotides Calculated from scratch

```{r}
Xtwo_fourier_antiphase = readRDS("data/Created/tiling_Xtwo_fourier_antiphase.rds")
Xtwo_fourier_antiphase_test = readRDS("data/Created/tiling_Xtwo_fourier_antiphase_test.rds")
```

```{r}
fourier2_antiphase_df = data.frame(y, Xtwo_fourier_antiphase)
fourier2_antiphase_df = fourier2_antiphase_df[complete.cases(fourier2_antiphase_df),]
lm.fourier2_antiphase = lm(y~., data=fourier2_antiphase_df)

cor(lm.fourier2_antiphase$fitted.values, fourier2_antiphase_df$y)
# 0.2053897

fourier2_antiphase_test_df = data.frame(y_test, Xtwo_fourier_antiphase_test)
fourier2_antiphase_test_df = fourier2_antiphase_test_df[complete.cases(fourier2_antiphase_test_df),]
lm.fourier2_antiphase_pred = predict(lm.fourier2_antiphase, fourier2_antiphase_test_df)
cor(lm.fourier2_antiphase_pred, fourier2_antiphase_test_df$y_test)
# 0.2036734

mean((lm.fourier2_antiphase_pred - fourier2_antiphase_test_df$y_test)^2)
# 0.2309335
```

We get test prediction correlation of 0.2036734 and MSE of 0.2309335



# Inputs: Fourier distance feature Based on AA/TT/AT/TA and CC/GG/CG/GC Dinucleotides Calculated from scratch

```{r}
Xtwo_fourier_distance = readRDS("data/Created/tiling_Xtwo_fourier_distance.rds")
Xtwo_fourier_distance_test = readRDS("data/Created/tiling_Xtwo_fourier_distance_test.rds")
```

```{r}
fourier2_distance_df = data.frame(y, Xtwo_fourier_distance)
# fourier2_distance_df = fourier2_distance_df[complete.cases(fourier2_distance_df),]
lm.fourier2_distance = lm(y~., data=fourier2_distance_df)

cor(lm.fourier2_distance$fitted.values, y)
# 0.4130922

fourier2_distance_test_df = data.frame(y_test, Xtwo_fourier_distance_test)
# fourier2_distance_test_df = fourier2_distance_test_df[complete.cases(fourier2_distance_test_df),]
lm.fourier2_distance_pred = predict(lm.fourier2_distance, fourier2_distance_test_df)
cor(lm.fourier2_distance_pred, y_test)
# 0.4108517

mean((lm.fourier2_distance_pred - y_test)^2)
# 0.2003258
```

We get test prediction correlation of 0.4108517 and MSE of 0.2003258



# Inputs: Fourier Features Based on AAA/AAT/ATA/ATT/TAA/TAT/TTA/TTT Trinucleotides Calculated from scratch

```{r}
library(Matrix)
library(glmnet)
Xthree_AT_fourier_cos = readRDS("data/Created/tiling_Xthree_AT_fourier_cos.rds")
Xthree_AT_fourier_sin = readRDS("data/Created/tiling_Xthree_AT_fourier_sin.rds")
Xthree_AT_fourier_cos_test = readRDS("data/Created/tiling_Xthree_AT_fourier_cos_test.rds")
Xthree_AT_fourier_sin_test = readRDS("data/Created/tiling_Xthree_AT_fourier_sin_test.rds")
```

## Raw Fourier features

```{r}
X_fourier3 = bind_cols(Xthree_AT_fourier_cos, Xthree_AT_fourier_sin)
x_fourier3 = sparse.model.matrix(~ ., data=X_fourier3)

set.seed(50)
la.model_fourier3 = cv.glmnet(x_fourier3, y, alpha=1, family="gaussian")
ri.model_fourier3 = cv.glmnet(x_fourier3, y, alpha=0, family="gaussian")

la.fourier3_best_lambda = la.model_fourier3$lambda.min
la.fourier3_best_lambda
ri.fourier3_best_lambda = ri.model_fourier3$lambda.min
ri.fourier3_best_lambda

la.model_fourier3.train_pred = predict(la.model_fourier3, 
                                       newx = x_fourier3, 
                                       s=la.fourier3_best_lambda)
ri.model_fourier3.train_pred = predict(ri.model_fourier3, 
                                       newx = x_fourier3, 
                                       s=ri.fourier3_best_lambda)

cor(la.model_fourier3.train_pred, y, method="pearson")
# 0.110633
mean((la.model_fourier3.train_pred - y)^2)
# 0.2393994
cor(ri.model_fourier3.train_pred, y, method="pearson")
# 0.1117476
mean((ri.model_fourier3.train_pred - y)^2)
# 0.2393297

X_fourier3_test = bind_cols(Xthree_AT_fourier_cos_test, Xthree_AT_fourier_sin_test)
x_fourier3_test = sparse.model.matrix(~., data=X_fourier3_test)

la.model_fourier3.pred = predict(la.model_fourier3, 
                                 newx = x_fourier3_test, 
                                 s=la.fourier3_best_lambda)
ri.model_fourier3.pred = predict(ri.model_fourier3, 
                                 newx = x_fourier3_test, 
                                 s=ri.fourier3_best_lambda)

cor(la.model_fourier3.pred, y_test, method="pearson")
# 0.1074808
mean((la.model_fourier3.pred - y_test)^2)
# 0.2382275
cor(ri.model_fourier3.pred, y_test, method="pearson")
# 0.1067618
mean((ri.model_fourier3.pred - y_test)^2)
# 0.238258
```

We get test prediction correlation of 0.1074808 and MSE of 0.2382275 with lasso
We get test prediction correlation of 0.1067618 and MSE of 0.238258 with ridge



## Absolute value of Fourier features

```{r}
X_fourier3_abs = bind_cols(abs(Xthree_AT_fourier_cos), abs(Xthree_AT_fourier_sin))
x_fourier3_abs = sparse.model.matrix(~ ., data=X_fourier3_abs)

set.seed(50)
la.model_fourier3_abs = cv.glmnet(x_fourier3_abs, y, alpha=1, family="gaussian")
ri.model_fourier3_abs = cv.glmnet(x_fourier3_abs, y, alpha=0, family="gaussian")

la.fourier3_abs_best_lambda = la.model_fourier3_abs$lambda.min
la.fourier3_abs_best_lambda
ri.fourier3_abs_best_lambda = ri.model_fourier3_abs$lambda.min
ri.fourier3_abs_best_lambda

la.model_fourier3_abs.train_pred = predict(la.model_fourier3_abs, 
                                           newx = x_fourier3_abs, 
                                           s=la.fourier3_abs_best_lambda)
ri.model_fourier3_abs.train_pred = predict(ri.model_fourier3_abs, 
                                           newx = x_fourier3_abs, 
                                           s=ri.fourier3_abs_best_lambda)

cor(la.model_fourier3_abs.train_pred, y, method="pearson")
# 0.3877487
mean((la.model_fourier3_abs.train_pred - y)^2)
# 0.2059111
cor(ri.model_fourier3_abs.train_pred, y, method="pearson")
# 0.3877722
mean((ri.model_fourier3_abs.train_pred - y)^2)
# 0.2059142

X_fourier3_abs_test = bind_cols(abs(Xthree_AT_fourier_cos_test), abs(Xthree_AT_fourier_sin_test))
x_fourier3_abs_test = sparse.model.matrix(~., data=X_fourier3_abs_test)

la.model_fourier3_abs.pred = predict(la.model_fourier3_abs, 
                                     newx = x_fourier3_abs_test, 
                                     s=la.fourier3_abs_best_lambda)
ri.model_fourier3_abs.pred = predict(ri.model_fourier3_abs, 
                                     newx = x_fourier3_abs_test, 
                                     s=ri.fourier3_abs_best_lambda)

cor(la.model_fourier3_abs.pred, y_test, method="pearson")
# 0.3865635
mean((la.model_fourier3_abs.pred - y_test)^2)
# 0.2050001
cor(ri.model_fourier3_abs.pred, y_test, method="pearson")
# 0.386441
mean((ri.model_fourier3_abs.pred - y_test)^2)
# 0.2050341
```

We get test prediction correlation of 0.3865635 and MSE of 0.2050001 with lasso
We get test prediction correlation of 0.386441 and MSE of 0.2050341 with ridge



## Squared value of Fourier features

```{r}
X_fourier3_sq = bind_cols(Xthree_AT_fourier_cos^2, Xthree_AT_fourier_sin^2)
x_fourier3_sq = sparse.model.matrix(~ ., data=X_fourier3_sq)

set.seed(50)
la.model_fourier3_sq = cv.glmnet(x_fourier3_sq, y, alpha=1, family="gaussian")
ri.model_fourier3_sq = cv.glmnet(x_fourier3_sq, y, alpha=0, family="gaussian")

la.fourier3_sq_best_lambda = la.model_fourier3_sq$lambda.min
la.fourier3_sq_best_lambda
ri.fourier3_sq_best_lambda = ri.model_fourier3_sq$lambda.min
ri.fourier3_sq_best_lambda

la.model_fourier3_sq.train_pred = predict(la.model_fourier3_sq, 
                                          newx = x_fourier3_sq, 
                                          s=la.fourier3_sq_best_lambda)
ri.model_fourier3_sq.train_pred = predict(ri.model_fourier3_sq, 
                                          newx = x_fourier3_sq, 
                                          s=ri.fourier3_sq_best_lambda)

cor(la.model_fourier3_sq.train_pred, y, method="pearson")
# 0.4054642
mean((la.model_fourier3_sq.train_pred - y)^2)
# 0.2025057
cor(ri.model_fourier3_sq.train_pred, y, method="pearson")
# 0.4054897
mean((ri.model_fourier3_sq.train_pred - y)^2)
# 0.2025088

X_fourier3_sq_test = bind_cols(Xthree_AT_fourier_cos_test^2, Xthree_AT_fourier_sin_test^2)
x_fourier3_sq_test = sparse.model.matrix(~., data=X_fourier3_sq_test)

la.model_fourier3_sq.pred = predict(la.model_fourier3_sq, 
                                    newx = x_fourier3_sq_test, 
                                    s=la.fourier3_sq_best_lambda)
ri.model_fourier3_sq.pred = predict(ri.model_fourier3_sq, 
                                    newx = x_fourier3_sq_test, 
                                    s=ri.fourier3_sq_best_lambda)

cor(la.model_fourier3_sq.pred, y_test, method="pearson")
# 0.3984834
mean((la.model_fourier3_sq.pred - y_test)^2)
# 0.2027403
cor(ri.model_fourier3_sq.pred, y_test, method="pearson")
# 0.3982836
mean((ri.model_fourier3_sq.pred - y_test)^2)
# 0.2027837
```

We get test prediction correlation of 0.3984834 and MSE of 0.2027403 with lasso
We get test prediction correlation of 0.3982836 and MSE of 0.2027837 with ridge


# Inputs: Fourier Features Based on AA/TT/AT/TA Dinucleotides and AAA/AAT/ATA/ATT/TAA/TAT/TTA/TTT Trinucleotides Calculated from scratch

```{r}
library(Matrix)
library(glmnet)
Xtwo_AT_fourier_cos = readRDS("data/Created/tiling_Xtwo_AT_fourier_cos.rds")
Xtwo_AT_fourier_sin = readRDS("data/Created/tiling_Xtwo_AT_fourier_sin.rds")
Xtwo_AT_fourier_cos_test = readRDS("data/Created/tiling_Xtwo_AT_fourier_cos_test.rds")
Xtwo_AT_fourier_sin_test = readRDS("data/Created/tiling_Xtwo_AT_fourier_sin_test.rds")

Xthree_AT_fourier_cos = readRDS("data/Created/tiling_Xthree_AT_fourier_cos.rds")
Xthree_AT_fourier_sin = readRDS("data/Created/tiling_Xthree_AT_fourier_sin.rds")
Xthree_AT_fourier_cos_test = readRDS("data/Created/tiling_Xthree_AT_fourier_cos_test.rds")
Xthree_AT_fourier_sin_test = readRDS("data/Created/tiling_Xthree_AT_fourier_sin_test.rds")
```

## Squared value of Fourier features

```{r}
X_fourier23_sq.1 = bind_cols(Xtwo_AT_fourier_cos^2, Xtwo_AT_fourier_sin^2,
                             Xthree_AT_fourier_cos^2, Xthree_AT_fourier_sin^2)
x_fourier23_sq.1 = sparse.model.matrix(~ ., data=X_fourier23_sq.1)

set.seed(50)
la.model_fourier23_sq.1 = cv.glmnet(x_fourier23_sq.1, y, alpha=1, family="gaussian")
ri.model_fourier23_sq.1 = cv.glmnet(x_fourier23_sq.1, y, alpha=0, family="gaussian")

la.fourier23_sq_best_lambda.1 = la.model_fourier23_sq.1$lambda.min
la.fourier23_sq_best_lambda.1
ri.fourier23_sq_best_lambda.1 = ri.model_fourier23_sq.1$lambda.min
ri.fourier23_sq_best_lambda.1

la.model_fourier23_sq.train_pred.1 = predict(la.model_fourier23_sq.1, 
                                             newx = x_fourier23_sq.1, 
                                             s=la.fourier23_sq_best_lambda.1)
ri.model_fourier23_sq.train_pred.1 = predict(ri.model_fourier23_sq.1, 
                                             newx = x_fourier23_sq.1, 
                                             s=ri.fourier23_sq_best_lambda.1)

cor(la.model_fourier23_sq.train_pred.1, y, method="pearson")
# 0.4425116
mean((la.model_fourier23_sq.train_pred.1 - y)^2)
# 0.1948916
cor(ri.model_fourier23_sq.train_pred.1, y, method="pearson")
# 0.4424999
mean((ri.model_fourier23_sq.train_pred.1 - y)^2)
# 0.1949009

X_fourier23_sq_test.1 = bind_cols(Xtwo_AT_fourier_cos_test^2, Xtwo_AT_fourier_sin_test^2,
                                  Xthree_AT_fourier_cos_test^2, Xthree_AT_fourier_sin_test^2)
x_fourier23_sq_test.1 = sparse.model.matrix(~., data=X_fourier23_sq_test.1)

la.model_fourier23_sq.pred.1 = predict(la.model_fourier23_sq.1, 
                                       newx = x_fourier23_sq_test.1, 
                                       s=la.fourier23_sq_best_lambda.1)
ri.model_fourier23_sq.pred.1 = predict(ri.model_fourier23_sq.1, 
                                       newx = x_fourier23_sq_test.1, 
                                       s=ri.fourier23_sq_best_lambda.1)

cor(la.model_fourier23_sq.pred.1, y_test, method="pearson")
# 0.4390548
mean((la.model_fourier23_sq.pred.1 - y_test)^2)
# 0.1945543
cor(ri.model_fourier23_sq.pred.1, y_test, method="pearson")
# 0.4390413
mean((ri.model_fourier23_sq.pred.1 - y_test)^2)
# 0.1945698
```

We get test prediction correlation of 0.4390548 and MSE of 0.1945543 with lasso
We get test prediction correlation of 0.4390413 and MSE of 0.1945698 with ridge


# Inputs: Fourier Features Based on CCC/CCG/CGC/CGG/GCC/GCG/GGC/GGG Trinucleotides Calculated from scratch

```{r}
Xthree_CG_fourier_cos = readRDS("data/Created/tiling_Xthree_CG_fourier_cos.rds")
Xthree_CG_fourier_sin = readRDS("data/Created/tiling_Xthree_CG_fourier_sin.rds")
Xthree_CG_fourier_cos_test = readRDS("data/Created/tiling_Xthree_CG_fourier_cos_test.rds")
Xthree_CG_fourier_sin_test = readRDS("data/Created/tiling_Xthree_CG_fourier_sin_test.rds")
```

## Raw Fourier features

```{r}
X_fourier3CG = bind_cols(Xthree_CG_fourier_cos, Xthree_CG_fourier_sin)
x_fourier3CG = sparse.model.matrix(~ ., data=X_fourier3CG)

set.seed(50)
la.model_fourier3CG = cv.glmnet(x_fourier3CG, y, alpha=1, family="gaussian")
ri.model_fourier3CG = cv.glmnet(x_fourier3CG, y, alpha=0, family="gaussian")

la.fourier3CG_best_lambda = la.model_fourier3CG$lambda.min
la.fourier3CG_best_lambda
ri.fourier3CG_best_lambda = ri.model_fourier3CG$lambda.min
ri.fourier3CG_best_lambda

la.model_fourier3CG.train_pred = predict(la.model_fourier3CG, 
                                         newx = x_fourier3CG, 
                                         s=la.fourier3CG_best_lambda)
ri.model_fourier3CG.train_pred = predict(ri.model_fourier3CG, 
                                         newx = x_fourier3CG, 
                                         s=ri.fourier3CG_best_lambda)

cor(la.model_fourier3CG.train_pred, y, method="pearson")
# 0.09464623
mean((la.model_fourier3CG.train_pred - y)^2)
# 0.2401757
cor(ri.model_fourier3CG.train_pred, y, method="pearson")
# 0.0946409
mean((ri.model_fourier3CG.train_pred - y)^2)
# 0.2401767

X_fourier3CG_test = bind_cols(Xthree_CG_fourier_cos_test, Xthree_CG_fourier_sin_test)
x_fourier3CG_test = sparse.model.matrix(~., data=X_fourier3CG_test)

la.model_fourier3CG.pred = predict(la.model_fourier3CG, 
                                   newx = x_fourier3CG_test, 
                                   s=la.fourier3CG_best_lambda)
ri.model_fourier3CG.pred = predict(ri.model_fourier3CG, 
                                   newx = x_fourier3CG_test, 
                                   s=ri.fourier3CG_best_lambda)

cor(la.model_fourier3CG.pred, y_test, method="pearson")
# 0.1014645
mean((la.model_fourier3CG.pred - y_test)^2)
# 0.2385337
cor(ri.model_fourier3CG.pred, y_test, method="pearson")
# 0.1015675
mean((ri.model_fourier3CG.pred - y_test)^2)
# 0.2385333
```

We get test prediction correlation of 0.1014645 and MSE of 0.2385337 with lasso
We get test prediction correlation of 0.1015675 and MSE of 0.2385333 with ridge

## Absolute value of Fourier features

```{r}
X_fourier3CG_abs = bind_cols(abs(Xthree_CG_fourier_cos), abs(Xthree_CG_fourier_sin))
x_fourier3CG_abs = sparse.model.matrix(~ ., data=X_fourier3CG_abs)

set.seed(50)
la.model_fourier3CG_abs = cv.glmnet(x_fourier3CG_abs, y, alpha=1, family="gaussian")
ri.model_fourier3CG_abs = cv.glmnet(x_fourier3CG_abs, y, alpha=0, family="gaussian")

la.fourier3CG_abs_best_lambda = la.model_fourier3CG_abs$lambda.min
la.fourier3CG_abs_best_lambda
ri.fourier3CG_abs_best_lambda = ri.model_fourier3CG_abs$lambda.min
ri.fourier3CG_abs_best_lambda

la.model_fourier3CG_abs.train_pred = predict(la.model_fourier3CG_abs, 
                                             newx = x_fourier3CG_abs, 
                                             s=la.fourier3CG_abs_best_lambda)
ri.model_fourier3CG_abs.train_pred = predict(ri.model_fourier3CG_abs, 
                                             newx = x_fourier3CG_abs, 
                                             s=ri.fourier3CG_abs_best_lambda)

cor(la.model_fourier3CG_abs.train_pred, y, method="pearson")
# 0.1328121
mean((la.model_fourier3CG_abs.train_pred - y)^2)
# 0.2380809
cor(ri.model_fourier3CG_abs.train_pred, y, method="pearson")
# 0.1335408
mean((ri.model_fourier3CG_abs.train_pred - y)^2)
# 0.2380288

X_fourier3CG_abs_test = bind_cols(abs(Xthree_CG_fourier_cos_test), abs(Xthree_CG_fourier_sin_test))
x_fourier3CG_abs_test = sparse.model.matrix(~., data=X_fourier3CG_abs_test)

la.model_fourier3CG_abs.pred = predict(la.model_fourier3CG_abs, 
                                       newx = x_fourier3CG_abs_test, 
                                       s=la.fourier3CG_abs_best_lambda)
ri.model_fourier3CG_abs.pred = predict(ri.model_fourier3CG_abs, 
                                       newx = x_fourier3CG_abs_test, 
                                       s=ri.fourier3CG_abs_best_lambda)

cor(la.model_fourier3CG_abs.pred, y_test, method="pearson")
# 0.126132
mean((la.model_fourier3CG_abs.pred - y_test)^2)
# 0.237171
cor(ri.model_fourier3CG_abs.pred, y_test, method="pearson")
# 0.126703
mean((ri.model_fourier3CG_abs.pred - y_test)^2)
# 0.2371377
```

We get test prediction correlation of 0.126132 and MSE of 0.237171 with lasso
We get test prediction correlation of 0.126703 and MSE of 0.2371377 with ridge

## Squared value of Fourier features

```{r}
X_fourier3CG_sq = bind_cols(Xthree_CG_fourier_cos^2, Xthree_CG_fourier_sin^2)
x_fourier3CG_sq = sparse.model.matrix(~ ., data=X_fourier3CG_sq)

set.seed(50)
la.model_fourier3CG_sq = cv.glmnet(x_fourier3CG_sq, y, alpha=1, family="gaussian")
ri.model_fourier3CG_sq = cv.glmnet(x_fourier3CG_sq, y, alpha=0, family="gaussian")

la.fourier3CG_sq_best_lambda = la.model_fourier3CG_sq$lambda.min
la.fourier3CG_sq_best_lambda
ri.fourier3CG_sq_best_lambda = ri.model_fourier3CG_sq$lambda.min
ri.fourier3CG_sq_best_lambda

la.model_fourier3CG_sq.train_pred = predict(la.model_fourier3CG_sq, 
                                            newx = x_fourier3CG_sq, 
                                            s=la.fourier3CG_sq_best_lambda)
ri.model_fourier3CG_sq.train_pred = predict(ri.model_fourier3CG_sq, 
                                            newx = x_fourier3CG_sq, 
                                            s=ri.fourier3CG_sq_best_lambda)

cor(la.model_fourier3CG_sq.train_pred, y, method="pearson")
# 0.1284571
mean((la.model_fourier3CG_sq.train_pred - y)^2)
# 0.23835
cor(ri.model_fourier3CG_sq.train_pred, y, method="pearson")
# 0.1285514
mean((ri.model_fourier3CG_sq.train_pred - y)^2)
# 0.2383477

X_fourier3CG_sq_test = bind_cols(Xthree_CG_fourier_cos_test^2, Xthree_CG_fourier_sin_test^2)
x_fourier3CG_sq_test = sparse.model.matrix(~., data=X_fourier3CG_sq_test)

la.model_fourier3CG_sq.pred = predict(la.model_fourier3CG_sq, 
                                      newx = x_fourier3CG_sq_test, 
                                      s=la.fourier3CG_sq_best_lambda)
ri.model_fourier3CG_sq.pred = predict(ri.model_fourier3CG_sq, 
                                      newx = x_fourier3CG_sq_test, 
                                      s=ri.fourier3CG_sq_best_lambda)

cor(la.model_fourier3CG_sq.pred, y_test, method="pearson")
# 0.1208532
mean((la.model_fourier3CG_sq.pred - y_test)^2)
# 0.2374861
cor(ri.model_fourier3CG_sq.pred, y_test, method="pearson")
# 0.1204101
mean((ri.model_fourier3CG_sq.pred - y_test)^2)
# 0.2375112
```

We get test prediction correlation of 0.1208532 and MSE of 0.2374861 with lasso
We get test prediction correlation of 0.1204101 and MSE of 0.2375112 with ridge


# Inputs: Position Specific Nucleotides + Fourier Features Based on A/T Nucleotides Calculated from scratch

## Include interaction terms for position specific nucleotides

### Absolute value of Fourier features

FIXME

We get test prediction correlation of 0.5989802 and MSE of 0.1547213 with lasso
We get test prediction correlation of 0.5923677 and MSE of 0.1567304 with ridge

### Squared value of Fourier features

FIXME

We get test prediction correlation of 0.6064937 and MSE of 0.1524679 with lasso
We get test prediction correlation of 0.594584 and MSE of 0.1558945 with ridge

# Inputs: Position Specific Nucleotides + Fourier Features Based on A/T Nucleotides Calculated from scratch + Markov Ratio

## Include interaction terms for position specific nucleotides

### Absolute value of Fourier features

FIXME

We get test prediction correlation of 0.6547909 and MSE of 0.146181 with lasso
We get test prediction correlation of 0.6597876 and MSE of 0.1370969 with ridge

### Squared value of Fourier features

FIXME

We get test prediction correlation of 0.658897 and MSE of 0.1447027 with lasso
We get test prediction correlation of 0.6626426 and MSE of 0.1361796 with ridge

# Inputs: Counts of dinucleotides + Fourier Features Based on A/T Nucleotides Calculated from scratch

```{r}
nucleotides <- c("A", "C", "G", "T")
dinucleotides <- gtools::permutations(n = 4, r = 2, v = nucleotides,
                                      repeats.allowed = TRUE) %>%
  apply(1, paste, collapse = "")

Xone_AT_fourier_cos = readRDS("data/Created/tiling_Xone_AT_fourier_cos.rds")
Xone_AT_fourier_sin = readRDS("data/Created/tiling_Xone_AT_fourier_sin.rds")
Xone_AT_fourier_cos_test = readRDS("data/Created/tiling_Xone_AT_fourier_cos_test.rds")
Xone_AT_fourier_sin_test = readRDS("data/Created/tiling_Xone_AT_fourier_sin_test.rds")

Xone_AT_fourier_random_cos = readRDS("data/Created/random_Xone_AT_fourier_cos.rds")
Xone_AT_fourier_random_sin = readRDS("data/Created/random_Xone_AT_fourier_sin.rds")
Xone_AT_fourier_cos_random_test = readRDS("data/Created/random_Xone_AT_fourier_cos_test.rds")
Xone_AT_fourier_sin_random_test = readRDS("data/Created/random_Xone_AT_fourier_sin_test.rds")
```

## Squared value of Fourier features

```{r}
dat_di2 = cbind(dat%>%
                  select(all_of(dinucleotides), C0_new), 
                Xone_AT_fourier_cos^2, Xone_AT_fourier_sin^2)
di2 = lm(C0_new~., data = dat_di2)
cor(di2$fitted.values, y)
# 0.5282832

dat_test_di2 = cbind(dat_test%>%
                       select(all_of(dinucleotides), C0_new), Xone_AT_fourier_cos_test^2, Xone_AT_fourier_sin_test^2)
di2_pred = predict(di2, dat_test_di2)
cor(di2_pred, y_test)
# 0.5282508

mean((di2_pred - y_test)^2)
# 0.1737535

dat_random_test_di = dat_random_test %>%
  select(all_of(dinucleotides), C0_new)
dat_random_test_di2 = cbind(dat_random_test_di, Xone_AT_fourier_cos_random_test^2, Xone_AT_fourier_sin_random_test^2)
di2_random_pred = predict(di2, dat_random_test_di2)
cor(di2_random_pred, dat_random_test$C0_new)
# 0.492201
```

We get test prediction correlation of 0.5282508 and MSE of 0.1737535


# Inputs: Counts of dinucleotides + Fourier Features Based on A/T Nucleotides Calculated from scratch + Markov Ratio

```{r}
nucleotides <- c("A", "C", "G", "T")
dinucleotides <- gtools::permutations(n = 4, r = 2, v = nucleotides,
                                      repeats.allowed = TRUE) %>%
  apply(1, paste, collapse = "")

Xone_AT_fourier_cos = readRDS("data/Created/tiling_Xone_AT_fourier_cos.rds")
Xone_AT_fourier_sin = readRDS("data/Created/tiling_Xone_AT_fourier_sin.rds")
Xone_AT_fourier_cos_test = readRDS("data/Created/tiling_Xone_AT_fourier_cos_test.rds")
Xone_AT_fourier_sin_test = readRDS("data/Created/tiling_Xone_AT_fourier_sin_test.rds")
```

## Squared value of Fourier features

```{r}
dat_di3 = cbind(dat%>%
                  select(all_of(dinucleotides), C0_new, ratio_score_2nd), 
                Xone_AT_fourier_cos^2, Xone_AT_fourier_sin^2)
di3 = lm(C0_new~., data = dat_di3)
cor(di3$fitted.values, y)
# 0.5621387

dat_test_di3 = cbind(dat_test%>%
                       select(all_of(dinucleotides), C0_new, ratio_score_2nd), 
                     Xone_AT_fourier_cos_test^2, Xone_AT_fourier_sin_test^2)
di3_pred = predict(di3, dat_test_di3)
cor(di3_pred, y_test)
# 0.6182846

mean((di3_pred - y_test)^2)
# 0.1533497
```

We get test prediction correlation of 0.6182846 and MSE of 0.1533497

# Inputs: Counts of dinucleotides + Fourier Features Based on AA/TT/AT/TA Dinucleotides Calculated from scratch

```{r}
nucleotides <- c("A", "C", "G", "T")
dinucleotides <- gtools::permutations(n = 4, r = 2, v = nucleotides,
                                      repeats.allowed = TRUE) %>%
  apply(1, paste, collapse = "")

Xtwo_AT_fourier_cos = readRDS("data/Created/tiling_Xtwo_AT_fourier_cos.rds")
Xtwo_AT_fourier_sin = readRDS("data/Created/tiling_Xtwo_AT_fourier_sin.rds")
Xtwo_AT_fourier_cos_test = readRDS("data/Created/tiling_Xtwo_AT_fourier_cos_test.rds")
Xtwo_AT_fourier_sin_test = readRDS("data/Created/tiling_Xtwo_AT_fourier_sin_test.rds")
```

## Squared value of Fourier features

```{r}
dat_di4 = cbind(dat%>%
                  select(all_of(dinucleotides), C0_new), 
                Xtwo_AT_fourier_cos^2, Xtwo_AT_fourier_sin^2)
di4 = lm(C0_new~., data = dat_di4)
cor(di4$fitted.values, y)
# 0.5408736

dat_test_di4 = cbind(dat_test%>%
                       select(all_of(dinucleotides), C0_new), 
                     Xtwo_AT_fourier_cos_test^2, Xtwo_AT_fourier_sin_test^2)
di4_pred = predict(di4, dat_test_di4)
cor(di4_pred, y_test)
# 0.5420182

mean((di4_pred - y_test)^2)
# 0.1702036
```

We get test prediction correlation of 0.5420182 and MSE of 0.1702036


# Inputs: Position Specific Nucleotides + Counts of dinucleotides + Fourier Features Based on AA/TT/AT/TA Dinucleotides Calculated from scratch

```{r}
ps1 <- paste0("X", 1:50, "mono")
nucleotides <- c("A", "C", "G", "T")
dinucleotides <- gtools::permutations(n = 4, r = 2, v = nucleotides,
                                      repeats.allowed = TRUE) %>%
  apply(1, paste, collapse = "")

Xtwo_AT_fourier_cos = readRDS("data/Created/tiling_Xtwo_AT_fourier_cos.rds")
Xtwo_AT_fourier_sin = readRDS("data/Created/tiling_Xtwo_AT_fourier_sin.rds")
Xtwo_AT_fourier_cos_test = readRDS("data/Created/tiling_Xtwo_AT_fourier_cos_test.rds")
Xtwo_AT_fourier_sin_test = readRDS("data/Created/tiling_Xtwo_AT_fourier_sin_test.rds")
```

## Squared value of Fourier features

```{r}
dat_di5 = cbind(dat%>%
                  select(all_of(dinucleotides), all_of(ps1), C0_new), 
                Xtwo_AT_fourier_cos^2, Xtwo_AT_fourier_sin^2)
di5 = lm(C0_new~., data = dat_di5)
cor(di5$fitted.values, y)
# 0.5569422

dat_test_di5 = cbind(dat_test%>%
                       select(all_of(dinucleotides), all_of(ps1), C0_new), 
                     Xtwo_AT_fourier_cos_test^2, Xtwo_AT_fourier_sin_test^2)
di5_pred = predict(di5, dat_test_di5)
cor(di5_pred, y_test)
# 0.5604364

mean((di5_pred - y_test)^2)
# 0.1653147
```

We get test prediction correlation of 0.5604364 and MSE of 0.1653147

# Inputs: Position Specific Nucleotides + Counts of dinucleotides + Fourier Features Based on AA/TT/AT/TA and CC/GG/CG/GC Dinucleotides Calculated from scratch

```{r}
ps1 <- paste0("X", 1:50, "mono")
nucleotides <- c("A", "C", "G", "T")
dinucleotides <- gtools::permutations(n = 4, r = 2, v = nucleotides,
                                      repeats.allowed = TRUE) %>%
  apply(1, paste, collapse = "")

Xtwo_AT_fourier_cos = readRDS("data/Created/tiling_Xtwo_AT_fourier_cos.rds")
Xtwo_AT_fourier_sin = readRDS("data/Created/tiling_Xtwo_AT_fourier_sin.rds")
Xtwo_AT_fourier_cos_test = readRDS("data/Created/tiling_Xtwo_AT_fourier_cos_test.rds")
Xtwo_AT_fourier_sin_test = readRDS("data/Created/tiling_Xtwo_AT_fourier_sin_test.rds")

Xtwo_CG_fourier_cos = readRDS("data/Created/tiling_Xtwo_CG_fourier_cos.rds")
Xtwo_CG_fourier_sin = readRDS("data/Created/tiling_Xtwo_CG_fourier_sin.rds")
Xtwo_CG_fourier_cos_test = readRDS("data/Created/tiling_Xtwo_CG_fourier_cos_test.rds")
Xtwo_CG_fourier_sin_test = readRDS("data/Created/tiling_Xtwo_CG_fourier_sin_test.rds")
```

## Squared value of Fourier features

```{r}
dat_di7 = cbind(dat%>%
                  select(all_of(ps1), all_of(dinucleotides), C0_new), 
                Xtwo_AT_fourier_cos^2, Xtwo_AT_fourier_sin^2,
                Xtwo_CG_fourier_cos^2, Xtwo_CG_fourier_sin^2)
di7 = lm(C0_new~., data = dat_di7)
cor(di7$fitted.values, y)
# 0.5630473

dat_test_di7 = cbind(dat_test%>%
                       select(all_of(ps1), all_of(dinucleotides), C0_new), 
                     Xtwo_AT_fourier_cos_test^2, Xtwo_AT_fourier_sin_test^2,
                     Xtwo_CG_fourier_cos_test^2, Xtwo_CG_fourier_sin_test^2)
di7_pred = predict(di7, dat_test_di7)
cor(di7_pred, y_test)
# 0.5651252

mean((di7_pred - y_test)^2)
# 0.1640416
```

We get test prediction correlation of 0.5651252 and MSE of 0.1640416


# Inputs: Position Specific Nucleotides + Counts of dinucleotides + Fourier Features Based on AA/TT/AT/TA and CC/GG/CG/GC Dinucleotides + Distance Calculated from scratch

```{r}
ps1 <- paste0("X", 1:50, "mono")
nucleotides <- c("A", "C", "G", "T")
dinucleotides <- gtools::permutations(n = 4, r = 2, v = nucleotides,
                                      repeats.allowed = TRUE) %>%
  apply(1, paste, collapse = "")

Xtwo_AT_fourier_cos = readRDS("data/Created/tiling_Xtwo_AT_fourier_cos.rds")
Xtwo_AT_fourier_sin = readRDS("data/Created/tiling_Xtwo_AT_fourier_sin.rds")
Xtwo_AT_fourier_cos_test = readRDS("data/Created/tiling_Xtwo_AT_fourier_cos_test.rds")
Xtwo_AT_fourier_sin_test = readRDS("data/Created/tiling_Xtwo_AT_fourier_sin_test.rds")

Xtwo_CG_fourier_cos = readRDS("data/Created/tiling_Xtwo_CG_fourier_cos.rds")
Xtwo_CG_fourier_sin = readRDS("data/Created/tiling_Xtwo_CG_fourier_sin.rds")
Xtwo_CG_fourier_cos_test = readRDS("data/Created/tiling_Xtwo_CG_fourier_cos_test.rds")
Xtwo_CG_fourier_sin_test = readRDS("data/Created/tiling_Xtwo_CG_fourier_sin_test.rds")

Xtwo_fourier_distance = readRDS("data/Created/tiling_Xtwo_fourier_distance.rds")
Xtwo_fourier_distance_test = readRDS("data/Created/tiling_Xtwo_fourier_distance_test.rds")
```

## Squared value of Fourier features

```{r}
dat_di8 = cbind(dat%>%
                  select(all_of(ps1), all_of(dinucleotides), C0_new), 
                Xtwo_AT_fourier_cos^2, Xtwo_AT_fourier_sin^2,
                Xtwo_CG_fourier_cos^2, Xtwo_CG_fourier_sin^2,
                Xtwo_fourier_distance)

di8 = lm(C0_new~., data = dat_di8)
cor(di8$fitted.values, y)
# 0.5669834

dat_test_di8 = cbind(dat_test%>%
                       select(all_of(ps1), all_of(dinucleotides), C0_new), 
                     Xtwo_AT_fourier_cos_test^2, Xtwo_AT_fourier_sin_test^2,
                     Xtwo_CG_fourier_cos_test^2, Xtwo_CG_fourier_sin_test^2,
                     Xtwo_fourier_distance_test)
di8_pred = predict(di8, dat_test_di8)
cor(di8_pred, y_test)
# 0.5692508

mean((di8_pred - y_test)^2)
# 0.1629129
```

We get test prediction correlation of 0.5692508 and MSE of 0.1629129


# Inputs: Position Specific Dinucleotides + Fourier Features Based on A/T Nucleotides Calculated from scratch

FIXME

# Inputs: Position Specific Dinucleotides + Fourier Features Based on A/T Nucleotides Calculated from scratch + Markov Ratio

FIXME

# Inputs: Position Specific Dinucleotides + Fourier Features Based on A/T Nucleotides Calculated using fft

FIXME

# Inputs: Position Specific Dinucleotides + Fourier Features Based on A/T Nucleotides Calculated using fft + Markov Ratio

FIXME

# Inputs: Position Specific Dinucleotides + Fourier Features Based on AA/TT/AT/TA Dinucleotides Calculated from scratch

FIXME

# Inputs: Position Specific Dinucleotides + Fourier Features Based on AA/TT/AT/TA Dinucleotides Calculated from scratch + Markov Ratio

FIXME

# Inputs: Position Specific Dinucleotides + Fourier Features Based on AA/TT/AT/TA Dinucleotides Calculated using fft

```{r}
ps2 <- paste0("X", 1:49, "di")

Xtwo_AorT_fourier_cos = readRDS("data/Created/tiling_Xtwo_AorT_fourier_cos.rds")
Xtwo_AorT_fourier_sin = readRDS("data/Created/tiling_Xtwo_AorT_fourier_sin.rds")
Xtwo_AorT_fourier_cos_test = readRDS("data/Created/tiling_Xtwo_AorT_fourier_cos_test.rds")
Xtwo_AorT_fourier_sin_test = readRDS("data/Created/tiling_Xtwo_AorT_fourier_sin_test.rds")
```

## Squared Value of Fourier Features

### Simple Linear Model

```{r}
dat_ps2_3 = cbind(dat %>% select(all_of(ps2), C0_new), 
                  (Xtwo_AorT_fourier_cos)^2, (Xtwo_AorT_fourier_sin)^2)
ps2_3_lm = lm(C0_new~., data=dat_ps2_3)

cor(ps2_3_lm$fitted.values, y)
# 0.5285921

dat_test_ps2_3 = cbind(dat_test %>% select(all_of(ps2), C0_new),
                       (Xtwo_AorT_fourier_cos_test)^2, (Xtwo_AorT_fourier_sin_test)^2)
ps2_3_lm_pred = predict(ps2_3_lm, dat_test_ps2_3)
cor(ps2_3_lm_pred, y_test)
# 0.5293898

mean((ps2_3_lm_pred - y_test)^2)
# 0.1734634
```

We get test prediction correlation of 0.5293898 and MSE of 0.1734634

# Inputs: Position Specific Dinucleotides + Fourier Features Based on AA/TT/AT/TA Dinucleotides Calculated using fft + Markov Ratio

```{r}
ps2 <- paste0("X", 1:49, "di")

Xtwo_AorT_fourier_cos = readRDS("data/Created/tiling_Xtwo_AorT_fourier_cos.rds")
Xtwo_AorT_fourier_sin = readRDS("data/Created/tiling_Xtwo_AorT_fourier_sin.rds")
Xtwo_AorT_fourier_cos_test = readRDS("data/Created/tiling_Xtwo_AorT_fourier_cos_test.rds")
Xtwo_AorT_fourier_sin_test = readRDS("data/Created/tiling_Xtwo_AorT_fourier_sin_test.rds")
```

## Squared Value of Fourier Features

### Simple Linear Model

```{r}
dat_ps2_4 = cbind(dat %>% select(all_of(ps2), ratio_score_2nd, C0_new), 
                  (Xtwo_AorT_fourier_cos)^2, (Xtwo_AorT_fourier_sin)^2)
ps2_4_lm = lm(C0_new~., data=dat_ps2_4)

cor(ps2_4_lm$fitted.values, y)
# 0.5518466

dat_test_ps2_4 = cbind(dat_test %>% select(all_of(ps2), ratio_score_2nd, C0_new),
                       (Xtwo_AorT_fourier_cos_test)^2, (Xtwo_AorT_fourier_sin_test)^2)
ps2_4_lm_pred = predict(ps2_4_lm, dat_test_ps2_4)
cor(ps2_4_lm_pred, y_test)
# 0.6164852

mean((ps2_4_lm_pred - y_test)^2)
# 0.1532374
```

We get test prediction correlation of 0.6164852 and MSE of 0.1532374


# Inputs: Position Specific Dinucleotides + Counts of dinucleotides + Fourier Features Based on A/T Nucleotides and AA/TT/AT/TA Dinucleotides Calculated from scratch

```{r}
library(lightgbm)
source("scripts/functions/lgbm-helper-functions.R")
ps2 <- paste0("X", 1:49, "di")
nucleotides <- c("A", "C", "G", "T")
dinucleotides <- gtools::permutations(n = 4, r = 2, v = nucleotides,
                                      repeats.allowed = TRUE) %>%
  apply(1, paste, collapse = "")

Xtwo_AT_fourier_cos = readRDS("data/Created/tiling_Xtwo_AT_fourier_cos.rds")
Xtwo_AT_fourier_sin = readRDS("data/Created/tiling_Xtwo_AT_fourier_sin.rds")
Xtwo_AT_fourier_cos_test = readRDS("data/Created/tiling_Xtwo_AT_fourier_cos_test.rds")
Xtwo_AT_fourier_sin_test = readRDS("data/Created/tiling_Xtwo_AT_fourier_sin_test.rds")
```

## Squared value of Fourier features

### Simple Linear Model

```{r}
dat_di6 = cbind(dat %>%
                  select(all_of(ps2), all_of(dinucleotides), C0_new),
                Xtwo_AT_fourier_cos^2, Xtwo_AT_fourier_sin^2)
di6 = lm(C0_new~., data = dat_di6)
cor(di6$fitted.values, y)
# 0.5699001

dat_test_di6 = cbind(dat_test %>%
                       select(all_of(ps2), all_of(dinucleotides), C0_new),
                     Xtwo_AT_fourier_cos_test^2, Xtwo_AT_fourier_sin_test^2)
di6_pred = predict(di6, dat_test_di6)
cor(di6_pred, y_test)
# 0.5669735

mean((di6_pred - y_test)^2)
# 0.1635324
```

We get test prediction correlation of 0.5669735 and MSE of 0.1635324

### LightGBM (tree-based) Model

```{r}
set.seed(50)
dat_di6.lgb_train_set = dat_di6 %>%
  select(-C0_new)
dat_di6.lgb_train_rules = lgb.convert_with_rules(data = dat_di6.lgb_train_set)
dat_di6.lgb_train_data = lgb.Dataset(data = as.matrix(dat_di6.lgb_train_rules$data),
                                     label = dat_di6$C0_new,
                                     categorical_feature = handle_categorical(colnames(dat_di6.lgb_train_rules$data)))
dat_di6.lgb_test_set = dat_test_di6 %>%
  select(-C0_new)
dat_di6.lgb_test_matrix = as.matrix(lgb.convert_with_rules(data = dat_di6.lgb_test_set, rules = dat_di6.lgb_train_rules$rules)$data)
dat_di6.lgb_test_data = lgb.Dataset(data = dat_di6.lgb_test_matrix,
                                    label = dat_test_di6$C0_new,
                                    categorical_feature = handle_categorical(colnames(dat_di6.lgb_test_matrix)))
dat_di6.lgb_obj = lightgbm(data = dat_di6.lgb_train_data,
                           params = list(learning_rate = c(0.1),
                                         objective = c("regression"),
                                         min_data_in_leaf = 100,
                                         max_depth = c(5),
                                         num_leaves = c(1000),
                                         lambda_l2 = c(1),
                                         boosting = c("gbdt")),
                           valids = list(valid = dat_di6.lgb_test_data),
                           nrounds = 2000,
                           early_stopping_rounds = 50)

dat_di6.lgb_train_pred = predict(dat_di6.lgb_obj, data = as.matrix(dat_di6.lgb_train_rules$data))
cor(dat_di6.lgb_train_pred, y, method="pearson")
# 0.8088937 (nrounds = 520)


dat_di6.lgb_test_pred = predict(dat_di6.lgb_obj, data = dat_di6.lgb_test_matrix)

cor(dat_di6.lgb_test_pred, y_test, method="pearson")
# 0.607076 (nrounds = 520)

mean((dat_di6.lgb_test_pred - y_test)^2)
# 0.1522613 (nrounds = 520)
```

We get test prediction correlation of 0.607076 and MSE of 0.1522613

# Inputs: Position Specific Nucleotides and Dinucleotides + Fourier Features Based on A/T Nucleotides Calculated from scratch

## Absolute value of Fourier features

FIXME

We get test prediction correlation of 0.5356259 and MSE of 0.1718656 with lasso
We get test prediction correlation of 0.5353876 and MSE of 0.1719261 with ridge

## Squared value of Fourier features

FIXME

We get test prediction correlation of 0.5477633 and MSE of 0.1686968 with lasso
We get test prediction correlation of 0.5474702 and MSE of 0.1687779 with ridge

# Inputs: Position Specific Nucleotides and Dinucleotides + Fourier Features Based on A/T Nucleotides Calculated from scratch + Markov Ratio

## Raw Fourier features

FIXME

We get test prediction correlation of 0.5188741 and MSE of 0.1796695 with lasso
We get test prediction correlation of 0.5256611 and MSE of 0.1752468 with ridge

## Absolute value of Fourier features

FIXME

We get test prediction correlation of 0.6175315 and MSE of 0.1539154 with lasso
We get test prediction correlation of 0.621028 and MSE of 0.1499129 with ridge

## Squared value of Fourier features

FIXME

We get test prediction correlation of 0.6266625 and MSE of 0.1509019 with lasso
We get test prediction correlation of 0.6294407 and MSE of 0.1473828 with ridge

# Inputs: Position Specific Nucleotides and Dinucleotides + Fourier Features Based on A/T Nucleotides and AA/TT/AT/TA Dinucleotides Calculated from scratch

## Squared value of Fourier features

FIXME

We get test prediction correlation of 0.5947467 and MSE of 0.1559105 with lasso
We get test prediction correlation of 0.5521032 and MSE of 0.1684463 with ridge


# Inputs: Counts of trinucleotides + Fourier Features Based on A/T Nucleotides Calculated from scratch

```{r}
nucleotides <- c("A", "C", "G", "T")
dinucleotides <- gtools::permutations(n = 4, r = 2, v = nucleotides,
                                      repeats.allowed = TRUE) %>%
  apply(1, paste, collapse = "")
trinucleotides <- gtools::permutations(n = 4, r = 3, v = nucleotides,
                                       repeats.allowed = TRUE) %>%
  apply(1, paste, collapse = "")

Xone_AT_fourier_cos = readRDS("data/Created/tiling_Xone_AT_fourier_cos.rds")
Xone_AT_fourier_sin = readRDS("data/Created/tiling_Xone_AT_fourier_sin.rds")
Xone_AT_fourier_cos_test = readRDS("data/Created/tiling_Xone_AT_fourier_cos_test.rds")
Xone_AT_fourier_sin_test = readRDS("data/Created/tiling_Xone_AT_fourier_sin_test.rds")
```

## Squared value of Fourier features

```{r}
dat_tri2 = cbind(dat%>%
                   select(all_of(trinucleotides), C0_new), 
                 Xone_AT_fourier_cos^2, Xone_AT_fourier_sin^2)
tri2 = lm(C0_new~., data = dat_tri2)
cor(tri2$fitted.values, y)
# 0.5464385

dat_test_tri2 = cbind(dat_test %>%
                        select(all_of(trinucleotides), C0_new), 
                      Xone_AT_fourier_cos_test^2, Xone_AT_fourier_sin_test^2)
tri2_pred = predict(tri2, dat_test_tri2)
cor(tri2_pred, y_test)
# 0.545001

mean((tri2_pred - y_test)^2)
# 0.1694237

dat_random_test_tri2 = cbind(dat_random_test %>%
                               select(all_of(trinucleotides), C0_new), 
                             Xone_AT_fourier_cos_random_test^2, Xone_AT_fourier_sin_random_test^2)
tri2_random_pred = predict(tri2, dat_random_test_tri2)
cor(tri2_random_pred, dat_random_test$C0_new)
# 0.5344724
```

We get test prediction correlation of 0.545001 and MSE of 0.1694237



# Inputs: Counts of trinucleotides + Fourier Features Based on A/T Nucleotides Calculated from scratch + Markov Ratio

```{r}
nucleotides <- c("A", "C", "G", "T")
dinucleotides <- gtools::permutations(n = 4, r = 2, v = nucleotides,
                                      repeats.allowed = TRUE) %>%
  apply(1, paste, collapse = "")
trinucleotides <- gtools::permutations(n = 4, r = 3, v = nucleotides,
                                       repeats.allowed = TRUE) %>%
  apply(1, paste, collapse = "")

Xone_AT_fourier_cos = readRDS("data/Created/tiling_Xone_AT_fourier_cos.rds")
Xone_AT_fourier_sin = readRDS("data/Created/tiling_Xone_AT_fourier_sin.rds")
Xone_AT_fourier_cos_test = readRDS("data/Created/tiling_Xone_AT_fourier_cos_test.rds")
Xone_AT_fourier_sin_test = readRDS("data/Created/tiling_Xone_AT_fourier_sin_test.rds")
```

## Squared value of Fourier features

```{r}
dat_tri3 = cbind(dat %>% 
                   select(all_of(trinucleotides), C0_new, ratio_score_2nd),
                 Xone_AT_fourier_cos^2, Xone_AT_fourier_sin^2)
tri3 = lm(C0_new~., data = dat_tri3)
cor(tri3$fitted.values, y)
# 0.5661495

dat_test_tri3 = cbind(dat_test %>% 
                        select(all_of(trinucleotides), C0_new, ratio_score_2nd),
                      Xone_AT_fourier_cos_test^2, Xone_AT_fourier_sin_test^2)
tri3_pred = predict(tri3, dat_test_tri3)
cor(tri3_pred, y_test)
# 0.6209622

mean((tri3_pred - y_test)^2)
# 0.15208
```

We get test prediction correlation of 0.6209622 and MSE of 0.15208

# Inputs: Counts of trinucleotides + Fourier Features Based on AA/TT/AT/TA Dinucleotides Calculated from scratch

```{r}
nucleotides <- c("A", "C", "G", "T")
dinucleotides <- gtools::permutations(n = 4, r = 2, v = nucleotides,
                                      repeats.allowed = TRUE) %>%
  apply(1, paste, collapse = "")
trinucleotides <- gtools::permutations(n = 4, r = 3, v = nucleotides,
                                       repeats.allowed = TRUE) %>%
  apply(1, paste, collapse = "")

Xtwo_AT_fourier_cos = readRDS("data/Created/tiling_Xtwo_AT_fourier_cos.rds")
Xtwo_AT_fourier_sin = readRDS("data/Created/tiling_Xtwo_AT_fourier_sin.rds")
Xtwo_AT_fourier_cos_test = readRDS("data/Created/tiling_Xtwo_AT_fourier_cos_test.rds")
Xtwo_AT_fourier_sin_test = readRDS("data/Created/tiling_Xtwo_AT_fourier_sin_test.rds")
```

## Squared value of Fourier features

### Simple Linear Model

```{r}
dat_tri4 = cbind(dat%>%
                   select(all_of(trinucleotides), C0_new), 
                 Xtwo_AT_fourier_cos^2, Xtwo_AT_fourier_sin^2)
tri4 = lm(C0_new~., data = dat_tri4)
cor(tri4$fitted.values, y)
# 0.5595122

dat_test_tri4 = cbind(dat_test%>%
                        select(all_of(trinucleotides), C0_new), 
                      Xtwo_AT_fourier_cos_test^2, Xtwo_AT_fourier_sin_test^2)
tri4_pred = predict(tri4, dat_test_tri4)
cor(tri4_pred, y_test)
# 0.5579731

mean((tri4_pred - y_test)^2)
# 0.1659748
```

We get test prediction correlation of 0.5579731 and MSE of 0.1659748

### LightGBM (tree-based) Model

```{r}
library(lightgbm)
source("scripts/functions/lgbm-helper-functions.R")
set.seed(50)
dat_tri4.lgb_train_set = dat_tri4 %>%
  select(-C0_new)
dat_tri4.lgb_train_rules = lgb.convert_with_rules(data = dat_tri4.lgb_train_set)
dat_tri4.lgb_train_data = lgb.Dataset(data = as.matrix(dat_tri4.lgb_train_rules$data),
                                      label = dat_tri4$C0_new,
                                      categorical_feature = handle_categorical(colnames(dat_tri4.lgb_train_rules$data)))
dat_tri4.lgb_test_set = dat_test_tri4 %>%
  select(-C0_new)
dat_tri4.lgb_test_matrix = as.matrix(lgb.convert_with_rules(data = dat_tri4.lgb_test_set, rules = dat_tri4.lgb_train_rules$rules)$data)
dat_tri4.lgb_test_data = lgb.Dataset(data = dat_tri4.lgb_test_matrix,
                                     label = dat_test_tri4$C0_new,
                                     categorical_feature = handle_categorical(colnames(dat_tri4.lgb_test_matrix)))
dat_tri4.lgb_obj = lightgbm(data = dat_tri4.lgb_train_data,
                            params = list(learning_rate = c(0.1),
                                          objective = c("regression"),
                                          min_data_in_leaf = 100,
                                          max_depth = c(5),
                                          num_leaves = c(1000),
                                          lambda_l2 = c(1),
                                          boosting = c("gbdt")),
                            valids = list(valid = dat_tri4.lgb_test_data),
                            nrounds = 2000,
                            early_stopping_rounds = 50)

dat_tri4.lgb_train_pred = predict(dat_tri4.lgb_obj, data = as.matrix(dat_tri4.lgb_train_rules$data))
cor(dat_tri4.lgb_train_pred, y, method="pearson")
# 0.6486812 (nrounds = 194)


dat_tri4.lgb_test_pred = predict(dat_tri4.lgb_obj, data = dat_tri4.lgb_test_matrix)

cor(dat_tri4.lgb_test_pred, y_test, method="pearson")
# 0.5851218 (nrounds = 194)

mean((dat_tri4.lgb_test_pred - y_test)^2)
# 0.1586546 (nrounds = 194)
```

We get test prediction correlation of 0.5851218 and MSE of 0.1586546


# Inputs: Counts of trinucleotides + Fourier Features Based on CC/GG/CG/GC Dinucleotides Calculated from scratch

```{r}
nucleotides <- c("A", "C", "G", "T")
dinucleotides <- gtools::permutations(n = 4, r = 2, v = nucleotides,
                                      repeats.allowed = TRUE) %>%
  apply(1, paste, collapse = "")
trinucleotides <- gtools::permutations(n = 4, r = 3, v = nucleotides,
                                       repeats.allowed = TRUE) %>%
  apply(1, paste, collapse = "")

Xtwo_CG_fourier_cos = readRDS("data/Created/tiling_Xtwo_CG_fourier_cos.rds")
Xtwo_CG_fourier_sin = readRDS("data/Created/tiling_Xtwo_CG_fourier_sin.rds")
Xtwo_CG_fourier_cos_test = readRDS("data/Created/tiling_Xtwo_CG_fourier_cos_test.rds")
Xtwo_CG_fourier_sin_test = readRDS("data/Created/tiling_Xtwo_CG_fourier_sin_test.rds")
```

## Squared value of Fourier features

```{r}
dat_tri8 = cbind(dat%>%
                   select(all_of(trinucleotides), C0_new), 
                 Xtwo_CG_fourier_cos^2, Xtwo_CG_fourier_sin^2)
tri8 = lm(C0_new~., data = dat_tri8)
cor(tri8$fitted.values, y)
# 0.4146018

dat_test_tri8 = cbind(dat_test %>%
                        select(all_of(trinucleotides), C0_new), 
                      Xtwo_CG_fourier_cos_test^2, Xtwo_CG_fourier_sin_test^2)
tri8_pred = predict(tri8, dat_test_tri8)
cor(tri8_pred, y_test)
# 0.4153577

mean((tri8_pred - y_test)^2)
# 0.1994364
```

We get test prediction correlation of 0.4153577 and MSE of 0.1994364

# Inputs: Counts of trinucleotides + Fourier Features Based on all Dinucleotides + Modulus of Difference of Fourier Features Based on all Dinucleotides with h=6 (period 9.8) Calculated using fft

```{r}
nucleotides <- c("A", "C", "G", "T")
dinucleotides <- gtools::permutations(n = 4, r = 2, v = nucleotides,
                                      repeats.allowed = TRUE) %>%
  apply(1, paste, collapse = "")
trinucleotides <- gtools::permutations(n = 4, r = 3, v = nucleotides,
                                       repeats.allowed = TRUE) %>%
  apply(1, paste, collapse = "")

fourier_di_cos = readRDS("data/Created/tiling_fourier_di_cos.rds")
fourier_di_sin = readRDS("data/Created/tiling_fourier_di_sin.rds")
fourier_di_cos_test = readRDS("data/Created/tiling_fourier_di_cos_test.rds")
fourier_di_sin_test = readRDS("data/Created/tiling_fourier_di_sin_test.rds")

fourier_6_mod = readRDS("data/Created/tiling_fourier_6_mod.rds")
fourier_6_mod_test = readRDS("data/Created/tiling_fourier_6_mod_test.rds")
```

## Squared value of Fourier features calculated using fft

### Simple Linear Model

```{r}
dat_tri19 = cbind(dat %>% select(all_of(trinucleotides), C0_new), 
                  (fourier_di_cos)^2, (fourier_di_sin)^2, 
                  (fourier_6_mod)^2)

tri19_lm = lm(C0_new~., data=dat_tri19)
cor(tri19_lm$fitted.values, y)
# 0.6042256

dat_test_tri19 = cbind(dat_test %>% select(all_of(trinucleotides), C0_new),
                       (fourier_di_cos_test)^2, (fourier_di_sin_test)^2, 
                       (fourier_6_mod_test)^2)

tri19_pred = predict(tri19_lm, dat_test_tri19)

cor(tri19_pred, y_test)
# 0.5988849

mean((tri19_pred - y_test)^2)
# 0.1545988
```

We get test prediction correlation of 0.5988849 and MSE of 0.1545988

### LightGBM (tree-based) Model

```{r}
library(lightgbm)
source("scripts/functions/lgbm-helper-functions.R")
set.seed(50)
dat_tri19.lgb_train_set = dat_tri19 %>%
  select(-C0_new)
dat_tri19.lgb_train_rules = lgb.convert_with_rules(data = dat_tri19.lgb_train_set)
dat_tri19.lgb_train_data = lgb.Dataset(data = as.matrix(dat_tri19.lgb_train_rules$data),
                                       label = dat_tri19$C0_new,
                                       categorical_feature = handle_categorical(colnames(dat_tri19.lgb_train_rules$data)))
dat_tri19.lgb_test_set = dat_test_tri19 %>%
  select(-C0_new)
dat_tri19.lgb_test_matrix = as.matrix(lgb.convert_with_rules(data = dat_tri19.lgb_test_set, rules = dat_tri19.lgb_train_rules$rules)$data)
dat_tri19.lgb_test_data = lgb.Dataset(data = dat_tri19.lgb_test_matrix,
                                      label = dat_test_tri19$C0_new,
                                      categorical_feature = handle_categorical(colnames(dat_tri19.lgb_test_matrix)))
dat_tri19.lgb_obj = lightgbm(data = dat_tri19.lgb_train_data,
                             params = list(learning_rate = c(0.1),
                                           objective = c("regression"),
                                           min_data_in_leaf = 100,
                                           max_depth = c(5),
                                           num_leaves = c(1000),
                                           lambda_l2 = c(1),
                                           boosting = c("gbdt")),
                             valids = list(valid = dat_tri19.lgb_test_data),
                             nrounds = 2000,
                             early_stopping_rounds = 50)

dat_tri19.lgb_train_pred = predict(dat_tri19.lgb_obj, data = as.matrix(dat_tri19.lgb_train_rules$data))
cor(dat_tri19.lgb_train_pred, y, method="pearson")
# 0.8458488 (nrounds = 770)


dat_tri19.lgb_test_pred = predict(dat_tri19.lgb_obj, data = dat_tri19.lgb_test_matrix)

cor(dat_tri19.lgb_test_pred, y_test, method="pearson")
# 0.610662 (nrounds = 770)

mean((dat_tri19.lgb_test_pred - y_test)^2)
# 0.1511534 (nrounds = 770)
```

We get test prediction correlation of 0.610662 and MSE of 0.1511534


# Inputs: Counts of trinucleotides + Fourier Features Based on all Dinucleotides with h=6 (period 9.8) + Modulus of Difference of Fourier Features Based on all Dinucleotides with h=6 (period 9.8) Calculated using fft

```{r}
nucleotides <- c("A", "C", "G", "T")
dinucleotides <- gtools::permutations(n = 4, r = 2, v = nucleotides,
                                      repeats.allowed = TRUE) %>%
  apply(1, paste, collapse = "")
trinucleotides <- gtools::permutations(n = 4, r = 3, v = nucleotides,
                                       repeats.allowed = TRUE) %>%
  apply(1, paste, collapse = "")

fourier_di_cos = readRDS("data/Created/tiling_fourier_di_cos.rds")
fourier_di_sin = readRDS("data/Created/tiling_fourier_di_sin.rds")
fourier_di_cos_test = readRDS("data/Created/tiling_fourier_di_cos_test.rds")
fourier_di_sin_test = readRDS("data/Created/tiling_fourier_di_sin_test.rds")

fourier_di_cos_6 = as.data.frame(fourier_di_cos) %>% select(ends_with("_6"))
fourier_di_sin_6 = as.data.frame(fourier_di_sin) %>% select(ends_with("_6"))
fourier_di_cos_6_test = as.data.frame(fourier_di_cos_test) %>% select(ends_with("_6"))
fourier_di_sin_6_test = as.data.frame(fourier_di_sin_test) %>% select(ends_with("_6"))

fourier_6_mod = readRDS("data/Created/tiling_fourier_6_mod.rds")
fourier_6_mod_test = readRDS("data/Created/tiling_fourier_6_mod_test.rds")
```

## Squared value of Fourier features calculated using fft

### Simple Linear Model

```{r}
dat_tri20 = cbind(dat %>% select(all_of(trinucleotides), C0_new), 
                  (fourier_di_cos_6)^2, (fourier_di_sin_6)^2, 
                  (fourier_6_mod)^2)

tri20_lm = lm(C0_new~., data=dat_tri20)
cor(tri20_lm$fitted.values, y)
# 0.5827744

dat_test_tri20 = cbind(dat_test %>% select(all_of(trinucleotides), C0_new),
                       (fourier_di_cos_6_test)^2, (fourier_di_sin_6_test)^2, 
                       (fourier_6_mod_test)^2)

tri20_pred = predict(tri20_lm, dat_test_tri20)

cor(tri20_pred, y_test)
# 0.5870865

mean((tri20_pred - y_test)^2)
# 0.1579404
```

We get test prediction correlation of 0.5870865 and MSE of 0.1579404

### LightGBM (tree-based) Model

```{r}
library(lightgbm)
source("scripts/functions/lgbm-helper-functions.R")
set.seed(50)
dat_tri20.lgb_train_set = dat_tri20 %>%
  select(-C0_new)
dat_tri20.lgb_train_rules = lgb.convert_with_rules(data = dat_tri20.lgb_train_set)
dat_tri20.lgb_train_data = lgb.Dataset(data = as.matrix(dat_tri20.lgb_train_rules$data),
                                       label = dat_tri20$C0_new,
                                       categorical_feature = handle_categorical(colnames(dat_tri20.lgb_train_rules$data)))
dat_tri20.lgb_test_set = dat_test_tri20 %>%
  select(-C0_new)
dat_tri20.lgb_test_matrix = as.matrix(lgb.convert_with_rules(data = dat_tri20.lgb_test_set, rules = dat_tri20.lgb_train_rules$rules)$data)
dat_tri20.lgb_test_data = lgb.Dataset(data = dat_tri20.lgb_test_matrix,
                                      label = dat_test_tri20$C0_new,
                                      categorical_feature = handle_categorical(colnames(dat_tri20.lgb_test_matrix)))
dat_tri20.lgb_obj = lightgbm(data = dat_tri20.lgb_train_data,
                             params = list(learning_rate = c(0.1),
                                           objective = c("regression"),
                                           min_data_in_leaf = 100,
                                           max_depth = c(5),
                                           num_leaves = c(1000),
                                           lambda_l2 = c(1),
                                           boosting = c("gbdt")),
                             valids = list(valid = dat_tri20.lgb_test_data),
                             nrounds = 2000,
                             early_stopping_rounds = 50)

dat_tri20.lgb_train_pred = predict(dat_tri20.lgb_obj, data = as.matrix(dat_tri20.lgb_train_rules$data))
cor(dat_tri20.lgb_train_pred, y, method="pearson")
# 0.8051862 (nrounds = 792)

dat_tri20.lgb_test_pred = predict(dat_tri20.lgb_obj, data = dat_tri20.lgb_test_matrix)

cor(dat_tri20.lgb_test_pred, y_test, method="pearson")
# 0.6191117 (nrounds = 792)

mean((dat_tri20.lgb_test_pred - y_test)^2)
# 0.1486626 (nrounds = 792)
```

We get test prediction correlation of 0.6191117 and MSE of 0.1486626

# Inputs: Counts of trinucleotides + Fourier Features Based on CC/GG/CG/GC Dinucleotides and AA/TT/AT/TA Dinucleotides Calculated from scratch

```{r}
library(mgcv)
nucleotides <- c("A", "C", "G", "T")
dinucleotides <- gtools::permutations(n = 4, r = 2, v = nucleotides,
                                      repeats.allowed = TRUE) %>%
  apply(1, paste, collapse = "")
trinucleotides <- gtools::permutations(n = 4, r = 3, v = nucleotides,
                                       repeats.allowed = TRUE) %>%
  apply(1, paste, collapse = "")

Xtwo_AT_fourier_cos = readRDS("data/Created/tiling_Xtwo_AT_fourier_cos.rds")
Xtwo_AT_fourier_sin = readRDS("data/Created/tiling_Xtwo_AT_fourier_sin.rds")
Xtwo_AT_fourier_cos_test = readRDS("data/Created/tiling_Xtwo_AT_fourier_cos_test.rds")
Xtwo_AT_fourier_sin_test = readRDS("data/Created/tiling_Xtwo_AT_fourier_sin_test.rds")

Xtwo_CG_fourier_cos = readRDS("data/Created/tiling_Xtwo_CG_fourier_cos.rds")
Xtwo_CG_fourier_sin = readRDS("data/Created/tiling_Xtwo_CG_fourier_sin.rds")
Xtwo_CG_fourier_cos_test = readRDS("data/Created/tiling_Xtwo_CG_fourier_cos_test.rds")
Xtwo_CG_fourier_sin_test = readRDS("data/Created/tiling_Xtwo_CG_fourier_sin_test.rds")
```

## Squared value of Fourier features

```{r}
dat_tri9 = cbind(dat%>%
                   select(all_of(trinucleotides), C0_new), 
                 Xtwo_CG_fourier_cos^2, Xtwo_CG_fourier_sin^2, 
                 Xtwo_AT_fourier_cos^2, Xtwo_AT_fourier_sin^2)
tri9 = lm(C0_new~., data = dat_tri9)
cor(tri9$fitted.values, y)
# 0.5661867

dat_test_tri9 = cbind(dat_test %>%
                        select(all_of(trinucleotides), C0_new), 
                      Xtwo_CG_fourier_cos_test^2, Xtwo_CG_fourier_sin_test^2,
                      Xtwo_AT_fourier_cos_test^2, Xtwo_AT_fourier_sin_test^2)
tri9_pred = predict(tri9, dat_test_tri9)
cor(tri9_pred, y_test)
# 0.5643077

mean((tri9_pred - y_test)^2)
# 0.1642621
```

We get test prediction correlation of 0.5643077 and MSE of 0.1642621

## Smooth functions of Fourier features

```{r}
tri9_nonlinear_features = setdiff(colnames(cbind(Xtwo_AT_fourier_cos, Xtwo_AT_fourier_sin, 
                                                 Xtwo_CG_fourier_cos, Xtwo_CG_fourier_sin)), "fouriercosCG2_25")
tri9_linear_features = setdiff(colnames(dat_tri9), c(tri9_nonlinear_features, "C0_new"))
tri9_gam_formula = as.formula(paste0("C0_new~",paste(tri9_linear_features, collapse = "+"), "+", paste(paste0("s(", tri9_nonlinear_features, ")"), collapse = "+")))

tri9_gam = bam(tri9_gam_formula, data=dat_tri9)
cor(tri9_gam$fitted.values, dat_tri$C0_new)
# 0.5688698

tri9_gam_pred = predict(tri9_gam, dat_test_tri9)
cor(tri9_gam_pred, y_test)
# 0.5644073

mean((tri9_gam_pred - y_test)^2)
# 
```

We get test prediction correlation of 0.5644073 and MSE of FIXME

# Inputs: Counts of trinucleotides + Fourier Features Based on CC/GG/CG/GC Dinucleotides and AA/TT/AT/TA Dinucleotides + Fourier antiphase feature Calculated from scratch

```{r}
nucleotides <- c("A", "C", "G", "T")
dinucleotides <- gtools::permutations(n = 4, r = 2, v = nucleotides,
                                      repeats.allowed = TRUE) %>%
  apply(1, paste, collapse = "")
trinucleotides <- gtools::permutations(n = 4, r = 3, v = nucleotides,
                                       repeats.allowed = TRUE) %>%
  apply(1, paste, collapse = "")

Xtwo_AT_fourier_cos = readRDS("data/Created/tiling_Xtwo_AT_fourier_cos.rds")
Xtwo_AT_fourier_sin = readRDS("data/Created/tiling_Xtwo_AT_fourier_sin.rds")
Xtwo_AT_fourier_cos_test = readRDS("data/Created/tiling_Xtwo_AT_fourier_cos_test.rds")
Xtwo_AT_fourier_sin_test = readRDS("data/Created/tiling_Xtwo_AT_fourier_sin_test.rds")

Xtwo_CG_fourier_cos = readRDS("data/Created/tiling_Xtwo_CG_fourier_cos.rds")
Xtwo_CG_fourier_sin = readRDS("data/Created/tiling_Xtwo_CG_fourier_sin.rds")
Xtwo_CG_fourier_cos_test = readRDS("data/Created/tiling_Xtwo_CG_fourier_cos_test.rds")
Xtwo_CG_fourier_sin_test = readRDS("data/Created/tiling_Xtwo_CG_fourier_sin_test.rds")

Xtwo_fourier_antiphase = readRDS("data/Created/tiling_Xtwo_fourier_antiphase.rds")
Xtwo_fourier_antiphase_test = readRDS("data/Created/tiling_Xtwo_fourier_antiphase_test.rds")
```

## Squared value of Fourier features

```{r}
dat_tri11 = cbind(dat%>%
                    select(all_of(trinucleotides), C0_new), 
                  Xtwo_CG_fourier_cos^2, Xtwo_CG_fourier_sin^2, 
                  Xtwo_AT_fourier_cos^2, Xtwo_AT_fourier_sin^2, 
                  Xtwo_fourier_antiphase)
dat_tri11 = dat_tri11[complete.cases(dat_tri11),]
tri11 = lm(C0_new~., data = dat_tri11)
cor(tri11$fitted.values, dat_tri11$C0_new)
# 0.5691566

dat_test_tri11 = cbind(dat_test %>%
                         select(all_of(trinucleotides), C0_new),
                       Xtwo_CG_fourier_cos_test^2, Xtwo_CG_fourier_sin_test^2, 
                       Xtwo_AT_fourier_cos_test^2, Xtwo_AT_fourier_sin_test^2, 
                       Xtwo_fourier_antiphase_test)
dat_test_tri11 = dat_test_tri11[complete.cases(dat_test_tri11),]
tri11_pred = predict(tri11, dat_test_tri11)
cor(tri11_pred, dat_test_tri11$C0_new)
# 0.5688204

mean((tri11_pred - dat_test_tri11$C0_new)^2)
# 0.1629713
```

We get test prediction correlation of 0.5688204 and MSE of 0.1629713

# Inputs: Position Specific Nucleotides + Counts of trinucleotides + Fourier Features Based on AA/TT/AT/TA Dinucleotides Calculated from scratch

```{r}
ps1 <- paste0("X", 1:50, "mono")
nucleotides <- c("A", "C", "G", "T")
dinucleotides <- gtools::permutations(n = 4, r = 2, v = nucleotides,
                                      repeats.allowed = TRUE) %>%
  apply(1, paste, collapse = "")
trinucleotides <- gtools::permutations(n = 4, r = 3, v = nucleotides,
                                       repeats.allowed = TRUE) %>%
  apply(1, paste, collapse = "")

Xtwo_AT_fourier_cos = readRDS("data/Created/tiling_Xtwo_AT_fourier_cos.rds")
Xtwo_AT_fourier_sin = readRDS("data/Created/tiling_Xtwo_AT_fourier_sin.rds")
Xtwo_AT_fourier_cos_test = readRDS("data/Created/tiling_Xtwo_AT_fourier_cos_test.rds")
Xtwo_AT_fourier_sin_test = readRDS("data/Created/tiling_Xtwo_AT_fourier_sin_test.rds")
```

## Squared value of Fourier features

```{r}
dat_tri5 = cbind(dat %>%
                   select(all_of(ps1), all_of(trinucleotides), C0_new),
                 Xtwo_AT_fourier_cos^2, Xtwo_AT_fourier_sin^2)
tri5 = lm(C0_new~., data = dat_tri5)
cor(tri5$fitted.values, y)
# 0.5744163

dat_test_tri5 = cbind(dat_test %>%
                        select(all_of(ps1), all_of(trinucleotides), C0_new),
                      Xtwo_AT_fourier_cos_test^2, Xtwo_AT_fourier_sin_test^2)
tri5_pred = predict(tri5, dat_test_tri5)
cor(tri5_pred, y_test)
# 0.5754247

mean((tri5_pred - y_test)^2)
# 0.1612067
```

We get test prediction correlation of 0.5754247 and MSE of 0.1612067

# Inputs: Position Specific Nucleotides + Counts of trinucleotides + Fourier Features Based on AA/TT/AT/TA Dinucleotides Calculated from scratch + Markov Ratio

```{r}
library(lightgbm)
source("scripts/functions/lgbm-helper-functions.R")
ps1 <- paste0("X", 1:50, "mono")
nucleotides <- c("A", "C", "G", "T")
dinucleotides <- gtools::permutations(n = 4, r = 2, v = nucleotides,
                                      repeats.allowed = TRUE) %>%
  apply(1, paste, collapse = "")
trinucleotides <- gtools::permutations(n = 4, r = 3, v = nucleotides,
                                       repeats.allowed = TRUE) %>%
  apply(1, paste, collapse = "")

Xtwo_AT_fourier_cos = readRDS("data/Created/tiling_Xtwo_AT_fourier_cos.rds")
Xtwo_AT_fourier_sin = readRDS("data/Created/tiling_Xtwo_AT_fourier_sin.rds")
Xtwo_AT_fourier_cos_test = readRDS("data/Created/tiling_Xtwo_AT_fourier_cos_test.rds")
Xtwo_AT_fourier_sin_test = readRDS("data/Created/tiling_Xtwo_AT_fourier_sin_test.rds")
```

## Squared value of Fourier features

### Simple Linear Model

```{r}
dat_tri10 = cbind(dat %>% 
                    select(all_of(ps1), all_of(trinucleotides), 
                           ratio_score_2nd, C0_new),
                  Xtwo_AT_fourier_cos^2, Xtwo_AT_fourier_sin^2)
tri10 = lm(C0_new~., data = dat_tri10)
cor(tri10$fitted.values, y)
# 0.5893882

dat_test_tri10 = cbind(dat_test %>% 
                         select(all_of(ps1), all_of(trinucleotides),
                                ratio_score_2nd, C0_new),
                       Xtwo_AT_fourier_cos_test^2, Xtwo_AT_fourier_sin_test^2)
tri10_pred = predict(tri10, dat_test_tri10)
cor(tri10_pred, y_test)
# 0.6407631

mean((tri10_pred - y_test)^2)
# 0.1459824
```

We get test prediction correlation of 0.6407631 and MSE of 0.1459824

### LightGBM (tree-based) Model

```{r}
set.seed(50)
dat_tri10.lgb_train_set = dat_tri10 %>%
  select(-C0_new)
dat_tri10.lgb_train_rules = lgb.convert_with_rules(data = dat_tri10.lgb_train_set)
dat_tri10.lgb_train_data = lgb.Dataset(data = as.matrix(dat_tri10.lgb_train_rules$data),
                                       label = dat_tri10$C0_new,
                                       categorical_feature = handle_categorical(colnames(dat_tri10.lgb_train_rules$data)))
dat_tri10.lgb_test_set = dat_test_tri10 %>%
  select(-C0_new)
dat_tri10.lgb_test_matrix = as.matrix(lgb.convert_with_rules(data = dat_tri10.lgb_test_set, rules = dat_tri10.lgb_train_rules$rules)$data)
dat_tri10.lgb_test_data = lgb.Dataset(data = dat_tri10.lgb_test_matrix,
                                      label = dat_test_tri10$C0_new,
                                      categorical_feature = handle_categorical(colnames(dat_tri10.lgb_test_matrix)))
dat_tri10.lgb_obj = lightgbm(data = dat_tri10.lgb_train_data,
                             params = list(learning_rate = c(0.1),
                                           objective = c("regression"),
                                           min_data_in_leaf = 100,
                                           max_depth = c(5),
                                           num_leaves = c(1000),
                                           lambda_l2 = c(1),
                                           boosting = c("gbdt")),
                             valids = list(valid = dat_tri10.lgb_test_data),
                             nrounds = 2000,
                             early_stopping_rounds = 50)

dat_tri10.lgb_train_pred = predict(dat_tri10.lgb_obj, data = as.matrix(dat_tri10.lgb_train_rules$data))
cor(dat_tri10.lgb_train_pred, y, method="pearson")
# 0.7072647 (nrounds = 330)

dat_tri10.lgb_test_pred = predict(dat_tri10.lgb_obj, data = dat_tri10.lgb_test_matrix)

cor(dat_tri10.lgb_test_pred, y_test, method="pearson")
# 0.6642808 (nrounds = 330)

mean((dat_tri10.lgb_test_pred - y_test)^2)
# 0.1360679
```

We get test prediction correlation of 0.6642808 and MSE of 0.1360679

```{r}
as.data.frame(lgb.importance(dat_tri10.lgb_obj)) %>%
  mutate(Feature = fct_rev(fct_inorder(Feature))) %>%
  dplyr::slice(1:50) %>%
  ggplot(aes(x = Feature, y = Gain)) +
  geom_col(fill = "dodgerblue") +
  coord_flip() +
  theme_bw()
```

# Inputs: Position Specific Nucleotides + Counts of trinucleotides + Fourier Features Based on all Dinucleotides with h=6 (period 9.8) + Modulus of Difference of Fourier Features Based on all Dinucleotides with h=6 (period 9.8) Calculated using fft

```{r}
ps1 <- paste0("X", 1:50, "mono")
nucleotides <- c("A", "C", "G", "T")
dinucleotides <- gtools::permutations(n = 4, r = 2, v = nucleotides,
                                      repeats.allowed = TRUE) %>%
  apply(1, paste, collapse = "")
trinucleotides <- gtools::permutations(n = 4, r = 3, v = nucleotides,
                                       repeats.allowed = TRUE) %>%
  apply(1, paste, collapse = "")

fourier_di_cos = readRDS("data/Created/tiling_fourier_di_cos.rds")
fourier_di_sin = readRDS("data/Created/tiling_fourier_di_sin.rds")
fourier_di_cos_test = readRDS("data/Created/tiling_fourier_di_cos_test.rds")
fourier_di_sin_test = readRDS("data/Created/tiling_fourier_di_sin_test.rds")

fourier_di_cos_6 = as.data.frame(fourier_di_cos) %>% select(ends_with("_6"))
fourier_di_sin_6 = as.data.frame(fourier_di_sin) %>% select(ends_with("_6"))
fourier_di_cos_6_test = as.data.frame(fourier_di_cos_test) %>% select(ends_with("_6"))
fourier_di_sin_6_test = as.data.frame(fourier_di_sin_test) %>% select(ends_with("_6"))

fourier_6_mod = readRDS("data/Created/tiling_fourier_6_mod.rds")
fourier_6_mod_test = readRDS("data/Created/tiling_fourier_6_mod_test.rds")
```

## Squared value of Fourier features

### Simple Linear Model

```{r}
dat_tri21 = cbind(dat %>% select(all_of(ps1), all_of(trinucleotides), C0_new), 
                  (fourier_di_cos_6)^2, (fourier_di_sin_6)^2, 
                  (fourier_6_mod)^2)

tri21_lm = lm(C0_new~., data=dat_tri21)
cor(tri21_lm$fitted.values, y)
# 0.594933

dat_test_tri21 = cbind(dat_test %>% select(all_of(ps1), all_of(trinucleotides), C0_new),
                       (fourier_di_cos_6_test)^2, (fourier_di_sin_6_test)^2, 
                       (fourier_6_mod_test)^2)

tri21_pred = predict(tri21_lm, dat_test_tri21)

cor(tri21_pred, y_test)
# 0.6009336

mean((tri21_pred - y_test)^2)
# 0.1539751
```

We get test prediction correlation of 0.6009336 and MSE of 0.1539751

### LightGBM (tree-based) Model

```{r}
library(lightgbm)
source("scripts/functions/lgbm-helper-functions.R")
set.seed(50)
dat_tri21.lgb_train_set = dat_tri21 %>%
  select(-C0_new)
dat_tri21.lgb_train_rules = lgb.convert_with_rules(data = dat_tri21.lgb_train_set)
dat_tri21.lgb_train_data = lgb.Dataset(data = as.matrix(dat_tri21.lgb_train_rules$data),
                                       label = dat_tri21$C0_new,
                                       categorical_feature = handle_categorical(colnames(dat_tri21.lgb_train_rules$data)))
dat_tri21.lgb_test_set = dat_test_tri21 %>%
  select(-C0_new)
dat_tri21.lgb_test_matrix = as.matrix(lgb.convert_with_rules(data = dat_tri21.lgb_test_set, rules = dat_tri21.lgb_train_rules$rules)$data)
dat_tri21.lgb_test_data = lgb.Dataset(data = dat_tri21.lgb_test_matrix,
                                      label = dat_test_tri21$C0_new,
                                      categorical_feature = handle_categorical(colnames(dat_tri21.lgb_test_matrix)))
dat_tri21.lgb_obj = lightgbm(data = dat_tri21.lgb_train_data,
                             params = list(learning_rate = c(0.1),
                                           objective = c("regression"),
                                           min_data_in_leaf = 100,
                                           max_depth = c(5),
                                           num_leaves = c(1000),
                                           lambda_l2 = c(1),
                                           boosting = c("gbdt")),
                             valids = list(valid = dat_tri21.lgb_test_data),
                             nrounds = 2000,
                             early_stopping_rounds = 50)

dat_tri21.lgb_train_pred = predict(dat_tri21.lgb_obj, data = as.matrix(dat_tri21.lgb_train_rules$data))
cor(dat_tri21.lgb_train_pred, y, method="pearson")
# 0.8260211 (nrounds = 791)

dat_tri21.lgb_test_pred = predict(dat_tri21.lgb_obj, data = dat_tri21.lgb_test_matrix)

cor(dat_tri21.lgb_test_pred, y_test, method="pearson")
# 0.6472589 (nrounds = 791)

mean((dat_tri21.lgb_test_pred - y_test)^2)
# 0.1403171 (nrounds = 791)
```

We get test prediction correlation of 0.6472589 and MSE of 0.1403171

# Inputs: Position Specific Dinucleotides + Counts of trinucleotides + Fourier Features Based on AA/TT/AT/TA Dinucleotides Calculated from scratch

```{r}
ps2 <- paste0("X", 1:49, "di")
nucleotides <- c("A", "C", "G", "T")
dinucleotides <- gtools::permutations(n = 4, r = 2, v = nucleotides,
                                      repeats.allowed = TRUE) %>%
  apply(1, paste, collapse = "")
trinucleotides <- gtools::permutations(n = 4, r = 3, v = nucleotides,
                                       repeats.allowed = TRUE) %>%
  apply(1, paste, collapse = "")

Xtwo_AT_fourier_cos = readRDS("data/Created/tiling_Xtwo_AT_fourier_cos.rds")
Xtwo_AT_fourier_sin = readRDS("data/Created/tiling_Xtwo_AT_fourier_sin.rds")
Xtwo_AT_fourier_cos_test = readRDS("data/Created/tiling_Xtwo_AT_fourier_cos_test.rds")
Xtwo_AT_fourier_sin_test = readRDS("data/Created/tiling_Xtwo_AT_fourier_sin_test.rds")
```

## Squared value of Fourier features

### Simple Linear Model

```{r}
dat_tri6 = cbind(dat %>%
                   select(all_of(ps2), all_of(trinucleotides), C0_new),
                 Xtwo_AT_fourier_cos^2, Xtwo_AT_fourier_sin^2)
tri6 = lm(C0_new~., data = dat_tri6)
cor(tri6$fitted.values, y)
# 0.5869089

dat_test_tri6 = cbind(dat_test %>%
                        select(all_of(ps2), all_of(trinucleotides), C0_new),
                      Xtwo_AT_fourier_cos_test^2, Xtwo_AT_fourier_sin_test^2)
tri6_pred = predict(tri6, dat_test_tri6)
cor(tri6_pred, y_test)
# 0.5814369

mean((tri6_pred - y_test)^2)
# 0.1595429
```

We get test prediction correlation of 0.5814369 and MSE of 0.1595429

### LightGBM (tree-based) Model

```{r}
set.seed(50)
dat_tri6.lgb_train_set = dat_tri6 %>%
  select(-C0_new)
dat_tri6.lgb_train_rules = lgb.convert_with_rules(data = dat_tri6.lgb_train_set)
dat_tri6.lgb_train_data = lgb.Dataset(data = as.matrix(dat_tri6.lgb_train_rules$data),
                                      label = dat_tri6$C0_new,
                                      categorical_feature = handle_categorical(colnames(dat_tri6.lgb_train_rules$data)))
dat_tri6.lgb_test_set = dat_test_tri6 %>%
  select(-C0_new)
dat_tri6.lgb_test_matrix = as.matrix(lgb.convert_with_rules(data = dat_tri6.lgb_test_set, rules = dat_tri6.lgb_train_rules$rules)$data)
dat_tri6.lgb_test_data = lgb.Dataset(data = dat_tri6.lgb_test_matrix,
                                     label = dat_test_tri6$C0_new,
                                     categorical_feature = handle_categorical(colnames(dat_tri6.lgb_test_matrix)))
dat_tri6.lgb_obj = lightgbm(data = dat_tri6.lgb_train_data,
                            params = list(learning_rate = c(0.1),
                                          objective = c("regression"),
                                          min_data_in_leaf = 100,
                                          max_depth = c(5),
                                          num_leaves = c(1000),
                                          lambda_l2 = c(1),
                                          boosting = c("gbdt")),
                            valids = list(valid = dat_tri6.lgb_test_data),
                            nrounds = 2000,
                            early_stopping_rounds = 50)

dat_tri6.lgb_train_pred = predict(dat_tri6.lgb_obj, data = as.matrix(dat_tri6.lgb_train_rules$data))
cor(dat_tri6.lgb_train_pred, y, method="pearson")
# 0.8176157 (nrounds = 539)

dat_tri6.lgb_test_pred = predict(dat_tri6.lgb_obj, data = dat_tri6.lgb_test_matrix)

cor(dat_tri6.lgb_test_pred, y_test, method="pearson")
# 0.6196948 (nrounds = 539)

mean((dat_tri6.lgb_test_pred - y_test)^2)
# 0.1484938
```

We get test prediction correlation of 0.6196948 and MSE of 0.1484938


# Inputs: Position Specific Dinucleotides + Counts of trinucleotides + Fourier Features Based on AA/TT/AT/TA Dinucleotides Calculated from scratch + Markov Ratio

```{r}
ps2 <- paste0("X", 1:49, "di")
nucleotides <- c("A", "C", "G", "T")
dinucleotides <- gtools::permutations(n = 4, r = 2, v = nucleotides,
                                      repeats.allowed = TRUE) %>%
  apply(1, paste, collapse = "")
trinucleotides <- gtools::permutations(n = 4, r = 3, v = nucleotides,
                                       repeats.allowed = TRUE) %>%
  apply(1, paste, collapse = "")

Xtwo_AT_fourier_cos = readRDS("data/Created/tiling_Xtwo_AT_fourier_cos.rds")
Xtwo_AT_fourier_sin = readRDS("data/Created/tiling_Xtwo_AT_fourier_sin.rds")
Xtwo_AT_fourier_cos_test = readRDS("data/Created/tiling_Xtwo_AT_fourier_cos_test.rds")
Xtwo_AT_fourier_sin_test = readRDS("data/Created/tiling_Xtwo_AT_fourier_sin_test.rds")
```

## Squared value of Fourier features

### Simple Linear Model

```{r}
dat_tri12 = cbind(dat %>% 
                    select(all_of(ps2), all_of(trinucleotides),
                           ratio_score_2nd, C0_new),
                  Xtwo_AT_fourier_cos^2, Xtwo_AT_fourier_sin^2)
tri12 = lm(C0_new~., data = dat_tri12)
cor(tri12$fitted.values, y)
# 0.5869089

dat_test_tri12 = cbind(dat_test %>% 
                         select(all_of(ps2), all_of(trinucleotides),
                                ratio_score_2nd, C0_new),
                       Xtwo_AT_fourier_cos_test^2, Xtwo_AT_fourier_sin_test^2)
tri12_pred = predict(tri12, dat_test_tri12)
cor(tri12_pred, y_test)
# 0.6456037

mean((tri12_pred - y_test)^2)
# 0.1431784
```

We get test prediction correlation of 0.6456037 and MSE of 0.1431784

### LightGBM (tree-based) Model

```{r}
set.seed(50)
dat_tri12.lgb_train_set = dat_tri12 %>%
  select(-C0_new)
dat_tri12.lgb_train_rules = lgb.convert_with_rules(data = dat_tri12.lgb_train_set)
dat_tri12.lgb_train_data = lgb.Dataset(data = as.matrix(dat_tri12.lgb_train_rules$data),
                                       label = dat_tri12$C0_new,
                                       categorical_feature = handle_categorical(colnames(dat_tri12.lgb_train_rules$data)))
dat_tri12.lgb_test_set = dat_test_tri12 %>%
  select(-C0_new)
dat_tri12.lgb_test_matrix = as.matrix(lgb.convert_with_rules(data = dat_tri12.lgb_test_set, rules = dat_tri12.lgb_train_rules$rules)$data)
dat_tri12.lgb_test_data = lgb.Dataset(data = dat_tri12.lgb_test_matrix,
                                      label = dat_test_tri12$C0_new,
                                      categorical_feature = handle_categorical(colnames(dat_tri12.lgb_test_matrix)))
dat_tri12.lgb_obj = lightgbm(data = dat_tri12.lgb_train_data,
                             params = list(learning_rate = c(0.1),
                                           objective = c("regression"),
                                           min_data_in_leaf = 100,
                                           max_depth = c(5),
                                           num_leaves = c(1000),
                                           lambda_l2 = c(1),
                                           boosting = c("gbdt")),
                             valids = list(valid = dat_tri12.lgb_test_data),
                             nrounds = 2000,
                             early_stopping_rounds = 50)

dat_tri12.lgb_train_pred = predict(dat_tri12.lgb_obj, data = as.matrix(dat_tri12.lgb_train_rules$data))
cor(dat_tri12.lgb_train_pred, y, method="pearson")
# 0.871121 (nrounds = 802)

dat_tri12.lgb_test_pred = predict(dat_tri12.lgb_obj, data = dat_tri12.lgb_test_matrix)

cor(dat_tri12.lgb_test_pred, y_test, method="pearson")
# 0.6771887 (nrounds = 802)

mean((dat_tri12.lgb_test_pred - y_test)^2)
# 0.1319553
```

We get test prediction correlation of 0.6771887 and MSE of 0.1319553

```{r}
as.data.frame(lgb.importance(dat_tri12.lgb_obj)) %>%
  mutate(Feature = fct_rev(fct_inorder(Feature))) %>%
  dplyr::slice(1:50) %>%
  ggplot(aes(x = Feature, y = Gain)) +
  geom_col(fill = "dodgerblue") +
  coord_flip() +
  theme_bw()
```

# Inputs: Position Specific Dinucleotides + Counts of trinucleotides + Fourier Features Based on all Dinucleotides Calculated using fft

```{r}
ps2 <- paste0("X", 1:49, "di")
nucleotides <- c("A", "C", "G", "T")
dinucleotides <- gtools::permutations(n = 4, r = 2, v = nucleotides,
                                      repeats.allowed = TRUE) %>%
  apply(1, paste, collapse = "")
trinucleotides <- gtools::permutations(n = 4, r = 3, v = nucleotides,
                                       repeats.allowed = TRUE) %>%
  apply(1, paste, collapse = "")

fourier_di_cos = readRDS("data/Created/tiling_fourier_di_cos.rds")
fourier_di_sin = readRDS("data/Created/tiling_fourier_di_sin.rds")
fourier_di_cos_test = readRDS("data/Created/tiling_fourier_di_cos_test.rds")
fourier_di_sin_test = readRDS("data/Created/tiling_fourier_di_sin_test.rds")
```

## Squared value of Fourier features

### Simple Linear Model

```{r}
dat_tri18 = cbind(dat %>%
                    select(all_of(ps2), all_of(trinucleotides), C0_new),
                  fourier_di_cos^2, fourier_di_sin^2)
tri18 = lm(C0_new~., data = dat_tri18)
cor(tri18$fitted.values, y)
# 0.4985743

dat_test_tri18 = cbind(dat_test %>%
                         select(all_of(ps2), all_of(trinucleotides), C0_new),
                       fourier_di_cos_test^2, fourier_di_sin_test^2)
tri18_pred = predict(tri18, dat_test_tri18)
cor(tri18_pred, y_test)
# 0.4761316

mean((tri18_pred - y_test)^2)
# 0.1865884
```

We get test prediction correlation of 0.4761316 and MSE of 0.1865884

### LightGBM (tree-based) Model

```{r}
set.seed(50)
dat_tri18.lgb_train_set = dat_tri18 %>%
  select(-C0_new)
dat_tri18.lgb_train_rules = lgb.convert_with_rules(data = dat_tri18.lgb_train_set)
dat_tri18.lgb_train_data = lgb.Dataset(data = as.matrix(dat_tri18.lgb_train_rules$data),
                                       label = dat_tri18$C0_new,
                                       categorical_feature = handle_categorical(colnames(dat_tri18.lgb_train_rules$data)))
dat_tri18.lgb_test_set = dat_test_tri18 %>%
  select(-C0_new)
dat_tri18.lgb_test_matrix = as.matrix(lgb.convert_with_rules(data = dat_tri18.lgb_test_set, rules = dat_tri18.lgb_train_rules$rules)$data)
dat_tri18.lgb_test_data = lgb.Dataset(data = dat_tri18.lgb_test_matrix,
                                      label = dat_test_tri18$C0_new,
                                      categorical_feature = handle_categorical(colnames(dat_tri18.lgb_test_matrix)))
dat_tri18.lgb_obj = lightgbm(data = dat_tri18.lgb_train_data,
                             params = list(learning_rate = c(0.1),
                                           objective = c("regression"),
                                           min_data_in_leaf = 100,
                                           max_depth = c(5),
                                           num_leaves = c(1000),
                                           lambda_l2 = c(1),
                                           boosting = c("gbdt")),
                             valids = list(valid = dat_tri18.lgb_test_data),
                             nrounds = 2000,
                             early_stopping_rounds = 50)

dat_tri18.lgb_train_pred = predict(dat_tri18.lgb_obj, data = as.matrix(dat_tri18.lgb_train_rules$data))
cor(dat_tri18.lgb_train_pred, y, method="pearson")
# 0.8562448 (nrounds = 738)

dat_tri18.lgb_test_pred = predict(dat_tri18.lgb_obj, data = dat_tri18.lgb_test_matrix)

cor(dat_tri18.lgb_test_pred, y_test, method="pearson")
# 0.5566456 (nrounds = 738)

mean((dat_tri18.lgb_test_pred - y_test)^2)
# 0.1667621
```

We get test prediction correlation of 0.5566456 and MSE of 0.1667621

```{r}
dat_tri18.feature_importance = as.data.frame(lgb.importance(dat_tri18.lgb_obj)) %>%
  mutate(Feature = fct_rev(fct_inorder(Feature))) %>%
  dplyr::slice(1:50) %>%
  ggplot(aes(x = Feature, y = Gain)) +
  geom_col(fill = "dodgerblue") +
  coord_flip() +
  theme_bw()
dat_tri18.feature_importance
```


# Inputs: Position Specific Dinucleotides + Counts of trinucleotides + Fourier Features Based on all Dinucleotides with h=6 (period 9.8) + Modulus of Difference of Fourier Features Based on all Dinucleotides with h=6 (period 9.8) Calculated using fft

```{r}
ps2 <- paste0("X", 1:49, "di")
nucleotides <- c("A", "C", "G", "T")
dinucleotides <- gtools::permutations(n = 4, r = 2, v = nucleotides,
                                      repeats.allowed = TRUE) %>%
  apply(1, paste, collapse = "")
trinucleotides <- gtools::permutations(n = 4, r = 3, v = nucleotides,
                                       repeats.allowed = TRUE) %>%
  apply(1, paste, collapse = "")

fourier_di_cos = readRDS("data/Created/tiling_fourier_di_cos.rds")
fourier_di_sin = readRDS("data/Created/tiling_fourier_di_sin.rds")
fourier_di_cos_test = readRDS("data/Created/tiling_fourier_di_cos_test.rds")
fourier_di_sin_test = readRDS("data/Created/tiling_fourier_di_sin_test.rds")

fourier_di_cos_6 = as.data.frame(fourier_di_cos) %>% select(ends_with("_6"))
fourier_di_sin_6 = as.data.frame(fourier_di_sin) %>% select(ends_with("_6"))
fourier_di_cos_6_test = as.data.frame(fourier_di_cos_test) %>% select(ends_with("_6"))
fourier_di_sin_6_test = as.data.frame(fourier_di_sin_test) %>% select(ends_with("_6"))

fourier_6_mod = readRDS("data/Created/tiling_fourier_6_mod.rds")
fourier_6_mod_test = readRDS("data/Created/tiling_fourier_6_mod_test.rds")
```

## Squared value of Fourier features calculated using fft

### Simple Linear Model

```{r}
dat_tri22 = cbind(dat %>% select(all_of(ps2), all_of(trinucleotides), C0_new), 
                  (fourier_di_cos_6)^2, (fourier_di_sin_6)^2, 
                  (fourier_6_mod)^2)

tri22_lm = lm(C0_new~., data=dat_tri22)
cor(tri22_lm$fitted.values, y)
# 0.60605

dat_test_tri22 = cbind(dat_test %>% select(all_of(ps2), all_of(trinucleotides), C0_new),
                       (fourier_di_cos_6_test)^2, (fourier_di_sin_6_test)^2, 
                       (fourier_6_mod_test)^2)

tri22_pred = predict(tri22_lm, dat_test_tri22)

cor(tri22_pred, y_test)
# 0.6056564

mean((tri22_pred - y_test)^2)
# 0.1526126
```

We get test prediction correlation of 0.6056564 and MSE of 0.1526126

### LightGBM (tree-based) Model

```{r}
library(lightgbm)
source("scripts/functions/lgbm-helper-functions.R")
set.seed(50)
dat_tri22.lgb_train_set = dat_tri22 %>%
  select(-C0_new)
dat_tri22.lgb_train_rules = lgb.convert_with_rules(data = dat_tri22.lgb_train_set)
dat_tri22.lgb_train_data = lgb.Dataset(data = as.matrix(dat_tri22.lgb_train_rules$data),
                                       label = dat_tri22$C0_new,
                                       categorical_feature = handle_categorical(colnames(dat_tri22.lgb_train_rules$data)))
dat_tri22.lgb_test_set = dat_test_tri22 %>%
  select(-C0_new)
dat_tri22.lgb_test_matrix = as.matrix(lgb.convert_with_rules(data = dat_tri22.lgb_test_set, rules = dat_tri22.lgb_train_rules$rules)$data)
dat_tri22.lgb_test_data = lgb.Dataset(data = dat_tri22.lgb_test_matrix,
                                      label = dat_test_tri22$C0_new,
                                      categorical_feature = handle_categorical(colnames(dat_tri22.lgb_test_matrix)))
dat_tri22.lgb_obj = lightgbm(data = dat_tri22.lgb_train_data,
                             params = list(learning_rate = c(0.1),
                                           objective = c("regression"),
                                           min_data_in_leaf = 100,
                                           max_depth = c(5),
                                           num_leaves = c(1000),
                                           lambda_l2 = c(1),
                                           boosting = c("gbdt")),
                             valids = list(valid = dat_tri22.lgb_test_data),
                             nrounds = 2000,
                             early_stopping_rounds = 50)

dat_tri22.lgb_train_pred = predict(dat_tri22.lgb_obj, data = as.matrix(dat_tri22.lgb_train_rules$data))
cor(dat_tri22.lgb_train_pred, y, method="pearson")
# 0.8575844 (nrounds = 656)

dat_tri22.lgb_test_pred = predict(dat_tri22.lgb_obj, data = dat_tri22.lgb_test_matrix)

cor(dat_tri22.lgb_test_pred, y_test, method="pearson")
# 0.6473864 (nrounds = 656)

mean((dat_tri22.lgb_test_pred - y_test)^2)
# 0.1404243 (nrounds = 656)
```

We get test prediction correlation of 0.6473864 and MSE of 0.1404243

# Inputs: Position Specific Dinucleotides + Counts of trinucleotides + Fourier Features Based on all Dinucleotides with h=6 (period 9.8) + Modulus of Difference of Fourier Features Based on all Dinucleotides with h=6 (period 9.8) Calculated using fft + Markov Ratio

```{r}
ps2 <- paste0("X", 1:49, "di")
nucleotides <- c("A", "C", "G", "T")
dinucleotides <- gtools::permutations(n = 4, r = 2, v = nucleotides,
                                      repeats.allowed = TRUE) %>%
  apply(1, paste, collapse = "")
trinucleotides <- gtools::permutations(n = 4, r = 3, v = nucleotides,
                                       repeats.allowed = TRUE) %>%
  apply(1, paste, collapse = "")

fourier_di_cos = readRDS("data/Created/tiling_fourier_di_cos.rds")
fourier_di_sin = readRDS("data/Created/tiling_fourier_di_sin.rds")
fourier_di_cos_test = readRDS("data/Created/tiling_fourier_di_cos_test.rds")
fourier_di_sin_test = readRDS("data/Created/tiling_fourier_di_sin_test.rds")

fourier_di_cos_6 = as.data.frame(fourier_di_cos) %>% select(ends_with("_6"))
fourier_di_sin_6 = as.data.frame(fourier_di_sin) %>% select(ends_with("_6"))
fourier_di_cos_6_test = as.data.frame(fourier_di_cos_test) %>% select(ends_with("_6"))
fourier_di_sin_6_test = as.data.frame(fourier_di_sin_test) %>% select(ends_with("_6"))

fourier_6_mod = readRDS("data/Created/tiling_fourier_6_mod.rds")
fourier_6_mod_test = readRDS("data/Created/tiling_fourier_6_mod_test.rds")
```

## Squared value of Fourier features

### Simple Linear Model

```{r}
dat_tri23 = cbind(dat %>% select(all_of(ps2), all_of(trinucleotides), 
                                 ratio_score_2nd, C0_new), 
                  (fourier_di_cos_6)^2, (fourier_di_sin_6)^2, 
                  (fourier_6_mod)^2)

tri23_lm = lm(C0_new~., data=dat_tri23)
cor(tri23_lm$fitted.values, y)
# 0.6135146

dat_test_tri23 = cbind(dat_test %>% select(all_of(ps2), all_of(trinucleotides), 
                                           ratio_score_2nd,  C0_new),
                       (fourier_di_cos_6_test)^2, (fourier_di_sin_6_test)^2, 
                       (fourier_6_mod_test)^2)

tri23_pred = predict(tri23_lm, dat_test_tri23)

cor(tri23_pred, y_test)
# 0.661856

mean((tri23_pred - y_test)^2)
# 0.1385466
```

We get test prediction correlation of 0.661856 and MSE of 0.1385466

### LightGBM (tree-based) Model

```{r}
library(lightgbm)
source("scripts/functions/lgbm-helper-functions.R")
set.seed(50)
dat_tri23.lgb_train_set = dat_tri23 %>%
  select(-C0_new)
dat_tri23.lgb_train_rules = lgb.convert_with_rules(data = dat_tri23.lgb_train_set)
dat_tri23.lgb_train_data = lgb.Dataset(data = as.matrix(dat_tri23.lgb_train_rules$data),
                                       label = dat_tri23$C0_new,
                                       categorical_feature = handle_categorical(colnames(dat_tri23.lgb_train_rules$data)))
dat_tri23.lgb_test_set = dat_test_tri23 %>%
  select(-C0_new)
dat_tri23.lgb_test_matrix = as.matrix(lgb.convert_with_rules(data = dat_tri23.lgb_test_set, rules = dat_tri23.lgb_train_rules$rules)$data)
dat_tri23.lgb_test_data = lgb.Dataset(data = dat_tri23.lgb_test_matrix,
                                      label = dat_test_tri23$C0_new,
                                      categorical_feature = handle_categorical(colnames(dat_tri23.lgb_test_matrix)))
dat_tri23.lgb_obj = lightgbm(data = dat_tri23.lgb_train_data,
                             params = list(learning_rate = c(0.1),
                                           objective = c("regression"),
                                           min_data_in_leaf = 100,
                                           max_depth = c(5),
                                           num_leaves = c(1000),
                                           lambda_l2 = c(1),
                                           boosting = c("gbdt")),
                             valids = list(valid = dat_tri23.lgb_test_data),
                             nrounds = 2000,
                             early_stopping_rounds = 50)

dat_tri23.lgb_train_pred = predict(dat_tri23.lgb_obj, data = as.matrix(dat_tri23.lgb_train_rules$data))
cor(dat_tri23.lgb_train_pred, y, method="pearson")
# 0.7662354 (nrounds = 296)

dat_tri23.lgb_test_pred = predict(dat_tri23.lgb_obj, data = dat_tri23.lgb_test_matrix)

cor(dat_tri23.lgb_test_pred, y_test, method="pearson")
# 0.6730427 (nrounds = 296)

mean((dat_tri23.lgb_test_pred - y_test)^2)
# 0.1326919 (nrounds = 296)
```

We get test prediction correlation of 0.6730427 and MSE of 0.1326919


# Inputs: Position Specific Dinucleotides + Counts of trinucleotides + Fourier Features Based on A/T Nucleotides and AA/TT/AT/TA Dinucleotides Calculated from scratch

```{r}
ps2 <- paste0("X", 1:49, "di")
nucleotides <- c("A", "C", "G", "T")
dinucleotides <- gtools::permutations(n = 4, r = 2, v = nucleotides,
                                      repeats.allowed = TRUE) %>%
  apply(1, paste, collapse = "")
trinucleotides <- gtools::permutations(n = 4, r = 3, v = nucleotides,
                                       repeats.allowed = TRUE) %>%
  apply(1, paste, collapse = "")

Xone_AT_fourier_cos = readRDS("data/Created/tiling_Xone_AT_fourier_cos.rds")
Xone_AT_fourier_sin = readRDS("data/Created/tiling_Xone_AT_fourier_sin.rds")
Xone_AT_fourier_cos_test = readRDS("data/Created/tiling_Xone_AT_fourier_cos_test.rds")
Xone_AT_fourier_sin_test = readRDS("data/Created/tiling_Xone_AT_fourier_sin_test.rds")

Xtwo_AT_fourier_cos = readRDS("data/Created/tiling_Xtwo_AT_fourier_cos.rds")
Xtwo_AT_fourier_sin = readRDS("data/Created/tiling_Xtwo_AT_fourier_sin.rds")
Xtwo_AT_fourier_cos_test = readRDS("data/Created/tiling_Xtwo_AT_fourier_cos_test.rds")
Xtwo_AT_fourier_sin_test = readRDS("data/Created/tiling_Xtwo_AT_fourier_sin_test.rds")
```

## Squared value of Fourier features

### Simple Linear Model

```{r}
dat_tri13 = cbind(dat %>%
                    select(all_of(ps2), all_of(trinucleotides), C0_new),
                  Xone_AT_fourier_cos^2, Xone_AT_fourier_sin^2,
                  Xtwo_AT_fourier_cos^2, Xtwo_AT_fourier_sin^2)
tri13 = lm(C0_new~., data = dat_tri13)
cor(tri13$fitted.values, y)
# 0.5950419

dat_test_tri13 = cbind(dat_test %>%
                         select(all_of(ps2), all_of(trinucleotides), C0_new),
                       Xone_AT_fourier_cos_test^2, Xone_AT_fourier_sin_test^2,
                       Xtwo_AT_fourier_cos_test^2, Xtwo_AT_fourier_sin_test^2)
tri13_pred = predict(tri13, dat_test_tri13)
cor(tri13_pred, y_test)
# 0.5890185

mean((tri13_pred - y_test)^2)
# 0.1574067
```

We get test prediction correlation of 0.5890185 and MSE of 0.1574067

### LightGBM (tree-based) Model

```{r}
set.seed(50)
dat_tri13.lgb_train_set = dat_tri13 %>%
  select(-C0_new)
dat_tri13.lgb_train_rules = lgb.convert_with_rules(data = dat_tri13.lgb_train_set)
dat_tri13.lgb_train_data = lgb.Dataset(data = as.matrix(dat_tri13.lgb_train_rules$data),
                                       label = dat_tri13$C0_new,
                                       categorical_feature = handle_categorical(colnames(dat_tri13.lgb_train_rules$data)))
dat_tri13.lgb_test_set = dat_test_tri13 %>%
  select(-C0_new)
dat_tri13.lgb_test_matrix = as.matrix(lgb.convert_with_rules(data = dat_tri13.lgb_test_set, rules = dat_tri13.lgb_train_rules$rules)$data)
dat_tri13.lgb_test_data = lgb.Dataset(data = dat_tri13.lgb_test_matrix,
                                      label = dat_test_tri13$C0_new,
                                      categorical_feature = handle_categorical(colnames(dat_tri13.lgb_test_matrix)))
dat_tri13.lgb_obj = lightgbm(data = dat_tri13.lgb_train_data,
                             params = list(learning_rate = c(0.1),
                                           objective = c("regression"),
                                           min_data_in_leaf = 100,
                                           max_depth = c(5),
                                           num_leaves = c(1000),
                                           lambda_l2 = c(1),
                                           boosting = c("gbdt")),
                             valids = list(valid = dat_tri13.lgb_test_data),
                             nrounds = 2000,
                             early_stopping_rounds = 50)

dat_tri13.lgb_train_pred = predict(dat_tri13.lgb_obj, data = as.matrix(dat_tri13.lgb_train_rules$data))
cor(dat_tri13.lgb_train_pred, y, method="pearson")
# 0.8319893 (nrounds = 572)

dat_tri13.lgb_test_pred = predict(dat_tri13.lgb_obj, data = dat_tri13.lgb_test_matrix)

cor(dat_tri13.lgb_test_pred, y_test, method="pearson")
# 0.630346 (nrounds = 572)

mean((dat_tri13.lgb_test_pred - y_test)^2)
# 0.1453261
```

We get test prediction correlation of 0.630346 and MSE of 0.1453261

# Inputs: Position Specific Dinucleotides + Counts of trinucleotides + Fourier distance feature Based on AA/TT/AT/TA and CC/GG/CG/GC Dinucleotides Calculated from scratch

```{r}
ps2 <- paste0("X", 1:49, "di")
nucleotides <- c("A", "C", "G", "T")
dinucleotides <- gtools::permutations(n = 4, r = 2, v = nucleotides,
                                      repeats.allowed = TRUE) %>%
  apply(1, paste, collapse = "")
trinucleotides <- gtools::permutations(n = 4, r = 3, v = nucleotides,
                                       repeats.allowed = TRUE) %>%
  apply(1, paste, collapse = "")

Xtwo_fourier_distance = readRDS("data/Created/tiling_Xtwo_fourier_distance.rds")
Xtwo_fourier_distance_test = readRDS("data/Created/tiling_Xtwo_fourier_distance_test.rds")
```

## Simple Linear Model

```{r}
dat_tri14 = cbind(dat %>%
                    select(all_of(ps2), all_of(trinucleotides), C0_new),
                  Xtwo_fourier_distance)
tri14 = lm(C0_new~., data = dat_tri14)
cor(tri14$fitted.values, y)
# 0.5651197

dat_test_tri14 = cbind(dat_test %>%
                         select(all_of(ps2), all_of(trinucleotides), C0_new),
                       Xtwo_fourier_distance_test)
tri14_pred = predict(tri14, dat_test_tri14)
cor(tri14_pred, y_test)
# 0.5586271

mean((tri14_pred - y_test)^2)
# 0.1658256
```

We get test prediction correlation of 0.5586271 and MSE of 0.1658256

## LightGBM (tree-based) Model

```{r}
set.seed(50)
dat_tri14.lgb_train_set = dat_tri14 %>%
  select(-C0_new)
dat_tri14.lgb_train_rules = lgb.convert_with_rules(data = dat_tri14.lgb_train_set)
dat_tri14.lgb_train_data = lgb.Dataset(data = as.matrix(dat_tri14.lgb_train_rules$data),
                                       label = dat_tri14$C0_new,
                                       categorical_feature = handle_categorical(colnames(dat_tri14.lgb_train_rules$data)))
dat_tri14.lgb_test_set = dat_test_tri14 %>%
  select(-C0_new)
dat_tri14.lgb_test_matrix = as.matrix(lgb.convert_with_rules(data = dat_tri14.lgb_test_set, rules = dat_tri14.lgb_train_rules$rules)$data)
dat_tri14.lgb_test_data = lgb.Dataset(data = dat_tri14.lgb_test_matrix,
                                      label = dat_test_tri14$C0_new,
                                      categorical_feature = handle_categorical(colnames(dat_tri14.lgb_test_matrix)))
dat_tri14.lgb_obj = lightgbm(data = dat_tri14.lgb_train_data,
                             params = list(learning_rate = c(0.1),
                                           objective = c("regression"),
                                           min_data_in_leaf = 100,
                                           max_depth = c(5),
                                           num_leaves = c(1000),
                                           lambda_l2 = c(1),
                                           boosting = c("gbdt")),
                             valids = list(valid = dat_tri14.lgb_test_data),
                             nrounds = 4000,
                             early_stopping_rounds = 50)

dat_tri14.lgb_train_pred = predict(dat_tri14.lgb_obj, data = as.matrix(dat_tri14.lgb_train_rules$data))
cor(dat_tri14.lgb_train_pred, y, method="pearson")
# 0.9848729 (nrounds = 2611)

dat_tri14.lgb_test_pred = predict(dat_tri14.lgb_obj, data = dat_tri14.lgb_test_matrix)

cor(dat_tri14.lgb_test_pred, y_test, method="pearson")
# 0.6547131 (nrounds = 2611)

mean((dat_tri14.lgb_test_pred - y_test)^2)
# 0.1377094
```

We get test prediction correlation of 0.6547131 and MSE of 0.1377094

```{r}
dat_tri14.feature_importance = as.data.frame(lgb.importance(dat_tri14.lgb_obj)) %>%
  mutate(Feature = fct_rev(fct_inorder(Feature))) %>%
  dplyr::slice(1:50) %>%
  ggplot(aes(x = Feature, y = Gain)) +
  geom_col(fill = "dodgerblue") +
  coord_flip() +
  theme_bw()
dat_tri14.feature_importance
```


# Inputs: Position Specific Dinucleotides + Counts of trinucleotides + Fourier Features Based on AA/TT/AT/TA and CC/GG/CG/GC Dinucleotides Calculated from scratch

```{r}
ps2 <- paste0("X", 1:49, "di")
nucleotides <- c("A", "C", "G", "T")
dinucleotides <- gtools::permutations(n = 4, r = 2, v = nucleotides,
                                      repeats.allowed = TRUE) %>%
  apply(1, paste, collapse = "")
trinucleotides <- gtools::permutations(n = 4, r = 3, v = nucleotides,
                                       repeats.allowed = TRUE) %>%
  apply(1, paste, collapse = "")

Xtwo_AT_fourier_cos = readRDS("data/Created/tiling_Xtwo_AT_fourier_cos.rds")
Xtwo_AT_fourier_sin = readRDS("data/Created/tiling_Xtwo_AT_fourier_sin.rds")
Xtwo_AT_fourier_cos_test = readRDS("data/Created/tiling_Xtwo_AT_fourier_cos_test.rds")
Xtwo_AT_fourier_sin_test = readRDS("data/Created/tiling_Xtwo_AT_fourier_sin_test.rds")

Xtwo_CG_fourier_cos = readRDS("data/Created/tiling_Xtwo_CG_fourier_cos.rds")
Xtwo_CG_fourier_sin = readRDS("data/Created/tiling_Xtwo_CG_fourier_sin.rds")
Xtwo_CG_fourier_cos_test = readRDS("data/Created/tiling_Xtwo_CG_fourier_cos_test.rds")
Xtwo_CG_fourier_sin_test = readRDS("data/Created/tiling_Xtwo_CG_fourier_sin_test.rds")
```

## Squared value of Fourier features

### Simple Linear Model

```{r}
dat_tri15 = cbind(dat %>%
                    select(all_of(ps2), all_of(trinucleotides), C0_new),
                  Xtwo_AT_fourier_cos^2, Xtwo_AT_fourier_sin^2,
                  Xtwo_CG_fourier_cos^2, Xtwo_CG_fourier_sin^2)
tri15 = lm(C0_new~., data = dat_tri15)
cor(tri15$fitted.values, y)
# 0.5924007

dat_test_tri15 = cbind(dat_test %>%
                         select(all_of(ps2), all_of(trinucleotides), C0_new),
                       Xtwo_AT_fourier_cos_test^2, Xtwo_AT_fourier_sin_test^2,
                       Xtwo_CG_fourier_cos_test^2, Xtwo_CG_fourier_sin_test^2)
tri15_pred = predict(tri15, dat_test_tri15)
cor(tri15_pred, y_test)
# 0.5861323

mean((tri15_pred - y_test)^2)
# 0.158226
```

We get test prediction correlation of 0.5861323 and MSE of 0.158226

### LightGBM (tree-based) Model

```{r}
set.seed(50)
dat_tri15.lgb_train_set = dat_tri15 %>%
  select(-C0_new)
dat_tri15.lgb_train_rules = lgb.convert_with_rules(data = dat_tri15.lgb_train_set)
dat_tri15.lgb_train_data = lgb.Dataset(data = as.matrix(dat_tri15.lgb_train_rules$data),
                                       label = dat_tri15$C0_new,
                                       categorical_feature = handle_categorical(colnames(dat_tri15.lgb_train_rules$data)))
dat_tri15.lgb_test_set = dat_test_tri15 %>%
  select(-C0_new)
dat_tri15.lgb_test_matrix = as.matrix(lgb.convert_with_rules(data = dat_tri15.lgb_test_set, rules = dat_tri15.lgb_train_rules$rules)$data)
dat_tri15.lgb_test_data = lgb.Dataset(data = dat_tri15.lgb_test_matrix,
                                      label = dat_test_tri15$C0_new,
                                      categorical_feature = handle_categorical(colnames(dat_tri15.lgb_test_matrix)))
dat_tri15.lgb_obj = lightgbm(data = dat_tri15.lgb_train_data,
                             params = list(learning_rate = c(0.1),
                                           objective = c("regression"),
                                           min_data_in_leaf = 100,
                                           max_depth = c(5),
                                           num_leaves = c(1000),
                                           lambda_l2 = c(1),
                                           boosting = c("gbdt")),
                             valids = list(valid = dat_tri15.lgb_test_data),
                             nrounds = 2000,
                             early_stopping_rounds = 50)

dat_tri15.lgb_train_pred = predict(dat_tri15.lgb_obj, data = as.matrix(dat_tri15.lgb_train_rules$data))
cor(dat_tri15.lgb_train_pred, y, method="pearson")
# 0.7880678 (nrounds = 396)

dat_tri15.lgb_test_pred = predict(dat_tri15.lgb_obj, data = dat_tri15.lgb_test_matrix)

cor(dat_tri15.lgb_test_pred, y_test, method="pearson")
# 0.6244396 (nrounds = 396)

mean((dat_tri15.lgb_test_pred - y_test)^2)
# 0.1471526
```

We get test prediction correlation of 0.6244396 and MSE of 0.1471526

```{r}
dat_tri15.feature_importance = as.data.frame(lgb.importance(dat_tri15.lgb_obj)) %>%
  mutate(Feature = fct_rev(fct_inorder(Feature))) %>%
  dplyr::slice(1:50) %>%
  ggplot(aes(x = Feature, y = Gain)) +
  geom_col(fill = "dodgerblue") +
  coord_flip() +
  theme_bw()
dat_tri15.feature_importance
```


# Inputs: Position Specific Dinucleotides + Counts of trinucleotides + Fourier Features Based on AA/TT/AT/TA and CC/GG/CG/GC Dinucleotides + Distance between them calculated from scratch

```{r}
ps2 <- paste0("X", 1:49, "di")
nucleotides <- c("A", "C", "G", "T")
dinucleotides <- gtools::permutations(n = 4, r = 2, v = nucleotides,
                                      repeats.allowed = TRUE) %>%
  apply(1, paste, collapse = "")
trinucleotides <- gtools::permutations(n = 4, r = 3, v = nucleotides,
                                       repeats.allowed = TRUE) %>%
  apply(1, paste, collapse = "")

Xtwo_AT_fourier_cos = readRDS("data/Created/tiling_Xtwo_AT_fourier_cos.rds")
Xtwo_AT_fourier_sin = readRDS("data/Created/tiling_Xtwo_AT_fourier_sin.rds")
Xtwo_AT_fourier_cos_test = readRDS("data/Created/tiling_Xtwo_AT_fourier_cos_test.rds")
Xtwo_AT_fourier_sin_test = readRDS("data/Created/tiling_Xtwo_AT_fourier_sin_test.rds")

Xtwo_CG_fourier_cos = readRDS("data/Created/tiling_Xtwo_CG_fourier_cos.rds")
Xtwo_CG_fourier_sin = readRDS("data/Created/tiling_Xtwo_CG_fourier_sin.rds")
Xtwo_CG_fourier_cos_test = readRDS("data/Created/tiling_Xtwo_CG_fourier_cos_test.rds")
Xtwo_CG_fourier_sin_test = readRDS("data/Created/tiling_Xtwo_CG_fourier_sin_test.rds")

Xtwo_fourier_distance = readRDS("data/Created/tiling_Xtwo_fourier_distance.rds")
Xtwo_fourier_distance_test = readRDS("data/Created/tiling_Xtwo_fourier_distance_test.rds")
```

## Squared value of Fourier features

### Simple Linear Model

```{r}
dat_tri16 = cbind(dat %>%
                    select(all_of(ps2), all_of(trinucleotides), C0_new),
                  Xtwo_AT_fourier_cos^2, Xtwo_AT_fourier_sin^2,
                  Xtwo_CG_fourier_cos^2, Xtwo_CG_fourier_sin^2,
                  Xtwo_fourier_distance)
tri16 = lm(C0_new~., data = dat_tri16)
cor(tri16$fitted.values, y)
# 0.5957067

dat_test_tri16 = cbind(dat_test %>%
                         select(all_of(ps2), all_of(trinucleotides), C0_new),
                       Xtwo_AT_fourier_cos_test^2, Xtwo_AT_fourier_sin_test^2,
                       Xtwo_CG_fourier_cos_test^2, Xtwo_CG_fourier_sin_test^2,
                       Xtwo_fourier_distance_test)
tri16_pred = predict(tri16, dat_test_tri16)
cor(tri16_pred, y_test)
# 0.5899598

mean((tri16_pred - y_test)^2)
# 0.1571372
```

We get test prediction correlation of 0.5899598 and MSE of 0.1571372

### LightGBM (tree-based) Model

```{r}
set.seed(50)
dat_tri16.lgb_train_set = dat_tri16 %>%
  select(-C0_new)
dat_tri16.lgb_train_rules = lgb.convert_with_rules(data = dat_tri16.lgb_train_set)
dat_tri16.lgb_train_data = lgb.Dataset(data = as.matrix(dat_tri16.lgb_train_rules$data),
                                       label = dat_tri16$C0_new,
                                       categorical_feature = handle_categorical(colnames(dat_tri16.lgb_train_rules$data)))
dat_tri16.lgb_test_set = dat_test_tri16 %>%
  select(-C0_new)
dat_tri16.lgb_test_matrix = as.matrix(lgb.convert_with_rules(data = dat_tri16.lgb_test_set, rules = dat_tri16.lgb_train_rules$rules)$data)
dat_tri16.lgb_test_data = lgb.Dataset(data = dat_tri16.lgb_test_matrix,
                                      label = dat_test_tri16$C0_new,
                                      categorical_feature = handle_categorical(colnames(dat_tri16.lgb_test_matrix)))
dat_tri16.lgb_obj = lightgbm(data = dat_tri16.lgb_train_data,
                             params = list(learning_rate = c(0.1),
                                           objective = c("regression"),
                                           min_data_in_leaf = 100,
                                           max_depth = c(5),
                                           num_leaves = c(1000),
                                           lambda_l2 = c(1),
                                           boosting = c("gbdt")),
                             valids = list(valid = dat_tri16.lgb_test_data),
                             nrounds = 2000,
                             early_stopping_rounds = 50)

dat_tri16.lgb_train_pred = predict(dat_tri16.lgb_obj, data = as.matrix(dat_tri16.lgb_train_rules$data))
cor(dat_tri16.lgb_train_pred, y, method="pearson")
# 0.795029 (nrounds = 410)

dat_tri16.lgb_test_pred = predict(dat_tri16.lgb_obj, data = dat_tri16.lgb_test_matrix)

cor(dat_tri16.lgb_test_pred, y_test, method="pearson")
# 0.6263284 (nrounds = 410)

mean((dat_tri16.lgb_test_pred - y_test)^2)
# 0.1465886
```

We get test prediction correlation of 0.6263284 and MSE of 0.1465886

```{r}
dat_tri16.feature_importance = as.data.frame(lgb.importance(dat_tri16.lgb_obj)) %>%
  mutate(Feature = fct_rev(fct_inorder(Feature))) %>%
  dplyr::slice(1:50) %>%
  ggplot(aes(x = Feature, y = Gain)) +
  geom_col(fill = "dodgerblue") +
  coord_flip() +
  theme_bw()
dat_tri16.feature_importance
```


# Inputs: Position Specific Dinucleotides + Counts of trinucleotides + Amplitude of Fourier Features Based on AA/TT/AT/TA Dinucleotides + Fourier distance feature Based on AA/TT/AT/TA and CC/GG/CG/GC Dinucleotides Calculated from scratch

```{r}
ps2 <- paste0("X", 1:49, "di")
nucleotides <- c("A", "C", "G", "T")
dinucleotides <- gtools::permutations(n = 4, r = 2, v = nucleotides,
                                      repeats.allowed = TRUE) %>%
  apply(1, paste, collapse = "")
trinucleotides <- gtools::permutations(n = 4, r = 3, v = nucleotides,
                                       repeats.allowed = TRUE) %>%
  apply(1, paste, collapse = "")

Xtwo_fourier_distance = readRDS("data/Created/tiling_Xtwo_fourier_distance.rds")
Xtwo_fourier_distance_test = readRDS("data/Created/tiling_Xtwo_fourier_distance_test.rds")

Xtwo_AT_fourier_amp = readRDS("data/Created/tiling_Xtwo_AT_fourier_amp.rds")
Xtwo_AT_fourier_amp_test = readRDS("data/Created/tiling_Xtwo_AT_fourier_amp_test.rds")
```

## Simple Linear Model

```{r}
dat_tri17 = cbind(dat %>%
                    select(all_of(ps2), all_of(trinucleotides), C0_new),
                  Xtwo_AT_fourier_amp, Xtwo_fourier_distance)
tri17 = lm(C0_new~., data = dat_tri17)
cor(tri17$fitted.values, y)
# 0.5810939

dat_test_tri17 = cbind(dat_test %>%
                         select(all_of(ps2), all_of(trinucleotides), C0_new),
                       Xtwo_AT_fourier_amp_test, Xtwo_fourier_distance_test)
tri17_pred = predict(tri17, dat_test_tri17)
cor(tri17_pred, y_test)
# 0.5762994

mean((tri17_pred - y_test)^2)
# 0.1609835
```

We get test prediction correlation of 0.5762994 and MSE of 0.1609835

## LightGBM (tree-based) Model

```{r}
set.seed(50)
dat_tri17.lgb_train_set = dat_tri17 %>%
  select(-C0_new)
dat_tri17.lgb_train_rules = lgb.convert_with_rules(data = dat_tri17.lgb_train_set)
dat_tri17.lgb_train_data = lgb.Dataset(data = as.matrix(dat_tri17.lgb_train_rules$data),
                                       label = dat_tri17$C0_new,
                                       categorical_feature = handle_categorical(colnames(dat_tri17.lgb_train_rules$data)))
dat_tri17.lgb_test_set = dat_test_tri17 %>%
  select(-C0_new)
dat_tri17.lgb_test_matrix = as.matrix(lgb.convert_with_rules(data = dat_tri17.lgb_test_set, rules = dat_tri17.lgb_train_rules$rules)$data)
dat_tri17.lgb_test_data = lgb.Dataset(data = dat_tri17.lgb_test_matrix,
                                      label = dat_test_tri17$C0_new,
                                      categorical_feature = handle_categorical(colnames(dat_tri17.lgb_test_matrix)))
dat_tri17.lgb_obj = lightgbm(data = dat_tri17.lgb_train_data,
                             params = list(learning_rate = c(0.1),
                                           objective = c("regression"),
                                           min_data_in_leaf = 100,
                                           max_depth = c(5),
                                           num_leaves = c(1000),
                                           lambda_l2 = c(1),
                                           boosting = c("gbdt")),
                             valids = list(valid = dat_tri17.lgb_test_data),
                             nrounds = 2000,
                             early_stopping_rounds = 50)

dat_tri17.lgb_train_pred = predict(dat_tri17.lgb_obj, data = as.matrix(dat_tri17.lgb_train_rules$data))
cor(dat_tri17.lgb_train_pred, y, method="pearson")
# 0.8857826 (nrounds = 887)

dat_tri17.lgb_test_pred = predict(dat_tri17.lgb_obj, data = dat_tri17.lgb_test_matrix)

cor(dat_tri17.lgb_test_pred, y_test, method="pearson")
# 0.6347076 (nrounds = 887)

mean((dat_tri17.lgb_test_pred - y_test)^2)
# 0.1439464
```

We get test prediction correlation of 0.6347076 and MSE of 0.1439464

```{r}
dat_tri17.feature_importance = as.data.frame(lgb.importance(dat_tri17.lgb_obj)) %>%
  mutate(Feature = fct_rev(fct_inorder(Feature))) %>%
  dplyr::slice(1:50) %>%
  ggplot(aes(x = Feature, y = Gain)) +
  geom_col(fill = "dodgerblue") +
  coord_flip() +
  theme_bw()
dat_tri17.feature_importance
```


# Inputs: Position Specific Nucleotides and Di/Tri/Tetra/Pentanucleotides + Counts of nucleotides and di/trinucleotides + GC Count + Fourier Features Based on A/T Nucleotides and AA/TT/AT/TA Dinucleotides Calculated from scratch

## Squared value of Fourier features

FIXME

We get test prediction correlation of 0.5947468 and MSE of 0.1559104 with lasso
We get test prediction correlation of 0.5521174 and MSE of 0.1684419 with ridge

# Inputs: Position Specific Nucleotides and Di/Tri/Tetra/Pentanucleotides + Counts of nucleotides and di/trinucleotides + Fourier Features Based on A/T Nucleotides Calculated from scratch + Markov Ratio

## Raw Fourier features

FIXME

We get test prediction correlation of 0.5325079 and MSE of 0.1755468 with lasso
We get test prediction correlation of 0.4227327 and MSE of 0.1991023 with ridge

## Absolute value of Fourier features

FIXME

We get test prediction correlation of 0.6240565 and MSE of 0.1499349 with lasso
We get test prediction correlation of 0.5195996 and MSE of 0.1767014 with ridge

## Squared value of Fourier features

FIXME

We get test prediction correlation of 0.632222 and MSE of 0.1473066 with lasso
We get test prediction correlation of 0.5272287 and MSE of 0.1746053 with ridge

# Inputs: Position Specific Nucleotides and Di/Tri/Tetra/Pentanucleotides + Counts of nucleotides and di/trinucleotides + Fourier Features Based on A/T Nucleotides and AA/TT/AT/TA Dinucleotides Calculated from scratch + Markov Ratio

## Squared value of Fourier features

FIXME

We get test prediction correlation of 0.6479363 and MSE of 0.1428807 with lasso
We get test prediction correlation of 0.5691 and MSE of 0.1642059 with ridge

# Inputs: Distance Frequency Between AA/TT/AT/TA and CC/GG/CG/GC Dinucleotides Only

```{r}
dist_freq_AorTdi = readRDS("data/Created/tiling_dist_freq_AorTdi.rds")
dist_freq_AorTdi_test = readRDS("data/Created/tiling_dist_freq_AorTdi_test.rds")
```

## Simple Linear Model

```{r}
dat_dist_freq_AorTdi = cbind(dist_freq_AorTdi, dat %>% select(C0_new))

dist_freq_AorTdi_lm = lm(C0_new~., data=dat_dist_freq_AorTdi)
cor(dist_freq_AorTdi_lm$fitted.values, y)
# 0.3958934

dat_test_dist_freq_AorTdi = cbind(dist_freq_AorTdi_test, dat_test %>% select(C0_new))

dist_freq_AorTdi_pred = predict(dist_freq_AorTdi_lm, dat_test_dist_freq_AorTdi)

cor(dist_freq_AorTdi_pred, y_test)
# 0.3988815

mean((dist_freq_AorTdi_pred - y_test)^2)
# 0.2026721
```

We get test prediction correlation of 0.3988815 and MSE of 0.2026721

## LightGBM (tree-based) Model

```{r}
library(lightgbm)
source("scripts/functions/lgbm-helper-functions.R")
set.seed(50)
dat_dist_freq_AorTdi.lgb_train_set = dat_dist_freq_AorTdi %>%
  select(-C0_new)
dat_dist_freq_AorTdi.lgb_train_rules = lgb.convert_with_rules(data = dat_dist_freq_AorTdi.lgb_train_set)
dat_dist_freq_AorTdi.lgb_train_data = lgb.Dataset(data = as.matrix(dat_dist_freq_AorTdi.lgb_train_rules$data),
                                                  label = dat_dist_freq_AorTdi$C0_new,
                                                  categorical_feature = handle_categorical(colnames(dat_dist_freq_AorTdi.lgb_train_rules$data)))
dat_dist_freq_AorTdi.lgb_test_set = dat_test_dist_freq_AorTdi %>%
  select(-C0_new)
dat_dist_freq_AorTdi.lgb_test_matrix = as.matrix(lgb.convert_with_rules(data = dat_dist_freq_AorTdi.lgb_test_set, rules = dat_dist_freq_AorTdi.lgb_train_rules$rules)$data)
dat_dist_freq_AorTdi.lgb_test_data = lgb.Dataset(data = dat_dist_freq_AorTdi.lgb_test_matrix,
                                                 label = dat_test_dist_freq_AorTdi$C0_new,
                                                 categorical_feature = handle_categorical(colnames(dat_dist_freq_AorTdi.lgb_test_matrix)))
dat_dist_freq_AorTdi.lgb_obj = lightgbm(data = dat_dist_freq_AorTdi.lgb_train_data,
                                        params = list(learning_rate = c(0.1),
                                                      objective = c("regression"),
                                                      min_data_in_leaf = 100,
                                                      max_depth = c(5),
                                                      num_leaves = c(1000),
                                                      lambda_l2 = c(1),
                                                      boosting = c("gbdt")),
                                        valids = list(valid = dat_dist_freq_AorTdi.lgb_test_data),
                                        nrounds = 8000,
                                        early_stopping_rounds = 50)

dat_dist_freq_AorTdi.lgb_train_pred = predict(dat_dist_freq_AorTdi.lgb_obj, data = as.matrix(dat_dist_freq_AorTdi.lgb_train_rules$data))
cor(dat_dist_freq_AorTdi.lgb_train_pred, y, method="pearson")
# 0.4713347 (nrounds = 417)

dat_dist_freq_AorTdi.lgb_test_pred = predict(dat_dist_freq_AorTdi.lgb_obj, data = dat_dist_freq_AorTdi.lgb_test_matrix)

cor(dat_dist_freq_AorTdi.lgb_test_pred, y_test, method="pearson")
# 0.4085076 (nrounds = 417)

mean((dat_dist_freq_AorTdi.lgb_test_pred - y_test)^2)
# 0.2008515 (nrounds = 417)
```

We get test prediction correlation of 0.4085076 and MSE of 0.2008515

```{r}
dat_dist_freq_AorTdi.feature_importance = as.data.frame(lgb.importance(dat_dist_freq_AorTdi.lgb_obj)) %>%
  mutate(Feature = fct_rev(fct_inorder(Feature))) %>%
  dplyr::slice(1:50) %>%
  ggplot(aes(x = Feature, y = Gain)) +
  geom_col(fill = "dodgerblue") +
  coord_flip() +
  theme_bw()
dat_dist_freq_AorTdi.feature_importance
```



# Inputs: Position Specific Dinucleotides +  Distance Frequency Between AA/TT/AT/TA and CC/GG/CG/GC Dinucleotides

```{r}
ps2 <- paste0("X", 1:49, "di")

nucleotides <- c("A", "C", "G", "T")
dinucleotides <- gtools::permutations(n = 4, r = 2, v = nucleotides,
                                      repeats.allowed = TRUE) %>%
  apply(1, paste, collapse = "")

dist_freq_AorTdi = readRDS("data/Created/tiling_dist_freq_AorTdi.rds")
dist_freq_AorTdi_test = readRDS("data/Created/tiling_dist_freq_AorTdi_test.rds")
```

## Simple Linear Model

```{r}
dat_dist_freq_AorTdi4 = cbind(dat %>% select(all_of(ps2), C0_new), 
                              dist_freq_AorTdi)

dist_freq_AorTdi4_lm = lm(C0_new~., data=dat_dist_freq_AorTdi4)
cor(dist_freq_AorTdi4_lm$fitted.values, y)
# 0.5416255

dat_test_dist_freq_AorTdi4 = cbind(dat_test %>% select(all_of(ps2), C0_new), 
                                   dist_freq_AorTdi_test)

dist_freq_AorTdi4_pred = predict(dist_freq_AorTdi4_lm, dat_test_dist_freq_AorTdi4)

cor(dist_freq_AorTdi4_pred, y_test)
# 0.5406809

mean((dist_freq_AorTdi4_pred - y_test)^2)
# 0.1705532
```

We get test prediction correlation of 0.5406809 and MSE of 0.1705532

## LightGBM (tree-based) Model

```{r}
library(lightgbm)
source("scripts/functions/lgbm-helper-functions.R")
set.seed(50)
dat_dist_freq_AorTdi4.lgb_train_set = dat_dist_freq_AorTdi4 %>%
  select(-C0_new)
dat_dist_freq_AorTdi4.lgb_train_rules = lgb.convert_with_rules(data = dat_dist_freq_AorTdi4.lgb_train_set)
dat_dist_freq_AorTdi4.lgb_train_data = lgb.Dataset(data = as.matrix(dat_dist_freq_AorTdi4.lgb_train_rules$data),
                                                   label = dat_dist_freq_AorTdi4$C0_new,
                                                   categorical_feature = handle_categorical(colnames(dat_dist_freq_AorTdi4.lgb_train_rules$data)))
dat_dist_freq_AorTdi4.lgb_test_set = dat_test_dist_freq_AorTdi4 %>%
  select(-C0_new)
dat_dist_freq_AorTdi4.lgb_test_matrix = as.matrix(lgb.convert_with_rules(data = dat_dist_freq_AorTdi4.lgb_test_set, rules = dat_dist_freq_AorTdi4.lgb_train_rules$rules)$data)
dat_dist_freq_AorTdi4.lgb_test_data = lgb.Dataset(data = dat_dist_freq_AorTdi4.lgb_test_matrix,
                                                  label = dat_test_dist_freq_AorTdi4$C0_new,
                                                  categorical_feature = handle_categorical(colnames(dat_dist_freq_AorTdi4.lgb_test_matrix)))
dat_dist_freq_AorTdi4.lgb_obj = lightgbm(data = dat_dist_freq_AorTdi4.lgb_train_data,
                                         params = list(learning_rate = c(0.1),
                                                       objective = c("regression"),
                                                       min_data_in_leaf = 100,
                                                       max_depth = c(5),
                                                       num_leaves = c(1000),
                                                       lambda_l2 = c(1),
                                                       boosting = c("gbdt")),
                                         valids = list(valid = dat_dist_freq_AorTdi4.lgb_test_data),
                                         nrounds = 8000,
                                         early_stopping_rounds = 50)

dat_dist_freq_AorTdi4.lgb_train_pred = predict(dat_dist_freq_AorTdi4.lgb_obj, data = as.matrix(dat_dist_freq_AorTdi4.lgb_train_rules$data))
cor(dat_dist_freq_AorTdi4.lgb_train_pred, y, method="pearson")
# 0.9959181 (nrounds = 3566)

dat_dist_freq_AorTdi4.lgb_test_pred = predict(dat_dist_freq_AorTdi4.lgb_obj, data = dat_dist_freq_AorTdi4.lgb_test_matrix)

cor(dat_dist_freq_AorTdi4.lgb_test_pred, y_test, method="pearson")
# 0.6663733 (nrounds = 3566)

mean((dat_dist_freq_AorTdi4.lgb_test_pred - y_test)^2)
# 0.1341123 (nrounds = 3566)
```

We get test prediction correlation of 0.6663733 and MSE of 0.1341123

```{r}
dat_dist_freq_AorTdi4.feature_importance = as.data.frame(lgb.importance(dat_dist_freq_AorTdi4.lgb_obj)) %>%
  mutate(Feature = fct_rev(fct_inorder(Feature))) %>%
  dplyr::slice(1:50) %>%
  ggplot(aes(x = Feature, y = Gain)) +
  geom_col(fill = "dodgerblue") +
  coord_flip() +
  theme_bw()
dat_dist_freq_AorTdi4.feature_importance
```


# Inputs: Counts of Dinucleotides + Distance Frequency Between AA/TT/AT/TA and CC/GG/CG/GC Dinucleotides

```{r}
nucleotides <- c("A", "C", "G", "T")
dinucleotides <- gtools::permutations(n = 4, r = 2, v = nucleotides,
                                      repeats.allowed = TRUE) %>%
  apply(1, paste, collapse = "")

dist_freq_AorTdi = readRDS("data/Created/tiling_dist_freq_AorTdi.rds")
dist_freq_AorTdi_test = readRDS("data/Created/tiling_dist_freq_AorTdi_test.rds")
```

## Simple Linear Model

```{r}
dat_dist_freq_AorTdi2 = cbind(dat %>% select(all_of(dinucleotides), C0_new), 
                              dist_freq_AorTdi)

dist_freq_AorTdi2_lm = lm(C0_new~., data=dat_dist_freq_AorTdi2)
cor(dist_freq_AorTdi2_lm$fitted.values, y)
# 0.5091531

dat_test_dist_freq_AorTdi2 = cbind(dat_test %>% select(all_of(dinucleotides), C0_new), 
                                   dist_freq_AorTdi_test)

dist_freq_AorTdi2_pred = predict(dist_freq_AorTdi2_lm, dat_test_dist_freq_AorTdi2)

cor(dist_freq_AorTdi2_pred, y_test)
# 0.5147807

mean((dist_freq_AorTdi2_pred - y_test)^2)
# 0.1771493
```

We get test prediction correlation of 0.5147807 and MSE of 0.1771493

## LightGBM (tree-based) Model

```{r}
library(lightgbm)
source("scripts/functions/lgbm-helper-functions.R")
set.seed(50)
dat_dist_freq_AorTdi2.lgb_train_set = dat_dist_freq_AorTdi2 %>%
  select(-C0_new)
dat_dist_freq_AorTdi2.lgb_train_rules = lgb.convert_with_rules(data = dat_dist_freq_AorTdi2.lgb_train_set)
dat_dist_freq_AorTdi2.lgb_train_data = lgb.Dataset(data = as.matrix(dat_dist_freq_AorTdi2.lgb_train_rules$data),
                                                   label = dat_dist_freq_AorTdi2$C0_new,
                                                   categorical_feature = handle_categorical(colnames(dat_dist_freq_AorTdi2.lgb_train_rules$data)))
dat_dist_freq_AorTdi2.lgb_test_set = dat_test_dist_freq_AorTdi2 %>%
  select(-C0_new)
dat_dist_freq_AorTdi2.lgb_test_matrix = as.matrix(lgb.convert_with_rules(data = dat_dist_freq_AorTdi2.lgb_test_set, rules = dat_dist_freq_AorTdi2.lgb_train_rules$rules)$data)
dat_dist_freq_AorTdi2.lgb_test_data = lgb.Dataset(data = dat_dist_freq_AorTdi2.lgb_test_matrix,
                                                  label = dat_test_dist_freq_AorTdi2$C0_new,
                                                  categorical_feature = handle_categorical(colnames(dat_dist_freq_AorTdi2.lgb_test_matrix)))
dat_dist_freq_AorTdi2.lgb_obj = lightgbm(data = dat_dist_freq_AorTdi2.lgb_train_data,
                                         params = list(learning_rate = c(0.1),
                                                       objective = c("regression"),
                                                       min_data_in_leaf = 100,
                                                       max_depth = c(5),
                                                       num_leaves = c(1000),
                                                       lambda_l2 = c(1),
                                                       boosting = c("gbdt")),
                                         valids = list(valid = dat_dist_freq_AorTdi2.lgb_test_data),
                                         nrounds = 2000,
                                         early_stopping_rounds = 50)

dat_dist_freq_AorTdi2.lgb_train_pred = predict(dat_dist_freq_AorTdi2.lgb_obj, data = as.matrix(dat_dist_freq_AorTdi2.lgb_train_rules$data))
cor(dat_dist_freq_AorTdi2.lgb_train_pred, y, method="pearson")
# 0.6603474 (nrounds = 916)

dat_dist_freq_AorTdi2.lgb_test_pred = predict(dat_dist_freq_AorTdi2.lgb_obj, data = dat_dist_freq_AorTdi2.lgb_test_matrix)

cor(dat_dist_freq_AorTdi2.lgb_test_pred, y_test, method="pearson")
# 0.5491041 (nrounds = 916)

mean((dat_dist_freq_AorTdi2.lgb_test_pred - y_test)^2)
# 0.1683724 (nrounds = 916)
```

We get test prediction correlation of 0.5491041 and MSE of 0.1683724

```{r}
dat_dist_freq_AorTdi2.feature_importance = as.data.frame(lgb.importance(dat_dist_freq_AorTdi2.lgb_obj)) %>%
  mutate(Feature = fct_rev(fct_inorder(Feature))) %>%
  dplyr::slice(1:50) %>%
  ggplot(aes(x = Feature, y = Gain)) +
  geom_col(fill = "dodgerblue") +
  coord_flip() +
  theme_bw()
dat_dist_freq_AorTdi2.feature_importance
```


# Inputs: Position Specific Dinucleotides + Counts of Dinucleotides +  Distance Frequency Between AA/TT/AT/TA and CC/GG/CG/GC Dinucleotides

```{r}
ps2 <- paste0("X", 1:49, "di")

nucleotides <- c("A", "C", "G", "T")
dinucleotides <- gtools::permutations(n = 4, r = 2, v = nucleotides,
                                      repeats.allowed = TRUE) %>%
  apply(1, paste, collapse = "")

dist_freq_AorTdi = readRDS("data/Created/tiling_dist_freq_AorTdi.rds")
dist_freq_AorTdi_test = readRDS("data/Created/tiling_dist_freq_AorTdi_test.rds")
```

## Simple Linear Model

```{r}
dat_dist_freq_AorTdi5 = cbind(dat %>% select(all_of(ps2), 
                                             all_of(dinucleotides), C0_new), 
                              dist_freq_AorTdi)

dist_freq_AorTdi5_lm = lm(C0_new~., data=dat_dist_freq_AorTdi5)
cor(dist_freq_AorTdi5_lm$fitted.values, y)
# 0.5416255

dat_test_dist_freq_AorTdi5 = cbind(dat_test %>% select(all_of(ps2), 
                                                       all_of(dinucleotides), C0_new), 
                                   dist_freq_AorTdi_test)

dist_freq_AorTdi5_pred = predict(dist_freq_AorTdi5_lm, dat_test_dist_freq_AorTdi5)

cor(dist_freq_AorTdi5_pred, y_test)
# 0.5406809

mean((dist_freq_AorTdi5_pred - y_test)^2)
# 0.1705532
```

We get test prediction correlation of 0.5406809 and MSE of 0.1705532

## LightGBM (tree-based) Model

```{r}
library(lightgbm)
source("scripts/functions/lgbm-helper-functions.R")
set.seed(50)
dat_dist_freq_AorTdi5.lgb_train_set = dat_dist_freq_AorTdi5 %>%
  select(-C0_new)
dat_dist_freq_AorTdi5.lgb_train_rules = lgb.convert_with_rules(data = dat_dist_freq_AorTdi5.lgb_train_set)
dat_dist_freq_AorTdi5.lgb_train_data = lgb.Dataset(data = as.matrix(dat_dist_freq_AorTdi5.lgb_train_rules$data),
                                                   label = dat_dist_freq_AorTdi5$C0_new,
                                                   categorical_feature = handle_categorical(colnames(dat_dist_freq_AorTdi5.lgb_train_rules$data)))
dat_dist_freq_AorTdi5.lgb_test_set = dat_test_dist_freq_AorTdi5 %>%
  select(-C0_new)
dat_dist_freq_AorTdi5.lgb_test_matrix = as.matrix(lgb.convert_with_rules(data = dat_dist_freq_AorTdi5.lgb_test_set, rules = dat_dist_freq_AorTdi5.lgb_train_rules$rules)$data)
dat_dist_freq_AorTdi5.lgb_test_data = lgb.Dataset(data = dat_dist_freq_AorTdi5.lgb_test_matrix,
                                                  label = dat_test_dist_freq_AorTdi5$C0_new,
                                                  categorical_feature = handle_categorical(colnames(dat_dist_freq_AorTdi5.lgb_test_matrix)))
dat_dist_freq_AorTdi5.lgb_obj = lightgbm(data = dat_dist_freq_AorTdi5.lgb_train_data,
                                         params = list(learning_rate = c(0.1),
                                                       objective = c("regression"),
                                                       min_data_in_leaf = 100,
                                                       max_depth = c(5),
                                                       num_leaves = c(1000),
                                                       lambda_l2 = c(1),
                                                       boosting = c("gbdt")),
                                         valids = list(valid = dat_dist_freq_AorTdi5.lgb_test_data),
                                         nrounds = 8000,
                                         early_stopping_rounds = 50)

dat_dist_freq_AorTdi5.lgb_train_pred = predict(dat_dist_freq_AorTdi5.lgb_obj, data = as.matrix(dat_dist_freq_AorTdi5.lgb_train_rules$data))
cor(dat_dist_freq_AorTdi5.lgb_train_pred, y, method="pearson")
# 0.9885083 (nrounds = 2757)

dat_dist_freq_AorTdi5.lgb_test_pred = predict(dat_dist_freq_AorTdi5.lgb_obj, data = dat_dist_freq_AorTdi5.lgb_test_matrix)

cor(dat_dist_freq_AorTdi5.lgb_test_pred, y_test, method="pearson")
# 0.6610645 (nrounds = 2757)

mean((dat_dist_freq_AorTdi5.lgb_test_pred - y_test)^2)
# 0.1358151 (nrounds = 2757)
```

We get test prediction correlation of 0.6610645 and MSE of 0.1358151

```{r}
dat_dist_freq_AorTdi5.feature_importance = as.data.frame(lgb.importance(dat_dist_freq_AorTdi5.lgb_obj)) %>%
  mutate(Feature = fct_rev(fct_inorder(Feature))) %>%
  dplyr::slice(1:50) %>%
  ggplot(aes(x = Feature, y = Gain)) +
  geom_col(fill = "dodgerblue") +
  coord_flip() +
  theme_bw()
dat_dist_freq_AorTdi5.feature_importance
```


# Inputs: Counts of Trinucleotides +  Distance Frequency Between AA/TT/AT/TA and CC/GG/CG/GC Dinucleotides

```{r}
nucleotides <- c("A", "C", "G", "T")
dinucleotides <- gtools::permutations(n = 4, r = 2, v = nucleotides,
                                      repeats.allowed = TRUE) %>%
  apply(1, paste, collapse = "")
trinucleotides <- gtools::permutations(n = 4, r = 3, v = nucleotides,
                                       repeats.allowed = TRUE) %>%
  apply(1, paste, collapse = "")

dist_freq_AorTdi = readRDS("data/Created/tiling_dist_freq_AorTdi.rds")
dist_freq_AorTdi_test = readRDS("data/Created/tiling_dist_freq_AorTdi_test.rds")
```

## Simple Linear Model

```{r}
dat_dist_freq_AorTdi3 = cbind(dat %>% select(all_of(trinucleotides), C0_new), 
                              dist_freq_AorTdi)

dist_freq_AorTdi3_lm = lm(C0_new~., data=dat_dist_freq_AorTdi3)
cor(dist_freq_AorTdi3_lm$fitted.values, y)
# 0.5281893

dat_test_dist_freq_AorTdi3 = cbind(dat_test %>% select(all_of(trinucleotides), C0_new), 
                                   dist_freq_AorTdi_test)

dist_freq_AorTdi3_pred = predict(dist_freq_AorTdi3_lm, dat_test_dist_freq_AorTdi3)

cor(dist_freq_AorTdi3_pred, y_test)
# 0.53174

mean((dist_freq_AorTdi3_pred - y_test)^2)
# 0.1728655
```

We get test prediction correlation of 0.53174 and MSE of 0.1728655

## LightGBM (tree-based) Model

```{r}
library(lightgbm)
source("scripts/functions/lgbm-helper-functions.R")
set.seed(50)
dat_dist_freq_AorTdi3.lgb_train_set = dat_dist_freq_AorTdi3 %>%
  select(-C0_new)
dat_dist_freq_AorTdi3.lgb_train_rules = lgb.convert_with_rules(data = dat_dist_freq_AorTdi3.lgb_train_set)
dat_dist_freq_AorTdi3.lgb_train_data = lgb.Dataset(data = as.matrix(dat_dist_freq_AorTdi3.lgb_train_rules$data),
                                                   label = dat_dist_freq_AorTdi3$C0_new,
                                                   categorical_feature = handle_categorical(colnames(dat_dist_freq_AorTdi3.lgb_train_rules$data)))
dat_dist_freq_AorTdi3.lgb_test_set = dat_test_dist_freq_AorTdi3 %>%
  select(-C0_new)
dat_dist_freq_AorTdi3.lgb_test_matrix = as.matrix(lgb.convert_with_rules(data = dat_dist_freq_AorTdi3.lgb_test_set, rules = dat_dist_freq_AorTdi3.lgb_train_rules$rules)$data)
dat_dist_freq_AorTdi3.lgb_test_data = lgb.Dataset(data = dat_dist_freq_AorTdi3.lgb_test_matrix,
                                                  label = dat_test_dist_freq_AorTdi3$C0_new,
                                                  categorical_feature = handle_categorical(colnames(dat_dist_freq_AorTdi3.lgb_test_matrix)))
dat_dist_freq_AorTdi3.lgb_obj = lightgbm(data = dat_dist_freq_AorTdi3.lgb_train_data,
                                         params = list(learning_rate = c(0.1),
                                                       objective = c("regression"),
                                                       min_data_in_leaf = 100,
                                                       max_depth = c(5),
                                                       num_leaves = c(1000),
                                                       lambda_l2 = c(1),
                                                       boosting = c("gbdt")),
                                         valids = list(valid = dat_dist_freq_AorTdi3.lgb_test_data),
                                         nrounds = 4000,
                                         early_stopping_rounds = 50)

dat_dist_freq_AorTdi3.lgb_train_pred = predict(dat_dist_freq_AorTdi3.lgb_obj, data = as.matrix(dat_dist_freq_AorTdi3.lgb_train_rules$data))
cor(dat_dist_freq_AorTdi3.lgb_train_pred, y, method="pearson")
# 0.8644696 (nrounds = 3869)

dat_dist_freq_AorTdi3.lgb_test_pred = predict(dat_dist_freq_AorTdi3.lgb_obj, data = dat_dist_freq_AorTdi3.lgb_test_matrix)

cor(dat_dist_freq_AorTdi3.lgb_test_pred, y_test, method="pearson")
# 0.6342229 (nrounds = 3869)

mean((dat_dist_freq_AorTdi3.lgb_test_pred - y_test)^2)
# 0.1441179 (nrounds = 3869)
```

We get test prediction correlation of 0.6342229 and MSE of 0.1441179

```{r}
dat_dist_freq_AorTdi3.feature_importance = as.data.frame(lgb.importance(dat_dist_freq_AorTdi3.lgb_obj)) %>%
  mutate(Feature = fct_rev(fct_inorder(Feature))) %>%
  dplyr::slice(1:50) %>%
  ggplot(aes(x = Feature, y = Gain)) +
  geom_col(fill = "dodgerblue") +
  coord_flip() +
  theme_bw()
dat_dist_freq_AorTdi3.feature_importance
```


# Inputs: Counts of Trinucleotides +  Distance Frequency Between AA/TT/AT/TA and CC/GG/CG/GC Dinucleotides + Markov Ratio

```{r}
nucleotides <- c("A", "C", "G", "T")
dinucleotides <- gtools::permutations(n = 4, r = 2, v = nucleotides,
                                      repeats.allowed = TRUE) %>%
  apply(1, paste, collapse = "")
trinucleotides <- gtools::permutations(n = 4, r = 3, v = nucleotides,
                                       repeats.allowed = TRUE) %>%
  apply(1, paste, collapse = "")

dist_freq_AorTdi = readRDS("data/Created/tiling_dist_freq_AorTdi.rds")
dist_freq_AorTdi_test = readRDS("data/Created/tiling_dist_freq_AorTdi_test.rds")
```

## Simple Linear Model

```{r}
dat_dist_freq_AorTdi7 = cbind(dat %>% select(all_of(trinucleotides), 
                                             ratio_score_2nd, C0_new), 
                              dist_freq_AorTdi)

dist_freq_AorTdi7_lm = lm(C0_new~., data=dat_dist_freq_AorTdi7)
cor(dist_freq_AorTdi7_lm$fitted.values, y)
# 0.5475463

dat_test_dist_freq_AorTdi7 = cbind(dat_test %>% select(all_of(trinucleotides), 
                                                       ratio_score_2nd, C0_new), 
                                   dist_freq_AorTdi_test)

dist_freq_AorTdi7_pred = predict(dist_freq_AorTdi7_lm, dat_test_dist_freq_AorTdi7)

cor(dist_freq_AorTdi7_pred, y_test)
# 0.6128883
# 0.5311516

mean((dist_freq_AorTdi7_pred - y_test)^2)
# 0.153482
# 0.1730365
```

We get test prediction correlation of 0.6128883 and MSE of 0.153482

## LightGBM (tree-based) Model

```{r}
library(lightgbm)
source("scripts/functions/lgbm-helper-functions.R")
set.seed(50)
dat_dist_freq_AorTdi7.lgb_train_set = dat_dist_freq_AorTdi7 %>%
  select(-C0_new)
dat_dist_freq_AorTdi7.lgb_train_rules = lgb.convert_with_rules(data = dat_dist_freq_AorTdi7.lgb_train_set)
dat_dist_freq_AorTdi7.lgb_train_data = lgb.Dataset(data = as.matrix(dat_dist_freq_AorTdi7.lgb_train_rules$data),
                                                   label = dat_dist_freq_AorTdi7$C0_new,
                                                   categorical_feature = handle_categorical(colnames(dat_dist_freq_AorTdi7.lgb_train_rules$data)))
dat_dist_freq_AorTdi7.lgb_test_set = dat_test_dist_freq_AorTdi7 %>%
  select(-C0_new)
dat_dist_freq_AorTdi7.lgb_test_matrix = as.matrix(lgb.convert_with_rules(data = dat_dist_freq_AorTdi7.lgb_test_set, rules = dat_dist_freq_AorTdi7.lgb_train_rules$rules)$data)
dat_dist_freq_AorTdi7.lgb_test_data = lgb.Dataset(data = dat_dist_freq_AorTdi7.lgb_test_matrix,
                                                  label = dat_test_dist_freq_AorTdi7$C0_new,
                                                  categorical_feature = handle_categorical(colnames(dat_dist_freq_AorTdi7.lgb_test_matrix)))
dat_dist_freq_AorTdi7.lgb_obj = lightgbm(data = dat_dist_freq_AorTdi7.lgb_train_data,
                                         params = list(learning_rate = c(0.1),
                                                       objective = c("regression"),
                                                       min_data_in_leaf = 100,
                                                       max_depth = c(5),
                                                       num_leaves = c(1000),
                                                       lambda_l2 = c(1),
                                                       boosting = c("gbdt")),
                                         valids = list(valid = dat_dist_freq_AorTdi7.lgb_test_data),
                                         nrounds = 4000,
                                         early_stopping_rounds = 50)

dat_dist_freq_AorTdi7.lgb_train_pred = predict(dat_dist_freq_AorTdi7.lgb_obj, data = as.matrix(dat_dist_freq_AorTdi7.lgb_train_rules$data))
cor(dat_dist_freq_AorTdi7.lgb_train_pred, y, method="pearson")
# 0.7843664 (nrounds = 1686)
# 0.8674562 (nrounds = 3706)

dat_dist_freq_AorTdi7.lgb_test_pred = predict(dat_dist_freq_AorTdi7.lgb_obj, data = dat_dist_freq_AorTdi7.lgb_test_matrix)

cor(dat_dist_freq_AorTdi7.lgb_test_pred, y_test, method="pearson")
# 0.6706326 (nrounds = 1686)
# 0.6350612 (nrounds = 3706)

mean((dat_dist_freq_AorTdi7.lgb_test_pred - y_test)^2)
# 0.1340019 (nrounds = 1686)
# 0.1438456 (nrounds = 3706)
```

We get test prediction correlation of 0.6706326 and MSE of 0.1340019

```{r}
dat_dist_freq_AorTdi7.feature_importance = as.data.frame(lgb.importance(dat_dist_freq_AorTdi7.lgb_obj)) %>%
  mutate(Feature = fct_rev(fct_inorder(Feature))) %>%
  dplyr::slice(1:50) %>%
  ggplot(aes(x = Feature, y = Gain)) +
  geom_col(fill = "dodgerblue") +
  coord_flip() +
  theme_bw()
dat_dist_freq_AorTdi7.feature_importance
```


# Inputs: Counts of Trinucleotides +  Distance Frequency Between AA/TT/AT/TA and CC/GG/CG/GC Dinucleotides + Free Energy

```{r}
nucleotides <- c("A", "C", "G", "T")
dinucleotides <- gtools::permutations(n = 4, r = 2, v = nucleotides,
                                      repeats.allowed = TRUE) %>%
  apply(1, paste, collapse = "")
trinucleotides <- gtools::permutations(n = 4, r = 3, v = nucleotides,
                                       repeats.allowed = TRUE) %>%
  apply(1, paste, collapse = "")

dist_freq_AorTdi = readRDS("data/Created/tiling_dist_freq_AorTdi.rds")
dist_freq_AorTdi_test = readRDS("data/Created/tiling_dist_freq_AorTdi_test.rds")
```

## Simple Linear Model

```{r}
dat_dist_freq_AorTdi7_2 = cbind(dat %>% select(all_of(trinucleotides), 
                                               sequence_energy, C0_new), 
                                dist_freq_AorTdi)

dist_freq_AorTdi7_2_lm = lm(C0_new~., data=dat_dist_freq_AorTdi7_2)
cor(dist_freq_AorTdi7_2_lm$fitted.values, y)
# 0.5282112

dat_test_dist_freq_AorTdi7_2 = cbind(dat_test %>% select(all_of(trinucleotides), 
                                                         sequence_energy, C0_new), 
                                     dist_freq_AorTdi_test)

dist_freq_AorTdi7_2_pred = predict(dist_freq_AorTdi7_2_lm, dat_test_dist_freq_AorTdi7_2)

cor(dist_freq_AorTdi7_2_pred, y_test)
# 0.531704

mean((dist_freq_AorTdi7_2_pred - y_test)^2)
# 0.1728746
```

We get test prediction correlation of 0.531704 and MSE of 0.1728746

## LightGBM (tree-based) Model

```{r}
library(lightgbm)
source("scripts/functions/lgbm-helper-functions.R")
set.seed(50)
dat_dist_freq_AorTdi7_2.lgb_train_set = dat_dist_freq_AorTdi7_2 %>%
  select(-C0_new)
dat_dist_freq_AorTdi7_2.lgb_train_rules = lgb.convert_with_rules(data = dat_dist_freq_AorTdi7_2.lgb_train_set)
dat_dist_freq_AorTdi7_2.lgb_train_data = lgb.Dataset(data = as.matrix(dat_dist_freq_AorTdi7_2.lgb_train_rules$data),
                                                     label = dat_dist_freq_AorTdi7_2$C0_new,
                                                     categorical_feature = handle_categorical(colnames(dat_dist_freq_AorTdi7_2.lgb_train_rules$data)))
dat_dist_freq_AorTdi7_2.lgb_test_set = dat_test_dist_freq_AorTdi7_2 %>%
  select(-C0_new)
dat_dist_freq_AorTdi7_2.lgb_test_matrix = as.matrix(lgb.convert_with_rules(data = dat_dist_freq_AorTdi7_2.lgb_test_set, rules = dat_dist_freq_AorTdi7_2.lgb_train_rules$rules)$data)
dat_dist_freq_AorTdi7_2.lgb_test_data = lgb.Dataset(data = dat_dist_freq_AorTdi7_2.lgb_test_matrix,
                                                    label = dat_test_dist_freq_AorTdi7_2$C0_new,
                                                    categorical_feature = handle_categorical(colnames(dat_dist_freq_AorTdi7_2.lgb_test_matrix)))
dat_dist_freq_AorTdi7_2.lgb_obj = lightgbm(data = dat_dist_freq_AorTdi7_2.lgb_train_data,
                                           params = list(learning_rate = c(0.1),
                                                         objective = c("regression"),
                                                         min_data_in_leaf = 100,
                                                         max_depth = c(5),
                                                         num_leaves = c(1000),
                                                         lambda_l2 = c(1),
                                                         boosting = c("gbdt")),
                                           valids = list(valid = dat_dist_freq_AorTdi7_2.lgb_test_data),
                                           nrounds = 8000,
                                           early_stopping_rounds = 50)

dat_dist_freq_AorTdi7_2.lgb_train_pred = predict(dat_dist_freq_AorTdi7_2.lgb_obj, data = as.matrix(dat_dist_freq_AorTdi7_2.lgb_train_rules$data))
cor(dat_dist_freq_AorTdi7_2.lgb_train_pred, y, method="pearson")
# 0.8748442 (nrounds = 4031)

dat_dist_freq_AorTdi7_2.lgb_test_pred = predict(dat_dist_freq_AorTdi7_2.lgb_obj, data = dat_dist_freq_AorTdi7_2.lgb_test_matrix)

cor(dat_dist_freq_AorTdi7_2.lgb_test_pred, y_test, method="pearson")
# 0.6382989 (nrounds = 4031)

mean((dat_dist_freq_AorTdi7_2.lgb_test_pred - y_test)^2)
# 0.1428475 (nrounds = 4031)
```

We get test prediction correlation of 0.6382989 and MSE of 0.1428475

```{r}
dat_dist_freq_AorTdi7.feature_importance = as.data.frame(lgb.importance(dat_dist_freq_AorTdi7.lgb_obj)) %>%
  mutate(Feature = fct_rev(fct_inorder(Feature))) %>%
  dplyr::slice(1:50) %>%
  ggplot(aes(x = Feature, y = Gain)) +
  geom_col(fill = "dodgerblue") +
  coord_flip() +
  theme_bw()
dat_dist_freq_AorTdi7.feature_importance
```


# Inputs: Counts of Trinucleotides +  Distance Frequency Between AA/TT/AT/TA and CC/GG/CG/GC Dinucleotides + Melting Temperature

```{r}
nucleotides <- c("A", "C", "G", "T")
dinucleotides <- gtools::permutations(n = 4, r = 2, v = nucleotides,
                                      repeats.allowed = TRUE) %>%
  apply(1, paste, collapse = "")
trinucleotides <- gtools::permutations(n = 4, r = 3, v = nucleotides,
                                       repeats.allowed = TRUE) %>%
  apply(1, paste, collapse = "")

dist_freq_AorTdi = readRDS("data/Created/tiling_dist_freq_AorTdi.rds")
dist_freq_AorTdi_test = readRDS("data/Created/tiling_dist_freq_AorTdi_test.rds")
```

## Simple Linear Model

```{r}
dat_dist_freq_AorTdi7_3 = cbind(dat %>% select(all_of(trinucleotides), 
                                               tm1, C0_new), 
                                dist_freq_AorTdi)

dist_freq_AorTdi7_3_lm = lm(C0_new~., data=dat_dist_freq_AorTdi7_3)
cor(dist_freq_AorTdi7_3_lm$fitted.values, y)
# 0.5284481

dat_test_dist_freq_AorTdi7_3 = cbind(dat_test %>% select(all_of(trinucleotides), 
                                                         tm1, C0_new), 
                                     dist_freq_AorTdi_test)

dist_freq_AorTdi7_3_pred = predict(dist_freq_AorTdi7_3_lm, dat_test_dist_freq_AorTdi7_3)

cor(dist_freq_AorTdi7_3_pred, y_test)
# 0.5314771

mean((dist_freq_AorTdi7_3_pred - y_test)^2)
# 0.1729327
```

We get test prediction correlation of 0.5314771 and MSE of 0.1729327

## LightGBM (tree-based) Model

```{r}
library(lightgbm)
source("scripts/functions/lgbm-helper-functions.R")
set.seed(50)
dat_dist_freq_AorTdi7_3.lgb_train_set = dat_dist_freq_AorTdi7_3 %>%
  select(-C0_new)
dat_dist_freq_AorTdi7_3.lgb_train_rules = lgb.convert_with_rules(data = dat_dist_freq_AorTdi7_3.lgb_train_set)
dat_dist_freq_AorTdi7_3.lgb_train_data = lgb.Dataset(data = as.matrix(dat_dist_freq_AorTdi7_3.lgb_train_rules$data),
                                                     label = dat_dist_freq_AorTdi7_3$C0_new,
                                                     categorical_feature = handle_categorical(colnames(dat_dist_freq_AorTdi7_3.lgb_train_rules$data)))
dat_dist_freq_AorTdi7_3.lgb_test_set = dat_test_dist_freq_AorTdi7_3 %>%
  select(-C0_new)
dat_dist_freq_AorTdi7_3.lgb_test_matrix = as.matrix(lgb.convert_with_rules(data = dat_dist_freq_AorTdi7_3.lgb_test_set, rules = dat_dist_freq_AorTdi7_3.lgb_train_rules$rules)$data)
dat_dist_freq_AorTdi7_3.lgb_test_data = lgb.Dataset(data = dat_dist_freq_AorTdi7_3.lgb_test_matrix,
                                                    label = dat_test_dist_freq_AorTdi7_3$C0_new,
                                                    categorical_feature = handle_categorical(colnames(dat_dist_freq_AorTdi7_3.lgb_test_matrix)))
dat_dist_freq_AorTdi7_3.lgb_obj = lightgbm(data = dat_dist_freq_AorTdi7_3.lgb_train_data,
                                           params = list(learning_rate = c(0.1),
                                                         objective = c("regression"),
                                                         min_data_in_leaf = 100,
                                                         max_depth = c(5),
                                                         num_leaves = c(1000),
                                                         lambda_l2 = c(1),
                                                         boosting = c("gbdt")),
                                           valids = list(valid = dat_dist_freq_AorTdi7_3.lgb_test_data),
                                           nrounds = 8000,
                                           early_stopping_rounds = 50)

dat_dist_freq_AorTdi7_3.lgb_train_pred = predict(dat_dist_freq_AorTdi7_3.lgb_obj, data = as.matrix(dat_dist_freq_AorTdi7_3.lgb_train_rules$data))
cor(dat_dist_freq_AorTdi7_3.lgb_train_pred, y, method="pearson")
# 0.8391794 (nrounds = 2933)

dat_dist_freq_AorTdi7_3.lgb_test_pred = predict(dat_dist_freq_AorTdi7_3.lgb_obj, data = dat_dist_freq_AorTdi7_3.lgb_test_matrix)

cor(dat_dist_freq_AorTdi7_3.lgb_test_pred, y_test, method="pearson")
# 0.629312 (nrounds = 2933)

mean((dat_dist_freq_AorTdi7_3.lgb_test_pred - y_test)^2)
# 0.1455728 (nrounds = 2933)
```

We get test prediction correlation of 0.629312 and MSE of 0.1455728

```{r}
dat_dist_freq_AorTdi7.feature_importance = as.data.frame(lgb.importance(dat_dist_freq_AorTdi7.lgb_obj)) %>%
  mutate(Feature = fct_rev(fct_inorder(Feature))) %>%
  dplyr::slice(1:50) %>%
  ggplot(aes(x = Feature, y = Gain)) +
  geom_col(fill = "dodgerblue") +
  coord_flip() +
  theme_bw()
dat_dist_freq_AorTdi7.feature_importance
```


# Inputs: Position Specific Dinucleotides + Counts of Trinucleotides +  Distance Frequency Between AA/TT/AT/TA and CC/GG/CG/GC Dinucleotides

```{r}
ps2 <- paste0("X", 1:49, "di")

nucleotides <- c("A", "C", "G", "T")
dinucleotides <- gtools::permutations(n = 4, r = 2, v = nucleotides,
                                      repeats.allowed = TRUE) %>%
  apply(1, paste, collapse = "")
trinucleotides <- gtools::permutations(n = 4, r = 3, v = nucleotides,
                                       repeats.allowed = TRUE) %>%
  apply(1, paste, collapse = "")

dist_freq_AorTdi = readRDS("data/Created/tiling_dist_freq_AorTdi.rds")
dist_freq_AorTdi_test = readRDS("data/Created/tiling_dist_freq_AorTdi_test.rds")
```

## Simple Linear Model

```{r}
dat_dist_freq_AorTdi6 = cbind(dat %>% select(all_of(ps2), 
                                             all_of(trinucleotides), C0_new), 
                              dist_freq_AorTdi)

dist_freq_AorTdi6_lm = lm(C0_new~., data=dat_dist_freq_AorTdi6)
cor(dist_freq_AorTdi6_lm$fitted.values, y)
# 0.5595588

dat_test_dist_freq_AorTdi6 = cbind(dat_test %>% select(all_of(ps2), 
                                                       all_of(trinucleotides), C0_new), 
                                   dist_freq_AorTdi_test)

dist_freq_AorTdi6_pred = predict(dist_freq_AorTdi6_lm, dat_test_dist_freq_AorTdi6)

cor(dist_freq_AorTdi6_pred, y_test)
# 0.5556381

mean((dist_freq_AorTdi6_pred - y_test)^2)
# 0.1666169
```

We get test prediction correlation of 0.5556381 and MSE of 0.1666169

## LightGBM (tree-based) Model

```{r}
library(lightgbm)
source("scripts/functions/lgbm-helper-functions.R")
set.seed(50)
dat_dist_freq_AorTdi6.lgb_train_set = dat_dist_freq_AorTdi6 %>%
  select(-C0_new)
dat_dist_freq_AorTdi6.lgb_train_rules = lgb.convert_with_rules(data = dat_dist_freq_AorTdi6.lgb_train_set)
dat_dist_freq_AorTdi6.lgb_train_data = lgb.Dataset(data = as.matrix(dat_dist_freq_AorTdi6.lgb_train_rules$data),
                                                   label = dat_dist_freq_AorTdi6$C0_new,
                                                   categorical_feature = handle_categorical(colnames(dat_dist_freq_AorTdi6.lgb_train_rules$data)))
dat_dist_freq_AorTdi6.lgb_test_set = dat_test_dist_freq_AorTdi6 %>%
  select(-C0_new)
dat_dist_freq_AorTdi6.lgb_test_matrix = as.matrix(lgb.convert_with_rules(data = dat_dist_freq_AorTdi6.lgb_test_set, rules = dat_dist_freq_AorTdi6.lgb_train_rules$rules)$data)
dat_dist_freq_AorTdi6.lgb_test_data = lgb.Dataset(data = dat_dist_freq_AorTdi6.lgb_test_matrix,
                                                  label = dat_test_dist_freq_AorTdi6$C0_new,
                                                  categorical_feature = handle_categorical(colnames(dat_dist_freq_AorTdi6.lgb_test_matrix)))
dat_dist_freq_AorTdi6.lgb_obj = lightgbm(data = dat_dist_freq_AorTdi6.lgb_train_data,
                                         params = list(learning_rate = c(0.1),
                                                       objective = c("regression"),
                                                       min_data_in_leaf = 100,
                                                       max_depth = c(5),
                                                       num_leaves = c(1000),
                                                       lambda_l2 = c(1),
                                                       boosting = c("gbdt")),
                                         valids = list(valid = dat_dist_freq_AorTdi6.lgb_test_data),
                                         nrounds = 4000,
                                         early_stopping_rounds = 50)

dat_dist_freq_AorTdi6.lgb_train_pred = predict(dat_dist_freq_AorTdi6.lgb_obj, data = as.matrix(dat_dist_freq_AorTdi6.lgb_train_rules$data))
cor(dat_dist_freq_AorTdi6.lgb_train_pred, y, method="pearson")
# 0.9841138 (nrounds = 2628)

dat_dist_freq_AorTdi6.lgb_test_pred = predict(dat_dist_freq_AorTdi6.lgb_obj, data = dat_dist_freq_AorTdi6.lgb_test_matrix)

cor(dat_dist_freq_AorTdi6.lgb_test_pred, y_test, method="pearson")
# 0.66804 (nrounds = 2628)

mean((dat_dist_freq_AorTdi6.lgb_test_pred - y_test)^2)
# 0.1336224 (nrounds = 2628)
```

We get test prediction correlation of 0.66804 and MSE of 0.1336224

```{r}
dat_dist_freq_AorTdi6.feature_importance = as.data.frame(lgb.importance(dat_dist_freq_AorTdi6.lgb_obj)) %>%
  mutate(Feature = fct_rev(fct_inorder(Feature))) %>%
  dplyr::slice(1:50) %>%
  ggplot(aes(x = Feature, y = Gain)) +
  geom_col(fill = "dodgerblue") +
  coord_flip() +
  theme_bw()
dat_dist_freq_AorTdi6.feature_importance
```


# Inputs: Fourier Features Based on all Dinucleotides with h=6 (period 9.8) Calculated using fft + Distance Frequency Between AA/TT/AT/TA and CC/GG/CG/GC Dinucleotides

```{r}
fourier_di_cos = readRDS("data/Created/tiling_fourier_di_cos.rds")
fourier_di_sin = readRDS("data/Created/tiling_fourier_di_sin.rds")
fourier_di_cos_test = readRDS("data/Created/tiling_fourier_di_cos_test.rds")
fourier_di_sin_test = readRDS("data/Created/tiling_fourier_di_sin_test.rds")

fourier_di_cos_6 = as.data.frame(fourier_di_cos) %>% select(ends_with("_6"))
fourier_di_sin_6 = as.data.frame(fourier_di_sin) %>% select(ends_with("_6"))
fourier_di_cos_6_test = as.data.frame(fourier_di_cos_test) %>% select(ends_with("_6"))
fourier_di_sin_6_test = as.data.frame(fourier_di_sin_test) %>% select(ends_with("_6"))

dist_freq_AorTdi = readRDS("data/Created/tiling_dist_freq_AorTdi.rds")
dist_freq_AorTdi_test = readRDS("data/Created/tiling_dist_freq_AorTdi_test.rds")
```

## Squared value of Fourier features

### Simple Linear Model

```{r}
dat_fourier_6_mod15 = cbind(dat %>% select(C0_new), 
                            (fourier_di_cos_6)^2, (fourier_di_sin_6)^2, 
                            dist_freq_AorTdi)

fourier_6_mod15_lm = lm(C0_new~., data=dat_fourier_6_mod15)
cor(fourier_6_mod15_lm$fitted.values, y)
# 0.4295732

dat_test_fourier_6_mod15 = cbind(dat_test %>% select(C0_new), 
                                 (fourier_di_cos_6_test)^2, (fourier_di_sin_6_test)^2, 
                                 dist_freq_AorTdi_test)

fourier_6_mod15_pred = predict(fourier_6_mod15_lm, dat_test_fourier_6_mod15)

cor(fourier_6_mod15_pred, y_test)
# 0.4360788

mean((fourier_6_mod15_pred - y_test)^2)
# 0.195193
```

We get test prediction correlation of 0.4360788 and MSE of 0.195193

### LightGBM (tree-based) Model

```{r}
library(lightgbm)
source("scripts/functions/lgbm-helper-functions.R")
set.seed(50)
dat_fourier_6_mod15.lgb_train_set = dat_fourier_6_mod15 %>%
  select(-C0_new)
dat_fourier_6_mod15.lgb_train_rules = lgb.convert_with_rules(data = dat_fourier_6_mod15.lgb_train_set)
dat_fourier_6_mod15.lgb_train_data = lgb.Dataset(data = as.matrix(dat_fourier_6_mod15.lgb_train_rules$data),
                                                 label = dat_fourier_6_mod15$C0_new,
                                                 categorical_feature = handle_categorical(colnames(dat_fourier_6_mod15.lgb_train_rules$data)))
dat_fourier_6_mod15.lgb_test_set = dat_test_fourier_6_mod15 %>%
  select(-C0_new)
dat_fourier_6_mod15.lgb_test_matrix = as.matrix(lgb.convert_with_rules(data = dat_fourier_6_mod15.lgb_test_set, rules = dat_fourier_6_mod15.lgb_train_rules$rules)$data)
dat_fourier_6_mod15.lgb_test_data = lgb.Dataset(data = dat_fourier_6_mod15.lgb_test_matrix,
                                                label = dat_test_fourier_6_mod15$C0_new,
                                                categorical_feature = handle_categorical(colnames(dat_fourier_6_mod15.lgb_test_matrix)))
dat_fourier_6_mod15.lgb_obj = lightgbm(data = dat_fourier_6_mod15.lgb_train_data,
                                       params = list(learning_rate = c(0.1),
                                                     objective = c("regression"),
                                                     min_data_in_leaf = 100,
                                                     max_depth = c(5),
                                                     num_leaves = c(1000),
                                                     lambda_l2 = c(1),
                                                     boosting = c("gbdt")),
                                       valids = list(valid = dat_fourier_6_mod15.lgb_test_data),
                                       nrounds = 8000,
                                       early_stopping_rounds = 50)

dat_fourier_6_mod15.lgb_train_pred = predict(dat_fourier_6_mod15.lgb_obj, data = as.matrix(dat_fourier_6_mod15.lgb_train_rules$data))
cor(dat_fourier_6_mod15.lgb_train_pred, y, method="pearson")
# 0.6258401 (nrounds = 427)

dat_fourier_6_mod15.lgb_test_pred = predict(dat_fourier_6_mod15.lgb_obj, data = dat_fourier_6_mod15.lgb_test_matrix)

cor(dat_fourier_6_mod15.lgb_test_pred, y_test, method="pearson")
# 0.4782976 (nrounds = 427)

mean((dat_fourier_6_mod15.lgb_test_pred - y_test)^2)
# 0.1858763 (nrounds = 427)
```

We get test prediction correlation of 0.4782976 and MSE of 0.1858763

```{r}
dat_fourier_6_mod15.feature_importance = as.data.frame(lgb.importance(dat_fourier_6_mod15.lgb_obj)) %>%
  mutate(Feature = fct_rev(fct_inorder(Feature))) %>%
  dplyr::slice(1:50) %>%
  ggplot(aes(x = Feature, y = Gain)) +
  geom_col(fill = "dodgerblue") +
  coord_flip() +
  theme_bw()
dat_fourier_6_mod15.feature_importance
```


# Inputs: Modulus of Difference of Fourier Features Based on all Dinucleotides with h=6 (period 9.8) Calculated using fft + Distance Frequency Between AA/TT/AT/TA and CC/GG/CG/GC Dinucleotides

```{r}
fourier_6_mod = readRDS("data/Created/tiling_fourier_6_mod.rds")
fourier_6_mod_test = readRDS("data/Created/tiling_fourier_6_mod_test.rds")

dist_freq_AorTdi = readRDS("data/Created/tiling_dist_freq_AorTdi.rds")
dist_freq_AorTdi_test = readRDS("data/Created/tiling_dist_freq_AorTdi_test.rds")
```

## Squared value of Fourier features

### Simple Linear Model

```{r}
dat_fourier_6_mod16 = cbind(dat %>% select(C0_new),
                            (fourier_6_mod)^2, dist_freq_AorTdi)

fourier_6_mod16_lm = lm(C0_new~., data=dat_fourier_6_mod16)
cor(fourier_6_mod16_lm$fitted.values, y)
# 0.5014558

dat_test_fourier_6_mod16 = cbind(dat_test %>% select(C0_new), 
                                 (fourier_6_mod_test)^2, dist_freq_AorTdi_test)

fourier_6_mod16_pred = predict(fourier_6_mod16_lm, dat_test_fourier_6_mod16)

cor(fourier_6_mod16_pred, y_test)
# 0.5060696

mean((fourier_6_mod16_pred - y_test)^2)
# 0.1792853
```

We get test prediction correlation of 0.5060696 and MSE of 0.1792853

### LightGBM (tree-based) Model

```{r}
library(lightgbm)
source("scripts/functions/lgbm-helper-functions.R")
set.seed(50)
dat_fourier_6_mod16.lgb_train_set = dat_fourier_6_mod16 %>%
  select(-C0_new)
dat_fourier_6_mod16.lgb_train_rules = lgb.convert_with_rules(data = dat_fourier_6_mod16.lgb_train_set)
dat_fourier_6_mod16.lgb_train_data = lgb.Dataset(data = as.matrix(dat_fourier_6_mod16.lgb_train_rules$data),
                                                 label = dat_fourier_6_mod16$C0_new,
                                                 categorical_feature = handle_categorical(colnames(dat_fourier_6_mod16.lgb_train_rules$data)))
dat_fourier_6_mod16.lgb_test_set = dat_test_fourier_6_mod16 %>%
  select(-C0_new)
dat_fourier_6_mod16.lgb_test_matrix = as.matrix(lgb.convert_with_rules(data = dat_fourier_6_mod16.lgb_test_set, rules = dat_fourier_6_mod16.lgb_train_rules$rules)$data)
dat_fourier_6_mod16.lgb_test_data = lgb.Dataset(data = dat_fourier_6_mod16.lgb_test_matrix,
                                                label = dat_test_fourier_6_mod16$C0_new,
                                                categorical_feature = handle_categorical(colnames(dat_fourier_6_mod16.lgb_test_matrix)))
dat_fourier_6_mod16.lgb_obj = lightgbm(data = dat_fourier_6_mod16.lgb_train_data,
                                       params = list(learning_rate = c(0.1),
                                                     objective = c("regression"),
                                                     min_data_in_leaf = 100,
                                                     max_depth = c(5),
                                                     num_leaves = c(1000),
                                                     lambda_l2 = c(1),
                                                     boosting = c("gbdt")),
                                       valids = list(valid = dat_fourier_6_mod16.lgb_test_data),
                                       nrounds = 8000,
                                       early_stopping_rounds = 50)

dat_fourier_6_mod16.lgb_train_pred = predict(dat_fourier_6_mod16.lgb_obj, data = as.matrix(dat_fourier_6_mod16.lgb_train_rules$data))
cor(dat_fourier_6_mod16.lgb_train_pred, y, method="pearson")
# 0.8930355 (nrounds = 1830)

dat_fourier_6_mod16.lgb_test_pred = predict(dat_fourier_6_mod16.lgb_obj, data = dat_fourier_6_mod16.lgb_test_matrix)

cor(dat_fourier_6_mod16.lgb_test_pred, y_test, method="pearson")
# 0.5510326 (nrounds = 1830)

mean((dat_fourier_6_mod16.lgb_test_pred - y_test)^2)
# 0.1679448 (nrounds = 1830)
```

We get test prediction correlation of 0.5510326 and MSE of 0.1679448

```{r}
dat_fourier_6_mod16.feature_importance = as.data.frame(lgb.importance(dat_fourier_6_mod16.lgb_obj)) %>%
  mutate(Feature = fct_rev(fct_inorder(Feature))) %>%
  dplyr::slice(1:50) %>%
  ggplot(aes(x = Feature, y = Gain)) +
  geom_col(fill = "dodgerblue") +
  coord_flip() +
  theme_bw()
dat_fourier_6_mod16.feature_importance
```


# Inputs: Fourier Features Based on all Dinucleotides with h=6 (period 9.8) + Modulus of Difference of Fourier Features Based on all Dinucleotides with h=6 (period 9.8) Calculated using fft + Distance Frequency Between AA/TT/AT/TA and CC/GG/CG/GC Dinucleotides

```{r}
fourier_di_cos = readRDS("data/Created/tiling_fourier_di_cos.rds")
fourier_di_sin = readRDS("data/Created/tiling_fourier_di_sin.rds")
fourier_di_cos_test = readRDS("data/Created/tiling_fourier_di_cos_test.rds")
fourier_di_sin_test = readRDS("data/Created/tiling_fourier_di_sin_test.rds")

fourier_di_cos_6 = as.data.frame(fourier_di_cos) %>% select(ends_with("_6"))
fourier_di_sin_6 = as.data.frame(fourier_di_sin) %>% select(ends_with("_6"))
fourier_di_cos_6_test = as.data.frame(fourier_di_cos_test) %>% select(ends_with("_6"))
fourier_di_sin_6_test = as.data.frame(fourier_di_sin_test) %>% select(ends_with("_6"))

fourier_6_mod = readRDS("data/Created/tiling_fourier_6_mod.rds")
fourier_6_mod_test = readRDS("data/Created/tiling_fourier_6_mod_test.rds")

dist_freq_AorTdi = readRDS("data/Created/tiling_dist_freq_AorTdi.rds")
dist_freq_AorTdi_test = readRDS("data/Created/tiling_dist_freq_AorTdi_test.rds")
```

## Squared value of Fourier features

### Simple Linear Model

```{r}
dat_fourier_6_mod17 = cbind(dat %>% select(C0_new), 
                            (fourier_di_cos_6)^2, (fourier_di_sin_6)^2, 
                            (fourier_6_mod)^2, dist_freq_AorTdi)

fourier_6_mod17_lm = lm(C0_new~., data=dat_fourier_6_mod17)
cor(fourier_6_mod17_lm$fitted.values, y)
# 0.5050201

dat_test_fourier_6_mod17 = cbind(dat_test %>% select(C0_new), 
                                 (fourier_di_cos_6_test)^2, (fourier_di_sin_6_test)^2, 
                                 (fourier_6_mod_test)^2, dist_freq_AorTdi_test)

fourier_6_mod17_pred = predict(fourier_6_mod17_lm, dat_test_fourier_6_mod17)

cor(fourier_6_mod17_pred, y_test)
# 0.51006

mean((fourier_6_mod17_pred - y_test)^2)
# 0.1783082
```

We get test prediction correlation of 0.51006 and MSE of 0.1783082

### LightGBM (tree-based) Model

```{r}
library(lightgbm)
source("scripts/functions/lgbm-helper-functions.R")
set.seed(50)
dat_fourier_6_mod17.lgb_train_set = dat_fourier_6_mod17 %>%
  select(-C0_new)
dat_fourier_6_mod17.lgb_train_rules = lgb.convert_with_rules(data = dat_fourier_6_mod17.lgb_train_set)
dat_fourier_6_mod17.lgb_train_data = lgb.Dataset(data = as.matrix(dat_fourier_6_mod17.lgb_train_rules$data),
                                                 label = dat_fourier_6_mod17$C0_new,
                                                 categorical_feature = handle_categorical(colnames(dat_fourier_6_mod17.lgb_train_rules$data)))
dat_fourier_6_mod17.lgb_test_set = dat_test_fourier_6_mod17 %>%
  select(-C0_new)
dat_fourier_6_mod17.lgb_test_matrix = as.matrix(lgb.convert_with_rules(data = dat_fourier_6_mod17.lgb_test_set, rules = dat_fourier_6_mod17.lgb_train_rules$rules)$data)
dat_fourier_6_mod17.lgb_test_data = lgb.Dataset(data = dat_fourier_6_mod17.lgb_test_matrix,
                                                label = dat_test_fourier_6_mod17$C0_new,
                                                categorical_feature = handle_categorical(colnames(dat_fourier_6_mod17.lgb_test_matrix)))
dat_fourier_6_mod17.lgb_obj = lightgbm(data = dat_fourier_6_mod17.lgb_train_data,
                                       params = list(learning_rate = c(0.1),
                                                     objective = c("regression"),
                                                     min_data_in_leaf = 100,
                                                     max_depth = c(5),
                                                     num_leaves = c(1000),
                                                     lambda_l2 = c(1),
                                                     boosting = c("gbdt")),
                                       valids = list(valid = dat_fourier_6_mod17.lgb_test_data),
                                       nrounds = 8000,
                                       early_stopping_rounds = 50)

dat_fourier_6_mod17.lgb_train_pred = predict(dat_fourier_6_mod17.lgb_obj, data = as.matrix(dat_fourier_6_mod17.lgb_train_rules$data))
cor(dat_fourier_6_mod17.lgb_train_pred, y, method="pearson")
# 0.861724 (nrounds = 1368)

dat_fourier_6_mod17.lgb_test_pred = predict(dat_fourier_6_mod17.lgb_obj, data = dat_fourier_6_mod17.lgb_test_matrix)

cor(dat_fourier_6_mod17.lgb_test_pred, y_test, method="pearson")
# 0.5532524 (nrounds = 1368)

mean((dat_fourier_6_mod17.lgb_test_pred - y_test)^2)
# 0.1672676 (nrounds = 1368)
```

We get test prediction correlation of 0.5532524 and MSE of 0.1672676

```{r}
dat_fourier_6_mod17.feature_importance = as.data.frame(lgb.importance(dat_fourier_6_mod17.lgb_obj)) %>%
  mutate(Feature = fct_rev(fct_inorder(Feature))) %>%
  dplyr::slice(1:50) %>%
  ggplot(aes(x = Feature, y = Gain)) +
  geom_col(fill = "dodgerblue") +
  coord_flip() +
  theme_bw()
dat_fourier_6_mod17.feature_importance
```


# Inputs: Position Specific Dinucleotides + Fourier Features Based on all Dinucleotides with h=6 (period 9.8) + Modulus of Difference of Fourier Features Based on all Dinucleotides with h=6 (period 9.8) Calculated using fft + Distance Frequency Between AA/TT/AT/TA and CC/GG/CG/GC Dinucleotides

```{r}
ps2 <- paste0("X", 1:49, "di")

fourier_di_cos = readRDS("data/Created/tiling_fourier_di_cos.rds")
fourier_di_sin = readRDS("data/Created/tiling_fourier_di_sin.rds")
fourier_di_cos_test = readRDS("data/Created/tiling_fourier_di_cos_test.rds")
fourier_di_sin_test = readRDS("data/Created/tiling_fourier_di_sin_test.rds")

fourier_di_cos_6 = as.data.frame(fourier_di_cos) %>% select(ends_with("_6"))
fourier_di_sin_6 = as.data.frame(fourier_di_sin) %>% select(ends_with("_6"))
fourier_di_cos_6_test = as.data.frame(fourier_di_cos_test) %>% select(ends_with("_6"))
fourier_di_sin_6_test = as.data.frame(fourier_di_sin_test) %>% select(ends_with("_6"))

fourier_6_mod = readRDS("data/Created/tiling_fourier_6_mod.rds")
fourier_6_mod_test = readRDS("data/Created/tiling_fourier_6_mod_test.rds")

dist_freq_AorTdi = readRDS("data/Created/tiling_dist_freq_AorTdi.rds")
dist_freq_AorTdi_test = readRDS("data/Created/tiling_dist_freq_AorTdi_test.rds")
```

## Squared value of Fourier features

### Simple Linear Model

```{r}
dat_fourier_6_mod10 = cbind(dat %>% select(all_of(ps2), C0_new), 
                            (fourier_di_cos_6)^2, (fourier_di_sin_6)^2, 
                            (fourier_6_mod)^2, dist_freq_AorTdi)

fourier_6_mod10_lm = lm(C0_new~., data=dat_fourier_6_mod10)
cor(fourier_6_mod10_lm$fitted.values, y)
# 0.6164384

dat_test_fourier_6_mod10 = cbind(dat_test %>% select(all_of(ps2), C0_new), 
                                 (fourier_di_cos_6_test)^2, (fourier_di_sin_6_test)^2, 
                                 (fourier_6_mod_test)^2, dist_freq_AorTdi_test)

fourier_6_mod10_pred = predict(fourier_6_mod10_lm, dat_test_fourier_6_mod10)

cor(fourier_6_mod10_pred, y_test)
# 0.6187115

mean((fourier_6_mod10_pred - y_test)^2)
# 0.148749
```

We get test prediction correlation of 0.6187115 and MSE of 0.148749

### LightGBM (tree-based) Model

```{r}
library(lightgbm)
source("scripts/functions/lgbm-helper-functions.R")
set.seed(50)
dat_fourier_6_mod10.lgb_train_set = dat_fourier_6_mod10 %>%
  select(-C0_new)
dat_fourier_6_mod10.lgb_train_rules = lgb.convert_with_rules(data = dat_fourier_6_mod10.lgb_train_set)
dat_fourier_6_mod10.lgb_train_data = lgb.Dataset(data = as.matrix(dat_fourier_6_mod10.lgb_train_rules$data),
                                                 label = dat_fourier_6_mod10$C0_new,
                                                 categorical_feature = handle_categorical(colnames(dat_fourier_6_mod10.lgb_train_rules$data)))
dat_fourier_6_mod10.lgb_test_set = dat_test_fourier_6_mod10 %>%
  select(-C0_new)
dat_fourier_6_mod10.lgb_test_matrix = as.matrix(lgb.convert_with_rules(data = dat_fourier_6_mod10.lgb_test_set, rules = dat_fourier_6_mod10.lgb_train_rules$rules)$data)
dat_fourier_6_mod10.lgb_test_data = lgb.Dataset(data = dat_fourier_6_mod10.lgb_test_matrix,
                                                label = dat_test_fourier_6_mod10$C0_new,
                                                categorical_feature = handle_categorical(colnames(dat_fourier_6_mod10.lgb_test_matrix)))
dat_fourier_6_mod10.lgb_obj = lightgbm(data = dat_fourier_6_mod10.lgb_train_data,
                                       params = list(learning_rate = c(0.1),
                                                     objective = c("regression"),
                                                     min_data_in_leaf = 100,
                                                     max_depth = c(5),
                                                     num_leaves = c(1000),
                                                     lambda_l2 = c(1),
                                                     boosting = c("gbdt")),
                                       valids = list(valid = dat_fourier_6_mod10.lgb_test_data),
                                       nrounds = 8000,
                                       early_stopping_rounds = 50)

dat_fourier_6_mod10.lgb_train_pred = predict(dat_fourier_6_mod10.lgb_obj, data = as.matrix(dat_fourier_6_mod10.lgb_train_rules$data))
cor(dat_fourier_6_mod10.lgb_train_pred, y, method="pearson")
# 0.9153158 (nrounds = 1005)

dat_fourier_6_mod10.lgb_test_pred = predict(dat_fourier_6_mod10.lgb_obj, data = dat_fourier_6_mod10.lgb_test_matrix)

cor(dat_fourier_6_mod10.lgb_test_pred, y_test, method="pearson")
# 0.6481126 (nrounds = 1005)

mean((dat_fourier_6_mod10.lgb_test_pred - y_test)^2)
# 0.1400053 (nrounds = 1005)
```

We get test prediction correlation of 0.6481126 and MSE of 0.1400053

```{r}
dat_fourier_6_mod10.feature_importance = as.data.frame(lgb.importance(dat_fourier_6_mod10.lgb_obj)) %>%
  mutate(Feature = fct_rev(fct_inorder(Feature))) %>%
  dplyr::slice(1:50) %>%
  ggplot(aes(x = Feature, y = Gain)) +
  geom_col(fill = "dodgerblue") +
  coord_flip() +
  theme_bw()
dat_fourier_6_mod10.feature_importance
```


# Inputs: Position Specific Trinucleotides + Fourier Features Based on all Dinucleotides with h=6 (period 9.8) + Modulus of Difference of Fourier Features Based on all Dinucleotides with h=6 (period 9.8) Calculated using fft + Distance Frequency Between AA/TT/AT/TA and CC/GG/CG/GC Dinucleotides

```{r}
ps3 <- paste0("X", 1:48, "tri")

fourier_di_cos = readRDS("data/Created/tiling_fourier_di_cos.rds")
fourier_di_sin = readRDS("data/Created/tiling_fourier_di_sin.rds")
fourier_di_cos_test = readRDS("data/Created/tiling_fourier_di_cos_test.rds")
fourier_di_sin_test = readRDS("data/Created/tiling_fourier_di_sin_test.rds")

fourier_di_cos_6 = as.data.frame(fourier_di_cos) %>% select(ends_with("_6"))
fourier_di_sin_6 = as.data.frame(fourier_di_sin) %>% select(ends_with("_6"))
fourier_di_cos_6_test = as.data.frame(fourier_di_cos_test) %>% select(ends_with("_6"))
fourier_di_sin_6_test = as.data.frame(fourier_di_sin_test) %>% select(ends_with("_6"))

fourier_6_mod = readRDS("data/Created/tiling_fourier_6_mod.rds")
fourier_6_mod_test = readRDS("data/Created/tiling_fourier_6_mod_test.rds")

dist_freq_AorTdi = readRDS("data/Created/tiling_dist_freq_AorTdi.rds")
dist_freq_AorTdi_test = readRDS("data/Created/tiling_dist_freq_AorTdi_test.rds")
```

## Squared value of Fourier features

### Simple Linear Model

```{r}
dat_fourier_6_mod11 = cbind(dat %>% select(all_of(ps3), C0_new), 
                            (fourier_di_cos_6)^2, (fourier_di_sin_6)^2, 
                            (fourier_6_mod)^2, dist_freq_AorTdi)

fourier_6_mod11_lm = lm(C0_new~., data=dat_fourier_6_mod11)
cor(fourier_6_mod11_lm$fitted.values, y)
# 

dat_test_fourier_6_mod11 = cbind(dat_test %>% select(all_of(ps3), C0_new), 
                                 (fourier_di_cos_6_test)^2, (fourier_di_sin_6_test)^2, 
                                 (fourier_6_mod_test)^2, dist_freq_AorTdi_test)

fourier_6_mod11_pred = predict(fourier_6_mod11_lm, dat_test_fourier_6_mod11)

cor(fourier_6_mod11_pred, y_test)
# 

mean((fourier_6_mod11_pred - y_test)^2)
# 
```

We get test prediction correlation of  and MSE of 

### LightGBM (tree-based) Model

```{r}
library(lightgbm)
source("scripts/functions/lgbm-helper-functions.R")
set.seed(50)
dat_fourier_6_mod11.lgb_train_set = dat_fourier_6_mod11 %>%
  select(-C0_new)
dat_fourier_6_mod11.lgb_train_rules = lgb.convert_with_rules(data = dat_fourier_6_mod11.lgb_train_set)
dat_fourier_6_mod11.lgb_train_data = lgb.Dataset(data = as.matrix(dat_fourier_6_mod11.lgb_train_rules$data),
                                                 label = dat_fourier_6_mod11$C0_new,
                                                 categorical_feature = handle_categorical(colnames(dat_fourier_6_mod11.lgb_train_rules$data)))
dat_fourier_6_mod11.lgb_test_set = dat_test_fourier_6_mod11 %>%
  select(-C0_new)
dat_fourier_6_mod11.lgb_test_matrix = as.matrix(lgb.convert_with_rules(data = dat_fourier_6_mod11.lgb_test_set, rules = dat_fourier_6_mod11.lgb_train_rules$rules)$data)
dat_fourier_6_mod11.lgb_test_data = lgb.Dataset(data = dat_fourier_6_mod11.lgb_test_matrix,
                                                label = dat_test_fourier_6_mod11$C0_new,
                                                categorical_feature = handle_categorical(colnames(dat_fourier_6_mod11.lgb_test_matrix)))
dat_fourier_6_mod11.lgb_obj = lightgbm(data = dat_fourier_6_mod11.lgb_train_data,
                                       params = list(learning_rate = c(0.1),
                                                     objective = c("regression"),
                                                     min_data_in_leaf = 100,
                                                     max_depth = c(5),
                                                     num_leaves = c(1000),
                                                     lambda_l2 = c(1),
                                                     boosting = c("gbdt")),
                                       valids = list(valid = dat_fourier_6_mod11.lgb_test_data),
                                       nrounds = 8000,
                                       early_stopping_rounds = 50)

dat_fourier_6_mod11.lgb_train_pred = predict(dat_fourier_6_mod11.lgb_obj, data = as.matrix(dat_fourier_6_mod11.lgb_train_rules$data))
cor(dat_fourier_6_mod11.lgb_train_pred, y, method="pearson")
#  (nrounds = )

dat_fourier_6_mod11.lgb_test_pred = predict(dat_fourier_6_mod11.lgb_obj, data = dat_fourier_6_mod11.lgb_test_matrix)

cor(dat_fourier_6_mod11.lgb_test_pred, y_test, method="pearson")
#  (nrounds = )

mean((dat_fourier_6_mod11.lgb_test_pred - y_test)^2)
#  (nrounds = )
```

We get test prediction correlation of  and MSE of 

```{r}
dat_fourier_6_mod11.feature_importance = as.data.frame(lgb.importance(dat_fourier_6_mod11.lgb_obj)) %>%
  mutate(Feature = fct_rev(fct_inorder(Feature))) %>%
  dplyr::slice(1:50) %>%
  ggplot(aes(x = Feature, y = Gain)) +
  geom_col(fill = "dodgerblue") +
  coord_flip() +
  theme_bw()
dat_fourier_6_mod11.feature_importance
```


# Inputs: Counts of Dinucleotides + Fourier Features Based on all Dinucleotides with h=6 (period 9.8) + Modulus of Difference of Fourier Features Based on all Dinucleotides with h=6 (period 9.8) Calculated using fft + Distance Frequency Between AA/TT/AT/TA and CC/GG/CG/GC Dinucleotides

```{r}
nucleotides <- c("A", "C", "G", "T")
dinucleotides <- gtools::permutations(n = 4, r = 2, v = nucleotides,
                                      repeats.allowed = TRUE) %>%
  apply(1, paste, collapse = "")

fourier_di_cos = readRDS("data/Created/tiling_fourier_di_cos.rds")
fourier_di_sin = readRDS("data/Created/tiling_fourier_di_sin.rds")
fourier_di_cos_test = readRDS("data/Created/tiling_fourier_di_cos_test.rds")
fourier_di_sin_test = readRDS("data/Created/tiling_fourier_di_sin_test.rds")

fourier_di_cos_6 = as.data.frame(fourier_di_cos) %>% select(ends_with("_6"))
fourier_di_sin_6 = as.data.frame(fourier_di_sin) %>% select(ends_with("_6"))
fourier_di_cos_6_test = as.data.frame(fourier_di_cos_test) %>% select(ends_with("_6"))
fourier_di_sin_6_test = as.data.frame(fourier_di_sin_test) %>% select(ends_with("_6"))

fourier_6_mod = readRDS("data/Created/tiling_fourier_6_mod.rds")
fourier_6_mod_test = readRDS("data/Created/tiling_fourier_6_mod_test.rds")

dist_freq_AorTdi = readRDS("data/Created/tiling_dist_freq_AorTdi.rds")
dist_freq_AorTdi_test = readRDS("data/Created/tiling_dist_freq_AorTdi_test.rds")
```

## Squared value of Fourier features

### Simple Linear Model

```{r}
dat_fourier_6_mod7 = cbind(dat %>% select(all_of(dinucleotides), C0_new), 
                           (fourier_di_cos_6)^2, (fourier_di_sin_6)^2, 
                           (fourier_6_mod)^2, dist_freq_AorTdi)

fourier_6_mod7_lm = lm(C0_new~., data=dat_fourier_6_mod7)
cor(fourier_6_mod7_lm$fitted.values, y)
# 0.5915793

dat_test_fourier_6_mod7 = cbind(dat_test %>% select(all_of(dinucleotides), C0_new), 
                                (fourier_di_cos_6_test)^2, (fourier_di_sin_6_test)^2, 
                                (fourier_6_mod_test)^2, dist_freq_AorTdi_test)

fourier_6_mod7_pred = predict(fourier_6_mod7_lm, dat_test_fourier_6_mod7)

cor(fourier_6_mod7_pred, y_test)
# 0.5977008

mean((fourier_6_mod7_pred - y_test)^2)
# 0.1549088
```

We get test prediction correlation of 0.5977008 and MSE of 0.1549088

### LightGBM (tree-based) Model

```{r}
library(lightgbm)
source("scripts/functions/lgbm-helper-functions.R")
set.seed(50)
dat_fourier_6_mod7.lgb_train_set = dat_fourier_6_mod7 %>%
  select(-C0_new)
dat_fourier_6_mod7.lgb_train_rules = lgb.convert_with_rules(data = dat_fourier_6_mod7.lgb_train_set)
dat_fourier_6_mod7.lgb_train_data = lgb.Dataset(data = as.matrix(dat_fourier_6_mod7.lgb_train_rules$data),
                                                label = dat_fourier_6_mod7$C0_new,
                                                categorical_feature = handle_categorical(colnames(dat_fourier_6_mod7.lgb_train_rules$data)))
dat_fourier_6_mod7.lgb_test_set = dat_test_fourier_6_mod7 %>%
  select(-C0_new)
dat_fourier_6_mod7.lgb_test_matrix = as.matrix(lgb.convert_with_rules(data = dat_fourier_6_mod7.lgb_test_set, rules = dat_fourier_6_mod7.lgb_train_rules$rules)$data)
dat_fourier_6_mod7.lgb_test_data = lgb.Dataset(data = dat_fourier_6_mod7.lgb_test_matrix,
                                               label = dat_test_fourier_6_mod7$C0_new,
                                               categorical_feature = handle_categorical(colnames(dat_fourier_6_mod7.lgb_test_matrix)))
dat_fourier_6_mod7.lgb_obj = lightgbm(data = dat_fourier_6_mod7.lgb_train_data,
                                      params = list(learning_rate = c(0.1),
                                                    objective = c("regression"),
                                                    min_data_in_leaf = 100,
                                                    max_depth = c(5),
                                                    num_leaves = c(1000),
                                                    lambda_l2 = c(1),
                                                    boosting = c("gbdt")),
                                      valids = list(valid = dat_fourier_6_mod7.lgb_test_data),
                                      nrounds = 8000,
                                      early_stopping_rounds = 50)

dat_fourier_6_mod7.lgb_train_pred = predict(dat_fourier_6_mod7.lgb_obj, data = as.matrix(dat_fourier_6_mod7.lgb_train_rules$data))
cor(dat_fourier_6_mod7.lgb_train_pred, y, method="pearson")
# 0.7941145 (nrounds = 720)

dat_fourier_6_mod7.lgb_test_pred = predict(dat_fourier_6_mod7.lgb_obj, data = dat_fourier_6_mod7.lgb_test_matrix)

cor(dat_fourier_6_mod7.lgb_test_pred, y_test, method="pearson")
# 0.6145521 (nrounds = 720)

mean((dat_fourier_6_mod7.lgb_test_pred - y_test)^2)
# 0.1499864 (nrounds = 720)
```

We get test prediction correlation of 0.6145521 and MSE of 0.1499864

```{r}
dat_fourier_6_mod7.feature_importance = as.data.frame(lgb.importance(dat_fourier_6_mod7.lgb_obj)) %>%
  mutate(Feature = fct_rev(fct_inorder(Feature))) %>%
  dplyr::slice(1:50) %>%
  ggplot(aes(x = Feature, y = Gain)) +
  geom_col(fill = "dodgerblue") +
  coord_flip() +
  theme_bw()
dat_fourier_6_mod7.feature_importance
```


# Inputs: Position Specific Dinucleotides + Counts of Dinucleotides + Fourier Features Based on all Dinucleotides with h=6 (period 9.8) + Modulus of Difference of Fourier Features Based on all Dinucleotides with h=6 (period 9.8) Calculated using fft + Distance Frequency Between AA/TT/AT/TA and CC/GG/CG/GC Dinucleotides

```{r}
ps2 <- paste0("X", 1:49, "di")

nucleotides <- c("A", "C", "G", "T")
dinucleotides <- gtools::permutations(n = 4, r = 2, v = nucleotides,
                                      repeats.allowed = TRUE) %>%
  apply(1, paste, collapse = "")

fourier_di_cos = readRDS("data/Created/tiling_fourier_di_cos.rds")
fourier_di_sin = readRDS("data/Created/tiling_fourier_di_sin.rds")
fourier_di_cos_test = readRDS("data/Created/tiling_fourier_di_cos_test.rds")
fourier_di_sin_test = readRDS("data/Created/tiling_fourier_di_sin_test.rds")

fourier_di_cos_6 = as.data.frame(fourier_di_cos) %>% select(ends_with("_6"))
fourier_di_sin_6 = as.data.frame(fourier_di_sin) %>% select(ends_with("_6"))
fourier_di_cos_6_test = as.data.frame(fourier_di_cos_test) %>% select(ends_with("_6"))
fourier_di_sin_6_test = as.data.frame(fourier_di_sin_test) %>% select(ends_with("_6"))

fourier_6_mod = readRDS("data/Created/tiling_fourier_6_mod.rds")
fourier_6_mod_test = readRDS("data/Created/tiling_fourier_6_mod_test.rds")

dist_freq_AorTdi = readRDS("data/Created/tiling_dist_freq_AorTdi.rds")
dist_freq_AorTdi_test = readRDS("data/Created/tiling_dist_freq_AorTdi_test.rds")
```

## Squared value of Fourier features

### Simple Linear Model

```{r}
dat_fourier_6_mod12 = cbind(dat %>% select(all_of(ps2), all_of(dinucleotides), C0_new), 
                            (fourier_di_cos_6)^2, (fourier_di_sin_6)^2, 
                            (fourier_6_mod)^2, dist_freq_AorTdi)

fourier_6_mod12_lm = lm(C0_new~., data=dat_fourier_6_mod12)
cor(fourier_6_mod12_lm$fitted.values, y)
# 0.6164384

dat_test_fourier_6_mod12 = cbind(dat_test %>% select(all_of(ps2), all_of(dinucleotides), C0_new), 
                                 (fourier_di_cos_6_test)^2, (fourier_di_sin_6_test)^2, 
                                 (fourier_6_mod_test)^2, dist_freq_AorTdi_test)

fourier_6_mod12_pred = predict(fourier_6_mod12_lm, dat_test_fourier_6_mod12)

cor(fourier_6_mod12_pred, y_test)
# 0.6187115

mean((fourier_6_mod12_pred - y_test)^2)
# 0.148749
```

We get test prediction correlation of 0.6187115 and MSE of 0.148749

### LightGBM (tree-based) Model

```{r}
library(lightgbm)
source("scripts/functions/lgbm-helper-functions.R")
set.seed(50)
dat_fourier_6_mod12.lgb_train_set = dat_fourier_6_mod12 %>%
  select(-C0_new)
dat_fourier_6_mod12.lgb_train_rules = lgb.convert_with_rules(data = dat_fourier_6_mod12.lgb_train_set)
dat_fourier_6_mod12.lgb_train_data = lgb.Dataset(data = as.matrix(dat_fourier_6_mod12.lgb_train_rules$data),
                                                 label = dat_fourier_6_mod12$C0_new,
                                                 categorical_feature = handle_categorical(colnames(dat_fourier_6_mod12.lgb_train_rules$data)))
dat_fourier_6_mod12.lgb_test_set = dat_test_fourier_6_mod12 %>%
  select(-C0_new)
dat_fourier_6_mod12.lgb_test_matrix = as.matrix(lgb.convert_with_rules(data = dat_fourier_6_mod12.lgb_test_set, rules = dat_fourier_6_mod12.lgb_train_rules$rules)$data)
dat_fourier_6_mod12.lgb_test_data = lgb.Dataset(data = dat_fourier_6_mod12.lgb_test_matrix,
                                                label = dat_test_fourier_6_mod12$C0_new,
                                                categorical_feature = handle_categorical(colnames(dat_fourier_6_mod12.lgb_test_matrix)))
dat_fourier_6_mod12.lgb_obj = lightgbm(data = dat_fourier_6_mod12.lgb_train_data,
                                       params = list(learning_rate = c(0.1),
                                                     objective = c("regression"),
                                                     min_data_in_leaf = 100,
                                                     max_depth = c(5),
                                                     num_leaves = c(1000),
                                                     lambda_l2 = c(1),
                                                     boosting = c("gbdt")),
                                       valids = list(valid = dat_fourier_6_mod12.lgb_test_data),
                                       nrounds = 8000,
                                       early_stopping_rounds = 50)

dat_fourier_6_mod12.lgb_train_pred = predict(dat_fourier_6_mod12.lgb_obj, data = as.matrix(dat_fourier_6_mod12.lgb_train_rules$data))
cor(dat_fourier_6_mod12.lgb_train_pred, y, method="pearson")
# 0.8890709 (nrounds = 851)

dat_fourier_6_mod12.lgb_test_pred = predict(dat_fourier_6_mod12.lgb_obj, data = dat_fourier_6_mod12.lgb_test_matrix)

cor(dat_fourier_6_mod12.lgb_test_pred, y_test, method="pearson")
# 0.6421519 (nrounds = 851)

mean((dat_fourier_6_mod12.lgb_test_pred - y_test)^2)
# 0.1416704 (nrounds = 851)
```

We get test prediction correlation of 0.6421519 and MSE of 0.1416704

```{r}
dat_fourier_6_mod12.feature_importance = as.data.frame(lgb.importance(dat_fourier_6_mod12.lgb_obj)) %>%
  mutate(Feature = fct_rev(fct_inorder(Feature))) %>%
  dplyr::slice(1:50) %>%
  ggplot(aes(x = Feature, y = Gain)) +
  geom_col(fill = "dodgerblue") +
  coord_flip() +
  theme_bw()
dat_fourier_6_mod12.feature_importance
```


# Inputs: Counts of Trinucleotides + Fourier Features Based on all Dinucleotides with h=6 (period 9.8) + Modulus of Difference of Fourier Features Based on all Dinucleotides with h=6 (period 9.8) Calculated using fft + Distance Frequency Between AA/TT/AT/TA and CC/GG/CG/GC Dinucleotides

```{r}
nucleotides <- c("A", "C", "G", "T")
dinucleotides <- gtools::permutations(n = 4, r = 2, v = nucleotides,
                                      repeats.allowed = TRUE) %>%
  apply(1, paste, collapse = "")
trinucleotides <- gtools::permutations(n = 4, r = 3, v = nucleotides,
                                       repeats.allowed = TRUE) %>%
  apply(1, paste, collapse = "")

fourier_di_cos = readRDS("data/Created/tiling_fourier_di_cos.rds")
fourier_di_sin = readRDS("data/Created/tiling_fourier_di_sin.rds")
fourier_di_cos_test = readRDS("data/Created/tiling_fourier_di_cos_test.rds")
fourier_di_sin_test = readRDS("data/Created/tiling_fourier_di_sin_test.rds")

fourier_di_cos_6 = as.data.frame(fourier_di_cos) %>% select(ends_with("_6"))
fourier_di_sin_6 = as.data.frame(fourier_di_sin) %>% select(ends_with("_6"))
fourier_di_cos_6_test = as.data.frame(fourier_di_cos_test) %>% select(ends_with("_6"))
fourier_di_sin_6_test = as.data.frame(fourier_di_sin_test) %>% select(ends_with("_6"))

fourier_6_mod = readRDS("data/Created/tiling_fourier_6_mod.rds")
fourier_6_mod_test = readRDS("data/Created/tiling_fourier_6_mod_test.rds")

dist_freq_AorTdi = readRDS("data/Created/tiling_dist_freq_AorTdi.rds")
dist_freq_AorTdi_test = readRDS("data/Created/tiling_dist_freq_AorTdi_test.rds")
```

## Squared value of Fourier features

### Simple Linear Model

```{r}
dat_fourier_6_mod8 = cbind(dat %>% select(all_of(trinucleotides), C0_new), 
                           (fourier_di_cos_6)^2, (fourier_di_sin_6)^2, 
                           (fourier_6_mod)^2, dist_freq_AorTdi)

fourier_6_mod8_lm = lm(C0_new~., data=dat_fourier_6_mod8)
cor(fourier_6_mod8_lm$fitted.values, y)
# 0.605476

dat_test_fourier_6_mod8 = cbind(dat_test %>% select(all_of(trinucleotides), C0_new), 
                                (fourier_di_cos_6_test)^2, (fourier_di_sin_6_test)^2, 
                                (fourier_6_mod_test)^2, dist_freq_AorTdi_test)

fourier_6_mod8_pred = predict(fourier_6_mod8_lm, dat_test_fourier_6_mod8)

cor(fourier_6_mod8_pred, y_test)
# 0.6109166

mean((fourier_6_mod8_pred - y_test)^2)
# 0.1510598
```

We get test prediction correlation of 0.6109166 and MSE of 0.1510598

### LightGBM (tree-based) Model

```{r}
library(lightgbm)
source("scripts/functions/lgbm-helper-functions.R")
set.seed(50)
dat_fourier_6_mod8.lgb_train_set = dat_fourier_6_mod8 %>%
  select(-C0_new)
dat_fourier_6_mod8.lgb_train_rules = lgb.convert_with_rules(data = dat_fourier_6_mod8.lgb_train_set)
dat_fourier_6_mod8.lgb_train_data = lgb.Dataset(data = as.matrix(dat_fourier_6_mod8.lgb_train_rules$data),
                                                label = dat_fourier_6_mod8$C0_new,
                                                categorical_feature = handle_categorical(colnames(dat_fourier_6_mod8.lgb_train_rules$data)))
dat_fourier_6_mod8.lgb_test_set = dat_test_fourier_6_mod8 %>%
  select(-C0_new)
dat_fourier_6_mod8.lgb_test_matrix = as.matrix(lgb.convert_with_rules(data = dat_fourier_6_mod8.lgb_test_set, rules = dat_fourier_6_mod8.lgb_train_rules$rules)$data)
dat_fourier_6_mod8.lgb_test_data = lgb.Dataset(data = dat_fourier_6_mod8.lgb_test_matrix,
                                               label = dat_test_fourier_6_mod8$C0_new,
                                               categorical_feature = handle_categorical(colnames(dat_fourier_6_mod8.lgb_test_matrix)))
dat_fourier_6_mod8.lgb_obj = lightgbm(data = dat_fourier_6_mod8.lgb_train_data,
                                      params = list(learning_rate = c(0.1),
                                                    objective = c("regression"),
                                                    min_data_in_leaf = 100,
                                                    max_depth = c(5),
                                                    num_leaves = c(1000),
                                                    lambda_l2 = c(1),
                                                    boosting = c("gbdt")),
                                      valids = list(valid = dat_fourier_6_mod8.lgb_test_data),
                                      nrounds = 8000,
                                      early_stopping_rounds = 50)

dat_fourier_6_mod8.lgb_train_pred = predict(dat_fourier_6_mod8.lgb_obj, data = as.matrix(dat_fourier_6_mod8.lgb_train_rules$data))
cor(dat_fourier_6_mod8.lgb_train_pred, y, method="pearson")
# 0.8511738 (nrounds = 1053)

dat_fourier_6_mod8.lgb_test_pred = predict(dat_fourier_6_mod8.lgb_obj, data = dat_fourier_6_mod8.lgb_test_matrix)

cor(dat_fourier_6_mod8.lgb_test_pred, y_test, method="pearson")
# 0.6437929 (nrounds = 1053)

mean((dat_fourier_6_mod8.lgb_test_pred - y_test)^2)
# 0.1411226 (nrounds = 1053)
```

We get test prediction correlation of 0.6437929 and MSE of 0.1411226

```{r}
dat_fourier_6_mod8.feature_importance = as.data.frame(lgb.importance(dat_fourier_6_mod8.lgb_obj)) %>%
  mutate(Feature = fct_rev(fct_inorder(Feature))) %>%
  dplyr::slice(1:50) %>%
  ggplot(aes(x = Feature, y = Gain)) +
  geom_col(fill = "dodgerblue") +
  coord_flip() +
  theme_bw()
dat_fourier_6_mod8.feature_importance
```


# Inputs: Position Specific Dinucleotides + Counts of Trinucleotides + Fourier Features Based on all Dinucleotides with h=6 (period 9.8) + Modulus of Difference of Fourier Features Based on all Dinucleotides with h=6 (period 9.8) Calculated using fft + Distance Frequency Between AA/TT/AT/TA and CC/GG/CG/GC Dinucleotides

```{r}
ps2 <- paste0("X", 1:49, "di")

nucleotides <- c("A", "C", "G", "T")
dinucleotides <- gtools::permutations(n = 4, r = 2, v = nucleotides,
                                      repeats.allowed = TRUE) %>%
  apply(1, paste, collapse = "")
trinucleotides <- gtools::permutations(n = 4, r = 3, v = nucleotides,
                                       repeats.allowed = TRUE) %>%
  apply(1, paste, collapse = "")

fourier_di_cos = readRDS("data/Created/tiling_fourier_di_cos.rds")
fourier_di_sin = readRDS("data/Created/tiling_fourier_di_sin.rds")
fourier_di_cos_test = readRDS("data/Created/tiling_fourier_di_cos_test.rds")
fourier_di_sin_test = readRDS("data/Created/tiling_fourier_di_sin_test.rds")

fourier_di_cos_6 = as.data.frame(fourier_di_cos) %>% select(ends_with("_6"))
fourier_di_sin_6 = as.data.frame(fourier_di_sin) %>% select(ends_with("_6"))
fourier_di_cos_6_test = as.data.frame(fourier_di_cos_test) %>% select(ends_with("_6"))
fourier_di_sin_6_test = as.data.frame(fourier_di_sin_test) %>% select(ends_with("_6"))

fourier_6_mod = readRDS("data/Created/tiling_fourier_6_mod.rds")
fourier_6_mod_test = readRDS("data/Created/tiling_fourier_6_mod_test.rds")

dist_freq_AorTdi = readRDS("data/Created/tiling_dist_freq_AorTdi.rds")
dist_freq_AorTdi_test = readRDS("data/Created/tiling_dist_freq_AorTdi_test.rds")
```

## Squared value of Fourier features

### Simple Linear Model

```{r}
dat_fourier_6_mod13 = cbind(dat %>% select(all_of(ps2), all_of(trinucleotides), C0_new), 
                            (fourier_di_cos_6)^2, (fourier_di_sin_6)^2, 
                            (fourier_6_mod)^2, dist_freq_AorTdi)

fourier_6_mod13_lm = lm(C0_new~., data=dat_fourier_6_mod13)
cor(fourier_6_mod13_lm$fitted.values, y)
# 0.6295412

dat_test_fourier_6_mod13 = cbind(dat_test %>% select(all_of(ps2), all_of(trinucleotides), C0_new), 
                                 (fourier_di_cos_6_test)^2, (fourier_di_sin_6_test)^2, 
                                 (fourier_6_mod_test)^2, dist_freq_AorTdi_test)

fourier_6_mod13_pred = predict(fourier_6_mod13_lm, dat_test_fourier_6_mod13)

cor(fourier_6_mod13_pred, y_test)
# 0.6305922

mean((fourier_6_mod13_pred - y_test)^2)
# 0.14518
```

We get test prediction correlation of 0.6305922 and MSE of 0.14518

### LightGBM (tree-based) Model

```{r}
library(lightgbm)
source("scripts/functions/lgbm-helper-functions.R")
set.seed(50)
dat_fourier_6_mod13.lgb_train_set = dat_fourier_6_mod13 %>%
  select(-C0_new)
dat_fourier_6_mod13.lgb_train_rules = lgb.convert_with_rules(data = dat_fourier_6_mod13.lgb_train_set)
dat_fourier_6_mod13.lgb_train_data = lgb.Dataset(data = as.matrix(dat_fourier_6_mod13.lgb_train_rules$data),
                                                 label = dat_fourier_6_mod13$C0_new,
                                                 categorical_feature = handle_categorical(colnames(dat_fourier_6_mod13.lgb_train_rules$data)))
dat_fourier_6_mod13.lgb_test_set = dat_test_fourier_6_mod13 %>%
  select(-C0_new)
dat_fourier_6_mod13.lgb_test_matrix = as.matrix(lgb.convert_with_rules(data = dat_fourier_6_mod13.lgb_test_set, rules = dat_fourier_6_mod13.lgb_train_rules$rules)$data)
dat_fourier_6_mod13.lgb_test_data = lgb.Dataset(data = dat_fourier_6_mod13.lgb_test_matrix,
                                                label = dat_test_fourier_6_mod13$C0_new,
                                                categorical_feature = handle_categorical(colnames(dat_fourier_6_mod13.lgb_test_matrix)))
dat_fourier_6_mod13.lgb_obj = lightgbm(data = dat_fourier_6_mod13.lgb_train_data,
                                       params = list(learning_rate = c(0.1),
                                                     objective = c("regression"),
                                                     min_data_in_leaf = 100,
                                                     max_depth = c(5),
                                                     num_leaves = c(1000),
                                                     lambda_l2 = c(1),
                                                     boosting = c("gbdt")),
                                       valids = list(valid = dat_fourier_6_mod13.lgb_test_data),
                                       nrounds = 8000,
                                       early_stopping_rounds = 50)

dat_fourier_6_mod13.lgb_train_pred = predict(dat_fourier_6_mod13.lgb_obj, data = as.matrix(dat_fourier_6_mod13.lgb_train_rules$data))
cor(dat_fourier_6_mod13.lgb_train_pred, y, method="pearson")
# 0.8826131 (nrounds = 759)

dat_fourier_6_mod13.lgb_test_pred = predict(dat_fourier_6_mod13.lgb_obj, data = dat_fourier_6_mod13.lgb_test_matrix)

cor(dat_fourier_6_mod13.lgb_test_pred, y_test, method="pearson")
# 0.6625988 (nrounds = 759)

mean((dat_fourier_6_mod13.lgb_test_pred - y_test)^2)
# 0.1353922 (nrounds = 759)
```

We get test prediction correlation of 0.6625988 and MSE of 0.1353922

```{r}
dat_fourier_6_mod13.feature_importance = as.data.frame(lgb.importance(dat_fourier_6_mod13.lgb_obj)) %>%
  mutate(Feature = fct_rev(fct_inorder(Feature))) %>%
  dplyr::slice(1:50) %>%
  ggplot(aes(x = Feature, y = Gain)) +
  geom_col(fill = "dodgerblue") +
  coord_flip() +
  theme_bw()
dat_fourier_6_mod13.feature_importance
```


# Inputs: Position Specific Dinucleotides + Counts of Trinucleotides + Fourier Features Based on all Dinucleotides with h=6 (period 9.8) + Modulus of Difference of Fourier Features Based on all Dinucleotides with h=6 (period 9.8) Calculated using fft + Distance Frequency Between AA/TT/AT/TA and CC/GG/CG/GC Dinucleotides + Markov Ratio

```{r}
ps2 <- paste0("X", 1:49, "di")

nucleotides <- c("A", "C", "G", "T")
dinucleotides <- gtools::permutations(n = 4, r = 2, v = nucleotides,
                                      repeats.allowed = TRUE) %>%
  apply(1, paste, collapse = "")
trinucleotides <- gtools::permutations(n = 4, r = 3, v = nucleotides,
                                       repeats.allowed = TRUE) %>%
  apply(1, paste, collapse = "")

fourier_di_cos = readRDS("data/Created/tiling_fourier_di_cos.rds")
fourier_di_sin = readRDS("data/Created/tiling_fourier_di_sin.rds")
fourier_di_cos_test = readRDS("data/Created/tiling_fourier_di_cos_test.rds")
fourier_di_sin_test = readRDS("data/Created/tiling_fourier_di_sin_test.rds")

fourier_di_cos_6 = as.data.frame(fourier_di_cos) %>% select(ends_with("_6"))
fourier_di_sin_6 = as.data.frame(fourier_di_sin) %>% select(ends_with("_6"))
fourier_di_cos_6_test = as.data.frame(fourier_di_cos_test) %>% select(ends_with("_6"))
fourier_di_sin_6_test = as.data.frame(fourier_di_sin_test) %>% select(ends_with("_6"))

fourier_6_mod = readRDS("data/Created/tiling_fourier_6_mod.rds")
fourier_6_mod_test = readRDS("data/Created/tiling_fourier_6_mod_test.rds")

dist_freq_AorTdi = readRDS("data/Created/tiling_dist_freq_AorTdi.rds")
dist_freq_AorTdi_test = readRDS("data/Created/tiling_dist_freq_AorTdi_test.rds")
```

## Squared value of Fourier features

### Simple Linear Model

```{r}
dat_fourier_6_mod14 = cbind(dat %>% select(all_of(ps2), all_of(trinucleotides),
                                           ratio_score_2nd, C0_new), 
                            (fourier_di_cos_6)^2, (fourier_di_sin_6)^2, 
                            (fourier_6_mod)^2, dist_freq_AorTdi)

fourier_6_mod14_lm = lm(C0_new~., data=dat_fourier_6_mod14)
cor(fourier_6_mod14_lm$fitted.values, y)
# 0.636164

dat_test_fourier_6_mod14 = cbind(dat_test %>% select(all_of(ps2), all_of(trinucleotides), 
                                                     ratio_score_2nd, C0_new), 
                                 (fourier_di_cos_6_test)^2, (fourier_di_sin_6_test)^2, 
                                 (fourier_6_mod_test)^2, dist_freq_AorTdi_test)

fourier_6_mod14_pred = predict(fourier_6_mod14_lm, dat_test_fourier_6_mod14)

cor(fourier_6_mod14_pred, y_test)
# 0.6803861

mean((fourier_6_mod14_pred - y_test)^2)
# 0.132313
```

We get test prediction correlation of 0.6803861 and MSE of 0.132313

### LightGBM (tree-based) Model

```{r}
library(lightgbm)
source("scripts/functions/lgbm-helper-functions.R")
set.seed(50)
dat_fourier_6_mod14.lgb_train_set = dat_fourier_6_mod14 %>%
  select(-C0_new)
dat_fourier_6_mod14.lgb_train_rules = lgb.convert_with_rules(data = dat_fourier_6_mod14.lgb_train_set)
dat_fourier_6_mod14.lgb_train_data = lgb.Dataset(data = as.matrix(dat_fourier_6_mod14.lgb_train_rules$data),
                                                 label = dat_fourier_6_mod14$C0_new,
                                                 categorical_feature = handle_categorical(colnames(dat_fourier_6_mod14.lgb_train_rules$data)))
dat_fourier_6_mod14.lgb_test_set = dat_test_fourier_6_mod14 %>%
  select(-C0_new)
dat_fourier_6_mod14.lgb_test_matrix = as.matrix(lgb.convert_with_rules(data = dat_fourier_6_mod14.lgb_test_set, rules = dat_fourier_6_mod14.lgb_train_rules$rules)$data)
dat_fourier_6_mod14.lgb_test_data = lgb.Dataset(data = dat_fourier_6_mod14.lgb_test_matrix,
                                                label = dat_test_fourier_6_mod14$C0_new,
                                                categorical_feature = handle_categorical(colnames(dat_fourier_6_mod14.lgb_test_matrix)))
dat_fourier_6_mod14.lgb_obj = lightgbm(data = dat_fourier_6_mod14.lgb_train_data,
                                       params = list(learning_rate = c(0.1),
                                                     objective = c("regression"),
                                                     min_data_in_leaf = 100,
                                                     max_depth = c(5),
                                                     num_leaves = c(1000),
                                                     lambda_l2 = c(1),
                                                     boosting = c("gbdt")),
                                       valids = list(valid = dat_fourier_6_mod14.lgb_test_data),
                                       nrounds = 8000,
                                       early_stopping_rounds = 50)

dat_fourier_6_mod14.lgb_train_pred = predict(dat_fourier_6_mod14.lgb_obj, data = as.matrix(dat_fourier_6_mod14.lgb_train_rules$data))
cor(dat_fourier_6_mod14.lgb_train_pred, y, method="pearson")
# 0.9273114 (nrounds = 1156)

dat_fourier_6_mod14.lgb_test_pred = predict(dat_fourier_6_mod14.lgb_obj, data = dat_fourier_6_mod14.lgb_test_matrix)

cor(dat_fourier_6_mod14.lgb_test_pred, y_test, method="pearson")
# 0.6969195 (nrounds = 1156)

mean((dat_fourier_6_mod14.lgb_test_pred - y_test)^2)
# 0.1260993 (nrounds = 1156)
```

We get test prediction correlation of 0.6969195 and MSE of 0.1260993

```{r}
dat_fourier_6_mod14.feature_importance = as.data.frame(lgb.importance(dat_fourier_6_mod14.lgb_obj)) %>%
  mutate(Feature = fct_rev(fct_inorder(Feature))) %>%
  dplyr::slice(1:50) %>%
  ggplot(aes(x = Feature, y = Gain)) +
  geom_col(fill = "dodgerblue") +
  coord_flip() +
  theme_bw()
dat_fourier_6_mod14.feature_importance
```


# Inputs: Counts of Di/Trinucleotides + Fourier Features Based on all Dinucleotides with h=6 (period 9.8) + Modulus of Difference of Fourier Features Based on all Dinucleotides with h=6 (period 9.8) Calculated using fft + Distance Frequency Between AA/TT/AT/TA and CC/GG/CG/GC Dinucleotides

```{r}
nucleotides <- c("A", "C", "G", "T")
dinucleotides <- gtools::permutations(n = 4, r = 2, v = nucleotides,
                                      repeats.allowed = TRUE) %>%
  apply(1, paste, collapse = "")
trinucleotides <- gtools::permutations(n = 4, r = 3, v = nucleotides,
                                       repeats.allowed = TRUE) %>%
  apply(1, paste, collapse = "")

fourier_di_cos = readRDS("data/Created/tiling_fourier_di_cos.rds")
fourier_di_sin = readRDS("data/Created/tiling_fourier_di_sin.rds")
fourier_di_cos_test = readRDS("data/Created/tiling_fourier_di_cos_test.rds")
fourier_di_sin_test = readRDS("data/Created/tiling_fourier_di_sin_test.rds")

fourier_di_cos_6 = as.data.frame(fourier_di_cos) %>% select(ends_with("_6"))
fourier_di_sin_6 = as.data.frame(fourier_di_sin) %>% select(ends_with("_6"))
fourier_di_cos_6_test = as.data.frame(fourier_di_cos_test) %>% select(ends_with("_6"))
fourier_di_sin_6_test = as.data.frame(fourier_di_sin_test) %>% select(ends_with("_6"))

fourier_6_mod = readRDS("data/Created/tiling_fourier_6_mod.rds")
fourier_6_mod_test = readRDS("data/Created/tiling_fourier_6_mod_test.rds")

dist_freq_AorTdi = readRDS("data/Created/tiling_dist_freq_AorTdi.rds")
dist_freq_AorTdi_test = readRDS("data/Created/tiling_dist_freq_AorTdi_test.rds")
```

## Squared value of Fourier features

### Simple Linear Model

```{r}
dat_fourier_6_mod9 = cbind(dat %>% select(all_of(dinucleotides), 
                                          all_of(trinucleotides), C0_new), 
                           (fourier_di_cos_6)^2, (fourier_di_sin_6)^2, 
                           (fourier_6_mod)^2, dist_freq_AorTdi)

fourier_6_mod9_lm = lm(C0_new~., data=dat_fourier_6_mod9)
cor(fourier_6_mod9_lm$fitted.values, y)
# 0.6063795

dat_test_fourier_6_mod9 = cbind(dat_test %>% select(all_of(dinucleotides), 
                                                    all_of(trinucleotides), C0_new), 
                                (fourier_di_cos_6_test)^2, (fourier_di_sin_6_test)^2, 
                                (fourier_6_mod_test)^2, dist_freq_AorTdi_test)

fourier_6_mod9_pred = predict(fourier_6_mod9_lm, dat_test_fourier_6_mod9)

cor(fourier_6_mod9_pred, y_test)
# 0.61049

mean((fourier_6_mod9_pred - y_test)^2)
# 0.1511864
```

We get test prediction correlation of 0.61049 and MSE of 0.1511864

### LightGBM (tree-based) Model

```{r}
library(lightgbm)
source("scripts/functions/lgbm-helper-functions.R")
set.seed(50)
dat_fourier_6_mod9.lgb_train_set = dat_fourier_6_mod9 %>%
  select(-C0_new)
dat_fourier_6_mod9.lgb_train_rules = lgb.convert_with_rules(data = dat_fourier_6_mod9.lgb_train_set)
dat_fourier_6_mod9.lgb_train_data = lgb.Dataset(data = as.matrix(dat_fourier_6_mod9.lgb_train_rules$data),
                                                label = dat_fourier_6_mod9$C0_new,
                                                categorical_feature = handle_categorical(colnames(dat_fourier_6_mod9.lgb_train_rules$data)))
dat_fourier_6_mod9.lgb_test_set = dat_test_fourier_6_mod9 %>%
  select(-C0_new)
dat_fourier_6_mod9.lgb_test_matrix = as.matrix(lgb.convert_with_rules(data = dat_fourier_6_mod9.lgb_test_set, rules = dat_fourier_6_mod9.lgb_train_rules$rules)$data)
dat_fourier_6_mod9.lgb_test_data = lgb.Dataset(data = dat_fourier_6_mod9.lgb_test_matrix,
                                               label = dat_test_fourier_6_mod9$C0_new,
                                               categorical_feature = handle_categorical(colnames(dat_fourier_6_mod9.lgb_test_matrix)))
dat_fourier_6_mod9.lgb_obj = lightgbm(data = dat_fourier_6_mod9.lgb_train_data,
                                      params = list(learning_rate = c(0.1),
                                                    objective = c("regression"),
                                                    min_data_in_leaf = 100,
                                                    max_depth = c(5),
                                                    num_leaves = c(1000),
                                                    lambda_l2 = c(1),
                                                    boosting = c("gbdt")),
                                      valids = list(valid = dat_fourier_6_mod9.lgb_test_data),
                                      nrounds = 8000,
                                      early_stopping_rounds = 50)

dat_fourier_6_mod9.lgb_train_pred = predict(dat_fourier_6_mod9.lgb_obj, data = as.matrix(dat_fourier_6_mod9.lgb_train_rules$data))
cor(dat_fourier_6_mod9.lgb_train_pred, y, method="pearson")
# 0.8457931 (nrounds = 997)

dat_fourier_6_mod9.lgb_test_pred = predict(dat_fourier_6_mod9.lgb_obj, data = dat_fourier_6_mod9.lgb_test_matrix)

cor(dat_fourier_6_mod9.lgb_test_pred, y_test, method="pearson")
# 0.6435706 (nrounds = 997)

mean((dat_fourier_6_mod9.lgb_test_pred - y_test)^2)
# 0.1411906 (nrounds = 997)
```

We get test prediction correlation of 0.6435706 and MSE of 0.1411906

```{r}
dat_fourier_6_mod9.feature_importance = as.data.frame(lgb.importance(dat_fourier_6_mod9.lgb_obj)) %>%
  mutate(Feature = fct_rev(fct_inorder(Feature))) %>%
  dplyr::slice(1:50) %>%
  ggplot(aes(x = Feature, y = Gain)) +
  geom_col(fill = "dodgerblue") +
  coord_flip() +
  theme_bw()
dat_fourier_6_mod9.feature_importance
```


# Inputs: All Distance Frequency Between AA/TT/AT/TA and CC/GG/CG/GC Dinucleotides Only

```{r}
dist_freq_AorTdi_AorTdi_bid2 = readRDS("data/Created/tiling_dist_freq_AorTdi_AorTdi_bid2.rds")
dist_freq_AorTdi_CorGdi_bid2 = readRDS("data/Created/tiling_dist_freq_AorTdi_CorGdi_bid2.rds")
dist_freq_CorGdi_CorGdi_bid2 = readRDS("data/Created/tiling_dist_freq_CorGdi_CorGdi_bid2.rds")
dist_freq_AorTdi_AorTdi_bid2_test = readRDS("data/Created/tiling_dist_freq_AorTdi_AorTdi_bid2_test.rds")
dist_freq_AorTdi_CorGdi_bid2_test = readRDS("data/Created/tiling_dist_freq_AorTdi_CorGdi_bid2_test.rds")
dist_freq_CorGdi_CorGdi_bid2_test = readRDS("data/Created/tiling_dist_freq_CorGdi_CorGdi_bid2_test.rds")
dist_freq_AorTdi_AorTdi_bid2_random_all = readRDS("data/Created/random_all_dist_freq_AorTdi_AorTdi_bid2.rds")
dist_freq_AorTdi_CorGdi_bid2_random_all = readRDS("data/Created/random_all_dist_freq_AorTdi_CorGdi_bid2.rds")
dist_freq_CorGdi_CorGdi_bid2_random_all = readRDS("data/Created/random_all_dist_freq_CorGdi_CorGdi_bid2.rds")
```

## Simple Linear Model

```{r}
dat_all_dist_freq_AorTdi_bid = cbind(dist_freq_AorTdi_AorTdi_bid2, 
                                     dist_freq_AorTdi_CorGdi_bid2,
                                     dist_freq_CorGdi_CorGdi_bid2,
                                     dat %>% select(C0_new))

all_dist_freq_AorTdi_bid_lm = lm(C0_new~., data=dat_all_dist_freq_AorTdi_bid)
cor(all_dist_freq_AorTdi_bid_lm$fitted.values, y)
# 0.5028064

dat_test_all_dist_freq_AorTdi_bid = cbind(dist_freq_AorTdi_AorTdi_bid2_test,
                                          dist_freq_AorTdi_CorGdi_bid2_test,
                                          dist_freq_CorGdi_CorGdi_bid2_test,
                                          dat_test %>% select(C0_new))

all_dist_freq_AorTdi_bid_pred = predict(all_dist_freq_AorTdi_bid_lm, 
                                        dat_test_all_dist_freq_AorTdi_bid)

cor(all_dist_freq_AorTdi_bid_pred, y_test)
# 0.5004576

mean((all_dist_freq_AorTdi_bid_pred - y_test)^2)
# 0.1806468

dat_random_all_all_dist_freq_AorTdi_bid = cbind(dist_freq_AorTdi_AorTdi_bid2_random_all,
                                                dist_freq_AorTdi_CorGdi_bid2_random_all,
                                                dist_freq_CorGdi_CorGdi_bid2_random_all,
                                                dat_random_all %>% select(C0_new))

all_dist_freq_AorTdi_bid_pred_random_all = predict(all_dist_freq_AorTdi_bid_lm, 
                                                   dat_random_all_all_dist_freq_AorTdi_bid)

cor(all_dist_freq_AorTdi_bid_pred_random_all, y_random_all)
# 0.4066192

mean((all_dist_freq_AorTdi_bid_pred_random_all - y_random_all)^2)
# 0.1263974
```

We get test prediction correlation of 0.5004576 and MSE of 0.1806468

## Lasso Model

```{r}
X_all_dist_freq_AorTdi_bid = dat_all_dist_freq_AorTdi_bid %>%
  select(-C0_new)

x_all_dist_freq_AorTdi_bid = sparse.model.matrix(~., data=X_all_dist_freq_AorTdi_bid)

set.seed(50)
la.model_all_dist_freq_AorTdi_bid = cv.glmnet(x_all_dist_freq_AorTdi_bid, y, alpha=1, family="gaussian")

la.all_dist_freq_AorTdi_bid_best_lambda = la.model_all_dist_freq_AorTdi_bid$lambda.min

sum(coef(la.model_all_dist_freq_AorTdi_bid, s=la.all_dist_freq_AorTdi_bid_best_lambda) != 0)
# 139

la.all_dist_freq_AorTdi_bid_lambda_1se = la.model_all_dist_freq_AorTdi_bid$lambda.1se

sum(coef(la.model_all_dist_freq_AorTdi_bid, s=la.all_dist_freq_AorTdi_bid_lambda_1se) != 0)
# 76

saveRDS(la.model_all_dist_freq_AorTdi_bid, "model/lasso-all_dist_freq_AorTdi_bid.rds")

la.model_all_dist_freq_AorTdi_bid.train_pred = predict(la.model_all_dist_freq_AorTdi_bid, newx = x_all_dist_freq_AorTdi_bid, s=la.all_dist_freq_AorTdi_bid_best_lambda)

cor(la.model_all_dist_freq_AorTdi_bid.train_pred, y, method="pearson")
# 0.5026003
mean((la.model_all_dist_freq_AorTdi_bid.train_pred - y)^2)
# 0.1811283

la.model_all_dist_freq_AorTdi_bid.train_pred2 = predict(la.model_all_dist_freq_AorTdi_bid, newx = x_all_dist_freq_AorTdi_bid, s=la.all_dist_freq_AorTdi_bid_lambda_1se)

cor(la.model_all_dist_freq_AorTdi_bid.train_pred2, y, method="pearson")
# 0.4979091
mean((la.model_all_dist_freq_AorTdi_bid.train_pred2 - y)^2)
# 0.182759

X_all_dist_freq_AorTdi_bid_test = dat_test_all_dist_freq_AorTdi_bid %>%
  select(-C0_new)
x_all_dist_freq_AorTdi_bid_test = sparse.model.matrix(~., data=X_all_dist_freq_AorTdi_bid_test)

# Predict values for test dataset:
la.model_all_dist_freq_AorTdi_bid.pred = predict(la.model_all_dist_freq_AorTdi_bid, newx = x_all_dist_freq_AorTdi_bid_test, s=la.all_dist_freq_AorTdi_bid_best_lambda)
# Prediction accuracy with test data:
cor(la.model_all_dist_freq_AorTdi_bid.pred, y_test, method="pearson")
# 0.5002599
mean((la.model_all_dist_freq_AorTdi_bid.pred - y_test)^2)
# 0.1806955

la.model_all_dist_freq_AorTdi_bid.pred2 = predict(la.model_all_dist_freq_AorTdi_bid, newx = x_all_dist_freq_AorTdi_bid_test, s=la.all_dist_freq_AorTdi_bid_lambda_1se)
# Prediction accuracy with test data:
cor(la.model_all_dist_freq_AorTdi_bid.pred2, y_test, method="pearson")
# 0.4992164
mean((la.model_all_dist_freq_AorTdi_bid.pred2 - y_test)^2)
# 0.1815632


# X_all_dist_freq_AorTdi_bid_random_all = dat_random_all_dist_freq_AorTdi_bid %>%
#   select(-C0_new)
# x_all_dist_freq_AorTdi_bid_random_all = sparse.model.matrix(~., data=X_all_dist_freq_AorTdi_bid_random_all)
# 
# # Predict values for random dataset:
# la.model_all_dist_freq_AorTdi_bid.pred_random_all = predict(la.model_all_dist_freq_AorTdi_bid, newx = x_all_dist_freq_AorTdi_bid_random_all, s=la.all_dist_freq_AorTdi_bid_best_lambda)
# # Prediction accuracy with random data:
# cor(la.model_all_dist_freq_AorTdi_bid.pred_random_all, y_random_all, method="pearson")
# # 
# mean((la.model_all_dist_freq_AorTdi_bid.pred_random_all - y_random_all)^2)
# # 
# 
# la.model_all_dist_freq_AorTdi_bid.pred2_random_all = predict(la.model_all_dist_freq_AorTdi_bid, newx = x_all_dist_freq_AorTdi_bid_random_all, s=la.all_dist_freq_AorTdi_bid_lambda_1se)
# # Prediction accuracy with random data:
# cor(la.model_all_dist_freq_AorTdi_bid.pred2_random_all, y_random_all, method="pearson")
# # 
# mean((la.model_all_dist_freq_AorTdi_bid.pred2_random_all - y_random_all)^2)
# #
```

We get test prediction correlation of 0.5002599 and MSE of 0.1806955 with min lasso (139 nonzero)
We get test prediction correlation of 0.4992164 and MSE of 0.1815632 with lasso 1se (76 nonzero)
We get prediction correlation of  on the random library with min lasso
We get prediction correlation of  on the random library with lasso 1se

## Group Lasso Model

### Groupings based on pairs of Dinucleotide Groups (3 groups)

```{r}
X_all_dist_freq_AorTdi_bid = dat_all_dist_freq_AorTdi_bid %>%
  select(-C0_new)

x_all_dist_freq_AorTdi_bid = sparse.model.matrix(~., data=X_all_dist_freq_AorTdi_bid)

gla.di_groups_all_dist_freq_AorTdi_bid = c(1, rep(2:4, each=47))

set.seed(50)
gla.model_all_dist_freq_AorTdi_bid = cv.sparsegl(x_all_dist_freq_AorTdi_bid, y, group=gla.di_groups_all_dist_freq_AorTdi_bid, family="gaussian")

gla.all_dist_freq_AorTdi_bid_best_lambda = gla.model_all_dist_freq_AorTdi_bid$lambda.min

sum(coef(gla.model_all_dist_freq_AorTdi_bid, s=gla.all_dist_freq_AorTdi_bid_best_lambda) != 0)
# 142

gla.all_dist_freq_AorTdi_bid_lambda_1se = gla.model_all_dist_freq_AorTdi_bid$lambda.1se

sum(coef(gla.model_all_dist_freq_AorTdi_bid, s=gla.all_dist_freq_AorTdi_bid_lambda_1se) != 0)
# 142

saveRDS(gla.model_all_dist_freq_AorTdi_bid, "model/group-lasso-all_dist_freq_AorTdi_bid.rds")

gla.model_all_dist_freq_AorTdi_bid.train_pred = predict(gla.model_all_dist_freq_AorTdi_bid, newx = x_all_dist_freq_AorTdi_bid, s=gla.all_dist_freq_AorTdi_bid_best_lambda)

cor(gla.model_all_dist_freq_AorTdi_bid.train_pred, y, method="pearson")
# 0.4773989
mean((gla.model_all_dist_freq_AorTdi_bid.train_pred - y)^2)
# 0.1878011

gla.model_all_dist_freq_AorTdi_bid.train_pred2 = predict(gla.model_all_dist_freq_AorTdi_bid, newx = x_all_dist_freq_AorTdi_bid, s=gla.all_dist_freq_AorTdi_bid_lambda_1se)

cor(gla.model_all_dist_freq_AorTdi_bid.train_pred2, y, method="pearson")
# 0.4731716
mean((gla.model_all_dist_freq_AorTdi_bid.train_pred2 - y)^2)
# 0.1892179

X_all_dist_freq_AorTdi_bid_test = dat_test_all_dist_freq_AorTdi_bid %>%
  select(-C0_new)
x_all_dist_freq_AorTdi_bid_test = sparse.model.matrix(~., data=X_all_dist_freq_AorTdi_bid_test)

# Predict values for test dataset:
gla.model_all_dist_freq_AorTdi_bid.pred = predict(gla.model_all_dist_freq_AorTdi_bid, newx = x_all_dist_freq_AorTdi_bid_test, s=gla.all_dist_freq_AorTdi_bid_best_lambda)
# Prediction accuracy with test data:
cor(gla.model_all_dist_freq_AorTdi_bid.pred, y_test, method="pearson")
# 0.4710044
mean((gla.model_all_dist_freq_AorTdi_bid.pred - y_test)^2)
# 0.188095

gla.model_all_dist_freq_AorTdi_bid.pred2 = predict(gla.model_all_dist_freq_AorTdi_bid, newx = x_all_dist_freq_AorTdi_bid_test, s=gla.all_dist_freq_AorTdi_bid_lambda_1se)
# Prediction accuracy with test data:
cor(gla.model_all_dist_freq_AorTdi_bid.pred2, y_test, method="pearson")
# 0.4663613
mean((gla.model_all_dist_freq_AorTdi_bid.pred2 - y_test)^2)
# 0.1895186

# # Predict values for random dataset:
# gla.model_all_dist_freq_AorTdi_bid.pred_random_all = predict(gla.model_all_dist_freq_AorTdi_bid, newx = x_all_dist_freq_AorTdi_bid_random_all, s=gla.all_dist_freq_AorTdi_bid_best_lambda)
# # Prediction accuracy with random data:
# cor(gla.model_all_dist_freq_AorTdi_bid.pred_random_all, y_random_all, method="pearson")
# # 
# mean((gla.model_all_dist_freq_AorTdi_bid.pred_random_all - y_random_all)^2)
# # 
# 
# gla.model_all_dist_freq_AorTdi_bid.pred2_random_all = predict(gla.model_all_dist_freq_AorTdi_bid, newx = x_all_dist_freq_AorTdi_bid_random_all, s=gla.all_dist_freq_AorTdi_bid_lambda_1se)
# # Prediction accuracy with random data:
# cor(gla.model_all_dist_freq_AorTdi_bid.pred2_random_all, y_random_all, method="pearson")
# # 
# mean((gla.model_all_dist_freq_AorTdi_bid.pred2_random_all - y_random_all)^2)
# # 
```

We get test prediction correlation of 0.4710044 and MSE of 0.188095 with min lasso (142 nonzero)
We get test prediction correlation of 0.4663613 and MSE of 0.1895186 with lasso 1se (142 nonzero)
We get prediction correlation of  on the random library with min lasso
We get prediction correlation of  on the random library with lasso 1se


### Groupings based on distances (47 groups)

```{r}
# X_all_dist_freq_AorTdi_bid = dat_all_dist_freq_AorTdi_bid %>%
#   select(-C0_new)
# 
# x_all_dist_freq_AorTdi_bid = sparse.model.matrix(~., data=X_all_dist_freq_AorTdi_bid)

gla2.di_groups_all_dist_freq_AorTdi_bid = c(1, rep(2:48, times=3))

set.seed(50)
gla2.model_all_dist_freq_AorTdi_bid = cv.sparsegl(x_all_dist_freq_AorTdi_bid, y, group=gla2.di_groups_all_dist_freq_AorTdi_bid, family="gaussian")

gla2.all_dist_freq_AorTdi_bid_best_lambda = gla2.model_all_dist_freq_AorTdi_bid$lambda.min

sum(coef(gla2.model_all_dist_freq_AorTdi_bid, s=gla2.all_dist_freq_AorTdi_bid_best_lambda) != 0)
# 142

gla2.all_dist_freq_AorTdi_bid_lambda_1se = gla2.model_all_dist_freq_AorTdi_bid$lambda.1se

sum(coef(gla2.model_all_dist_freq_AorTdi_bid, s=gla2.all_dist_freq_AorTdi_bid_lambda_1se) != 0)
# 136

saveRDS(gla2.model_all_dist_freq_AorTdi_bid, "model/group-lasso-2-all_dist_freq_AorTdi_bid.rds")

gla2.model_all_dist_freq_AorTdi_bid.train_pred = predict(gla2.model_all_dist_freq_AorTdi_bid, newx = x_all_dist_freq_AorTdi_bid, s=gla2.all_dist_freq_AorTdi_bid_best_lambda)

cor(gla2.model_all_dist_freq_AorTdi_bid.train_pred, y, method="pearson")
# 0.501784
mean((gla2.model_all_dist_freq_AorTdi_bid.train_pred - y)^2)
# 0.1813271

gla2.model_all_dist_freq_AorTdi_bid.train_pred2 = predict(gla2.model_all_dist_freq_AorTdi_bid, newx = x_all_dist_freq_AorTdi_bid, s=gla2.all_dist_freq_AorTdi_bid_lambda_1se)

cor(gla2.model_all_dist_freq_AorTdi_bid.train_pred2, y, method="pearson")
# 0.4965323
mean((gla2.model_all_dist_freq_AorTdi_bid.train_pred2 - y)^2)
# 0.1827988

# X_all_dist_freq_AorTdi_bid_test = dat_test_all_dist_freq_AorTdi_bid %>%
#   select(-C0_new)
# x_all_dist_freq_AorTdi_bid_test = sparse.model.matrix(~., data=X_all_dist_freq_AorTdi_bid_test)

# Predict values for test dataset:
gla2.model_all_dist_freq_AorTdi_bid.pred = predict(gla2.model_all_dist_freq_AorTdi_bid, newx = x_all_dist_freq_AorTdi_bid_test, s=gla2.all_dist_freq_AorTdi_bid_best_lambda)
# Prediction accuracy with test data:
cor(gla2.model_all_dist_freq_AorTdi_bid.pred, y_test, method="pearson")
# 0.4997703
mean((gla2.model_all_dist_freq_AorTdi_bid.pred - y_test)^2)
# 0.1808146

gla2.model_all_dist_freq_AorTdi_bid.pred2 = predict(gla2.model_all_dist_freq_AorTdi_bid, newx = x_all_dist_freq_AorTdi_bid_test, s=gla2.all_dist_freq_AorTdi_bid_lambda_1se)
# Prediction accuracy with test data:
cor(gla2.model_all_dist_freq_AorTdi_bid.pred2, y_test, method="pearson")
# 0.4931734
mean((gla2.model_all_dist_freq_AorTdi_bid.pred2 - y_test)^2)
# 0.1826092

# # Predict values for random dataset:
# gla2.model_all_dist_freq_AorTdi_bid.pred_random_all = predict(gla2.model_all_dist_freq_AorTdi_bid, newx = x_all_dist_freq_AorTdi_bid_random_all, s=gla2.all_dist_freq_AorTdi_bid_best_lambda)
# # Prediction accuracy with random data:
# cor(gla2.model_all_dist_freq_AorTdi_bid.pred_random_all, y_random_all, method="pearson")
# # 
# mean((gla2.model_all_dist_freq_AorTdi_bid.pred_random_all - y_random_all)^2)
# # 
# 
# gla2.model_all_dist_freq_AorTdi_bid.pred2_random_all = predict(gla2.model_all_dist_freq_AorTdi_bid, newx = x_all_dist_freq_AorTdi_bid_random_all, s=gla2.all_dist_freq_AorTdi_bid_lambda_1se)
# # Prediction accuracy with random data:
# cor(gla2.model_all_dist_freq_AorTdi_bid.pred2_random_all, y_random_all, method="pearson")
# # 
# mean((gla2.model_all_dist_freq_AorTdi_bid.pred2_random_all - y_random_all)^2)
# # 
```

We get test prediction correlation of 0.4997703 and MSE of 0.1808146 with min lasso (142 nonzero)
We get test prediction correlation of 0.4931734 and MSE of 0.1826092 with lasso 1se (136 nonzero)
We get prediction correlation of  on the random library with min lasso
We get prediction correlation of  on the random library with lasso 1se

## LightGBM (tree-based) Model

```{r}
library(lightgbm)
source("scripts/functions/lgbm-helper-functions.R")
set.seed(50)
dat_all_dist_freq_AorTdi_bid.lgb_train_set = dat_all_dist_freq_AorTdi_bid %>%
  select(-C0_new)
dat_all_dist_freq_AorTdi_bid.lgb_train_rules = lgb.convert_with_rules(data = dat_all_dist_freq_AorTdi_bid.lgb_train_set)
dat_all_dist_freq_AorTdi_bid.lgb_train_data = lgb.Dataset(data = as.matrix(dat_all_dist_freq_AorTdi_bid.lgb_train_rules$data),
                                                          label = dat_all_dist_freq_AorTdi_bid$C0_new,
                                                          categorical_feature = handle_categorical(colnames(dat_all_dist_freq_AorTdi_bid.lgb_train_rules$data)))
dat_all_dist_freq_AorTdi_bid.lgb_test_set = dat_test_all_dist_freq_AorTdi_bid %>%
  select(-C0_new)
dat_all_dist_freq_AorTdi_bid.lgb_test_matrix = as.matrix(lgb.convert_with_rules(data = dat_all_dist_freq_AorTdi_bid.lgb_test_set, rules = dat_all_dist_freq_AorTdi_bid.lgb_train_rules$rules)$data)
dat_all_dist_freq_AorTdi_bid.lgb_test_data = lgb.Dataset(data = dat_all_dist_freq_AorTdi_bid.lgb_test_matrix,
                                                         label = dat_test_all_dist_freq_AorTdi_bid$C0_new,
                                                         categorical_feature = handle_categorical(colnames(dat_all_dist_freq_AorTdi_bid.lgb_test_matrix)))
dat_all_dist_freq_AorTdi_bid.lgb_obj = lightgbm(data = dat_all_dist_freq_AorTdi_bid.lgb_train_data,
                                                params = list(learning_rate = c(0.1),
                                                              objective = c("regression"),
                                                              min_data_in_leaf = 100,
                                                              max_depth = c(5),
                                                              num_leaves = c(1000),
                                                              lambda_l2 = c(1),
                                                              boosting = c("gbdt")),
                                                valids = list(valid = dat_all_dist_freq_AorTdi_bid.lgb_test_data),
                                                nrounds = 8000,
                                                early_stopping_rounds = 50)

dat_all_dist_freq_AorTdi_bid.lgb_train_pred = predict(dat_all_dist_freq_AorTdi_bid.lgb_obj, data = as.matrix(dat_all_dist_freq_AorTdi_bid.lgb_train_rules$data))
cor(dat_all_dist_freq_AorTdi_bid.lgb_train_pred, y, method="pearson")
# 0.6608807 (nrounds = 609)

dat_all_dist_freq_AorTdi_bid.lgb_test_pred = predict(dat_all_dist_freq_AorTdi_bid.lgb_obj, data = dat_all_dist_freq_AorTdi_bid.lgb_test_matrix)

cor(dat_all_dist_freq_AorTdi_bid.lgb_test_pred, y_test, method="pearson")
# 0.5121309 (nrounds = 609)

mean((dat_all_dist_freq_AorTdi_bid.lgb_test_pred - y_test)^2)
# 0.1778076 (nrounds = 609)
```

We get test prediction correlation of 0.5121309 and MSE of 0.1778076

```{r}
dat_all_dist_freq_AorTdi_bid.feature_importance = as.data.frame(lgb.importance(dat_all_dist_freq_AorTdi_bid.lgb_obj)) %>%
  mutate(Feature = fct_rev(fct_inorder(Feature))) %>%
  dplyr::slice(1:50) %>%
  ggplot(aes(x = Feature, y = Gain)) +
  geom_col(fill = "dodgerblue") +
  coord_flip() +
  theme_bw()
dat_all_dist_freq_AorTdi_bid.feature_importance
```


# Inputs: Distance Frequency Between Dinucleotides and AA/TT/AT/TA or CC/GG/CG/GC Dinucleotides Only

```{r}
dist_freq_di_AorTdi_bid = readRDS("data/Created/tiling_dist_freq_di_AorTdi_bid.rds")
dist_freq_di_AorTdi_bid_test = readRDS("data/Created/tiling_dist_freq_di_AorTdi_bid_test.rds")
```

## Simple Linear Model

```{r}
dat_dist_freq_di_AorTdi_bid = cbind(dist_freq_di_AorTdi_bid, dat %>% select(C0_new))

dist_freq_di_AorTdi_bid_lm = lm(C0_new~., data=dat_dist_freq_di_AorTdi_bid)
cor(dist_freq_di_AorTdi_bid_lm$fitted.values, y)
# 0.5728371

dat_test_dist_freq_di_AorTdi_bid = cbind(dist_freq_di_AorTdi_bid_test, dat_test %>% select(C0_new))

dist_freq_di_AorTdi_bid_pred = predict(dist_freq_di_AorTdi_bid_lm, dat_test_dist_freq_di_AorTdi_bid)

cor(dist_freq_di_AorTdi_bid_pred, y_test)
# 0.5748267

mean((dist_freq_di_AorTdi_bid_pred - y_test)^2)
# 0.1613857
```

We get test prediction correlation of 0.5748267 and MSE of 0.1613857

## LightGBM (tree-based) Model

```{r}
library(lightgbm)
source("scripts/functions/lgbm-helper-functions.R")
set.seed(50)
dat_dist_freq_di_AorTdi_bid.lgb_train_set = dat_dist_freq_di_AorTdi_bid %>%
  select(-C0_new)
dat_dist_freq_di_AorTdi_bid.lgb_train_rules = lgb.convert_with_rules(data = dat_dist_freq_di_AorTdi_bid.lgb_train_set)
dat_dist_freq_di_AorTdi_bid.lgb_train_data = lgb.Dataset(data = as.matrix(dat_dist_freq_di_AorTdi_bid.lgb_train_rules$data),
                                                         label = dat_dist_freq_di_AorTdi_bid$C0_new,
                                                         categorical_feature = handle_categorical(colnames(dat_dist_freq_di_AorTdi_bid.lgb_train_rules$data)))
dat_dist_freq_di_AorTdi_bid.lgb_test_set = dat_test_dist_freq_di_AorTdi_bid %>%
  select(-C0_new)
dat_dist_freq_di_AorTdi_bid.lgb_test_matrix = as.matrix(lgb.convert_with_rules(data = dat_dist_freq_di_AorTdi_bid.lgb_test_set, rules = dat_dist_freq_di_AorTdi_bid.lgb_train_rules$rules)$data)
dat_dist_freq_di_AorTdi_bid.lgb_test_data = lgb.Dataset(data = dat_dist_freq_di_AorTdi_bid.lgb_test_matrix,
                                                        label = dat_test_dist_freq_di_AorTdi_bid$C0_new,
                                                        categorical_feature = handle_categorical(colnames(dat_dist_freq_di_AorTdi_bid.lgb_test_matrix)))
dat_dist_freq_di_AorTdi_bid.lgb_obj = lightgbm(data = dat_dist_freq_di_AorTdi_bid.lgb_train_data,
                                               params = list(learning_rate = c(0.1),
                                                             objective = c("regression"),
                                                             min_data_in_leaf = 100,
                                                             max_depth = c(5),
                                                             num_leaves = c(1000),
                                                             lambda_l2 = c(1),
                                                             boosting = c("gbdt")),
                                               valids = list(valid = dat_dist_freq_di_AorTdi_bid.lgb_test_data),
                                               nrounds = 8000,
                                               early_stopping_rounds = 50)

dat_dist_freq_di_AorTdi_bid.lgb_train_pred = predict(dat_dist_freq_di_AorTdi_bid.lgb_obj, data = as.matrix(dat_dist_freq_di_AorTdi_bid.lgb_train_rules$data))
cor(dat_dist_freq_di_AorTdi_bid.lgb_train_pred, y, method="pearson")
# 0.9140655 (nrounds = 3960)

dat_dist_freq_di_AorTdi_bid.lgb_test_pred = predict(dat_dist_freq_di_AorTdi_bid.lgb_obj, data = dat_dist_freq_di_AorTdi_bid.lgb_test_matrix)

cor(dat_dist_freq_di_AorTdi_bid.lgb_test_pred, y_test, method="pearson")
# 0.6751802 (nrounds = 3960)

mean((dat_dist_freq_di_AorTdi_bid.lgb_test_pred - y_test)^2)
# 0.1311579 (nrounds = 3960)
```

We get test prediction correlation of 0.6751802 and MSE of 0.1311579

```{r}
dat_dist_freq_di_AorTdi_bid.feature_importance = as.data.frame(lgb.importance(dat_dist_freq_di_AorTdi_bid.lgb_obj)) %>%
  mutate(Feature = fct_rev(fct_inorder(Feature))) %>%
  dplyr::slice(1:50) %>%
  ggplot(aes(x = Feature, y = Gain)) +
  geom_col(fill = "dodgerblue") +
  coord_flip() +
  theme_bw()
dat_dist_freq_di_AorTdi_bid.feature_importance
```



# Inputs: Position Specific Dinucleotides + Distance Frequency Between Dinucleotides and AA/TT/AT/TA or CC/GG/CG/GC Dinucleotides

```{r}
ps2 <- paste0("X", 1:49, "di")

dist_freq_di_AorTdi_bid = readRDS("data/Created/tiling_dist_freq_di_AorTdi_bid.rds")
dist_freq_di_AorTdi_bid_test = readRDS("data/Created/tiling_dist_freq_di_AorTdi_bid_test.rds")
```

## Simple Linear Model

```{r}
dat_dist_freq_di_AorTdi_bid2 = cbind(dat %>% select(all_of(ps2), C0_new), 
                                     dist_freq_di_AorTdi_bid)

dist_freq_di_AorTdi_bid2_lm = lm(C0_new~., data=dat_dist_freq_di_AorTdi_bid2)
cor(dist_freq_di_AorTdi_bid2_lm$fitted.values, y)
# 0.5986142

dat_test_dist_freq_di_AorTdi_bid2 = cbind(dat_test %>% select(all_of(ps2), C0_new), 
                                          dist_freq_di_AorTdi_bid_test)

dist_freq_di_AorTdi_bid2_pred = predict(dist_freq_di_AorTdi_bid2_lm, dat_test_dist_freq_di_AorTdi_bid2)

cor(dist_freq_di_AorTdi_bid2_pred, y_test)
# 0.5954743

mean((dist_freq_di_AorTdi_bid2_pred - y_test)^2)
# 0.1555617
```

We get test prediction correlation of 0.5954743 and MSE of 0.1555617

## LightGBM (tree-based) Model

```{r}
library(lightgbm)
source("scripts/functions/lgbm-helper-functions.R")
set.seed(50)
dat_dist_freq_di_AorTdi_bid2.lgb_train_set = dat_dist_freq_di_AorTdi_bid2 %>%
  select(-C0_new)
dat_dist_freq_di_AorTdi_bid2.lgb_train_rules = lgb.convert_with_rules(data = dat_dist_freq_di_AorTdi_bid2.lgb_train_set)
dat_dist_freq_di_AorTdi_bid2.lgb_train_data = lgb.Dataset(data = as.matrix(dat_dist_freq_di_AorTdi_bid2.lgb_train_rules$data),
                                                          label = dat_dist_freq_di_AorTdi_bid2$C0_new,
                                                          categorical_feature = handle_categorical(colnames(dat_dist_freq_di_AorTdi_bid2.lgb_train_rules$data)))
dat_dist_freq_di_AorTdi_bid2.lgb_test_set = dat_test_dist_freq_di_AorTdi_bid2 %>%
  select(-C0_new)
dat_dist_freq_di_AorTdi_bid2.lgb_test_matrix = as.matrix(lgb.convert_with_rules(data = dat_dist_freq_di_AorTdi_bid2.lgb_test_set, rules = dat_dist_freq_di_AorTdi_bid2.lgb_train_rules$rules)$data)
dat_dist_freq_di_AorTdi_bid2.lgb_test_data = lgb.Dataset(data = dat_dist_freq_di_AorTdi_bid2.lgb_test_matrix,
                                                         label = dat_test_dist_freq_di_AorTdi_bid2$C0_new,
                                                         categorical_feature = handle_categorical(colnames(dat_dist_freq_di_AorTdi_bid2.lgb_test_matrix)))
dat_dist_freq_di_AorTdi_bid2.lgb_obj = lightgbm(data = dat_dist_freq_di_AorTdi_bid2.lgb_train_data,
                                                params = list(learning_rate = c(0.1),
                                                              objective = c("regression"),
                                                              min_data_in_leaf = 100,
                                                              max_depth = c(5),
                                                              num_leaves = c(1000),
                                                              lambda_l2 = c(1),
                                                              boosting = c("gbdt")),
                                                valids = list(valid = dat_dist_freq_di_AorTdi_bid2.lgb_test_data),
                                                nrounds = 8000,
                                                early_stopping_rounds = 50)

dat_dist_freq_di_AorTdi_bid2.lgb_train_pred = predict(dat_dist_freq_di_AorTdi_bid2.lgb_obj, data = as.matrix(dat_dist_freq_di_AorTdi_bid2.lgb_train_rules$data))
cor(dat_dist_freq_di_AorTdi_bid2.lgb_train_pred, y, method="pearson")
# 0.9955052 (nrounds = 4127)

dat_dist_freq_di_AorTdi_bid2.lgb_test_pred = predict(dat_dist_freq_di_AorTdi_bid2.lgb_obj, data = dat_dist_freq_di_AorTdi_bid2.lgb_test_matrix)

cor(dat_dist_freq_di_AorTdi_bid2.lgb_test_pred, y_test, method="pearson")
# 0.6761633 (nrounds = 4127)

mean((dat_dist_freq_di_AorTdi_bid2.lgb_test_pred - y_test)^2)
# 0.1308615 (nrounds = 4127)
```

We get test prediction correlation of 0.6761633 and MSE of 0.1308615

```{r}
dat_dist_freq_di_AorTdi_bid2.feature_importance = as.data.frame(lgb.importance(dat_dist_freq_di_AorTdi_bid2.lgb_obj)) %>%
  mutate(Feature = fct_rev(fct_inorder(Feature))) %>%
  dplyr::slice(1:50) %>%
  ggplot(aes(x = Feature, y = Gain)) +
  geom_col(fill = "dodgerblue") +
  coord_flip() +
  theme_bw()
dat_dist_freq_di_AorTdi_bid2.feature_importance
```

# Inputs: Counts of Dinucleotides + Distance Frequency Between Dinucleotides and AA/TT/AT/TA or CC/GG/CG/GC Dinucleotides

```{r}
nucleotides <- c("A", "C", "G", "T")
dinucleotides <- gtools::permutations(n = 4, r = 2, v = nucleotides,
                                      repeats.allowed = TRUE) %>%
  apply(1, paste, collapse = "")

dist_freq_di_AorTdi_bid = readRDS("data/Created/tiling_dist_freq_di_AorTdi_bid.rds")
dist_freq_di_AorTdi_bid_test = readRDS("data/Created/tiling_dist_freq_di_AorTdi_bid_test.rds")
```

## Simple Linear Model

```{r}
dat_dist_freq_di_AorTdi_bid3 = cbind(dat %>% select(all_of(dinucleotides), C0_new), 
                                     dist_freq_di_AorTdi_bid)

dist_freq_di_AorTdi_bid3_lm = lm(C0_new~., data=dat_dist_freq_di_AorTdi_bid3)
cor(dist_freq_di_AorTdi_bid3_lm$fitted.values, y)
# 0.5769954

dat_test_dist_freq_di_AorTdi_bid3 = cbind(dat_test %>% select(all_of(dinucleotides), C0_new), 
                                          dist_freq_di_AorTdi_bid_test)

dist_freq_di_AorTdi_bid3_pred = predict(dist_freq_di_AorTdi_bid3_lm, dat_test_dist_freq_di_AorTdi_bid3)

cor(dist_freq_di_AorTdi_bid3_pred, y_test)
# 0.5797033

mean((dist_freq_di_AorTdi_bid3_pred - y_test)^2)
# 0.160031
```

We get test prediction correlation of 0.5797033 and MSE of 0.160031

## LightGBM (tree-based) Model

```{r}
library(lightgbm)
source("scripts/functions/lgbm-helper-functions.R")
set.seed(50)
dat_dist_freq_di_AorTdi_bid3.lgb_train_set = dat_dist_freq_di_AorTdi_bid3 %>%
  select(-C0_new)
dat_dist_freq_di_AorTdi_bid3.lgb_train_rules = lgb.convert_with_rules(data = dat_dist_freq_di_AorTdi_bid3.lgb_train_set)
dat_dist_freq_di_AorTdi_bid3.lgb_train_data = lgb.Dataset(data = as.matrix(dat_dist_freq_di_AorTdi_bid3.lgb_train_rules$data),
                                                          label = dat_dist_freq_di_AorTdi_bid3$C0_new,
                                                          categorical_feature = handle_categorical(colnames(dat_dist_freq_di_AorTdi_bid3.lgb_train_rules$data)))
dat_dist_freq_di_AorTdi_bid3.lgb_test_set = dat_test_dist_freq_di_AorTdi_bid3 %>%
  select(-C0_new)
dat_dist_freq_di_AorTdi_bid3.lgb_test_matrix = as.matrix(lgb.convert_with_rules(data = dat_dist_freq_di_AorTdi_bid3.lgb_test_set, rules = dat_dist_freq_di_AorTdi_bid3.lgb_train_rules$rules)$data)
dat_dist_freq_di_AorTdi_bid3.lgb_test_data = lgb.Dataset(data = dat_dist_freq_di_AorTdi_bid3.lgb_test_matrix,
                                                         label = dat_test_dist_freq_di_AorTdi_bid3$C0_new,
                                                         categorical_feature = handle_categorical(colnames(dat_dist_freq_di_AorTdi_bid3.lgb_test_matrix)))
dat_dist_freq_di_AorTdi_bid3.lgb_obj = lightgbm(data = dat_dist_freq_di_AorTdi_bid3.lgb_train_data,
                                                params = list(learning_rate = c(0.1),
                                                              objective = c("regression"),
                                                              min_data_in_leaf = 100,
                                                              max_depth = c(5),
                                                              num_leaves = c(1000),
                                                              lambda_l2 = c(1),
                                                              boosting = c("gbdt")),
                                                valids = list(valid = dat_dist_freq_di_AorTdi_bid3.lgb_test_data),
                                                nrounds = 8000,
                                                early_stopping_rounds = 50)

dat_dist_freq_di_AorTdi_bid3.lgb_train_pred = predict(dat_dist_freq_di_AorTdi_bid3.lgb_obj, data = as.matrix(dat_dist_freq_di_AorTdi_bid3.lgb_train_rules$data))
cor(dat_dist_freq_di_AorTdi_bid3.lgb_train_pred, y, method="pearson")
# 0.9249318 (nrounds = 4275)

dat_dist_freq_di_AorTdi_bid3.lgb_test_pred = predict(dat_dist_freq_di_AorTdi_bid3.lgb_obj, data = dat_dist_freq_di_AorTdi_bid3.lgb_test_matrix)

cor(dat_dist_freq_di_AorTdi_bid3.lgb_test_pred, y_test, method="pearson")
# 0.6769969 (nrounds = 4275)

mean((dat_dist_freq_di_AorTdi_bid3.lgb_test_pred - y_test)^2)
# 0.1305565 (nrounds = 4275)
```

We get test prediction correlation of 0.6769969 and MSE of 0.1305565

```{r}
dat_dist_freq_di_AorTdi_bid3.feature_importance = as.data.frame(lgb.importance(dat_dist_freq_di_AorTdi_bid3.lgb_obj)) %>%
  mutate(Feature = fct_rev(fct_inorder(Feature))) %>%
  dplyr::slice(1:50) %>%
  ggplot(aes(x = Feature, y = Gain)) +
  geom_col(fill = "dodgerblue") +
  coord_flip() +
  theme_bw()
dat_dist_freq_di_AorTdi_bid3.feature_importance
```

# Inputs: Counts of Trinucleotides + Distance Frequency Between Dinucleotides and AA/TT/AT/TA or CC/GG/CG/GC Dinucleotides

```{r}
nucleotides <- c("A", "C", "G", "T")
dinucleotides <- gtools::permutations(n = 4, r = 2, v = nucleotides,
                                      repeats.allowed = TRUE) %>%
  apply(1, paste, collapse = "")
trinucleotides <- gtools::permutations(n = 4, r = 3, v = nucleotides,
                                       repeats.allowed = TRUE) %>%
  apply(1, paste, collapse = "")

dist_freq_di_AorTdi_bid = readRDS("data/Created/tiling_dist_freq_di_AorTdi_bid.rds")
dist_freq_di_AorTdi_bid_test = readRDS("data/Created/tiling_dist_freq_di_AorTdi_bid_test.rds")
```

## Simple Linear Model

```{r}
dat_dist_freq_di_AorTdi_bid4 = cbind(dat %>% select(all_of(trinucleotides), C0_new), 
                                     dist_freq_di_AorTdi_bid)

dist_freq_di_AorTdi_bid4_lm = lm(C0_new~., data=dat_dist_freq_di_AorTdi_bid4)
cor(dist_freq_di_AorTdi_bid4_lm$fitted.values, y)
# 0.5927612

dat_test_dist_freq_di_AorTdi_bid4 = cbind(dat_test %>% select(all_of(trinucleotides), C0_new), 
                                          dist_freq_di_AorTdi_bid_test)

dist_freq_di_AorTdi_bid4_pred = predict(dist_freq_di_AorTdi_bid4_lm, dat_test_dist_freq_di_AorTdi_bid4)

cor(dist_freq_di_AorTdi_bid4_pred, y_test)
# 0.5938126

mean((dist_freq_di_AorTdi_bid4_pred - y_test)^2)
# 0.1560412
```

We get test prediction correlation of 0.5938126 and MSE of 0.1560412

## LightGBM (tree-based) Model

```{r}
library(lightgbm)
source("scripts/functions/lgbm-helper-functions.R")
set.seed(50)
dat_dist_freq_di_AorTdi_bid4.lgb_train_set = dat_dist_freq_di_AorTdi_bid4 %>%
  select(-C0_new)
dat_dist_freq_di_AorTdi_bid4.lgb_train_rules = lgb.convert_with_rules(data = dat_dist_freq_di_AorTdi_bid4.lgb_train_set)
dat_dist_freq_di_AorTdi_bid4.lgb_train_data = lgb.Dataset(data = as.matrix(dat_dist_freq_di_AorTdi_bid4.lgb_train_rules$data),
                                                          label = dat_dist_freq_di_AorTdi_bid4$C0_new,
                                                          categorical_feature = handle_categorical(colnames(dat_dist_freq_di_AorTdi_bid4.lgb_train_rules$data)))
dat_dist_freq_di_AorTdi_bid4.lgb_test_set = dat_test_dist_freq_di_AorTdi_bid4 %>%
  select(-C0_new)
dat_dist_freq_di_AorTdi_bid4.lgb_test_matrix = as.matrix(lgb.convert_with_rules(data = dat_dist_freq_di_AorTdi_bid4.lgb_test_set, rules = dat_dist_freq_di_AorTdi_bid4.lgb_train_rules$rules)$data)
dat_dist_freq_di_AorTdi_bid4.lgb_test_data = lgb.Dataset(data = dat_dist_freq_di_AorTdi_bid4.lgb_test_matrix,
                                                         label = dat_test_dist_freq_di_AorTdi_bid4$C0_new,
                                                         categorical_feature = handle_categorical(colnames(dat_dist_freq_di_AorTdi_bid4.lgb_test_matrix)))
dat_dist_freq_di_AorTdi_bid4.lgb_obj = lightgbm(data = dat_dist_freq_di_AorTdi_bid4.lgb_train_data,
                                                params = list(learning_rate = c(0.1),
                                                              objective = c("regression"),
                                                              min_data_in_leaf = 100,
                                                              max_depth = c(5),
                                                              num_leaves = c(1000),
                                                              lambda_l2 = c(1),
                                                              boosting = c("gbdt")),
                                                valids = list(valid = dat_dist_freq_di_AorTdi_bid4.lgb_test_data),
                                                nrounds = 8000,
                                                early_stopping_rounds = 50)

dat_dist_freq_di_AorTdi_bid4.lgb_train_pred = predict(dat_dist_freq_di_AorTdi_bid4.lgb_obj, data = as.matrix(dat_dist_freq_di_AorTdi_bid4.lgb_train_rules$data))
cor(dat_dist_freq_di_AorTdi_bid4.lgb_train_pred, y, method="pearson")
# 0.9544434 (nrounds = 5482)

dat_dist_freq_di_AorTdi_bid4.lgb_test_pred = predict(dat_dist_freq_di_AorTdi_bid4.lgb_obj, data = dat_dist_freq_di_AorTdi_bid4.lgb_test_matrix)

cor(dat_dist_freq_di_AorTdi_bid4.lgb_test_pred, y_test, method="pearson")
# 0.7136886 (nrounds = 5482)

mean((dat_dist_freq_di_AorTdi_bid4.lgb_test_pred - y_test)^2)
# 0.1182569 (nrounds = 5482)
```

We get test prediction correlation of 0.7136886 and MSE of 0.1182569

```{r}
dat_dist_freq_di_AorTdi_bid4.feature_importance = as.data.frame(lgb.importance(dat_dist_freq_di_AorTdi_bid4.lgb_obj)) %>%
  mutate(Feature = fct_rev(fct_inorder(Feature))) %>%
  dplyr::slice(1:50) %>%
  ggplot(aes(x = Feature, y = Gain)) +
  geom_col(fill = "dodgerblue") +
  coord_flip() +
  theme_bw()
dat_dist_freq_di_AorTdi_bid4.feature_importance
```

# Inputs: (Counts of Trinucleotides)^2 + Distance Frequency Between Dinucleotides and AA/TT/AT/TA or CC/GG/CG/GC Dinucleotides

```{r}
nucleotides <- c("A", "C", "G", "T")
dinucleotides <- gtools::permutations(n = 4, r = 2, v = nucleotides,
                                      repeats.allowed = TRUE) %>%
  apply(1, paste, collapse = "")
trinucleotides <- gtools::permutations(n = 4, r = 3, v = nucleotides,
                                       repeats.allowed = TRUE) %>%
  apply(1, paste, collapse = "")

dist_freq_di_AorTdi_bid = readRDS("data/Created/tiling_dist_freq_di_AorTdi_bid.rds")
dist_freq_di_AorTdi_bid_test = readRDS("data/Created/tiling_dist_freq_di_AorTdi_bid_test.rds")
```

## Simple Linear Model

```{r}
dat_dist_freq_di_AorTdi_bid16 = cbind(dat %>% select(all_of(trinucleotides), C0_new), 
                                      dist_freq_di_AorTdi_bid)
dist_freq_di_AorTdi_bid16_formula = as.formula(paste0("C0_new~(", 
                                                      paste(trinucleotides, collapse=" + "),
                                                      ")^2 + ."))
dist_freq_di_AorTdi_bid16_lm = lm(dist_freq_di_AorTdi_bid16_formula, data=dat_dist_freq_di_AorTdi_bid16)
cor(dist_freq_di_AorTdi_bid16_lm$fitted.values, y)
# 0.628263

dat_test_dist_freq_di_AorTdi_bid16 = cbind(dat_test %>% select(all_of(trinucleotides), C0_new), 
                                           dist_freq_di_AorTdi_bid_test)

dist_freq_di_AorTdi_bid16_pred = predict(dist_freq_di_AorTdi_bid16_lm, dat_test_dist_freq_di_AorTdi_bid16)

cor(dist_freq_di_AorTdi_bid16_pred, y_test)
# 0.6008753

mean((dist_freq_di_AorTdi_bid16_pred - y_test)^2)
# 0.1542209
```

We get test prediction correlation of 0.6008753 and MSE of 0.1542209

# Inputs: Counts of Trinucleotides + (Distance Frequency Between Dinucleotides and AA/TT/AT/TA or CC/GG/CG/GC Dinucleotides)^2

```{r}
nucleotides <- c("A", "C", "G", "T")
dinucleotides <- gtools::permutations(n = 4, r = 2, v = nucleotides,
                                      repeats.allowed = TRUE) %>%
  apply(1, paste, collapse = "")
trinucleotides <- gtools::permutations(n = 4, r = 3, v = nucleotides,
                                       repeats.allowed = TRUE) %>%
  apply(1, paste, collapse = "")

dist_freq_di_AorTdi_bid = readRDS("data/Created/tiling_dist_freq_di_AorTdi_bid.rds")
dist_freq_di_AorTdi_bid_test = readRDS("data/Created/tiling_dist_freq_di_AorTdi_bid_test.rds")
```

## Simple Linear Model

```{r}
dat_dist_freq_di_AorTdi_bid17 = cbind(dat %>% select(all_of(trinucleotides), C0_new), 
                                      dist_freq_di_AorTdi_bid)
dist_freq_di_AorTdi_bid17_formula = as.formula(paste0("C0_new~(", 
                                                      paste(colnames(dist_freq_di_AorTdi_bid), collapse=" + "),
                                                      ")^2 + ."))
dist_freq_di_AorTdi_bid17_lm = lm(dist_freq_di_AorTdi_bid17_formula, data=dat_dist_freq_di_AorTdi_bid17)
cor(dist_freq_di_AorTdi_bid17_lm$fitted.values, y)
# 

dat_test_dist_freq_di_AorTdi_bid17 = cbind(dat_test %>% select(all_of(trinucleotides), C0_new), 
                                           dist_freq_di_AorTdi_bid_test)

dist_freq_di_AorTdi_bid17_pred = predict(dist_freq_di_AorTdi_bid17_lm, dat_test_dist_freq_di_AorTdi_bid17)

cor(dist_freq_di_AorTdi_bid17_pred, y_test)
# 

mean((dist_freq_di_AorTdi_bid17_pred - y_test)^2)
# 
```

We get test prediction correlation of  and MSE of 

# Inputs: Counts of Trinucleotides + Distance Frequency Between Dinucleotides and AA/TT/AT/TA or CC/GG/CG/GC Dinucleotides + Markov Ratio

```{r}
nucleotides <- c("A", "C", "G", "T")
dinucleotides <- gtools::permutations(n = 4, r = 2, v = nucleotides,
                                      repeats.allowed = TRUE) %>%
  apply(1, paste, collapse = "")
trinucleotides <- gtools::permutations(n = 4, r = 3, v = nucleotides,
                                       repeats.allowed = TRUE) %>%
  apply(1, paste, collapse = "")

dist_freq_di_AorTdi_bid = readRDS("data/Created/tiling_dist_freq_di_AorTdi_bid.rds")
dist_freq_di_AorTdi_bid_test = readRDS("data/Created/tiling_dist_freq_di_AorTdi_bid_test.rds")
```

## Simple Linear Model

```{r}
dat_dist_freq_di_AorTdi_bid5 = cbind(dat %>% select(all_of(trinucleotides), 
                                                    ratio_score_2nd, C0_new), 
                                     dist_freq_di_AorTdi_bid)

dist_freq_di_AorTdi_bid5_lm = lm(C0_new~., data=dat_dist_freq_di_AorTdi_bid5)
cor(dist_freq_di_AorTdi_bid5_lm$fitted.values, y)
# 0.6087059

dat_test_dist_freq_di_AorTdi_bid5 = cbind(dat_test %>% select(all_of(trinucleotides), 
                                                              ratio_score_2nd, C0_new), 
                                          dist_freq_di_AorTdi_bid_test)

dist_freq_di_AorTdi_bid5_pred = predict(dist_freq_di_AorTdi_bid5_lm, dat_test_dist_freq_di_AorTdi_bid5)

cor(dist_freq_di_AorTdi_bid5_pred, y_test)
# 0.6537301

mean((dist_freq_di_AorTdi_bid5_pred - y_test)^2)
# 0.1421565
```

We get test prediction correlation of 0.6537301 and MSE of 0.1421565

## LightGBM (tree-based) Model

```{r}
library(lightgbm)
source("scripts/functions/lgbm-helper-functions.R")
set.seed(50)
dat_dist_freq_di_AorTdi_bid5.lgb_train_set = dat_dist_freq_di_AorTdi_bid5 %>%
  select(-C0_new)
dat_dist_freq_di_AorTdi_bid5.lgb_train_rules = lgb.convert_with_rules(data = dat_dist_freq_di_AorTdi_bid5.lgb_train_set)
dat_dist_freq_di_AorTdi_bid5.lgb_train_data = lgb.Dataset(data = as.matrix(dat_dist_freq_di_AorTdi_bid5.lgb_train_rules$data),
                                                          label = dat_dist_freq_di_AorTdi_bid5$C0_new,
                                                          categorical_feature = handle_categorical(colnames(dat_dist_freq_di_AorTdi_bid5.lgb_train_rules$data)))
dat_dist_freq_di_AorTdi_bid5.lgb_test_set = dat_test_dist_freq_di_AorTdi_bid5 %>%
  select(-C0_new)
dat_dist_freq_di_AorTdi_bid5.lgb_test_matrix = as.matrix(lgb.convert_with_rules(data = dat_dist_freq_di_AorTdi_bid5.lgb_test_set, rules = dat_dist_freq_di_AorTdi_bid5.lgb_train_rules$rules)$data)
dat_dist_freq_di_AorTdi_bid5.lgb_test_data = lgb.Dataset(data = dat_dist_freq_di_AorTdi_bid5.lgb_test_matrix,
                                                         label = dat_test_dist_freq_di_AorTdi_bid5$C0_new,
                                                         categorical_feature = handle_categorical(colnames(dat_dist_freq_di_AorTdi_bid5.lgb_test_matrix)))
dat_dist_freq_di_AorTdi_bid5.lgb_obj = lightgbm(data = dat_dist_freq_di_AorTdi_bid5.lgb_train_data,
                                                params = list(learning_rate = c(0.1),
                                                              objective = c("regression"),
                                                              min_data_in_leaf = 100,
                                                              max_depth = c(5),
                                                              num_leaves = c(1000),
                                                              lambda_l2 = c(1),
                                                              boosting = c("gbdt")),
                                                valids = list(valid = dat_dist_freq_di_AorTdi_bid5.lgb_test_data),
                                                nrounds = 8000,
                                                early_stopping_rounds = 50)

dat_dist_freq_di_AorTdi_bid5.lgb_train_pred = predict(dat_dist_freq_di_AorTdi_bid5.lgb_obj, data = as.matrix(dat_dist_freq_di_AorTdi_bid5.lgb_train_rules$data))
cor(dat_dist_freq_di_AorTdi_bid5.lgb_train_pred, y, method="pearson")
# 0.9035401 (nrounds = 2696)

dat_dist_freq_di_AorTdi_bid5.lgb_test_pred = predict(dat_dist_freq_di_AorTdi_bid5.lgb_obj, data = dat_dist_freq_di_AorTdi_bid5.lgb_test_matrix)

cor(dat_dist_freq_di_AorTdi_bid5.lgb_test_pred, y_test, method="pearson")
# 0.7264361 (nrounds = 2696)

mean((dat_dist_freq_di_AorTdi_bid5.lgb_test_pred - y_test)^2)
# 0.1152822 (nrounds = 2696)
```

We get test prediction correlation of 0.7264361 and MSE of 0.1152822

```{r}
dat_dist_freq_di_AorTdi_bid5.feature_importance = as.data.frame(lgb.importance(dat_dist_freq_di_AorTdi_bid5.lgb_obj)) %>%
  mutate(Feature = fct_rev(fct_inorder(Feature))) %>%
  dplyr::slice(1:50) %>%
  ggplot(aes(x = Feature, y = Gain)) +
  geom_col(fill = "dodgerblue") +
  coord_flip() +
  theme_bw()
dat_dist_freq_di_AorTdi_bid5.feature_importance
```

# Inputs: Position Specific Dinucleotides + Counts of Trinucleotides + Distance Frequency Between Dinucleotides and AA/TT/AT/TA or CC/GG/CG/GC Dinucleotides

```{r}
ps2 <- paste0("X", 1:49, "di")

nucleotides <- c("A", "C", "G", "T")
dinucleotides <- gtools::permutations(n = 4, r = 2, v = nucleotides,
                                      repeats.allowed = TRUE) %>%
  apply(1, paste, collapse = "")
trinucleotides <- gtools::permutations(n = 4, r = 3, v = nucleotides,
                                       repeats.allowed = TRUE) %>%
  apply(1, paste, collapse = "")

dist_freq_di_AorTdi_bid = readRDS("data/Created/tiling_dist_freq_di_AorTdi_bid.rds")
dist_freq_di_AorTdi_bid_test = readRDS("data/Created/tiling_dist_freq_di_AorTdi_bid_test.rds")
```

## Simple Linear Model

```{r}
dat_dist_freq_di_AorTdi_bid6 = cbind(dat %>% select(all_of(ps2), 
                                                    all_of(trinucleotides), C0_new), 
                                     dist_freq_di_AorTdi_bid)

dist_freq_di_AorTdi_bid6_lm = lm(C0_new~., data=dat_dist_freq_di_AorTdi_bid6)
cor(dist_freq_di_AorTdi_bid6_lm$fitted.values, y)
# 0.6137059

dat_test_dist_freq_di_AorTdi_bid6 = cbind(dat_test %>% select(all_of(ps2), 
                                                              all_of(trinucleotides), C0_new), 
                                          dist_freq_di_AorTdi_bid_test)

dist_freq_di_AorTdi_bid6_pred = predict(dist_freq_di_AorTdi_bid6_lm, dat_test_dist_freq_di_AorTdi_bid6)

cor(dist_freq_di_AorTdi_bid6_pred, y_test)
# 0.6091341

mean((dist_freq_di_AorTdi_bid6_pred - y_test)^2)
# 0.1516057
```

We get test prediction correlation of 0.6091341 and MSE of 0.1516057

## LightGBM (tree-based) Model

```{r}
library(lightgbm)
source("scripts/functions/lgbm-helper-functions.R")
set.seed(50)
dat_dist_freq_di_AorTdi_bid6.lgb_train_set = dat_dist_freq_di_AorTdi_bid6 %>%
  select(-C0_new)
dat_dist_freq_di_AorTdi_bid6.lgb_train_rules = lgb.convert_with_rules(data = dat_dist_freq_di_AorTdi_bid6.lgb_train_set)
dat_dist_freq_di_AorTdi_bid6.lgb_train_data = lgb.Dataset(data = as.matrix(dat_dist_freq_di_AorTdi_bid6.lgb_train_rules$data),
                                                          label = dat_dist_freq_di_AorTdi_bid6$C0_new,
                                                          categorical_feature = handle_categorical(colnames(dat_dist_freq_di_AorTdi_bid6.lgb_train_rules$data)))
dat_dist_freq_di_AorTdi_bid6.lgb_test_set = dat_test_dist_freq_di_AorTdi_bid6 %>%
  select(-C0_new)
dat_dist_freq_di_AorTdi_bid6.lgb_test_matrix = as.matrix(lgb.convert_with_rules(data = dat_dist_freq_di_AorTdi_bid6.lgb_test_set, rules = dat_dist_freq_di_AorTdi_bid6.lgb_train_rules$rules)$data)
dat_dist_freq_di_AorTdi_bid6.lgb_test_data = lgb.Dataset(data = dat_dist_freq_di_AorTdi_bid6.lgb_test_matrix,
                                                         label = dat_test_dist_freq_di_AorTdi_bid6$C0_new,
                                                         categorical_feature = handle_categorical(colnames(dat_dist_freq_di_AorTdi_bid6.lgb_test_matrix)))
dat_dist_freq_di_AorTdi_bid6.lgb_obj = lightgbm(data = dat_dist_freq_di_AorTdi_bid6.lgb_train_data,
                                                params = list(learning_rate = c(0.1),
                                                              objective = c("regression"),
                                                              min_data_in_leaf = 100,
                                                              max_depth = c(5),
                                                              num_leaves = c(1000),
                                                              lambda_l2 = c(1),
                                                              boosting = c("gbdt")),
                                                valids = list(valid = dat_dist_freq_di_AorTdi_bid6.lgb_test_data),
                                                nrounds = 8000,
                                                early_stopping_rounds = 50)

dat_dist_freq_di_AorTdi_bid6.lgb_train_pred = predict(dat_dist_freq_di_AorTdi_bid6.lgb_obj, data = as.matrix(dat_dist_freq_di_AorTdi_bid6.lgb_train_rules$data))
cor(dat_dist_freq_di_AorTdi_bid6.lgb_train_pred, y, method="pearson")
# 0.9975489 (nrounds = 4911)

dat_dist_freq_di_AorTdi_bid6.lgb_test_pred = predict(dat_dist_freq_di_AorTdi_bid6.lgb_obj, data = dat_dist_freq_di_AorTdi_bid6.lgb_test_matrix)

cor(dat_dist_freq_di_AorTdi_bid6.lgb_test_pred, y_test, method="pearson")
# 0.698225 (nrounds = 4911)

mean((dat_dist_freq_di_AorTdi_bid6.lgb_test_pred - y_test)^2)
# 0.1236657 (nrounds = 4911)
```

We get test prediction correlation of 0.698225 and MSE of 0.1236657

```{r}
dat_dist_freq_di_AorTdi_bid6.feature_importance = as.data.frame(lgb.importance(dat_dist_freq_di_AorTdi_bid6.lgb_obj)) %>%
  mutate(Feature = fct_rev(fct_inorder(Feature))) %>%
  dplyr::slice(1:50) %>%
  ggplot(aes(x = Feature, y = Gain)) +
  geom_col(fill = "dodgerblue") +
  coord_flip() +
  theme_bw()
dat_dist_freq_di_AorTdi_bid6.feature_importance
```


# Inputs: Fourier Features Based on all Dinucleotides with h=6 (period 9.8) Calculated using fft + Distance Frequency Between Dinucleotides and AA/TT/AT/TA or CC/GG/CG/GC Dinucleotides

```{r}
fourier_di_cos = readRDS("data/Created/tiling_fourier_di_cos.rds")
fourier_di_sin = readRDS("data/Created/tiling_fourier_di_sin.rds")
fourier_di_cos_test = readRDS("data/Created/tiling_fourier_di_cos_test.rds")
fourier_di_sin_test = readRDS("data/Created/tiling_fourier_di_sin_test.rds")

fourier_di_cos_6 = as.data.frame(fourier_di_cos) %>% select(ends_with("_6"))
fourier_di_sin_6 = as.data.frame(fourier_di_sin) %>% select(ends_with("_6"))
fourier_di_cos_6_test = as.data.frame(fourier_di_cos_test) %>% select(ends_with("_6"))
fourier_di_sin_6_test = as.data.frame(fourier_di_sin_test) %>% select(ends_with("_6"))

dist_freq_di_AorTdi_bid = readRDS("data/Created/tiling_dist_freq_di_AorTdi_bid.rds")
dist_freq_di_AorTdi_bid_test = readRDS("data/Created/tiling_dist_freq_di_AorTdi_bid_test.rds")
```

## Squared value of Fourier features

### Simple Linear Model

```{r}
dat_dist_freq_di_AorTdi_bid7 = cbind(dat %>% select(C0_new), 
                                     (fourier_di_cos_6)^2, (fourier_di_sin_6)^2, 
                                     dist_freq_di_AorTdi_bid)

dist_freq_di_AorTdi_bid7_lm = lm(C0_new~., data=dat_dist_freq_di_AorTdi_bid7)
cor(dist_freq_di_AorTdi_bid7_lm$fitted.values, y)
# 0.5808074

dat_test_dist_freq_di_AorTdi_bid7 = cbind(dat_test %>% select(C0_new), 
                                          (fourier_di_cos_6_test)^2, (fourier_di_sin_6_test)^2, 
                                          dist_freq_di_AorTdi_bid_test)

dist_freq_di_AorTdi_bid7_pred = predict(dist_freq_di_AorTdi_bid7_lm, dat_test_dist_freq_di_AorTdi_bid7)

cor(dist_freq_di_AorTdi_bid7_pred, y_test)
# 0.5822617

mean((dist_freq_di_AorTdi_bid7_pred - y_test)^2)
# 0.1593069
```

We get test prediction correlation of 0.5822617 and MSE of 0.1593069

### LightGBM (tree-based) Model

```{r}
library(lightgbm)
source("scripts/functions/lgbm-helper-functions.R")
set.seed(50)
dat_dist_freq_di_AorTdi_bid7.lgb_train_set = dat_dist_freq_di_AorTdi_bid7 %>%
  select(-C0_new)
dat_dist_freq_di_AorTdi_bid7.lgb_train_rules = lgb.convert_with_rules(data = dat_dist_freq_di_AorTdi_bid7.lgb_train_set)
dat_dist_freq_di_AorTdi_bid7.lgb_train_data = lgb.Dataset(data = as.matrix(dat_dist_freq_di_AorTdi_bid7.lgb_train_rules$data),
                                                          label = dat_dist_freq_di_AorTdi_bid7$C0_new,
                                                          categorical_feature = handle_categorical(colnames(dat_dist_freq_di_AorTdi_bid7.lgb_train_rules$data)))
dat_dist_freq_di_AorTdi_bid7.lgb_test_set = dat_test_dist_freq_di_AorTdi_bid7 %>%
  select(-C0_new)
dat_dist_freq_di_AorTdi_bid7.lgb_test_matrix = as.matrix(lgb.convert_with_rules(data = dat_dist_freq_di_AorTdi_bid7.lgb_test_set, rules = dat_dist_freq_di_AorTdi_bid7.lgb_train_rules$rules)$data)
dat_dist_freq_di_AorTdi_bid7.lgb_test_data = lgb.Dataset(data = dat_dist_freq_di_AorTdi_bid7.lgb_test_matrix,
                                                         label = dat_test_dist_freq_di_AorTdi_bid7$C0_new,
                                                         categorical_feature = handle_categorical(colnames(dat_dist_freq_di_AorTdi_bid7.lgb_test_matrix)))
dat_dist_freq_di_AorTdi_bid7.lgb_obj = lightgbm(data = dat_dist_freq_di_AorTdi_bid7.lgb_train_data,
                                                params = list(learning_rate = c(0.1),
                                                              objective = c("regression"),
                                                              min_data_in_leaf = 100,
                                                              max_depth = c(5),
                                                              num_leaves = c(1000),
                                                              lambda_l2 = c(1),
                                                              boosting = c("gbdt")),
                                                valids = list(valid = dat_dist_freq_di_AorTdi_bid7.lgb_test_data),
                                                nrounds = 8000,
                                                early_stopping_rounds = 50)

dat_dist_freq_di_AorTdi_bid7.lgb_train_pred = predict(dat_dist_freq_di_AorTdi_bid7.lgb_obj, data = as.matrix(dat_dist_freq_di_AorTdi_bid7.lgb_train_rules$data))
cor(dat_dist_freq_di_AorTdi_bid7.lgb_train_pred, y, method="pearson")
# 0.8369823 (nrounds = 1280)

dat_dist_freq_di_AorTdi_bid7.lgb_test_pred = predict(dat_dist_freq_di_AorTdi_bid7.lgb_obj, data = dat_dist_freq_di_AorTdi_bid7.lgb_test_matrix)

cor(dat_dist_freq_di_AorTdi_bid7.lgb_test_pred, y_test, method="pearson")
# 0.632762 (nrounds = 1280)

mean((dat_dist_freq_di_AorTdi_bid7.lgb_test_pred - y_test)^2)
# 0.1445182 (nrounds = 1280)
```

We get test prediction correlation of 0.632762 and MSE of 0.1445182

```{r}
dat_dist_freq_di_AorTdi_bid7.feature_importance = as.data.frame(lgb.importance(dat_dist_freq_di_AorTdi_bid7.lgb_obj)) %>%
  mutate(Feature = fct_rev(fct_inorder(Feature))) %>%
  dplyr::slice(1:50) %>%
  ggplot(aes(x = Feature, y = Gain)) +
  geom_col(fill = "dodgerblue") +
  coord_flip() +
  theme_bw()
dat_dist_freq_di_AorTdi_bid7.feature_importance
```


# Inputs: Modulus of Difference of Fourier Features Based on all Dinucleotides with h=6 (period 9.8) Calculated using fft + Distance Frequency Between Dinucleotides and AA/TT/AT/TA or CC/GG/CG/GC Dinucleotides

```{r}
fourier_6_mod = readRDS("data/Created/tiling_fourier_6_mod.rds")
fourier_6_mod_test = readRDS("data/Created/tiling_fourier_6_mod_test.rds")

dist_freq_di_AorTdi_bid = readRDS("data/Created/tiling_dist_freq_di_AorTdi_bid.rds")
dist_freq_di_AorTdi_bid_test = readRDS("data/Created/tiling_dist_freq_di_AorTdi_bid_test.rds")
```

## Squared value of Fourier features

### Simple Linear Model

```{r}
dat_dist_freq_di_AorTdi_bid8 = cbind(dat %>% select(C0_new),
                                     (fourier_6_mod)^2, dist_freq_di_AorTdi_bid)

dist_freq_di_AorTdi_bid8_lm = lm(C0_new~., data=dat_dist_freq_di_AorTdi_bid8)
cor(dist_freq_di_AorTdi_bid8_lm$fitted.values, y)
# 0.6043689

dat_test_dist_freq_di_AorTdi_bid8 = cbind(dat_test %>% select(C0_new), 
                                          (fourier_6_mod_test)^2, dist_freq_di_AorTdi_bid_test)

dist_freq_di_AorTdi_bid8_pred = predict(dist_freq_di_AorTdi_bid8_lm, dat_test_dist_freq_di_AorTdi_bid8)

cor(dist_freq_di_AorTdi_bid8_pred, y_test)
# 0.6066521

mean((dist_freq_di_AorTdi_bid8_pred - y_test)^2)
# 0.1523163
```

We get test prediction correlation of 0.6066521 and MSE of 0.1523163

### LightGBM (tree-based) Model

```{r}
library(lightgbm)
source("scripts/functions/lgbm-helper-functions.R")
set.seed(50)
dat_dist_freq_di_AorTdi_bid8.lgb_train_set = dat_dist_freq_di_AorTdi_bid8 %>%
  select(-C0_new)
dat_dist_freq_di_AorTdi_bid8.lgb_train_rules = lgb.convert_with_rules(data = dat_dist_freq_di_AorTdi_bid8.lgb_train_set)
dat_dist_freq_di_AorTdi_bid8.lgb_train_data = lgb.Dataset(data = as.matrix(dat_dist_freq_di_AorTdi_bid8.lgb_train_rules$data),
                                                          label = dat_dist_freq_di_AorTdi_bid8$C0_new,
                                                          categorical_feature = handle_categorical(colnames(dat_dist_freq_di_AorTdi_bid8.lgb_train_rules$data)))
dat_dist_freq_di_AorTdi_bid8.lgb_test_set = dat_test_dist_freq_di_AorTdi_bid8 %>%
  select(-C0_new)
dat_dist_freq_di_AorTdi_bid8.lgb_test_matrix = as.matrix(lgb.convert_with_rules(data = dat_dist_freq_di_AorTdi_bid8.lgb_test_set, rules = dat_dist_freq_di_AorTdi_bid8.lgb_train_rules$rules)$data)
dat_dist_freq_di_AorTdi_bid8.lgb_test_data = lgb.Dataset(data = dat_dist_freq_di_AorTdi_bid8.lgb_test_matrix,
                                                         label = dat_test_dist_freq_di_AorTdi_bid8$C0_new,
                                                         categorical_feature = handle_categorical(colnames(dat_dist_freq_di_AorTdi_bid8.lgb_test_matrix)))
dat_dist_freq_di_AorTdi_bid8.lgb_obj = lightgbm(data = dat_dist_freq_di_AorTdi_bid8.lgb_train_data,
                                                params = list(learning_rate = c(0.1),
                                                              objective = c("regression"),
                                                              min_data_in_leaf = 100,
                                                              max_depth = c(5),
                                                              num_leaves = c(1000),
                                                              lambda_l2 = c(1),
                                                              boosting = c("gbdt")),
                                                valids = list(valid = dat_dist_freq_di_AorTdi_bid8.lgb_test_data),
                                                nrounds = 8000,
                                                early_stopping_rounds = 50)

dat_dist_freq_di_AorTdi_bid8.lgb_train_pred = predict(dat_dist_freq_di_AorTdi_bid8.lgb_obj, data = as.matrix(dat_dist_freq_di_AorTdi_bid8.lgb_train_rules$data))
cor(dat_dist_freq_di_AorTdi_bid8.lgb_train_pred, y, method="pearson")
# 0.9130657 (nrounds = 1862)

dat_dist_freq_di_AorTdi_bid8.lgb_test_pred = predict(dat_dist_freq_di_AorTdi_bid8.lgb_obj, data = dat_dist_freq_di_AorTdi_bid8.lgb_test_matrix)

cor(dat_dist_freq_di_AorTdi_bid8.lgb_test_pred, y_test, method="pearson")
# 0.6590067 (nrounds = 1862)

mean((dat_dist_freq_di_AorTdi_bid8.lgb_test_pred - y_test)^2)
# 0.1363621 (nrounds = 1862)
```

We get test prediction correlation of 0.6590067 and MSE of 0.1363621

```{r}
dat_dist_freq_di_AorTdi_bid8.feature_importance = as.data.frame(lgb.importance(dat_dist_freq_di_AorTdi_bid8.lgb_obj)) %>%
  mutate(Feature = fct_rev(fct_inorder(Feature))) %>%
  dplyr::slice(1:50) %>%
  ggplot(aes(x = Feature, y = Gain)) +
  geom_col(fill = "dodgerblue") +
  coord_flip() +
  theme_bw()
dat_dist_freq_di_AorTdi_bid8.feature_importance
```


# Inputs: Fourier Features Based on all Dinucleotides with h=6 (period 9.8) + Modulus of Difference of Fourier Features Based on all Dinucleotides with h=6 (period 9.8) Calculated using fft + Distance Frequency Between Dinucleotides and AA/TT/AT/TA or CC/GG/CG/GC Dinucleotides

```{r}
fourier_di_cos = readRDS("data/Created/tiling_fourier_di_cos.rds")
fourier_di_sin = readRDS("data/Created/tiling_fourier_di_sin.rds")
fourier_di_cos_test = readRDS("data/Created/tiling_fourier_di_cos_test.rds")
fourier_di_sin_test = readRDS("data/Created/tiling_fourier_di_sin_test.rds")

fourier_di_cos_6 = as.data.frame(fourier_di_cos) %>% select(ends_with("_6"))
fourier_di_sin_6 = as.data.frame(fourier_di_sin) %>% select(ends_with("_6"))
fourier_di_cos_6_test = as.data.frame(fourier_di_cos_test) %>% select(ends_with("_6"))
fourier_di_sin_6_test = as.data.frame(fourier_di_sin_test) %>% select(ends_with("_6"))

fourier_6_mod = readRDS("data/Created/tiling_fourier_6_mod.rds")
fourier_6_mod_test = readRDS("data/Created/tiling_fourier_6_mod_test.rds")

dist_freq_di_AorTdi_bid = readRDS("data/Created/tiling_dist_freq_di_AorTdi_bid.rds")
dist_freq_di_AorTdi_bid_test = readRDS("data/Created/tiling_dist_freq_di_AorTdi_bid_test.rds")
```

## Squared value of Fourier features

### Simple Linear Model

```{r}
dat_dist_freq_di_AorTdi_bid9 = cbind(dat %>% select(C0_new), 
                                     (fourier_di_cos_6)^2, (fourier_di_sin_6)^2, 
                                     (fourier_6_mod)^2, dist_freq_di_AorTdi_bid)

dist_freq_di_AorTdi_bid9_lm = lm(C0_new~., data=dat_dist_freq_di_AorTdi_bid9)
cor(dist_freq_di_AorTdi_bid9_lm$fitted.values, y)
# 0.6074207

dat_test_dist_freq_di_AorTdi_bid9 = cbind(dat_test %>% select(C0_new), 
                                          (fourier_di_cos_6_test)^2, (fourier_di_sin_6_test)^2, 
                                          (fourier_6_mod_test)^2, dist_freq_di_AorTdi_bid_test)

dist_freq_di_AorTdi_bid9_pred = predict(dist_freq_di_AorTdi_bid9_lm, dat_test_dist_freq_di_AorTdi_bid9)

cor(dist_freq_di_AorTdi_bid9_pred, y_test)
# 0.6093215

mean((dist_freq_di_AorTdi_bid9_pred - y_test)^2)
# 0.1515328
```

We get test prediction correlation of 0.6093215 and MSE of 0.1515328

### LightGBM (tree-based) Model

```{r}
library(lightgbm)
source("scripts/functions/lgbm-helper-functions.R")
set.seed(50)
dat_dist_freq_di_AorTdi_bid9.lgb_train_set = dat_dist_freq_di_AorTdi_bid9 %>%
  select(-C0_new)
dat_dist_freq_di_AorTdi_bid9.lgb_train_rules = lgb.convert_with_rules(data = dat_dist_freq_di_AorTdi_bid9.lgb_train_set)
dat_dist_freq_di_AorTdi_bid9.lgb_train_data = lgb.Dataset(data = as.matrix(dat_dist_freq_di_AorTdi_bid9.lgb_train_rules$data),
                                                          label = dat_dist_freq_di_AorTdi_bid9$C0_new,
                                                          categorical_feature = handle_categorical(colnames(dat_dist_freq_di_AorTdi_bid9.lgb_train_rules$data)))
dat_dist_freq_di_AorTdi_bid9.lgb_test_set = dat_test_dist_freq_di_AorTdi_bid9 %>%
  select(-C0_new)
dat_dist_freq_di_AorTdi_bid9.lgb_test_matrix = as.matrix(lgb.convert_with_rules(data = dat_dist_freq_di_AorTdi_bid9.lgb_test_set, rules = dat_dist_freq_di_AorTdi_bid9.lgb_train_rules$rules)$data)
dat_dist_freq_di_AorTdi_bid9.lgb_test_data = lgb.Dataset(data = dat_dist_freq_di_AorTdi_bid9.lgb_test_matrix,
                                                         label = dat_test_dist_freq_di_AorTdi_bid9$C0_new,
                                                         categorical_feature = handle_categorical(colnames(dat_dist_freq_di_AorTdi_bid9.lgb_test_matrix)))
dat_dist_freq_di_AorTdi_bid9.lgb_obj = lightgbm(data = dat_dist_freq_di_AorTdi_bid9.lgb_train_data,
                                                params = list(learning_rate = c(0.1),
                                                              objective = c("regression"),
                                                              min_data_in_leaf = 100,
                                                              max_depth = c(5),
                                                              num_leaves = c(1000),
                                                              lambda_l2 = c(1),
                                                              boosting = c("gbdt")),
                                                valids = list(valid = dat_dist_freq_di_AorTdi_bid9.lgb_test_data),
                                                nrounds = 8000,
                                                early_stopping_rounds = 50)

dat_dist_freq_di_AorTdi_bid9.lgb_train_pred = predict(dat_dist_freq_di_AorTdi_bid9.lgb_obj, data = as.matrix(dat_dist_freq_di_AorTdi_bid9.lgb_train_rules$data))
cor(dat_dist_freq_di_AorTdi_bid9.lgb_train_pred, y, method="pearson")
# 0.912129 (nrounds = 1729)

dat_dist_freq_di_AorTdi_bid9.lgb_test_pred = predict(dat_dist_freq_di_AorTdi_bid9.lgb_obj, data = dat_dist_freq_di_AorTdi_bid9.lgb_test_matrix)

cor(dat_dist_freq_di_AorTdi_bid9.lgb_test_pred, y_test, method="pearson")
# 0.6546141 (nrounds = 1729)

mean((dat_dist_freq_di_AorTdi_bid9.lgb_test_pred - y_test)^2)
# 0.1377398 (nrounds = 1729)
```

We get test prediction correlation of 0.6546141 and MSE of 0.1377398

```{r}
dat_dist_freq_di_AorTdi_bid9.feature_importance = as.data.frame(lgb.importance(dat_dist_freq_di_AorTdi_bid9.lgb_obj)) %>%
  mutate(Feature = fct_rev(fct_inorder(Feature))) %>%
  dplyr::slice(1:50) %>%
  ggplot(aes(x = Feature, y = Gain)) +
  geom_col(fill = "dodgerblue") +
  coord_flip() +
  theme_bw()
dat_dist_freq_di_AorTdi_bid9.feature_importance
```


# Inputs: Position Specific Dinucleotides + Fourier Features Based on all Dinucleotides with h=6 (period 9.8) + Modulus of Difference of Fourier Features Based on all Dinucleotides with h=6 (period 9.8) Calculated using fft + Distance Frequency Between Dinucleotides and AA/TT/AT/TA or CC/GG/CG/GC Dinucleotides

```{r}
ps2 <- paste0("X", 1:49, "di")

fourier_di_cos = readRDS("data/Created/tiling_fourier_di_cos.rds")
fourier_di_sin = readRDS("data/Created/tiling_fourier_di_sin.rds")
fourier_di_cos_test = readRDS("data/Created/tiling_fourier_di_cos_test.rds")
fourier_di_sin_test = readRDS("data/Created/tiling_fourier_di_sin_test.rds")

fourier_di_cos_6 = as.data.frame(fourier_di_cos) %>% select(ends_with("_6"))
fourier_di_sin_6 = as.data.frame(fourier_di_sin) %>% select(ends_with("_6"))
fourier_di_cos_6_test = as.data.frame(fourier_di_cos_test) %>% select(ends_with("_6"))
fourier_di_sin_6_test = as.data.frame(fourier_di_sin_test) %>% select(ends_with("_6"))

fourier_6_mod = readRDS("data/Created/tiling_fourier_6_mod.rds")
fourier_6_mod_test = readRDS("data/Created/tiling_fourier_6_mod_test.rds")

dist_freq_di_AorTdi_bid = readRDS("data/Created/tiling_dist_freq_di_AorTdi_bid.rds")
dist_freq_di_AorTdi_bid_test = readRDS("data/Created/tiling_dist_freq_di_AorTdi_bid_test.rds")
```

## Squared value of Fourier features

### Simple Linear Model

```{r}
dat_dist_freq_di_AorTdi_bid10 = cbind(dat %>% select(all_of(ps2), C0_new), 
                                      (fourier_di_cos_6)^2, (fourier_di_sin_6)^2, 
                                      (fourier_6_mod)^2, dist_freq_di_AorTdi_bid)

dist_freq_di_AorTdi_bid10_lm = lm(C0_new~., data=dat_dist_freq_di_AorTdi_bid10)
cor(dist_freq_di_AorTdi_bid10_lm$fitted.values, y)
# 0.6305764

dat_test_dist_freq_di_AorTdi_bid10 = cbind(dat_test %>% select(all_of(ps2), C0_new), 
                                           (fourier_di_cos_6_test)^2, (fourier_di_sin_6_test)^2, 
                                           (fourier_6_mod_test)^2, dist_freq_di_AorTdi_bid_test)

dist_freq_di_AorTdi_bid10_pred = predict(dist_freq_di_AorTdi_bid10_lm, dat_test_dist_freq_di_AorTdi_bid10)

cor(dist_freq_di_AorTdi_bid10_pred, y_test)
# 0.6290727

mean((dist_freq_di_AorTdi_bid10_pred - y_test)^2)
# 0.1456384
```

We get test prediction correlation of 0.6290727 and MSE of 0.1456384

### LightGBM (tree-based) Model

```{r}
library(lightgbm)
source("scripts/functions/lgbm-helper-functions.R")
set.seed(50)
dat_dist_freq_di_AorTdi_bid10.lgb_train_set = dat_dist_freq_di_AorTdi_bid10 %>%
  select(-C0_new)
dat_dist_freq_di_AorTdi_bid10.lgb_train_rules = lgb.convert_with_rules(data = dat_dist_freq_di_AorTdi_bid10.lgb_train_set)
dat_dist_freq_di_AorTdi_bid10.lgb_train_data = lgb.Dataset(data = as.matrix(dat_dist_freq_di_AorTdi_bid10.lgb_train_rules$data),
                                                           label = dat_dist_freq_di_AorTdi_bid10$C0_new,
                                                           categorical_feature = handle_categorical(colnames(dat_dist_freq_di_AorTdi_bid10.lgb_train_rules$data)))
dat_dist_freq_di_AorTdi_bid10.lgb_test_set = dat_test_dist_freq_di_AorTdi_bid10 %>%
  select(-C0_new)
dat_dist_freq_di_AorTdi_bid10.lgb_test_matrix = as.matrix(lgb.convert_with_rules(data = dat_dist_freq_di_AorTdi_bid10.lgb_test_set, rules = dat_dist_freq_di_AorTdi_bid10.lgb_train_rules$rules)$data)
dat_dist_freq_di_AorTdi_bid10.lgb_test_data = lgb.Dataset(data = dat_dist_freq_di_AorTdi_bid10.lgb_test_matrix,
                                                          label = dat_test_dist_freq_di_AorTdi_bid10$C0_new,
                                                          categorical_feature = handle_categorical(colnames(dat_dist_freq_di_AorTdi_bid10.lgb_test_matrix)))
dat_dist_freq_di_AorTdi_bid10.lgb_obj = lightgbm(data = dat_dist_freq_di_AorTdi_bid10.lgb_train_data,
                                                 params = list(learning_rate = c(0.1),
                                                               objective = c("regression"),
                                                               min_data_in_leaf = 100,
                                                               max_depth = c(5),
                                                               num_leaves = c(1000),
                                                               lambda_l2 = c(1),
                                                               boosting = c("gbdt")),
                                                 valids = list(valid = dat_dist_freq_di_AorTdi_bid10.lgb_test_data),
                                                 nrounds = 8000,
                                                 early_stopping_rounds = 50)

dat_dist_freq_di_AorTdi_bid10.lgb_train_pred = predict(dat_dist_freq_di_AorTdi_bid10.lgb_obj, data = as.matrix(dat_dist_freq_di_AorTdi_bid10.lgb_train_rules$data))
cor(dat_dist_freq_di_AorTdi_bid10.lgb_train_pred, y, method="pearson")
# 0.9705525 (nrounds = 1963)

dat_dist_freq_di_AorTdi_bid10.lgb_test_pred = predict(dat_dist_freq_di_AorTdi_bid10.lgb_obj, data = dat_dist_freq_di_AorTdi_bid10.lgb_test_matrix)

cor(dat_dist_freq_di_AorTdi_bid10.lgb_test_pred, y_test, method="pearson")
# 0.6751622 (nrounds = 1963)

mean((dat_dist_freq_di_AorTdi_bid10.lgb_test_pred - y_test)^2)
# 0.1312238 (nrounds = 1963)
```

We get test prediction correlation of 0.6751622 and MSE of 0.1312238

```{r}
dat_dist_freq_di_AorTdi_bid10.feature_importance = as.data.frame(lgb.importance(dat_dist_freq_di_AorTdi_bid10.lgb_obj)) %>%
  mutate(Feature = fct_rev(fct_inorder(Feature))) %>%
  dplyr::slice(1:50) %>%
  ggplot(aes(x = Feature, y = Gain)) +
  geom_col(fill = "dodgerblue") +
  coord_flip() +
  theme_bw()
dat_dist_freq_di_AorTdi_bid10.feature_importance
```


# Inputs: Counts of Dinucleotides + Fourier Features Based on all Dinucleotides with h=6 (period 9.8) + Modulus of Difference of Fourier Features Based on all Dinucleotides with h=6 (period 9.8) Calculated using fft + Distance Frequency Between Dinucleotides and AA/TT/AT/TA or CC/GG/CG/GC Dinucleotides

```{r}
nucleotides <- c("A", "C", "G", "T")
dinucleotides <- gtools::permutations(n = 4, r = 2, v = nucleotides,
                                      repeats.allowed = TRUE) %>%
  apply(1, paste, collapse = "")

fourier_di_cos = readRDS("data/Created/tiling_fourier_di_cos.rds")
fourier_di_sin = readRDS("data/Created/tiling_fourier_di_sin.rds")
fourier_di_cos_test = readRDS("data/Created/tiling_fourier_di_cos_test.rds")
fourier_di_sin_test = readRDS("data/Created/tiling_fourier_di_sin_test.rds")

fourier_di_cos_6 = as.data.frame(fourier_di_cos) %>% select(ends_with("_6"))
fourier_di_sin_6 = as.data.frame(fourier_di_sin) %>% select(ends_with("_6"))
fourier_di_cos_6_test = as.data.frame(fourier_di_cos_test) %>% select(ends_with("_6"))
fourier_di_sin_6_test = as.data.frame(fourier_di_sin_test) %>% select(ends_with("_6"))

fourier_6_mod = readRDS("data/Created/tiling_fourier_6_mod.rds")
fourier_6_mod_test = readRDS("data/Created/tiling_fourier_6_mod_test.rds")

dist_freq_di_AorTdi_bid = readRDS("data/Created/tiling_dist_freq_di_AorTdi_bid.rds")
dist_freq_di_AorTdi_bid_test = readRDS("data/Created/tiling_dist_freq_di_AorTdi_bid_test.rds")
```

## Squared value of Fourier features

### Simple Linear Model

```{r}
dat_dist_freq_di_AorTdi_bid11 = cbind(dat %>% select(all_of(dinucleotides), C0_new), 
                                      (fourier_di_cos_6)^2, (fourier_di_sin_6)^2, 
                                      (fourier_6_mod)^2, dist_freq_di_AorTdi_bid)

dist_freq_di_AorTdi_bid11_lm = lm(C0_new~., data=dat_dist_freq_di_AorTdi_bid11)
cor(dist_freq_di_AorTdi_bid11_lm$fitted.values, y)
# 0.611346

dat_test_dist_freq_di_AorTdi_bid11 = cbind(dat_test %>% select(all_of(dinucleotides), C0_new), 
                                           (fourier_di_cos_6_test)^2, (fourier_di_sin_6_test)^2, 
                                           (fourier_6_mod_test)^2, dist_freq_di_AorTdi_bid_test)

dist_freq_di_AorTdi_bid11_pred = predict(dist_freq_di_AorTdi_bid11_lm, dat_test_dist_freq_di_AorTdi_bid11)

cor(dist_freq_di_AorTdi_bid11_pred, y_test)
# 0.6139969

mean((dist_freq_di_AorTdi_bid11_pred - y_test)^2)
# 0.1501551
```

We get test prediction correlation of 0.6139969 and MSE of 0.1501551

### LightGBM (tree-based) Model

```{r}
library(lightgbm)
source("scripts/functions/lgbm-helper-functions.R")
set.seed(50)
dat_dist_freq_di_AorTdi_bid11.lgb_train_set = dat_dist_freq_di_AorTdi_bid11 %>%
  select(-C0_new)
dat_dist_freq_di_AorTdi_bid11.lgb_train_rules = lgb.convert_with_rules(data = dat_dist_freq_di_AorTdi_bid11.lgb_train_set)
dat_dist_freq_di_AorTdi_bid11.lgb_train_data = lgb.Dataset(data = as.matrix(dat_dist_freq_di_AorTdi_bid11.lgb_train_rules$data),
                                                           label = dat_dist_freq_di_AorTdi_bid11$C0_new,
                                                           categorical_feature = handle_categorical(colnames(dat_dist_freq_di_AorTdi_bid11.lgb_train_rules$data)))
dat_dist_freq_di_AorTdi_bid11.lgb_test_set = dat_test_dist_freq_di_AorTdi_bid11 %>%
  select(-C0_new)
dat_dist_freq_di_AorTdi_bid11.lgb_test_matrix = as.matrix(lgb.convert_with_rules(data = dat_dist_freq_di_AorTdi_bid11.lgb_test_set, rules = dat_dist_freq_di_AorTdi_bid11.lgb_train_rules$rules)$data)
dat_dist_freq_di_AorTdi_bid11.lgb_test_data = lgb.Dataset(data = dat_dist_freq_di_AorTdi_bid11.lgb_test_matrix,
                                                          label = dat_test_dist_freq_di_AorTdi_bid11$C0_new,
                                                          categorical_feature = handle_categorical(colnames(dat_dist_freq_di_AorTdi_bid11.lgb_test_matrix)))
dat_dist_freq_di_AorTdi_bid11.lgb_obj = lightgbm(data = dat_dist_freq_di_AorTdi_bid11.lgb_train_data,
                                                 params = list(learning_rate = c(0.1),
                                                               objective = c("regression"),
                                                               min_data_in_leaf = 100,
                                                               max_depth = c(5),
                                                               num_leaves = c(1000),
                                                               lambda_l2 = c(1),
                                                               boosting = c("gbdt")),
                                                 valids = list(valid = dat_dist_freq_di_AorTdi_bid11.lgb_test_data),
                                                 nrounds = 8000,
                                                 early_stopping_rounds = 50)

dat_dist_freq_di_AorTdi_bid11.lgb_train_pred = predict(dat_dist_freq_di_AorTdi_bid11.lgb_obj, data = as.matrix(dat_dist_freq_di_AorTdi_bid11.lgb_train_rules$data))
cor(dat_dist_freq_di_AorTdi_bid11.lgb_train_pred, y, method="pearson")
# 0.8616565 (nrounds = 1116)

dat_dist_freq_di_AorTdi_bid11.lgb_test_pred = predict(dat_dist_freq_di_AorTdi_bid11.lgb_obj, data = dat_dist_freq_di_AorTdi_bid11.lgb_test_matrix)

cor(dat_dist_freq_di_AorTdi_bid11.lgb_test_pred, y_test, method="pearson")
# 0.6570446 (nrounds = 1116)

mean((dat_dist_freq_di_AorTdi_bid11.lgb_test_pred - y_test)^2)
# 0.1370787 (nrounds = 1116)
```

We get test prediction correlation of 0.6570446 and MSE of 0.1370787

```{r}
dat_dist_freq_di_AorTdi_bid11.feature_importance = as.data.frame(lgb.importance(dat_dist_freq_di_AorTdi_bid11.lgb_obj)) %>%
  mutate(Feature = fct_rev(fct_inorder(Feature))) %>%
  dplyr::slice(1:50) %>%
  ggplot(aes(x = Feature, y = Gain)) +
  geom_col(fill = "dodgerblue") +
  coord_flip() +
  theme_bw()
dat_dist_freq_di_AorTdi_bid11.feature_importance
```



# Inputs: Counts of Trinucleotides + Fourier Features Based on all Dinucleotides with h=6 (period 9.8) + Modulus of Difference of Fourier Features Based on all Dinucleotides with h=6 (period 9.8) Calculated using fft + Distance Frequency Between Dinucleotides and AA/TT/AT/TA or CC/GG/CG/GC Dinucleotides

```{r}
nucleotides <- c("A", "C", "G", "T")
dinucleotides <- gtools::permutations(n = 4, r = 2, v = nucleotides,
                                      repeats.allowed = TRUE) %>%
  apply(1, paste, collapse = "")
trinucleotides <- gtools::permutations(n = 4, r = 3, v = nucleotides,
                                       repeats.allowed = TRUE) %>%
  apply(1, paste, collapse = "")

fourier_di_cos = readRDS("data/Created/tiling_fourier_di_cos.rds")
fourier_di_sin = readRDS("data/Created/tiling_fourier_di_sin.rds")
fourier_di_cos_test = readRDS("data/Created/tiling_fourier_di_cos_test.rds")
fourier_di_sin_test = readRDS("data/Created/tiling_fourier_di_sin_test.rds")

fourier_di_cos_6 = as.data.frame(fourier_di_cos) %>% select(ends_with("_6"))
fourier_di_sin_6 = as.data.frame(fourier_di_sin) %>% select(ends_with("_6"))
fourier_di_cos_6_test = as.data.frame(fourier_di_cos_test) %>% select(ends_with("_6"))
fourier_di_sin_6_test = as.data.frame(fourier_di_sin_test) %>% select(ends_with("_6"))

fourier_6_mod = readRDS("data/Created/tiling_fourier_6_mod.rds")
fourier_6_mod_test = readRDS("data/Created/tiling_fourier_6_mod_test.rds")

dist_freq_di_AorTdi_bid = readRDS("data/Created/tiling_dist_freq_di_AorTdi_bid.rds")
dist_freq_di_AorTdi_bid_test = readRDS("data/Created/tiling_dist_freq_di_AorTdi_bid_test.rds")
```

## Squared value of Fourier features

### Simple Linear Model

```{r}
dat_dist_freq_di_AorTdi_bid12 = cbind(dat %>% select(all_of(trinucleotides), C0_new), 
                                      (fourier_di_cos_6)^2, (fourier_di_sin_6)^2, 
                                      (fourier_6_mod)^2, dist_freq_di_AorTdi_bid)

dist_freq_di_AorTdi_bid12_lm = lm(C0_new~., data=dat_dist_freq_di_AorTdi_bid12)
cor(dist_freq_di_AorTdi_bid12_lm$fitted.values, y)
# 0.6231104

dat_test_dist_freq_di_AorTdi_bid12 = cbind(dat_test %>% select(all_of(trinucleotides), C0_new), 
                                           (fourier_di_cos_6_test)^2, (fourier_di_sin_6_test)^2, 
                                           (fourier_6_mod_test)^2, dist_freq_di_AorTdi_bid_test)

dist_freq_di_AorTdi_bid12_pred = predict(dist_freq_di_AorTdi_bid12_lm, dat_test_dist_freq_di_AorTdi_bid12)

cor(dist_freq_di_AorTdi_bid12_pred, y_test)
# 0.6254994

mean((dist_freq_di_AorTdi_bid12_pred - y_test)^2)
# 0.1467203
```

We get test prediction correlation of 0.6254994 and MSE of 0.1467203

### LightGBM (tree-based) Model

```{r}
library(lightgbm)
source("scripts/functions/lgbm-helper-functions.R")
set.seed(50)
dat_dist_freq_di_AorTdi_bid12.lgb_train_set = dat_dist_freq_di_AorTdi_bid12 %>%
  select(-C0_new)
dat_dist_freq_di_AorTdi_bid12.lgb_train_rules = lgb.convert_with_rules(data = dat_dist_freq_di_AorTdi_bid12.lgb_train_set)
dat_dist_freq_di_AorTdi_bid12.lgb_train_data = lgb.Dataset(data = as.matrix(dat_dist_freq_di_AorTdi_bid12.lgb_train_rules$data),
                                                           label = dat_dist_freq_di_AorTdi_bid12$C0_new,
                                                           categorical_feature = handle_categorical(colnames(dat_dist_freq_di_AorTdi_bid12.lgb_train_rules$data)))
dat_dist_freq_di_AorTdi_bid12.lgb_test_set = dat_test_dist_freq_di_AorTdi_bid12 %>%
  select(-C0_new)
dat_dist_freq_di_AorTdi_bid12.lgb_test_matrix = as.matrix(lgb.convert_with_rules(data = dat_dist_freq_di_AorTdi_bid12.lgb_test_set, rules = dat_dist_freq_di_AorTdi_bid12.lgb_train_rules$rules)$data)
dat_dist_freq_di_AorTdi_bid12.lgb_test_data = lgb.Dataset(data = dat_dist_freq_di_AorTdi_bid12.lgb_test_matrix,
                                                          label = dat_test_dist_freq_di_AorTdi_bid12$C0_new,
                                                          categorical_feature = handle_categorical(colnames(dat_dist_freq_di_AorTdi_bid12.lgb_test_matrix)))
dat_dist_freq_di_AorTdi_bid12.lgb_obj = lightgbm(data = dat_dist_freq_di_AorTdi_bid12.lgb_train_data,
                                                 params = list(learning_rate = c(0.1),
                                                               objective = c("regression"),
                                                               min_data_in_leaf = 100,
                                                               max_depth = c(5),
                                                               num_leaves = c(1000),
                                                               lambda_l2 = c(1),
                                                               boosting = c("gbdt")),
                                                 valids = list(valid = dat_dist_freq_di_AorTdi_bid12.lgb_test_data),
                                                 nrounds = 8000,
                                                 early_stopping_rounds = 50)

dat_dist_freq_di_AorTdi_bid12.lgb_train_pred = predict(dat_dist_freq_di_AorTdi_bid12.lgb_obj, data = as.matrix(dat_dist_freq_di_AorTdi_bid12.lgb_train_rules$data))
cor(dat_dist_freq_di_AorTdi_bid12.lgb_train_pred, y, method="pearson")
# 0.9395178 (nrounds = 2203)

dat_dist_freq_di_AorTdi_bid12.lgb_test_pred = predict(dat_dist_freq_di_AorTdi_bid12.lgb_obj, data = dat_dist_freq_di_AorTdi_bid12.lgb_test_matrix)

cor(dat_dist_freq_di_AorTdi_bid12.lgb_test_pred, y_test, method="pearson")
# 0.68261 (nrounds = 2203)

mean((dat_dist_freq_di_AorTdi_bid12.lgb_test_pred - y_test)^2)
# 0.1287353 (nrounds = 2203)
```

We get test prediction correlation of 0.68261 and MSE of 0.1287353

```{r}
dat_dist_freq_di_AorTdi_bid12.feature_importance = as.data.frame(lgb.importance(dat_dist_freq_di_AorTdi_bid12.lgb_obj)) %>%
  mutate(Feature = fct_rev(fct_inorder(Feature))) %>%
  dplyr::slice(1:50) %>%
  ggplot(aes(x = Feature, y = Gain)) +
  geom_col(fill = "dodgerblue") +
  coord_flip() +
  theme_bw()
dat_dist_freq_di_AorTdi_bid12.feature_importance
```


# Inputs: Position Specific Dinucleotides + Counts of Trinucleotides + Fourier Features Based on all Dinucleotides with h=6 (period 9.8) + Modulus of Difference of Fourier Features Based on all Dinucleotides with h=6 (period 9.8) Calculated using fft + Distance Frequency Between Dinucleotides and AA/TT/AT/TA or CC/GG/CG/GC Dinucleotides

```{r}
ps2 <- paste0("X", 1:49, "di")

nucleotides <- c("A", "C", "G", "T")
dinucleotides <- gtools::permutations(n = 4, r = 2, v = nucleotides,
                                      repeats.allowed = TRUE) %>%
  apply(1, paste, collapse = "")
trinucleotides <- gtools::permutations(n = 4, r = 3, v = nucleotides,
                                       repeats.allowed = TRUE) %>%
  apply(1, paste, collapse = "")

fourier_di_cos = readRDS("data/Created/tiling_fourier_di_cos.rds")
fourier_di_sin = readRDS("data/Created/tiling_fourier_di_sin.rds")
fourier_di_cos_test = readRDS("data/Created/tiling_fourier_di_cos_test.rds")
fourier_di_sin_test = readRDS("data/Created/tiling_fourier_di_sin_test.rds")

fourier_di_cos_6 = as.data.frame(fourier_di_cos) %>% select(ends_with("_6"))
fourier_di_sin_6 = as.data.frame(fourier_di_sin) %>% select(ends_with("_6"))
fourier_di_cos_6_test = as.data.frame(fourier_di_cos_test) %>% select(ends_with("_6"))
fourier_di_sin_6_test = as.data.frame(fourier_di_sin_test) %>% select(ends_with("_6"))

fourier_6_mod = readRDS("data/Created/tiling_fourier_6_mod.rds")
fourier_6_mod_test = readRDS("data/Created/tiling_fourier_6_mod_test.rds")

dist_freq_di_AorTdi_bid = readRDS("data/Created/tiling_dist_freq_di_AorTdi_bid.rds")
dist_freq_di_AorTdi_bid_test = readRDS("data/Created/tiling_dist_freq_di_AorTdi_bid_test.rds")
```

## Squared value of Fourier features

### Simple Linear Model

```{r}
dat_dist_freq_di_AorTdi_bid13 = cbind(dat %>% select(all_of(ps2), all_of(trinucleotides), C0_new), 
                                      (fourier_di_cos_6)^2, (fourier_di_sin_6)^2, 
                                      (fourier_6_mod)^2, dist_freq_di_AorTdi_bid)

dist_freq_di_AorTdi_bid13_lm = lm(C0_new~., data=dat_dist_freq_di_AorTdi_bid13)
cor(dist_freq_di_AorTdi_bid13_lm$fitted.values, y)
# 0.6418021

dat_test_dist_freq_di_AorTdi_bid13 = cbind(dat_test %>% select(all_of(ps2), all_of(trinucleotides), C0_new), 
                                           (fourier_di_cos_6_test)^2, (fourier_di_sin_6_test)^2, 
                                           (fourier_6_mod_test)^2, dist_freq_di_AorTdi_bid_test)

dist_freq_di_AorTdi_bid13_pred = predict(dist_freq_di_AorTdi_bid13_lm, dat_test_dist_freq_di_AorTdi_bid13)

cor(dist_freq_di_AorTdi_bid13_pred, y_test)
# 0.6402

mean((dist_freq_di_AorTdi_bid13_pred - y_test)^2)
# 0.1422396
```

We get test prediction correlation of 0.6402 and MSE of 0.1422396

### LightGBM (tree-based) Model

```{r}
library(lightgbm)
source("scripts/functions/lgbm-helper-functions.R")
set.seed(50)
dat_dist_freq_di_AorTdi_bid13.lgb_train_set = dat_dist_freq_di_AorTdi_bid13 %>%
  select(-C0_new)
dat_dist_freq_di_AorTdi_bid13.lgb_train_rules = lgb.convert_with_rules(data = dat_dist_freq_di_AorTdi_bid13.lgb_train_set)
dat_dist_freq_di_AorTdi_bid13.lgb_train_data = lgb.Dataset(data = as.matrix(dat_dist_freq_di_AorTdi_bid13.lgb_train_rules$data),
                                                           label = dat_dist_freq_di_AorTdi_bid13$C0_new,
                                                           categorical_feature = handle_categorical(colnames(dat_dist_freq_di_AorTdi_bid13.lgb_train_rules$data)))
dat_dist_freq_di_AorTdi_bid13.lgb_test_set = dat_test_dist_freq_di_AorTdi_bid13 %>%
  select(-C0_new)
dat_dist_freq_di_AorTdi_bid13.lgb_test_matrix = as.matrix(lgb.convert_with_rules(data = dat_dist_freq_di_AorTdi_bid13.lgb_test_set, rules = dat_dist_freq_di_AorTdi_bid13.lgb_train_rules$rules)$data)
dat_dist_freq_di_AorTdi_bid13.lgb_test_data = lgb.Dataset(data = dat_dist_freq_di_AorTdi_bid13.lgb_test_matrix,
                                                          label = dat_test_dist_freq_di_AorTdi_bid13$C0_new,
                                                          categorical_feature = handle_categorical(colnames(dat_dist_freq_di_AorTdi_bid13.lgb_test_matrix)))
dat_dist_freq_di_AorTdi_bid13.lgb_obj = lightgbm(data = dat_dist_freq_di_AorTdi_bid13.lgb_train_data,
                                                 params = list(learning_rate = c(0.1),
                                                               objective = c("regression"),
                                                               min_data_in_leaf = 100,
                                                               max_depth = c(5),
                                                               num_leaves = c(1000),
                                                               lambda_l2 = c(1),
                                                               boosting = c("gbdt")),
                                                 valids = list(valid = dat_dist_freq_di_AorTdi_bid13.lgb_test_data),
                                                 nrounds = 8000,
                                                 early_stopping_rounds = 50)

dat_dist_freq_di_AorTdi_bid13.lgb_train_pred = predict(dat_dist_freq_di_AorTdi_bid13.lgb_obj, data = as.matrix(dat_dist_freq_di_AorTdi_bid13.lgb_train_rules$data))
cor(dat_dist_freq_di_AorTdi_bid13.lgb_train_pred, y, method="pearson")
# 0.9387428 (nrounds = 1305)

dat_dist_freq_di_AorTdi_bid13.lgb_test_pred = predict(dat_dist_freq_di_AorTdi_bid13.lgb_obj, data = dat_dist_freq_di_AorTdi_bid13.lgb_test_matrix)

cor(dat_dist_freq_di_AorTdi_bid13.lgb_test_pred, y_test, method="pearson")
# 0.6829651 (nrounds = 1305)

mean((dat_dist_freq_di_AorTdi_bid13.lgb_test_pred - y_test)^2)
# 0.1287776 (nrounds = 1305)
```

We get test prediction correlation of 0.6829651 and MSE of 0.1287776

```{r}
dat_dist_freq_di_AorTdi_bid13.feature_importance = as.data.frame(lgb.importance(dat_dist_freq_di_AorTdi_bid13.lgb_obj)) %>%
  mutate(Feature = fct_rev(fct_inorder(Feature))) %>%
  dplyr::slice(1:50) %>%
  ggplot(aes(x = Feature, y = Gain)) +
  geom_col(fill = "dodgerblue") +
  coord_flip() +
  theme_bw()
dat_dist_freq_di_AorTdi_bid13.feature_importance
```


# Inputs: Position Specific Dinucleotides + Counts of Trinucleotides + Fourier Features Based on all Dinucleotides with h=6 (period 9.8) + Modulus of Difference of Fourier Features Based on all Dinucleotides with h=6 (period 9.8) Calculated using fft + Distance Frequency Between Dinucleotides and AA/TT/AT/TA or CC/GG/CG/GC Dinucleotides + Markov Ratio

```{r}
ps2 <- paste0("X", 1:49, "di")

nucleotides <- c("A", "C", "G", "T")
dinucleotides <- gtools::permutations(n = 4, r = 2, v = nucleotides,
                                      repeats.allowed = TRUE) %>%
  apply(1, paste, collapse = "")
trinucleotides <- gtools::permutations(n = 4, r = 3, v = nucleotides,
                                       repeats.allowed = TRUE) %>%
  apply(1, paste, collapse = "")

fourier_di_cos = readRDS("data/Created/tiling_fourier_di_cos.rds")
fourier_di_sin = readRDS("data/Created/tiling_fourier_di_sin.rds")
fourier_di_cos_test = readRDS("data/Created/tiling_fourier_di_cos_test.rds")
fourier_di_sin_test = readRDS("data/Created/tiling_fourier_di_sin_test.rds")

fourier_di_cos_6 = as.data.frame(fourier_di_cos) %>% select(ends_with("_6"))
fourier_di_sin_6 = as.data.frame(fourier_di_sin) %>% select(ends_with("_6"))
fourier_di_cos_6_test = as.data.frame(fourier_di_cos_test) %>% select(ends_with("_6"))
fourier_di_sin_6_test = as.data.frame(fourier_di_sin_test) %>% select(ends_with("_6"))

fourier_6_mod = readRDS("data/Created/tiling_fourier_6_mod.rds")
fourier_6_mod_test = readRDS("data/Created/tiling_fourier_6_mod_test.rds")

dist_freq_di_AorTdi_bid = readRDS("data/Created/tiling_dist_freq_di_AorTdi_bid.rds")
dist_freq_di_AorTdi_bid_test = readRDS("data/Created/tiling_dist_freq_di_AorTdi_bid_test.rds")
```

## Squared value of Fourier features

### Simple Linear Model

```{r}
dat_dist_freq_di_AorTdi_bid14 = cbind(dat %>% select(all_of(ps2), 
                                                     all_of(trinucleotides), 
                                                     ratio_score_2nd, C0_new), 
                                      (fourier_di_cos_6)^2, (fourier_di_sin_6)^2, 
                                      (fourier_6_mod)^2, dist_freq_di_AorTdi_bid)

dist_freq_di_AorTdi_bid14_lm = lm(C0_new~., data=dat_dist_freq_di_AorTdi_bid14)
cor(dist_freq_di_AorTdi_bid14_lm$fitted.values, y)
# 0.6481513

dat_test_dist_freq_di_AorTdi_bid14 = cbind(dat_test %>% select(all_of(ps2), 
                                                               all_of(trinucleotides), 
                                                               ratio_score_2nd, C0_new), 
                                           (fourier_di_cos_6_test)^2, (fourier_di_sin_6_test)^2, 
                                           (fourier_6_mod_test)^2, dist_freq_di_AorTdi_bid_test)

dist_freq_di_AorTdi_bid14_pred = predict(dist_freq_di_AorTdi_bid14_lm, dat_test_dist_freq_di_AorTdi_bid14)

cor(dist_freq_di_AorTdi_bid14_pred, y_test)
# 0.6867112

mean((dist_freq_di_AorTdi_bid14_pred - y_test)^2)
# 0.1303492
```

We get test prediction correlation of 0.6867112 and MSE of 0.1303492

### LightGBM (tree-based) Model

```{r}
library(lightgbm)
source("scripts/functions/lgbm-helper-functions.R")
set.seed(50)
dat_dist_freq_di_AorTdi_bid14.lgb_train_set = dat_dist_freq_di_AorTdi_bid14 %>%
  select(-C0_new)
dat_dist_freq_di_AorTdi_bid14.lgb_train_rules = lgb.convert_with_rules(data = dat_dist_freq_di_AorTdi_bid14.lgb_train_set)
dat_dist_freq_di_AorTdi_bid14.lgb_train_data = lgb.Dataset(data = as.matrix(dat_dist_freq_di_AorTdi_bid14.lgb_train_rules$data),
                                                           label = dat_dist_freq_di_AorTdi_bid14$C0_new,
                                                           categorical_feature = handle_categorical(colnames(dat_dist_freq_di_AorTdi_bid14.lgb_train_rules$data)))
dat_dist_freq_di_AorTdi_bid14.lgb_test_set = dat_test_dist_freq_di_AorTdi_bid14 %>%
  select(-C0_new)
dat_dist_freq_di_AorTdi_bid14.lgb_test_matrix = as.matrix(lgb.convert_with_rules(data = dat_dist_freq_di_AorTdi_bid14.lgb_test_set, rules = dat_dist_freq_di_AorTdi_bid14.lgb_train_rules$rules)$data)
dat_dist_freq_di_AorTdi_bid14.lgb_test_data = lgb.Dataset(data = dat_dist_freq_di_AorTdi_bid14.lgb_test_matrix,
                                                          label = dat_test_dist_freq_di_AorTdi_bid14$C0_new,
                                                          categorical_feature = handle_categorical(colnames(dat_dist_freq_di_AorTdi_bid14.lgb_test_matrix)))
dat_dist_freq_di_AorTdi_bid14.lgb_obj = lightgbm(data = dat_dist_freq_di_AorTdi_bid14.lgb_train_data,
                                                 params = list(learning_rate = c(0.1),
                                                               objective = c("regression"),
                                                               min_data_in_leaf = 100,
                                                               max_depth = c(5),
                                                               num_leaves = c(1000),
                                                               lambda_l2 = c(1),
                                                               boosting = c("gbdt")),
                                                 valids = list(valid = dat_dist_freq_di_AorTdi_bid14.lgb_test_data),
                                                 nrounds = 8000,
                                                 early_stopping_rounds = 50)

dat_dist_freq_di_AorTdi_bid14.lgb_train_pred = predict(dat_dist_freq_di_AorTdi_bid14.lgb_obj, data = as.matrix(dat_dist_freq_di_AorTdi_bid14.lgb_train_rules$data))
cor(dat_dist_freq_di_AorTdi_bid14.lgb_train_pred, y, method="pearson")
# 0.913258 (nrounds = 1002)

dat_dist_freq_di_AorTdi_bid14.lgb_test_pred = predict(dat_dist_freq_di_AorTdi_bid14.lgb_obj, data = dat_dist_freq_di_AorTdi_bid14.lgb_test_matrix)

cor(dat_dist_freq_di_AorTdi_bid14.lgb_test_pred, y_test, method="pearson")
# 0.7131962 (nrounds = 1002)

mean((dat_dist_freq_di_AorTdi_bid14.lgb_test_pred - y_test)^2)
# 0.119591 (nrounds = 1002)
```

We get test prediction correlation of 0.7131962 and MSE of 0.119591

```{r}
dat_dist_freq_di_AorTdi_bid14.feature_importance = as.data.frame(lgb.importance(dat_dist_freq_di_AorTdi_bid14.lgb_obj)) %>%
  mutate(Feature = fct_rev(fct_inorder(Feature))) %>%
  dplyr::slice(1:50) %>%
  ggplot(aes(x = Feature, y = Gain)) +
  geom_col(fill = "dodgerblue") +
  coord_flip() +
  theme_bw()
dat_dist_freq_di_AorTdi_bid14.feature_importance
```


# Inputs: Position Specific Dinucleotides + Counts of Trinucleotides + Fourier Features Based on all Dinucleotides + Modulus of Difference of Fourier Features Based on all Dinucleotides with h=6 (period 9.8) Calculated using fft + Distance Frequency Between Dinucleotides and AA/TT/AT/TA or CC/GG/CG/GC Dinucleotides

```{r}
library(Matrix)
library(glmnet)

ps2 <- paste0("X", 1:49, "di")

nucleotides <- c("A", "C", "G", "T")
dinucleotides <- gtools::permutations(n = 4, r = 2, v = nucleotides,
                                      repeats.allowed = TRUE) %>%
  apply(1, paste, collapse = "")
trinucleotides <- gtools::permutations(n = 4, r = 3, v = nucleotides,
                                       repeats.allowed = TRUE) %>%
  apply(1, paste, collapse = "")

fourier_di_cos = readRDS("data/Created/tiling_fourier_di_cos.rds")
fourier_di_sin = readRDS("data/Created/tiling_fourier_di_sin.rds")
fourier_di_cos_test = readRDS("data/Created/tiling_fourier_di_cos_test.rds")
fourier_di_sin_test = readRDS("data/Created/tiling_fourier_di_sin_test.rds")

fourier_6_mod = readRDS("data/Created/tiling_fourier_6_mod.rds")
fourier_6_mod_test = readRDS("data/Created/tiling_fourier_6_mod_test.rds")

dist_freq_di_AorTdi_bid = readRDS("data/Created/tiling_dist_freq_di_AorTdi_bid.rds")
dist_freq_di_AorTdi_bid_test = readRDS("data/Created/tiling_dist_freq_di_AorTdi_bid_test.rds")
```

## Squared value of Fourier features

### Simple Linear Model

```{r}
dat_dist_freq_di_AorTdi_bid15 = cbind(dat %>% select(all_of(ps2), all_of(trinucleotides), C0_new), 
                                      (fourier_di_cos)^2, (fourier_di_sin)^2, 
                                      (fourier_6_mod)^2, dist_freq_di_AorTdi_bid)

dist_freq_di_AorTdi_bid15_lm = lm(C0_new~., data=dat_dist_freq_di_AorTdi_bid15)
cor(dist_freq_di_AorTdi_bid15_lm$fitted.values, y)
# 0.6602164

dat_test_dist_freq_di_AorTdi_bid15 = cbind(dat_test %>% select(all_of(ps2), all_of(trinucleotides), C0_new), 
                                           (fourier_di_cos_test)^2, (fourier_di_sin_test)^2, 
                                           (fourier_6_mod_test)^2, dist_freq_di_AorTdi_bid_test)

dist_freq_di_AorTdi_bid15_pred = predict(dist_freq_di_AorTdi_bid15_lm, dat_test_dist_freq_di_AorTdi_bid15)

cor(dist_freq_di_AorTdi_bid15_pred, y_test)
# 0.6502064

mean((dist_freq_di_AorTdi_bid15_pred - y_test)^2)
# 0.1391734
```

We get test prediction correlation of 0.6502064 and MSE of 0.1391734

### LightGBM (tree-based) Model

```{r}
library(lightgbm)
source("scripts/functions/lgbm-helper-functions.R")
set.seed(50)
dat_dist_freq_di_AorTdi_bid15.lgb_train_set = dat_dist_freq_di_AorTdi_bid15 %>%
  select(-C0_new)
dat_dist_freq_di_AorTdi_bid15.lgb_train_rules = lgb.convert_with_rules(data = dat_dist_freq_di_AorTdi_bid15.lgb_train_set)
dat_dist_freq_di_AorTdi_bid15.lgb_train_data = lgb.Dataset(data = as.matrix(dat_dist_freq_di_AorTdi_bid15.lgb_train_rules$data),
                                                           label = dat_dist_freq_di_AorTdi_bid15$C0_new,
                                                           categorical_feature = handle_categorical(colnames(dat_dist_freq_di_AorTdi_bid15.lgb_train_rules$data)))
dat_dist_freq_di_AorTdi_bid15.lgb_test_set = dat_test_dist_freq_di_AorTdi_bid15 %>%
  select(-C0_new)
dat_dist_freq_di_AorTdi_bid15.lgb_test_matrix = as.matrix(lgb.convert_with_rules(data = dat_dist_freq_di_AorTdi_bid15.lgb_test_set, rules = dat_dist_freq_di_AorTdi_bid15.lgb_train_rules$rules)$data)
dat_dist_freq_di_AorTdi_bid15.lgb_test_data = lgb.Dataset(data = dat_dist_freq_di_AorTdi_bid15.lgb_test_matrix,
                                                          label = dat_test_dist_freq_di_AorTdi_bid15$C0_new,
                                                          categorical_feature = handle_categorical(colnames(dat_dist_freq_di_AorTdi_bid15.lgb_test_matrix)))
dat_dist_freq_di_AorTdi_bid15.lgb_obj = lightgbm(data = dat_dist_freq_di_AorTdi_bid15.lgb_train_data,
                                                 params = list(learning_rate = c(0.1),
                                                               objective = c("regression"),
                                                               min_data_in_leaf = 100,
                                                               max_depth = c(5),
                                                               num_leaves = c(1000),
                                                               lambda_l2 = c(1),
                                                               boosting = c("gbdt")),
                                                 valids = list(valid = dat_dist_freq_di_AorTdi_bid15.lgb_test_data),
                                                 nrounds = 8000,
                                                 early_stopping_rounds = 50)

dat_dist_freq_di_AorTdi_bid15.lgb_train_pred = predict(dat_dist_freq_di_AorTdi_bid15.lgb_obj, data = as.matrix(dat_dist_freq_di_AorTdi_bid15.lgb_train_rules$data))
cor(dat_dist_freq_di_AorTdi_bid15.lgb_train_pred, y, method="pearson")
# 0.9458571 (nrounds = 1341)

dat_dist_freq_di_AorTdi_bid15.lgb_test_pred = predict(dat_dist_freq_di_AorTdi_bid15.lgb_obj, data = dat_dist_freq_di_AorTdi_bid15.lgb_test_matrix)

cor(dat_dist_freq_di_AorTdi_bid15.lgb_test_pred, y_test, method="pearson")
# 0.6795563 (nrounds = 1341)

mean((dat_dist_freq_di_AorTdi_bid15.lgb_test_pred - y_test)^2)
# 0.1299081 (nrounds = 1341)
```

We get test prediction correlation of 0.6795563 and MSE of 0.1299081

```{r}
dat_dist_freq_di_AorTdi_bid15.feature_importance = as.data.frame(lgb.importance(dat_dist_freq_di_AorTdi_bid15.lgb_obj)) %>%
  mutate(Feature = fct_rev(fct_inorder(Feature))) %>%
  dplyr::slice(1:50) %>%
  ggplot(aes(x = Feature, y = Gain)) +
  geom_col(fill = "dodgerblue") +
  coord_flip() +
  theme_bw()
dat_dist_freq_di_AorTdi_bid15.feature_importance
```


# Inputs: All Distance Frequency Between Dinucleotides and AA/TT/AT/TA or CC/GG/CG/GC Dinucleotides Only

```{r}
library(Matrix)
library(glmnet)
library(sparsegl)

dist_freq_di_AorTdi_bid2 = readRDS("data/Created/tiling_dist_freq_di_AorTdi_bid2.rds")
dist_freq_di_CorGdi_bid2 = readRDS("data/Created/tiling_dist_freq_di_CorGdi_bid2.rds")
dist_freq_di_AorTdi_bid2_test = readRDS("data/Created/tiling_dist_freq_di_AorTdi_bid2_test.rds")
dist_freq_di_CorGdi_bid2_test = readRDS("data/Created/tiling_dist_freq_di_CorGdi_bid2_test.rds")

dist_freq_di_AorTdi_bid2_random_all = readRDS("data/Created/random_all_dist_freq_di_AorTdi_bid2.rds")
dist_freq_di_CorGdi_bid2_random_all = readRDS("data/Created/random_all_dist_freq_di_CorGdi_bid2.rds")
```

## Simple Linear Model

```{r}
dat_all_dist_freq_di_AorTdi_bid = cbind(dist_freq_di_AorTdi_bid2,
                                        dist_freq_di_CorGdi_bid2,
                                        dat %>% select(C0_new))

all_dist_freq_di_AorTdi_bid_lm = lm(C0_new~., data=dat_all_dist_freq_di_AorTdi_bid)
cor(all_dist_freq_di_AorTdi_bid_lm$fitted.values, y)
# 0.7324237

dat_test_all_dist_freq_di_AorTdi_bid = cbind(dist_freq_di_AorTdi_bid2_test,
                                             dist_freq_di_CorGdi_bid2_test,
                                             dat_test %>% select(C0_new))

all_dist_freq_di_AorTdi_bid_pred = predict(all_dist_freq_di_AorTdi_bid_lm, dat_test_all_dist_freq_di_AorTdi_bid)

cor(all_dist_freq_di_AorTdi_bid_pred, y_test)
# 0.7304727

mean((all_dist_freq_di_AorTdi_bid_pred - y_test)^2)
# 0.1124425

dat_random_all_dist_freq_di_AorTdi_bid = cbind(dist_freq_di_AorTdi_bid2_random_all,
                                               dist_freq_di_CorGdi_bid2_random_all,
                                               dat_random_all %>% select(C0_new))

random_all_dist_freq_di_AorTdi_bid_pred = predict(all_dist_freq_di_AorTdi_bid_lm, dat_random_all_dist_freq_di_AorTdi_bid)

cor(random_all_dist_freq_di_AorTdi_bid_pred, y_random_all)
# 0.6490919
```

We get test prediction correlation of 0.7304727 and MSE of 0.1124425
We get prediction correlation of 0.6490919 on the random library

## Lasso Model

```{r}
X_all_dist_freq_di_AorTdi_bid = dat_all_dist_freq_di_AorTdi_bid %>%
  select(-C0_new)

x_all_dist_freq_di_AorTdi_bid = sparse.model.matrix(~., data=X_all_dist_freq_di_AorTdi_bid)

set.seed(50)
la.model_all_dist_freq_di_AorTdi_bid = cv.glmnet(x_all_dist_freq_di_AorTdi_bid, y, alpha=1, family="gaussian")

la.all_dist_freq_di_AorTdi_bid_best_lambda = la.model_all_dist_freq_di_AorTdi_bid$lambda.min

sum(coef(la.model_all_dist_freq_di_AorTdi_bid, s=la.all_dist_freq_di_AorTdi_bid_best_lambda) != 0)
# 1406

la.all_dist_freq_di_AorTdi_bid_lambda_1se = la.model_all_dist_freq_di_AorTdi_bid$lambda.1se

sum(coef(la.model_all_dist_freq_di_AorTdi_bid, s=la.all_dist_freq_di_AorTdi_bid_lambda_1se) != 0)
# 1043

saveRDS(la.model_all_dist_freq_di_AorTdi_bid, "model/lasso-all_dist_freq_di_AorTdi_bid.rds")

la.model_all_dist_freq_di_AorTdi_bid.train_pred = predict(la.model_all_dist_freq_di_AorTdi_bid, newx = x_all_dist_freq_di_AorTdi_bid, s=la.all_dist_freq_di_AorTdi_bid_best_lambda)

cor(la.model_all_dist_freq_di_AorTdi_bid.train_pred, y, method="pearson")
# 0.7318081
mean((la.model_all_dist_freq_di_AorTdi_bid.train_pred - y)^2)
# 0.1125691

la.model_all_dist_freq_di_AorTdi_bid.train_pred2 = predict(la.model_all_dist_freq_di_AorTdi_bid, newx = x_all_dist_freq_di_AorTdi_bid, s=la.all_dist_freq_di_AorTdi_bid_lambda_1se)

cor(la.model_all_dist_freq_di_AorTdi_bid.train_pred2, y, method="pearson")
# 0.7262384
mean((la.model_all_dist_freq_di_AorTdi_bid.train_pred2 - y)^2)
# 0.1147511

X_all_dist_freq_di_AorTdi_bid_test = dat_test_all_dist_freq_di_AorTdi_bid %>%
  select(-C0_new)
x_all_dist_freq_di_AorTdi_bid_test = sparse.model.matrix(~., data=X_all_dist_freq_di_AorTdi_bid_test)

# Predict values for test dataset:
la.model_all_dist_freq_di_AorTdi_bid.pred = predict(la.model_all_dist_freq_di_AorTdi_bid, newx = x_all_dist_freq_di_AorTdi_bid_test, s=la.all_dist_freq_di_AorTdi_bid_best_lambda)
# Prediction accuracy with test data:
cor(la.model_all_dist_freq_di_AorTdi_bid.pred, y_test, method="pearson")
# 0.7302937
mean((la.model_all_dist_freq_di_AorTdi_bid.pred - y_test)^2)
# 0.1124889

la.model_all_dist_freq_di_AorTdi_bid.pred2 = predict(la.model_all_dist_freq_di_AorTdi_bid, newx = x_all_dist_freq_di_AorTdi_bid_test, s=la.all_dist_freq_di_AorTdi_bid_lambda_1se)
# Prediction accuracy with test data:
cor(la.model_all_dist_freq_di_AorTdi_bid.pred2, y_test, method="pearson")
# 0.7256155
mean((la.model_all_dist_freq_di_AorTdi_bid.pred2 - y_test)^2)
# 0.1142668


X_all_dist_freq_di_AorTdi_bid_random_all = dat_random_all_dist_freq_di_AorTdi_bid %>%
  select(-C0_new)
x_all_dist_freq_di_AorTdi_bid_random_all = sparse.model.matrix(~., data=X_all_dist_freq_di_AorTdi_bid_random_all)

# Predict values for random dataset:
la.model_all_dist_freq_di_AorTdi_bid.pred_random_all = predict(la.model_all_dist_freq_di_AorTdi_bid, newx = x_all_dist_freq_di_AorTdi_bid_random_all, s=la.all_dist_freq_di_AorTdi_bid_best_lambda)
# Prediction accuracy with random data:
cor(la.model_all_dist_freq_di_AorTdi_bid.pred_random_all, y_random_all, method="pearson")
# 0.648069
mean((la.model_all_dist_freq_di_AorTdi_bid.pred_random_all - y_random_all)^2)
# 0.08598576

la.model_all_dist_freq_di_AorTdi_bid.pred2_random_all = predict(la.model_all_dist_freq_di_AorTdi_bid, newx = x_all_dist_freq_di_AorTdi_bid_random_all, s=la.all_dist_freq_di_AorTdi_bid_lambda_1se)
# Prediction accuracy with random data:
cor(la.model_all_dist_freq_di_AorTdi_bid.pred2_random_all, y_random_all, method="pearson")
# 0.6440565
mean((la.model_all_dist_freq_di_AorTdi_bid.pred2_random_all - y_random_all)^2)
# 0.08595627
```

We get test prediction correlation of 0.7302937 and MSE of 0.1124889 with min lasso (1406 nonzero)
We get test prediction correlation of 0.7256155 and MSE of 0.1142668 with lasso 1se (1043 nonzero)
We get prediction correlation of 0.648069 on the random library with min lasso
We get prediction correlation of 0.6440565 on the random library with lasso 1se

## Group Lasso Model

### Groupings based on pairs of Dinucleotides and Dinucleotide Groups (32 groups)

```{r}
X_all_dist_freq_di_AorTdi_bid = dat_all_dist_freq_di_AorTdi_bid %>%
  select(-C0_new)

x_all_dist_freq_di_AorTdi_bid = sparse.model.matrix(~., data=X_all_dist_freq_di_AorTdi_bid)

gla.di_groups_all_dist_freq_di_AorTdi_bid = c(1, rep(2:17, times=47), rep(18:33, times=47))

set.seed(50)
gla.model_all_dist_freq_di_AorTdi_bid = cv.sparsegl(x_all_dist_freq_di_AorTdi_bid, y, group=gla.di_groups_all_dist_freq_di_AorTdi_bid, family="gaussian")

gla.all_dist_freq_di_AorTdi_bid_best_lambda = gla.model_all_dist_freq_di_AorTdi_bid$lambda.min

sum(coef(gla.model_all_dist_freq_di_AorTdi_bid, s=gla.all_dist_freq_di_AorTdi_bid_best_lambda) != 0)
# 1505

gla.all_dist_freq_di_AorTdi_bid_lambda_1se = gla.model_all_dist_freq_di_AorTdi_bid$lambda.1se

sum(coef(gla.model_all_dist_freq_di_AorTdi_bid, s=gla.all_dist_freq_di_AorTdi_bid_lambda_1se) != 0)
# 1505

saveRDS(gla.model_all_dist_freq_di_AorTdi_bid, "model/group-lasso-all_dist_freq_di_AorTdi_bid.rds")

gla.model_all_dist_freq_di_AorTdi_bid.train_pred = predict(gla.model_all_dist_freq_di_AorTdi_bid, newx = x_all_dist_freq_di_AorTdi_bid, s=gla.all_dist_freq_di_AorTdi_bid_best_lambda)

cor(gla.model_all_dist_freq_di_AorTdi_bid.train_pred, y, method="pearson")
# 0.7247211
mean((gla.model_all_dist_freq_di_AorTdi_bid.train_pred - y)^2)
# 0.1151216

gla.model_all_dist_freq_di_AorTdi_bid.train_pred2 = predict(gla.model_all_dist_freq_di_AorTdi_bid, newx = x_all_dist_freq_di_AorTdi_bid, s=gla.all_dist_freq_di_AorTdi_bid_lambda_1se)

cor(gla.model_all_dist_freq_di_AorTdi_bid.train_pred2, y, method="pearson")
# 0.7245491
mean((gla.model_all_dist_freq_di_AorTdi_bid.train_pred2 - y)^2)
# 0.1151846

X_all_dist_freq_di_AorTdi_bid_test = dat_test_all_dist_freq_di_AorTdi_bid %>%
  select(-C0_new)
x_all_dist_freq_di_AorTdi_bid_test = sparse.model.matrix(~., data=X_all_dist_freq_di_AorTdi_bid_test)

# Predict values for test dataset:
gla.model_all_dist_freq_di_AorTdi_bid.pred = predict(gla.model_all_dist_freq_di_AorTdi_bid, newx = x_all_dist_freq_di_AorTdi_bid_test, s=gla.all_dist_freq_di_AorTdi_bid_best_lambda)

# Prediction accuracy with test data:
cor(gla.model_all_dist_freq_di_AorTdi_bid.pred, y_test, method="pearson")
# 0.7229605
mean((gla.model_all_dist_freq_di_AorTdi_bid.pred - y_test)^2)
# 0.1150787

gla.model_all_dist_freq_di_AorTdi_bid.pred2 = predict(gla.model_all_dist_freq_di_AorTdi_bid, newx = x_all_dist_freq_di_AorTdi_bid_test, s=gla.all_dist_freq_di_AorTdi_bid_lambda_1se)

# Prediction accuracy with test data:
cor(gla.model_all_dist_freq_di_AorTdi_bid.pred2, y_test, method="pearson")
# 0.7227915
mean((gla.model_all_dist_freq_di_AorTdi_bid.pred2 - y_test)^2)
# 0.1151392

X_all_dist_freq_di_AorTdi_bid_random_all = dat_random_all_dist_freq_di_AorTdi_bid %>%
  select(-C0_new)
x_all_dist_freq_di_AorTdi_bid_random_all = sparse.model.matrix(~., data=X_all_dist_freq_di_AorTdi_bid_random_all)

# Predict values for random dataset:
gla.model_all_dist_freq_di_AorTdi_bid.pred_random_all = predict(gla.model_all_dist_freq_di_AorTdi_bid, newx = x_all_dist_freq_di_AorTdi_bid_random_all, s=gla.all_dist_freq_di_AorTdi_bid_best_lambda)

# Prediction accuracy with random data:
cor(gla.model_all_dist_freq_di_AorTdi_bid.pred_random_all, y_random_all, method="pearson")
# 0.6423178

mean((gla.model_all_dist_freq_di_AorTdi_bid.pred_random_all - y_random_all)^2)
# 0.08711482

gla.model_all_dist_freq_di_AorTdi_bid.pred2_random_all = predict(gla.model_all_dist_freq_di_AorTdi_bid, newx = x_all_dist_freq_di_AorTdi_bid_random_all, s=gla.all_dist_freq_di_AorTdi_bid_lambda_1se)

# Prediction accuracy with random data:
cor(gla.model_all_dist_freq_di_AorTdi_bid.pred2_random_all, y_random_all, method="pearson")
# 0.6421834

mean((gla.model_all_dist_freq_di_AorTdi_bid.pred2_random_all - y_random_all)^2)
# 0.08713387
```

We get test prediction correlation of 0.7229605 and MSE of 0.1150787 with min lasso (1505 nonzero)
We get test prediction correlation of 0.7227915 and MSE of 0.1151392 with lasso 1se (1505 nonzero)
We get prediction correlation of 0.6423178 on the random library with min lasso
We get prediction correlation of 0.6421834 on the random library with lasso 1se


### Groupings based on distances (47 groups)

```{r}
# X_all_dist_freq_di_AorTdi_bid = dat_all_dist_freq_di_AorTdi_bid %>%
#   select(-C0_new)
# 
# x_all_dist_freq_di_AorTdi_bid = sparse.model.matrix(~., data=X_all_dist_freq_di_AorTdi_bid)

gla2.di_groups_all_dist_freq_di_AorTdi_bid = c(1, rep(2:48, each=16), rep(2:48, each=16))

set.seed(50)
gla2.model_all_dist_freq_di_AorTdi_bid = cv.sparsegl(x_all_dist_freq_di_AorTdi_bid, y, group=gla2.di_groups_all_dist_freq_di_AorTdi_bid, family="gaussian")

gla2.all_dist_freq_di_AorTdi_bid_best_lambda = gla2.model_all_dist_freq_di_AorTdi_bid$lambda.min

sum(coef(gla2.model_all_dist_freq_di_AorTdi_bid, s=gla2.all_dist_freq_di_AorTdi_bid_best_lambda) != 0)
# 1505

gla2.all_dist_freq_di_AorTdi_bid_lambda_1se = gla2.model_all_dist_freq_di_AorTdi_bid$lambda.1se

sum(coef(gla2.model_all_dist_freq_di_AorTdi_bid, s=gla2.all_dist_freq_di_AorTdi_bid_lambda_1se) != 0)
# 1505

saveRDS(gla2.model_all_dist_freq_di_AorTdi_bid, "model/group-lasso-2-all_dist_freq_di_AorTdi_bid.rds")

gla2.model_all_dist_freq_di_AorTdi_bid.train_pred = predict(gla2.model_all_dist_freq_di_AorTdi_bid, newx = x_all_dist_freq_di_AorTdi_bid, s=gla2.all_dist_freq_di_AorTdi_bid_best_lambda)

cor(gla2.model_all_dist_freq_di_AorTdi_bid.train_pred, y, method="pearson")
# 0.7259207

mean((gla2.model_all_dist_freq_di_AorTdi_bid.train_pred - y)^2)
# 0.1146722

gla2.model_all_dist_freq_di_AorTdi_bid.train_pred2 = predict(gla2.model_all_dist_freq_di_AorTdi_bid, newx = x_all_dist_freq_di_AorTdi_bid, s=gla2.all_dist_freq_di_AorTdi_bid_lambda_1se)

cor(gla2.model_all_dist_freq_di_AorTdi_bid.train_pred2, y, method="pearson")
# 0.7259207
mean((gla2.model_all_dist_freq_di_AorTdi_bid.train_pred2 - y)^2)
# 0.1146722

# X_all_dist_freq_di_AorTdi_bid_test = dat_test_all_dist_freq_di_AorTdi_bid %>%
#   select(-C0_new)
# x_all_dist_freq_di_AorTdi_bid_test = sparse.model.matrix(~., data=X_all_dist_freq_di_AorTdi_bid_test)

# Predict values for test dataset:
gla2.model_all_dist_freq_di_AorTdi_bid.pred = predict(gla2.model_all_dist_freq_di_AorTdi_bid, newx = x_all_dist_freq_di_AorTdi_bid_test, s=gla2.all_dist_freq_di_AorTdi_bid_best_lambda)

# Prediction accuracy with test data:
cor(gla2.model_all_dist_freq_di_AorTdi_bid.pred, y_test, method="pearson")
# 0.7238293

mean((gla2.model_all_dist_freq_di_AorTdi_bid.pred - y_test)^2)
# 0.114757

gla2.model_all_dist_freq_di_AorTdi_bid.pred2 = predict(gla2.model_all_dist_freq_di_AorTdi_bid, newx = x_all_dist_freq_di_AorTdi_bid_test, s=gla2.all_dist_freq_di_AorTdi_bid_lambda_1se)

# Prediction accuracy with test data:
cor(gla2.model_all_dist_freq_di_AorTdi_bid.pred2, y_test, method="pearson")
# 0.7238293

mean((gla2.model_all_dist_freq_di_AorTdi_bid.pred2 - y_test)^2)
# 0.114757

# Predict values for random dataset:
gla2.model_all_dist_freq_di_AorTdi_bid.pred_random_all = predict(gla2.model_all_dist_freq_di_AorTdi_bid, newx = x_all_dist_freq_di_AorTdi_bid_random_all, s=gla2.all_dist_freq_di_AorTdi_bid_best_lambda)

# Prediction accuracy with random data:
cor(gla2.model_all_dist_freq_di_AorTdi_bid.pred_random_all, y_random_all, method="pearson")
# 0.6434471

mean((gla2.model_all_dist_freq_di_AorTdi_bid.pred_random_all - y_random_all)^2)
# 0.0869869

gla2.model_all_dist_freq_di_AorTdi_bid.pred2_random_all = predict(gla2.model_all_dist_freq_di_AorTdi_bid, newx = x_all_dist_freq_di_AorTdi_bid_random_all, s=gla2.all_dist_freq_di_AorTdi_bid_lambda_1se)

# Prediction accuracy with random data:
cor(gla2.model_all_dist_freq_di_AorTdi_bid.pred2_random_all, y_random_all, method="pearson")
# 0.6434471

mean((gla2.model_all_dist_freq_di_AorTdi_bid.pred2_random_all - y_random_all)^2)
# 0.0869869
```

We get test prediction correlation of 0.7238293 and MSE of 0.114757 with min lasso (1505 nonzero)
We get test prediction correlation of 0.7238293 and MSE of 0.114757 with lasso 1se (1505 nonzero)
We get prediction correlation of 0.6434471 on the random library with min lasso
We get prediction correlation of 0.6434471 on the random library with lasso 1se

## LightGBM (tree-based) Model

```{r}
library(lightgbm)
source("scripts/functions/lgbm-helper-functions.R")
set.seed(50)
dat_all_dist_freq_di_AorTdi_bid.lgb_train_set = dat_all_dist_freq_di_AorTdi_bid %>%
  select(-C0_new)
dat_all_dist_freq_di_AorTdi_bid.lgb_train_rules = lgb.convert_with_rules(data = dat_all_dist_freq_di_AorTdi_bid.lgb_train_set)
dat_all_dist_freq_di_AorTdi_bid.lgb_train_data = lgb.Dataset(data = as.matrix(dat_all_dist_freq_di_AorTdi_bid.lgb_train_rules$data),
                                                             label = dat_all_dist_freq_di_AorTdi_bid$C0_new,
                                                             categorical_feature = handle_categorical(colnames(dat_all_dist_freq_di_AorTdi_bid.lgb_train_rules$data)))
dat_all_dist_freq_di_AorTdi_bid.lgb_test_set = dat_test_all_dist_freq_di_AorTdi_bid %>%
  select(-C0_new)
dat_all_dist_freq_di_AorTdi_bid.lgb_test_matrix = as.matrix(lgb.convert_with_rules(data = dat_all_dist_freq_di_AorTdi_bid.lgb_test_set, rules = dat_all_dist_freq_di_AorTdi_bid.lgb_train_rules$rules)$data)
dat_all_dist_freq_di_AorTdi_bid.lgb_test_data = lgb.Dataset(data = dat_all_dist_freq_di_AorTdi_bid.lgb_test_matrix,
                                                            label = dat_test_all_dist_freq_di_AorTdi_bid$C0_new,
                                                            categorical_feature = handle_categorical(colnames(dat_all_dist_freq_di_AorTdi_bid.lgb_test_matrix)))
dat_all_dist_freq_di_AorTdi_bid.lgb_obj = lightgbm(data = dat_all_dist_freq_di_AorTdi_bid.lgb_train_data,
                                                   params = list(learning_rate = c(0.1),
                                                                 objective = c("regression"),
                                                                 min_data_in_leaf = 100,
                                                                 max_depth = c(5),
                                                                 num_leaves = c(1000),
                                                                 lambda_l2 = c(1),
                                                                 boosting = c("gbdt")),
                                                   valids = list(valid = dat_all_dist_freq_di_AorTdi_bid.lgb_test_data),
                                                   nrounds = 8000,
                                                   early_stopping_rounds = 50)

dat_all_dist_freq_di_AorTdi_bid.lgb_train_pred = predict(dat_all_dist_freq_di_AorTdi_bid.lgb_obj, data = as.matrix(dat_all_dist_freq_di_AorTdi_bid.lgb_train_rules$data))
cor(dat_all_dist_freq_di_AorTdi_bid.lgb_train_pred, y, method="pearson")
# 0.9863918 (nrounds = 5436)

dat_all_dist_freq_di_AorTdi_bid.lgb_test_pred = predict(dat_all_dist_freq_di_AorTdi_bid.lgb_obj, data = dat_all_dist_freq_di_AorTdi_bid.lgb_test_matrix)

cor(dat_all_dist_freq_di_AorTdi_bid.lgb_test_pred, y_test, method="pearson")
# 0.7693199 (nrounds = 5436)

mean((dat_all_dist_freq_di_AorTdi_bid.lgb_test_pred - y_test)^2)
# 0.09856109 (nrounds = 5436)
```

We get test prediction correlation of 0.7693199 and MSE of 0.09856109

```{r}
dat_all_dist_freq_di_AorTdi_bid.feature_importance = as.data.frame(lgb.importance(dat_all_dist_freq_di_AorTdi_bid.lgb_obj)) %>%
  mutate(Feature = fct_rev(fct_inorder(Feature))) %>%
  dplyr::slice(1:50) %>%
  ggplot(aes(x = Feature, y = Gain)) +
  geom_col(fill = "dodgerblue") +
  coord_flip() +
  theme_bw()
dat_all_dist_freq_di_AorTdi_bid.feature_importance
```

## Lasso

```{r}
X_all_dist_freq_di_AorTdi_bid = dat_all_dist_freq_di_AorTdi_bid %>% select(-C0_new)
x_all_dist_freq_di_AorTdi_bid = sparse.model.matrix(~., data=X_all_dist_freq_di_AorTdi_bid)

set.seed(50)
la.model_all_dist_freq_di_AorTdi_bid = cv.glmnet(x_all_dist_freq_di_AorTdi_bid, y,
                                                 alpha=1, family="gaussian")

saveRDS(la.model_all_dist_freq_di_AorTdi_bid, "model/lasso_all_dist_freq_di_AorTdi_bid.rds")

la.all_dist_freq_di_AorTdi_bid_best_lambda = la.model_all_dist_freq_di_AorTdi_bid$lambda.min
la.all_dist_freq_di_AorTdi_bid_best_lambda

la.all_dist_freq_di_AorTdi_bid_coefs = coef(la.model_all_dist_freq_di_AorTdi_bid, 
                                            s=la.all_dist_freq_di_AorTdi_bid_best_lambda)

la.model_all_dist_freq_di_AorTdi_bid.train_pred = predict(la.model_all_dist_freq_di_AorTdi_bid, 
                                                          newx = x_all_dist_freq_di_AorTdi_bid, 
                                                          s=la.all_dist_freq_di_AorTdi_bid_best_lambda)

cor(la.model_all_dist_freq_di_AorTdi_bid.train_pred, y, method="pearson")
# 0.7318081
mean((la.model_all_dist_freq_di_AorTdi_bid.train_pred - y)^2)
# 0.1125691

# Prepare test data:
X_all_dist_freq_di_AorTdi_bid_test = dat_test_all_dist_freq_di_AorTdi_bid %>% select(-C0_new)
x_all_dist_freq_di_AorTdi_bid_test = sparse.model.matrix(~., data=X_all_dist_freq_di_AorTdi_bid_test)

# Predict values for test dataset:
la.model_all_dist_freq_di_AorTdi_bid.pred = predict(la.model_all_dist_freq_di_AorTdi_bid, 
                                                    newx = x_all_dist_freq_di_AorTdi_bid_test,
                                                    s=la.all_dist_freq_di_AorTdi_bid_best_lambda)

cor(la.model_all_dist_freq_di_AorTdi_bid.pred, y_test, method="pearson")
# 0.7302937
mean((la.model_all_dist_freq_di_AorTdi_bid.pred - y_test)^2)
# 0.1124889

```




# Inputs: All Distance Frequency Between Dinucleotides and AA/TT/AT/TA or CC/GG/CG/GC Dinucleotides + Poly A/T Features

```{r}
library(Matrix)
library(glmnet)
library(sparsegl)

dist_freq_di_AorTdi_bid2 = readRDS("data/Created/tiling_dist_freq_di_AorTdi_bid2.rds")
dist_freq_di_CorGdi_bid2 = readRDS("data/Created/tiling_dist_freq_di_CorGdi_bid2.rds")
dist_freq_di_AorTdi_bid2_test = readRDS("data/Created/tiling_dist_freq_di_AorTdi_bid2_test.rds")
dist_freq_di_CorGdi_bid2_test = readRDS("data/Created/tiling_dist_freq_di_CorGdi_bid2_test.rds")

dist_freq_di_AorTdi_bid2_random_all = readRDS("data/Created/random_all_dist_freq_di_AorTdi_bid2.rds")
dist_freq_di_CorGdi_bid2_random_all = readRDS("data/Created/random_all_dist_freq_di_CorGdi_bid2.rds")

poly = readRDS("data/Created/tiling_poly_AorT.rds")
poly_test = readRDS("data/Created/tiling_poly_AorT_test.rds")
poly_random = readRDS("data/Created/random_poly_AorT_test.rds")
poly_random_test = readRDS("data/Created/random_poly_AorT_test.rds")
poly_random_all = rbind(poly_random, poly_random_test)
```

## Simple Linear Model

```{r}
dat_all_dist_freq_di_AorTdi_bid = cbind(dist_freq_di_AorTdi_bid2,
                                        dist_freq_di_CorGdi_bid2,
                                        dat %>% select(C0_new))

all_dist_freq_di_AorTdi_bid_lm = lm(C0_new~., data=dat_all_dist_freq_di_AorTdi_bid)
cor(all_dist_freq_di_AorTdi_bid_lm$fitted.values, y)
# 

dat_test_all_dist_freq_di_AorTdi_bid = cbind(dist_freq_di_AorTdi_bid2_test,
                                             dist_freq_di_CorGdi_bid2_test,
                                             dat_test %>% select(C0_new))

all_dist_freq_di_AorTdi_bid_pred = predict(all_dist_freq_di_AorTdi_bid_lm, dat_test_all_dist_freq_di_AorTdi_bid)

cor(all_dist_freq_di_AorTdi_bid_pred, y_test)
# 

mean((all_dist_freq_di_AorTdi_bid_pred - y_test)^2)
# 

dat_random_all_dist_freq_di_AorTdi_bid = cbind(dist_freq_di_AorTdi_bid2_random_all,
                                               dist_freq_di_CorGdi_bid2_random_all,
                                               dat_random_all %>% select(C0_new))

random_all_dist_freq_di_AorTdi_bid_pred = predict(all_dist_freq_di_AorTdi_bid_lm, dat_random_all_dist_freq_di_AorTdi_bid)

cor(random_all_dist_freq_di_AorTdi_bid_pred, y_random_all)
# 
```

We get test prediction correlation of  and MSE of 
We get prediction correlation of  on the random library


# Inputs: Position Specific Dinucleotides + All Distance Frequency Between Dinucleotides and AA/TT/AT/TA or CC/GG/CG/GC Dinucleotides

```{r}
ps2 <- paste0("X", 1:49, "di")

dist_freq_di_AorTdi_bid2 = readRDS("data/Created/tiling_dist_freq_di_AorTdi_bid2.rds")
dist_freq_di_CorGdi_bid2 = readRDS("data/Created/tiling_dist_freq_di_CorGdi_bid2.rds")
dist_freq_di_AorTdi_bid2_test = readRDS("data/Created/tiling_dist_freq_di_AorTdi_bid2_test.rds")
dist_freq_di_CorGdi_bid2_test = readRDS("data/Created/tiling_dist_freq_di_CorGdi_bid2_test.rds")
```

## Simple Linear Model

```{r}
dat_all_dist_freq_di_AorTdi_bid2 = cbind(dat %>% select(all_of(ps2), C0_new), 
                                         dist_freq_di_AorTdi_bid2,
                                         dist_freq_di_CorGdi_bid2)

all_dist_freq_di_AorTdi_bid2_lm = lm(C0_new~., data=dat_all_dist_freq_di_AorTdi_bid2)
cor(all_dist_freq_di_AorTdi_bid2_lm$fitted.values, y)
# 0.7529442

dat_test_all_dist_freq_di_AorTdi_bid2 = cbind(dat_test %>% select(all_of(ps2), C0_new), 
                                              dist_freq_di_AorTdi_bid2_test,
                                              dist_freq_di_CorGdi_bid2_test)

all_dist_freq_di_AorTdi_bid2_pred = predict(all_dist_freq_di_AorTdi_bid2_lm, dat_test_all_dist_freq_di_AorTdi_bid2)

cor(all_dist_freq_di_AorTdi_bid2_pred, y_test)
# 0.7476223

mean((all_dist_freq_di_AorTdi_bid2_pred - y_test)^2)
# 0.1063222

dat_random_all_all_dist_freq_di_AorTdi_bid2 = cbind(dat_random_all %>% 
                                                      select(all_of(ps2), C0_new),
                                                    dist_freq_di_AorTdi_bid2_random_all,
                                                    dist_freq_di_CorGdi_bid2_random_all)

all_dist_freq_di_AorTdi_bid2_pred_random_all = predict(all_dist_freq_di_AorTdi_bid2_lm, dat_random_all_all_dist_freq_di_AorTdi_bid2)

cor(all_dist_freq_di_AorTdi_bid2_pred_random_all, y_random_all)
# 0.6586663

mean((all_dist_freq_di_AorTdi_bid2_pred_random_all - y_random_all)^2)
# 0.08411416
```

We get test prediction correlation of 0.7476223 and MSE of 0.1063222
We get test prediction correlation of 0.6586663 and MSE of 0.08411416 on the Random Library

## LightGBM (tree-based) Model

```{r}
library(lightgbm)
source("scripts/functions/lgbm-helper-functions.R")
set.seed(50)
dat_all_dist_freq_di_AorTdi_bid2.lgb_train_set = dat_all_dist_freq_di_AorTdi_bid2 %>%
  select(-C0_new)
dat_all_dist_freq_di_AorTdi_bid2.lgb_train_rules = lgb.convert_with_rules(data = dat_all_dist_freq_di_AorTdi_bid2.lgb_train_set)
dat_all_dist_freq_di_AorTdi_bid2.lgb_train_data = lgb.Dataset(data = as.matrix(dat_all_dist_freq_di_AorTdi_bid2.lgb_train_rules$data),
                                                              label = dat_all_dist_freq_di_AorTdi_bid2$C0_new,
                                                              categorical_feature = handle_categorical(colnames(dat_all_dist_freq_di_AorTdi_bid2.lgb_train_rules$data)))
dat_all_dist_freq_di_AorTdi_bid2.lgb_test_set = dat_test_all_dist_freq_di_AorTdi_bid2 %>%
  select(-C0_new)
dat_all_dist_freq_di_AorTdi_bid2.lgb_test_matrix = as.matrix(lgb.convert_with_rules(data = dat_all_dist_freq_di_AorTdi_bid2.lgb_test_set, rules = dat_all_dist_freq_di_AorTdi_bid2.lgb_train_rules$rules)$data)
dat_all_dist_freq_di_AorTdi_bid2.lgb_test_data = lgb.Dataset(data = dat_all_dist_freq_di_AorTdi_bid2.lgb_test_matrix,
                                                             label = dat_test_all_dist_freq_di_AorTdi_bid2$C0_new,
                                                             categorical_feature = handle_categorical(colnames(dat_all_dist_freq_di_AorTdi_bid2.lgb_test_matrix)))
dat_all_dist_freq_di_AorTdi_bid2.lgb_obj = lightgbm(data = dat_all_dist_freq_di_AorTdi_bid2.lgb_train_data,
                                                    params = list(learning_rate = c(0.1),
                                                                  objective = c("regression"),
                                                                  min_data_in_leaf = 100,
                                                                  max_depth = c(5),
                                                                  num_leaves = c(1000),
                                                                  lambda_l2 = c(1),
                                                                  boosting = c("gbdt")),
                                                    valids = list(valid = dat_all_dist_freq_di_AorTdi_bid2.lgb_test_data),
                                                    nrounds = 8000,
                                                    early_stopping_rounds = 50)

dat_all_dist_freq_di_AorTdi_bid2.lgb_train_pred = predict(dat_all_dist_freq_di_AorTdi_bid2.lgb_obj, data = as.matrix(dat_all_dist_freq_di_AorTdi_bid2.lgb_train_rules$data))
cor(dat_all_dist_freq_di_AorTdi_bid2.lgb_train_pred, y, method="pearson")
# 0.9746898 (nrounds = 2112)

dat_all_dist_freq_di_AorTdi_bid2.lgb_test_pred = predict(dat_all_dist_freq_di_AorTdi_bid2.lgb_obj, data = dat_all_dist_freq_di_AorTdi_bid2.lgb_test_matrix)

cor(dat_all_dist_freq_di_AorTdi_bid2.lgb_test_pred, y_test, method="pearson")
# 0.7394211 (nrounds = 2112)

mean((dat_all_dist_freq_di_AorTdi_bid2.lgb_test_pred - y_test)^2)
# 0.1095456 (nrounds = 2112)
```

We get test prediction correlation of 0.7394211 and MSE of 0.1095456

```{r}
dat_all_dist_freq_di_AorTdi_bid2.feature_importance = as.data.frame(lgb.importance(dat_all_dist_freq_di_AorTdi_bid2.lgb_obj)) %>%
  mutate(Feature = fct_rev(fct_inorder(Feature))) %>%
  dplyr::slice(1:50) %>%
  ggplot(aes(x = Feature, y = Gain)) +
  geom_col(fill = "dodgerblue") +
  coord_flip() +
  theme_bw()
dat_all_dist_freq_di_AorTdi_bid2.feature_importance
```

# Inputs: Counts of Dinucleotides + All Distance Frequency Between Dinucleotides and AA/TT/AT/TA or CC/GG/CG/GC Dinucleotides

```{r}
nucleotides <- c("A", "C", "G", "T")
dinucleotides <- gtools::permutations(n = 4, r = 2, v = nucleotides,
                                      repeats.allowed = TRUE) %>%
  apply(1, paste, collapse = "")

dist_freq_di_AorTdi_bid2 = readRDS("data/Created/tiling_dist_freq_di_AorTdi_bid2.rds")
dist_freq_di_CorGdi_bid2 = readRDS("data/Created/tiling_dist_freq_di_CorGdi_bid2.rds")
dist_freq_di_AorTdi_bid2_test = readRDS("data/Created/tiling_dist_freq_di_AorTdi_bid2_test.rds")
dist_freq_di_CorGdi_bid2_test = readRDS("data/Created/tiling_dist_freq_di_CorGdi_bid2_test.rds")
```

## Simple Linear Model

```{r}
dat_all_dist_freq_di_AorTdi_bid3 = cbind(dat %>% select(all_of(dinucleotides), C0_new), 
                                         dist_freq_di_AorTdi_bid2,
                                         dist_freq_di_CorGdi_bid2)

all_dist_freq_di_AorTdi_bid3_lm = lm(C0_new~., data=dat_all_dist_freq_di_AorTdi_bid3)
cor(all_dist_freq_di_AorTdi_bid3_lm$fitted.values, y)
# 0.7345541

dat_test_all_dist_freq_di_AorTdi_bid3 = cbind(dat_test %>% select(all_of(dinucleotides), C0_new), 
                                              dist_freq_di_AorTdi_bid2_test,
                                              dist_freq_di_CorGdi_bid2_test)

all_dist_freq_di_AorTdi_bid3_pred = predict(all_dist_freq_di_AorTdi_bid3_lm, dat_test_all_dist_freq_di_AorTdi_bid3)

cor(all_dist_freq_di_AorTdi_bid3_pred, y_test)
# 0.7337776

mean((all_dist_freq_di_AorTdi_bid3_pred - y_test)^2)
# 0.1112686

dat_random_all_all_dist_freq_di_AorTdi_bid3 = cbind(dat_random_all %>% 
                                                      select(all_of(dinucleotides), C0_new),
                                                    dist_freq_di_AorTdi_bid2_random_all,
                                                    dist_freq_di_CorGdi_bid2_random_all)

all_dist_freq_di_AorTdi_bid3_pred_random_all = predict(all_dist_freq_di_AorTdi_bid3_lm, dat_random_all_all_dist_freq_di_AorTdi_bid3)

cor(all_dist_freq_di_AorTdi_bid3_pred_random_all, y_random_all)
# 0.6501833

mean((all_dist_freq_di_AorTdi_bid3_pred_random_all - y_random_all)^2)
# 0.08568101
```

We get test prediction correlation of 0.7337776 and MSE of 0.1112686
We get test prediction correlation of 0.6501833 and MSE of 0.08568101 on the Random Library


## LightGBM (tree-based) Model

```{r}
library(lightgbm)
source("scripts/functions/lgbm-helper-functions.R")
set.seed(50)
dat_all_dist_freq_di_AorTdi_bid3.lgb_train_set = dat_all_dist_freq_di_AorTdi_bid3 %>%
  select(-C0_new)
dat_all_dist_freq_di_AorTdi_bid3.lgb_train_rules = lgb.convert_with_rules(data = dat_all_dist_freq_di_AorTdi_bid3.lgb_train_set)
dat_all_dist_freq_di_AorTdi_bid3.lgb_train_data = lgb.Dataset(data = as.matrix(dat_all_dist_freq_di_AorTdi_bid3.lgb_train_rules$data),
                                                              label = dat_all_dist_freq_di_AorTdi_bid3$C0_new,
                                                              categorical_feature = handle_categorical(colnames(dat_all_dist_freq_di_AorTdi_bid3.lgb_train_rules$data)))
dat_all_dist_freq_di_AorTdi_bid3.lgb_test_set = dat_test_all_dist_freq_di_AorTdi_bid3 %>%
  select(-C0_new)
dat_all_dist_freq_di_AorTdi_bid3.lgb_test_matrix = as.matrix(lgb.convert_with_rules(data = dat_all_dist_freq_di_AorTdi_bid3.lgb_test_set, rules = dat_all_dist_freq_di_AorTdi_bid3.lgb_train_rules$rules)$data)
dat_all_dist_freq_di_AorTdi_bid3.lgb_test_data = lgb.Dataset(data = dat_all_dist_freq_di_AorTdi_bid3.lgb_test_matrix,
                                                             label = dat_test_all_dist_freq_di_AorTdi_bid3$C0_new,
                                                             categorical_feature = handle_categorical(colnames(dat_all_dist_freq_di_AorTdi_bid3.lgb_test_matrix)))
dat_all_dist_freq_di_AorTdi_bid3.lgb_obj = lightgbm(data = dat_all_dist_freq_di_AorTdi_bid3.lgb_train_data,
                                                    params = list(learning_rate = c(0.1),
                                                                  objective = c("regression"),
                                                                  min_data_in_leaf = 100,
                                                                  max_depth = c(5),
                                                                  num_leaves = c(1000),
                                                                  lambda_l2 = c(1),
                                                                  boosting = c("gbdt")),
                                                    valids = list(valid = dat_all_dist_freq_di_AorTdi_bid3.lgb_test_data),
                                                    nrounds = 8000,
                                                    early_stopping_rounds = 50)

dat_all_dist_freq_di_AorTdi_bid3.lgb_train_pred = predict(dat_all_dist_freq_di_AorTdi_bid3.lgb_obj, data = as.matrix(dat_all_dist_freq_di_AorTdi_bid3.lgb_train_rules$data))
cor(dat_all_dist_freq_di_AorTdi_bid3.lgb_train_pred, y, method="pearson")
# 0.9832856 (nrounds = 4885)

dat_all_dist_freq_di_AorTdi_bid3.lgb_test_pred = predict(dat_all_dist_freq_di_AorTdi_bid3.lgb_obj, data = dat_all_dist_freq_di_AorTdi_bid3.lgb_test_matrix)

cor(dat_all_dist_freq_di_AorTdi_bid3.lgb_test_pred, y_test, method="pearson")
# 0.7649495 (nrounds = 4885)

mean((dat_all_dist_freq_di_AorTdi_bid3.lgb_test_pred - y_test)^2)
# 0.1001137 (nrounds = 4885)
```

We get test prediction correlation of 0.7649495 and MSE of 0.1001137

```{r}
dat_all_dist_freq_di_AorTdi_bid3.feature_importance = as.data.frame(lgb.importance(dat_all_dist_freq_di_AorTdi_bid3.lgb_obj)) %>%
  mutate(Feature = fct_rev(fct_inorder(Feature))) %>%
  dplyr::slice(1:50) %>%
  ggplot(aes(x = Feature, y = Gain)) +
  geom_col(fill = "dodgerblue") +
  coord_flip() +
  theme_bw()
dat_all_dist_freq_di_AorTdi_bid3.feature_importance
```

# Inputs: Counts of Trinucleotides + All Distance Frequency Between Dinucleotides and AA/TT/AT/TA or CC/GG/CG/GC Dinucleotides

```{r}
nucleotides <- c("A", "C", "G", "T")
dinucleotides <- gtools::permutations(n = 4, r = 2, v = nucleotides,
                                      repeats.allowed = TRUE) %>%
  apply(1, paste, collapse = "")
trinucleotides <- gtools::permutations(n = 4, r = 3, v = nucleotides,
                                       repeats.allowed = TRUE) %>%
  apply(1, paste, collapse = "")

dist_freq_di_AorTdi_bid2 = readRDS("data/Created/tiling_dist_freq_di_AorTdi_bid2.rds")
dist_freq_di_CorGdi_bid2 = readRDS("data/Created/tiling_dist_freq_di_CorGdi_bid2.rds")
dist_freq_di_AorTdi_bid2_test = readRDS("data/Created/tiling_dist_freq_di_AorTdi_bid2_test.rds")
dist_freq_di_CorGdi_bid2_test = readRDS("data/Created/tiling_dist_freq_di_CorGdi_bid2_test.rds")
```

## Simple Linear Model

```{r}
dat_all_dist_freq_di_AorTdi_bid4 = cbind(dat %>% 
                                           select(all_of(trinucleotides), C0_new), 
                                         dist_freq_di_AorTdi_bid2,
                                         dist_freq_di_CorGdi_bid2)

all_dist_freq_di_AorTdi_bid4_lm = lm(C0_new~., data=dat_all_dist_freq_di_AorTdi_bid4)
cor(all_dist_freq_di_AorTdi_bid4_lm$fitted.values, y)
# 0.7416589

dat_test_all_dist_freq_di_AorTdi_bid4 = cbind(dat_test %>% 
                                                select(all_of(trinucleotides), C0_new), 
                                              dist_freq_di_AorTdi_bid2_test,
                                              dist_freq_di_CorGdi_bid2_test)

all_dist_freq_di_AorTdi_bid4_pred = predict(all_dist_freq_di_AorTdi_bid4_lm, dat_test_all_dist_freq_di_AorTdi_bid4)

cor(all_dist_freq_di_AorTdi_bid4_pred, y_test)
# 0.7395515

mean((all_dist_freq_di_AorTdi_bid4_pred - y_test)^2)
# 0.1092195

dat_random_all_all_dist_freq_di_AorTdi_bid4 = cbind(dat_random_all %>% 
                                                      select(all_of(trinucleotides), C0_new),
                                                    dist_freq_di_AorTdi_bid2_random_all,
                                                    dist_freq_di_CorGdi_bid2_random_all)

all_dist_freq_di_AorTdi_bid4_pred_random_all = predict(all_dist_freq_di_AorTdi_bid4_lm, dat_random_all_all_dist_freq_di_AorTdi_bid4)

cor(all_dist_freq_di_AorTdi_bid4_pred_random_all, y_random_all)
# 0.6661194

mean((all_dist_freq_di_AorTdi_bid4_pred_random_all - y_random_all)^2)
# 0.08275986
```

We get test prediction correlation of 0.7395515 and MSE of 0.1092195
We get test prediction correlation of 0.6661194 and MSE of 0.08275986 on the Random Library

## LightGBM (tree-based) Model

```{r}
library(lightgbm)
source("scripts/functions/lgbm-helper-functions.R")
set.seed(50)
dat_all_dist_freq_di_AorTdi_bid4.lgb_train_set = dat_all_dist_freq_di_AorTdi_bid4 %>%
  select(-C0_new)
dat_all_dist_freq_di_AorTdi_bid4.lgb_train_rules = lgb.convert_with_rules(data = dat_all_dist_freq_di_AorTdi_bid4.lgb_train_set)
dat_all_dist_freq_di_AorTdi_bid4.lgb_train_data = lgb.Dataset(data = as.matrix(dat_all_dist_freq_di_AorTdi_bid4.lgb_train_rules$data),
                                                              label = dat_all_dist_freq_di_AorTdi_bid4$C0_new,
                                                              categorical_feature = handle_categorical(colnames(dat_all_dist_freq_di_AorTdi_bid4.lgb_train_rules$data)))
dat_all_dist_freq_di_AorTdi_bid4.lgb_test_set = dat_test_all_dist_freq_di_AorTdi_bid4 %>%
  select(-C0_new)
dat_all_dist_freq_di_AorTdi_bid4.lgb_test_matrix = as.matrix(lgb.convert_with_rules(data = dat_all_dist_freq_di_AorTdi_bid4.lgb_test_set, rules = dat_all_dist_freq_di_AorTdi_bid4.lgb_train_rules$rules)$data)
dat_all_dist_freq_di_AorTdi_bid4.lgb_test_data = lgb.Dataset(data = dat_all_dist_freq_di_AorTdi_bid4.lgb_test_matrix,
                                                             label = dat_test_all_dist_freq_di_AorTdi_bid4$C0_new,
                                                             categorical_feature = handle_categorical(colnames(dat_all_dist_freq_di_AorTdi_bid4.lgb_test_matrix)))
dat_all_dist_freq_di_AorTdi_bid4.lgb_obj = lightgbm(data = dat_all_dist_freq_di_AorTdi_bid4.lgb_train_data,
                                                    params = list(learning_rate = c(0.1),
                                                                  objective = c("regression"),
                                                                  min_data_in_leaf = 100,
                                                                  max_depth = c(5),
                                                                  num_leaves = c(1000),
                                                                  lambda_l2 = c(1),
                                                                  boosting = c("gbdt")),
                                                    valids = list(valid = dat_all_dist_freq_di_AorTdi_bid4.lgb_test_data),
                                                    nrounds = 8000,
                                                    early_stopping_rounds = 50)

dat_all_dist_freq_di_AorTdi_bid4.lgb_train_pred = predict(dat_all_dist_freq_di_AorTdi_bid4.lgb_obj, data = as.matrix(dat_all_dist_freq_di_AorTdi_bid4.lgb_train_rules$data))
cor(dat_all_dist_freq_di_AorTdi_bid4.lgb_train_pred, y, method="pearson")
# 0.9931754 (nrounds = 7395)

dat_all_dist_freq_di_AorTdi_bid4.lgb_test_pred = predict(dat_all_dist_freq_di_AorTdi_bid4.lgb_obj, data = dat_all_dist_freq_di_AorTdi_bid4.lgb_test_matrix)

cor(dat_all_dist_freq_di_AorTdi_bid4.lgb_test_pred, y_test, method="pearson")
# 0.7733564 (nrounds = 7395)

mean((dat_all_dist_freq_di_AorTdi_bid4.lgb_test_pred - y_test)^2)
# 0.09697333 (nrounds = 7395)
```

We get test prediction correlation of 0.7733564 and MSE of 0.09697333

```{r}
dat_all_dist_freq_di_AorTdi_bid4.feature_importance = as.data.frame(lgb.importance(dat_all_dist_freq_di_AorTdi_bid4.lgb_obj)) %>%
  mutate(Feature = fct_rev(fct_inorder(Feature))) %>%
  dplyr::slice(1:50) %>%
  ggplot(aes(x = Feature, y = Gain)) +
  geom_col(fill = "dodgerblue") +
  coord_flip() +
  theme_bw()
dat_all_dist_freq_di_AorTdi_bid4.feature_importance
```


# Inputs: Position Specific Dinucleotides + Counts of Trinucleotides + All Distance Frequency Between Dinucleotides and AA/TT/AT/TA or CC/GG/CG/GC Dinucleotides

```{r}
ps2 <- paste0("X", 1:49, "di")

nucleotides <- c("A", "C", "G", "T")
dinucleotides <- gtools::permutations(n = 4, r = 2, v = nucleotides,
                                      repeats.allowed = TRUE) %>%
  apply(1, paste, collapse = "")
trinucleotides <- gtools::permutations(n = 4, r = 3, v = nucleotides,
                                       repeats.allowed = TRUE) %>%
  apply(1, paste, collapse = "")

dist_freq_di_AorTdi_bid2 = readRDS("data/Created/tiling_dist_freq_di_AorTdi_bid2.rds")
dist_freq_di_CorGdi_bid2 = readRDS("data/Created/tiling_dist_freq_di_CorGdi_bid2.rds")
dist_freq_di_AorTdi_bid2_test = readRDS("data/Created/tiling_dist_freq_di_AorTdi_bid2_test.rds")
dist_freq_di_CorGdi_bid2_test = readRDS("data/Created/tiling_dist_freq_di_CorGdi_bid2_test.rds")
```

## Simple Linear Model

```{r}
dat_all_dist_freq_di_AorTdi_bid6 = cbind(dat %>% select(all_of(ps2), 
                                                        all_of(trinucleotides), C0_new), 
                                         dist_freq_di_AorTdi_bid2,
                                         dist_freq_di_CorGdi_bid2)

all_dist_freq_di_AorTdi_bid6_lm = lm(C0_new~., data=dat_all_dist_freq_di_AorTdi_bid6)
cor(all_dist_freq_di_AorTdi_bid6_lm$fitted.values, y)
# 0.7596609

dat_test_all_dist_freq_di_AorTdi_bid6 = cbind(dat_test %>% select(all_of(ps2), 
                                                                  all_of(trinucleotides), C0_new), 
                                              dist_freq_di_AorTdi_bid2_test,
                                              dist_freq_di_CorGdi_bid2_test)

all_dist_freq_di_AorTdi_bid6_pred = predict(all_dist_freq_di_AorTdi_bid6_lm, dat_test_all_dist_freq_di_AorTdi_bid6)

cor(all_dist_freq_di_AorTdi_bid6_pred, y_test)
# 0.7538045

mean((all_dist_freq_di_AorTdi_bid6_pred - y_test)^2)
# 0.1040847

dat_random_all_all_dist_freq_di_AorTdi_bid6 = cbind(dat_random_all %>% 
                                                      select(all_of(ps2),
                                                             all_of(trinucleotides), C0_new),
                                                    dist_freq_di_AorTdi_bid2_random_all,
                                                    dist_freq_di_CorGdi_bid2_random_all)

all_dist_freq_di_AorTdi_bid6_pred_random_all = predict(all_dist_freq_di_AorTdi_bid6_lm, dat_random_all_all_dist_freq_di_AorTdi_bid6)

cor(all_dist_freq_di_AorTdi_bid6_pred_random_all, y_random_all)
# 0.6748933

mean((all_dist_freq_di_AorTdi_bid6_pred_random_all - y_random_all)^2)
# 0.08097739
```

We get test prediction correlation of 0.7538045 and MSE of 0.1040847
We get test prediction correlation of 0.6748933 and MSE of 0.08097739 on the Random Library


## LightGBM (tree-based) Model

```{r}
library(lightgbm)
source("scripts/functions/lgbm-helper-functions.R")
set.seed(50)
dat_all_dist_freq_di_AorTdi_bid6.lgb_train_set = dat_all_dist_freq_di_AorTdi_bid6 %>%
  select(-C0_new)
dat_all_dist_freq_di_AorTdi_bid6.lgb_train_rules = lgb.convert_with_rules(data = dat_all_dist_freq_di_AorTdi_bid6.lgb_train_set)
dat_all_dist_freq_di_AorTdi_bid6.lgb_train_data = lgb.Dataset(data = as.matrix(dat_all_dist_freq_di_AorTdi_bid6.lgb_train_rules$data),
                                                              label = dat_all_dist_freq_di_AorTdi_bid6$C0_new,
                                                              categorical_feature = handle_categorical(colnames(dat_all_dist_freq_di_AorTdi_bid6.lgb_train_rules$data)))
dat_all_dist_freq_di_AorTdi_bid6.lgb_test_set = dat_test_all_dist_freq_di_AorTdi_bid6 %>%
  select(-C0_new)
dat_all_dist_freq_di_AorTdi_bid6.lgb_test_matrix = as.matrix(lgb.convert_with_rules(data = dat_all_dist_freq_di_AorTdi_bid6.lgb_test_set, rules = dat_all_dist_freq_di_AorTdi_bid6.lgb_train_rules$rules)$data)
dat_all_dist_freq_di_AorTdi_bid6.lgb_test_data = lgb.Dataset(data = dat_all_dist_freq_di_AorTdi_bid6.lgb_test_matrix,
                                                             label = dat_test_all_dist_freq_di_AorTdi_bid6$C0_new,
                                                             categorical_feature = handle_categorical(colnames(dat_all_dist_freq_di_AorTdi_bid6.lgb_test_matrix)))
dat_all_dist_freq_di_AorTdi_bid6.lgb_obj = lightgbm(data = dat_all_dist_freq_di_AorTdi_bid6.lgb_train_data,
                                                    params = list(learning_rate = c(0.1),
                                                                  objective = c("regression"),
                                                                  min_data_in_leaf = 100,
                                                                  max_depth = c(5),
                                                                  num_leaves = c(1000),
                                                                  lambda_l2 = c(1),
                                                                  boosting = c("gbdt")),
                                                    valids = list(valid = dat_all_dist_freq_di_AorTdi_bid6.lgb_test_data),
                                                    nrounds = 8000,
                                                    early_stopping_rounds = 50)

dat_all_dist_freq_di_AorTdi_bid6.lgb_train_pred = predict(dat_all_dist_freq_di_AorTdi_bid6.lgb_obj, data = as.matrix(dat_all_dist_freq_di_AorTdi_bid6.lgb_train_rules$data))
cor(dat_all_dist_freq_di_AorTdi_bid6.lgb_train_pred, y, method="pearson")
# 0.9775784 (nrounds = 2216)

dat_all_dist_freq_di_AorTdi_bid6.lgb_test_pred = predict(dat_all_dist_freq_di_AorTdi_bid6.lgb_obj, data = dat_all_dist_freq_di_AorTdi_bid6.lgb_test_matrix)

cor(dat_all_dist_freq_di_AorTdi_bid6.lgb_test_pred, y_test, method="pearson")
# 0.7486625 (nrounds = 2216)

mean((dat_all_dist_freq_di_AorTdi_bid6.lgb_test_pred - y_test)^2)
# 0.106283 (nrounds = 2216)
```

We get test prediction correlation of 0.7486625 and MSE of 0.106283

```{r}
dat_all_dist_freq_di_AorTdi_bid6.feature_importance = as.data.frame(lgb.importance(dat_all_dist_freq_di_AorTdi_bid6.lgb_obj)) %>%
  mutate(Feature = fct_rev(fct_inorder(Feature))) %>%
  dplyr::slice(1:50) %>%
  ggplot(aes(x = Feature, y = Gain)) +
  geom_col(fill = "dodgerblue") +
  coord_flip() +
  theme_bw()
dat_all_dist_freq_di_AorTdi_bid6.feature_importance
```


# Inputs: Fourier Features Based on all Dinucleotides with h=6 (period 9.8) Calculated using fft + All Distance Frequency Between Dinucleotides and AA/TT/AT/TA or CC/GG/CG/GC Dinucleotides

```{r}
fourier_di_cos = readRDS("data/Created/tiling_fourier_di_cos.rds")
fourier_di_sin = readRDS("data/Created/tiling_fourier_di_sin.rds")
fourier_di_cos_test = readRDS("data/Created/tiling_fourier_di_cos_test.rds")
fourier_di_sin_test = readRDS("data/Created/tiling_fourier_di_sin_test.rds")

fourier_di_cos_6 = as.data.frame(fourier_di_cos) %>% select(ends_with("_6"))
fourier_di_sin_6 = as.data.frame(fourier_di_sin) %>% select(ends_with("_6"))
fourier_di_cos_6_test = as.data.frame(fourier_di_cos_test) %>% select(ends_with("_6"))
fourier_di_sin_6_test = as.data.frame(fourier_di_sin_test) %>% select(ends_with("_6"))

fourier_di_cos_random = readRDS("data/Created/random_fourier_di_cos.rds")
fourier_di_sin_random = readRDS("data/Created/random_fourier_di_sin.rds")
fourier_di_cos_random_test = readRDS("data/Created/random_fourier_di_cos_test.rds")
fourier_di_sin_random_test = readRDS("data/Created/random_fourier_di_sin_test.rds")

fourier_di_cos_random_all = rbind(fourier_di_cos_random, fourier_di_cos_random_test)
fourier_di_sin_random_all = rbind(fourier_di_sin_random, fourier_di_sin_random_test)

fourier_di_cos_6_random = as.data.frame(fourier_di_cos_random) %>% select(ends_with("_6"))
fourier_di_sin_6_random = as.data.frame(fourier_di_sin_random) %>% select(ends_with("_6"))
fourier_di_cos_6_random_test = as.data.frame(fourier_di_cos_random_test) %>% select(ends_with("_6"))
fourier_di_sin_6_random_test = as.data.frame(fourier_di_sin_random_test) %>% select(ends_with("_6"))

fourier_di_cos_6_random_all = rbind(fourier_di_cos_6_random, fourier_di_cos_6_random_test)
fourier_di_sin_6_random_all = rbind(fourier_di_sin_6_random, fourier_di_sin_6_random_test)

dist_freq_di_AorTdi_bid2 = readRDS("data/Created/tiling_dist_freq_di_AorTdi_bid2.rds")
dist_freq_di_CorGdi_bid2 = readRDS("data/Created/tiling_dist_freq_di_CorGdi_bid2.rds")
dist_freq_di_AorTdi_bid2_test = readRDS("data/Created/tiling_dist_freq_di_AorTdi_bid2_test.rds")
dist_freq_di_CorGdi_bid2_test = readRDS("data/Created/tiling_dist_freq_di_CorGdi_bid2_test.rds")
```

## Squared value of Fourier features

### Simple Linear Model

```{r}
dat_all_dist_freq_di_AorTdi_bid7 = cbind(dat %>% select(C0_new), 
                                         (fourier_di_cos_6)^2, 
                                         (fourier_di_sin_6)^2, 
                                         dist_freq_di_AorTdi_bid2,
                                         dist_freq_di_CorGdi_bid2)

all_dist_freq_di_AorTdi_bid7_lm = lm(C0_new~., data=dat_all_dist_freq_di_AorTdi_bid7)
cor(all_dist_freq_di_AorTdi_bid7_lm$fitted.values, y)
# 0.7356485

dat_test_all_dist_freq_di_AorTdi_bid7 = cbind(dat_test %>% select(C0_new), 
                                              (fourier_di_cos_6_test)^2, 
                                              (fourier_di_sin_6_test)^2, 
                                              dist_freq_di_AorTdi_bid2_test,
                                              dist_freq_di_CorGdi_bid2_test)

all_dist_freq_di_AorTdi_bid7_pred = predict(all_dist_freq_di_AorTdi_bid7_lm, dat_test_all_dist_freq_di_AorTdi_bid7)

cor(all_dist_freq_di_AorTdi_bid7_pred, y_test)
# 0.7332935

mean((all_dist_freq_di_AorTdi_bid7_pred - y_test)^2)
# 0.1114491

dat_random_all_all_dist_freq_di_AorTdi_bid7 = cbind(dat_random_all %>% select(C0_new),
                                                    (fourier_di_cos_6_random_all)^2,
                                                    (fourier_di_sin_6_random_all)^2,
                                                    dist_freq_di_AorTdi_bid2_random_all,
                                                    dist_freq_di_CorGdi_bid2_random_all)

all_dist_freq_di_AorTdi_bid7_pred_random_all = predict(all_dist_freq_di_AorTdi_bid7_lm, dat_random_all_all_dist_freq_di_AorTdi_bid7)

cor(all_dist_freq_di_AorTdi_bid7_pred_random_all, y_random_all)
# 0.6558271

mean((all_dist_freq_di_AorTdi_bid7_pred_random_all - y_random_all)^2)
# 0.08465269
```

We get test prediction correlation of 0.7332935 and MSE of 0.1114491
We get test prediction correlation of 0.6558271 and MSE of 0.08465269 on the Random Library


### LightGBM (tree-based) Model

```{r}
library(lightgbm)
source("scripts/functions/lgbm-helper-functions.R")
set.seed(50)
dat_all_dist_freq_di_AorTdi_bid7.lgb_train_set = dat_all_dist_freq_di_AorTdi_bid7 %>%
  select(-C0_new)
dat_all_dist_freq_di_AorTdi_bid7.lgb_train_rules = lgb.convert_with_rules(data = dat_all_dist_freq_di_AorTdi_bid7.lgb_train_set)
dat_all_dist_freq_di_AorTdi_bid7.lgb_train_data = lgb.Dataset(data = as.matrix(dat_all_dist_freq_di_AorTdi_bid7.lgb_train_rules$data),
                                                              label = dat_all_dist_freq_di_AorTdi_bid7$C0_new,
                                                              categorical_feature = handle_categorical(colnames(dat_all_dist_freq_di_AorTdi_bid7.lgb_train_rules$data)))
dat_all_dist_freq_di_AorTdi_bid7.lgb_test_set = dat_test_all_dist_freq_di_AorTdi_bid7 %>%
  select(-C0_new)
dat_all_dist_freq_di_AorTdi_bid7.lgb_test_matrix = as.matrix(lgb.convert_with_rules(data = dat_all_dist_freq_di_AorTdi_bid7.lgb_test_set, rules = dat_all_dist_freq_di_AorTdi_bid7.lgb_train_rules$rules)$data)
dat_all_dist_freq_di_AorTdi_bid7.lgb_test_data = lgb.Dataset(data = dat_all_dist_freq_di_AorTdi_bid7.lgb_test_matrix,
                                                             label = dat_test_all_dist_freq_di_AorTdi_bid7$C0_new,
                                                             categorical_feature = handle_categorical(colnames(dat_all_dist_freq_di_AorTdi_bid7.lgb_test_matrix)))
dat_all_dist_freq_di_AorTdi_bid7.lgb_obj = lightgbm(data = dat_all_dist_freq_di_AorTdi_bid7.lgb_train_data,
                                                    params = list(learning_rate = c(0.1),
                                                                  objective = c("regression"),
                                                                  min_data_in_leaf = 100,
                                                                  max_depth = c(5),
                                                                  num_leaves = c(1000),
                                                                  lambda_l2 = c(1),
                                                                  boosting = c("gbdt")),
                                                    valids = list(valid = dat_all_dist_freq_di_AorTdi_bid7.lgb_test_data),
                                                    nrounds = 8000,
                                                    early_stopping_rounds = 50)

dat_all_dist_freq_di_AorTdi_bid7.lgb_train_pred = predict(dat_all_dist_freq_di_AorTdi_bid7.lgb_obj, data = as.matrix(dat_all_dist_freq_di_AorTdi_bid7.lgb_train_rules$data))
cor(dat_all_dist_freq_di_AorTdi_bid7.lgb_train_pred, y, method="pearson")
# 0.9836477 (nrounds = 4451)

dat_all_dist_freq_di_AorTdi_bid7.lgb_test_pred = predict(dat_all_dist_freq_di_AorTdi_bid7.lgb_obj, data = dat_all_dist_freq_di_AorTdi_bid7.lgb_test_matrix)

cor(dat_all_dist_freq_di_AorTdi_bid7.lgb_test_pred, y_test, method="pearson")
# 0.7668331 (nrounds = 4451)

mean((dat_all_dist_freq_di_AorTdi_bid7.lgb_test_pred - y_test)^2)
# 0.09952286 (nrounds = 4451)
```

We get test prediction correlation of 0.7668331 and MSE of 0.09952286

```{r}
dat_all_dist_freq_di_AorTdi_bid7.feature_importance = as.data.frame(lgb.importance(dat_all_dist_freq_di_AorTdi_bid7.lgb_obj)) %>%
  mutate(Feature = fct_rev(fct_inorder(Feature))) %>%
  dplyr::slice(1:50) %>%
  ggplot(aes(x = Feature, y = Gain)) +
  geom_col(fill = "dodgerblue") +
  coord_flip() +
  theme_bw()
dat_all_dist_freq_di_AorTdi_bid7.feature_importance
```


# Inputs: Modulus of Difference of Fourier Features Based on all Dinucleotides with h=6 (period 9.8) Calculated using fft + All Distance Frequency Between Dinucleotides and AA/TT/AT/TA or CC/GG/CG/GC Dinucleotides

```{r}
fourier_6_mod = readRDS("data/Created/tiling_fourier_6_mod.rds")
fourier_6_mod_test = readRDS("data/Created/tiling_fourier_6_mod_test.rds")

fourier_6_mod_random = readRDS("data/Created/random_fourier_6_mod.rds")
fourier_6_mod_random_test = readRDS("data/Created/random_fourier_6_mod_test.rds")

fourier_6_mod_random_all = rbind(fourier_6_mod_random, fourier_6_mod_random_test)

dist_freq_di_AorTdi_bid2 = readRDS("data/Created/tiling_dist_freq_di_AorTdi_bid2.rds")
dist_freq_di_CorGdi_bid2 = readRDS("data/Created/tiling_dist_freq_di_CorGdi_bid2.rds")
dist_freq_di_AorTdi_bid2_test = readRDS("data/Created/tiling_dist_freq_di_AorTdi_bid2_test.rds")
dist_freq_di_CorGdi_bid2_test = readRDS("data/Created/tiling_dist_freq_di_CorGdi_bid2_test.rds")
```

## Squared value of Fourier features

### Simple Linear Model

```{r}
dat_all_dist_freq_di_AorTdi_bid8 = cbind(dat %>% select(C0_new),
                                         (fourier_6_mod)^2, 
                                         dist_freq_di_AorTdi_bid2,
                                         dist_freq_di_CorGdi_bid2)

all_dist_freq_di_AorTdi_bid8_lm = lm(C0_new~., data=dat_all_dist_freq_di_AorTdi_bid8)
cor(all_dist_freq_di_AorTdi_bid8_lm$fitted.values, y)
# 0.745304

dat_test_all_dist_freq_di_AorTdi_bid8 = cbind(dat_test %>% select(C0_new), 
                                              (fourier_6_mod_test)^2, 
                                              dist_freq_di_AorTdi_bid2_test,
                                              dist_freq_di_CorGdi_bid2_test)

all_dist_freq_di_AorTdi_bid8_pred = predict(all_dist_freq_di_AorTdi_bid8_lm, dat_test_all_dist_freq_di_AorTdi_bid8)

cor(all_dist_freq_di_AorTdi_bid8_pred, y_test)
# 0.7423464

mean((all_dist_freq_di_AorTdi_bid8_pred - y_test)^2)
# 0.1082425

dat_random_all_all_dist_freq_di_AorTdi_bid8 = cbind(dat_random_all %>% select(C0_new),
                                                    (fourier_6_mod_random_all)^2,
                                                    dist_freq_di_AorTdi_bid2_random_all,
                                                    dist_freq_di_CorGdi_bid2_random_all)

all_dist_freq_di_AorTdi_bid8_pred_random_all = predict(all_dist_freq_di_AorTdi_bid8_lm, dat_random_all_all_dist_freq_di_AorTdi_bid8)

cor(all_dist_freq_di_AorTdi_bid8_pred_random_all, y_random_all)
# 0.6727063

mean((all_dist_freq_di_AorTdi_bid8_pred_random_all - y_random_all)^2)
# 0.08113029
```

We get test prediction correlation of 0.7423464 and MSE of 0.1082425
We get test prediction correlation of 0.6727063 and MSE of 0.08113029 on the Random Library


### LightGBM (tree-based) Model

```{r}
library(lightgbm)
source("scripts/functions/lgbm-helper-functions.R")
set.seed(50)
dat_all_dist_freq_di_AorTdi_bid8.lgb_train_set = dat_all_dist_freq_di_AorTdi_bid8 %>%
  select(-C0_new)
dat_all_dist_freq_di_AorTdi_bid8.lgb_train_rules = lgb.convert_with_rules(data = dat_all_dist_freq_di_AorTdi_bid8.lgb_train_set)
dat_all_dist_freq_di_AorTdi_bid8.lgb_train_data = lgb.Dataset(data = as.matrix(dat_all_dist_freq_di_AorTdi_bid8.lgb_train_rules$data),
                                                              label = dat_all_dist_freq_di_AorTdi_bid8$C0_new,
                                                              categorical_feature = handle_categorical(colnames(dat_all_dist_freq_di_AorTdi_bid8.lgb_train_rules$data)))
dat_all_dist_freq_di_AorTdi_bid8.lgb_test_set = dat_test_all_dist_freq_di_AorTdi_bid8 %>%
  select(-C0_new)
dat_all_dist_freq_di_AorTdi_bid8.lgb_test_matrix = as.matrix(lgb.convert_with_rules(data = dat_all_dist_freq_di_AorTdi_bid8.lgb_test_set, rules = dat_all_dist_freq_di_AorTdi_bid8.lgb_train_rules$rules)$data)
dat_all_dist_freq_di_AorTdi_bid8.lgb_test_data = lgb.Dataset(data = dat_all_dist_freq_di_AorTdi_bid8.lgb_test_matrix,
                                                             label = dat_test_all_dist_freq_di_AorTdi_bid8$C0_new,
                                                             categorical_feature = handle_categorical(colnames(dat_all_dist_freq_di_AorTdi_bid8.lgb_test_matrix)))
dat_all_dist_freq_di_AorTdi_bid8.lgb_obj = lightgbm(data = dat_all_dist_freq_di_AorTdi_bid8.lgb_train_data,
                                                    params = list(learning_rate = c(0.1),
                                                                  objective = c("regression"),
                                                                  min_data_in_leaf = 100,
                                                                  max_depth = c(5),
                                                                  num_leaves = c(1000),
                                                                  lambda_l2 = c(1),
                                                                  boosting = c("gbdt")),
                                                    valids = list(valid = dat_all_dist_freq_di_AorTdi_bid8.lgb_test_data),
                                                    nrounds = 8000,
                                                    early_stopping_rounds = 50)

dat_all_dist_freq_di_AorTdi_bid8.lgb_train_pred = predict(dat_all_dist_freq_di_AorTdi_bid8.lgb_obj, data = as.matrix(dat_all_dist_freq_di_AorTdi_bid8.lgb_train_rules$data))
cor(dat_all_dist_freq_di_AorTdi_bid8.lgb_train_pred, y, method="pearson")
# 0.9859782 (nrounds = 4158)

dat_all_dist_freq_di_AorTdi_bid8.lgb_test_pred = predict(dat_all_dist_freq_di_AorTdi_bid8.lgb_obj, data = dat_all_dist_freq_di_AorTdi_bid8.lgb_test_matrix)

cor(dat_all_dist_freq_di_AorTdi_bid8.lgb_test_pred, y_test, method="pearson")
# 0.7612129 (nrounds = 4158)

mean((dat_all_dist_freq_di_AorTdi_bid8.lgb_test_pred - y_test)^2)
# 0.1014184 (nrounds = 4158)
```

We get test prediction correlation of 0.7612129 and MSE of 0.1014184

```{r}
dat_all_dist_freq_di_AorTdi_bid8.feature_importance = as.data.frame(lgb.importance(dat_all_dist_freq_di_AorTdi_bid8.lgb_obj)) %>%
  mutate(Feature = fct_rev(fct_inorder(Feature))) %>%
  dplyr::slice(1:50) %>%
  ggplot(aes(x = Feature, y = Gain)) +
  geom_col(fill = "dodgerblue") +
  coord_flip() +
  theme_bw()
dat_all_dist_freq_di_AorTdi_bid8.feature_importance
```


# Inputs: Counts of Trinucleotides + Modulus of Difference of Fourier Features Based on all Dinucleotides with h=6 (period 9.8) Calculated using fft + All Distance Frequency Between Dinucleotides and AA/TT/AT/TA or CC/GG/CG/GC Dinucleotides

```{r}
library(Matrix)
library(glmnet)

nucleotides <- c("A", "C", "G", "T")
dinucleotides <- gtools::permutations(n = 4, r = 2, v = nucleotides,
                                      repeats.allowed = TRUE) %>%
  apply(1, paste, collapse = "")
trinucleotides <- gtools::permutations(n = 4, r = 3, v = nucleotides,
                                       repeats.allowed = TRUE) %>%
  apply(1, paste, collapse = "")

fourier_6_mod = readRDS("data/Created/tiling_fourier_6_mod.rds")
fourier_6_mod_test = readRDS("data/Created/tiling_fourier_6_mod_test.rds")

dist_freq_di_AorTdi_bid2 = readRDS("data/Created/tiling_dist_freq_di_AorTdi_bid2.rds")
dist_freq_di_CorGdi_bid2 = readRDS("data/Created/tiling_dist_freq_di_CorGdi_bid2.rds")
dist_freq_di_AorTdi_bid2_test = readRDS("data/Created/tiling_dist_freq_di_AorTdi_bid2_test.rds")
dist_freq_di_CorGdi_bid2_test = readRDS("data/Created/tiling_dist_freq_di_CorGdi_bid2_test.rds")

fourier_6_mod_random = readRDS("data/Created/random_fourier_6_mod.rds")
fourier_6_mod_random_test = readRDS("data/Created/random_fourier_6_mod_test.rds")

fourier_6_mod_random_all = rbind(fourier_6_mod_random, fourier_6_mod_random_test)

dist_freq_di_AorTdi_bid2_random_all = readRDS("data/Created/random_all_dist_freq_di_AorTdi_bid2.rds")
dist_freq_di_CorGdi_bid2_random_all = readRDS("data/Created/random_all_dist_freq_di_CorGdi_bid2.rds")

fourier_6_mod_chrV = readRDS("data/Created/chrV_fourier_6_mod.rds")
fourier_6_mod_chrV_test = readRDS("data/Created/chrV_fourier_6_mod_test.rds")

fourier_6_mod_chrV_all = rbind(fourier_6_mod_chrV, fourier_6_mod_chrV_test)

dist_freq_di_AorTdi_bid2_chrV_all = readRDS("data/Created/chrV_all_dist_freq_di_AorTdi_bid2.rds")
dist_freq_di_CorGdi_bid2_chrV_all = readRDS("data/Created/chrV_all_dist_freq_di_CorGdi_bid2.rds")

fourier_6_mod_yeast = readRDS("data/Created/yeast_fourier_6_mod.rds")
fourier_6_mod_yeast_test = readRDS("data/Created/yeast_fourier_6_mod_test.rds")

fourier_6_mod_yeast_all = rbind(fourier_6_mod_yeast, fourier_6_mod_yeast_test)

dist_freq_di_AorTdi_bid2_yeast_all = readRDS("data/Created/yeast_all_dist_freq_di_AorTdi_bid2.rds")
dist_freq_di_CorGdi_bid2_yeast_all = readRDS("data/Created/yeast_all_dist_freq_di_CorGdi_bid2.rds")
```

## Squared value of Fourier features

### Simple Linear Model

```{r}
dat_all_dist_freq_di_AorTdi_bid16 = cbind(dat %>% select(all_of(trinucleotides), 
                                                         C0_new),
                                          (fourier_6_mod)^2, 
                                          dist_freq_di_AorTdi_bid2,
                                          dist_freq_di_CorGdi_bid2)

all_dist_freq_di_AorTdi_bid16_lm = lm(C0_new~., data=dat_all_dist_freq_di_AorTdi_bid16)
cor(all_dist_freq_di_AorTdi_bid16_lm$fitted.values, y)
# 0.7492692

dat_test_all_dist_freq_di_AorTdi_bid16 = cbind(dat_test %>% select(all_of(trinucleotides), 
                                                                   C0_new),
                                               (fourier_6_mod_test)^2, 
                                               dist_freq_di_AorTdi_bid2_test,
                                               dist_freq_di_CorGdi_bid2_test)

all_dist_freq_di_AorTdi_bid16_pred = predict(all_dist_freq_di_AorTdi_bid16_lm, dat_test_all_dist_freq_di_AorTdi_bid16)

cor(all_dist_freq_di_AorTdi_bid16_pred, y_test)
# 0.7462259

mean((all_dist_freq_di_AorTdi_bid16_pred - y_test)^2)
# 0.1068494

dat_random_all_all_dist_freq_di_AorTdi_bid16 = cbind(dat_random_all %>% 
                                                       select(all_of(trinucleotides),
                                                              C0_new),
                                                     (fourier_6_mod_random_all)^2,
                                                     dist_freq_di_AorTdi_bid2_random_all,
                                                     dist_freq_di_CorGdi_bid2_random_all)

all_dist_freq_di_AorTdi_bid16_pred_random_all = predict(all_dist_freq_di_AorTdi_bid16_lm, dat_random_all_all_dist_freq_di_AorTdi_bid16)

cor(all_dist_freq_di_AorTdi_bid16_pred_random_all, y_random_all)
# 0.682709

mean((all_dist_freq_di_AorTdi_bid16_pred_random_all - y_random_all)^2)
# 0.07928398

dat_chrV_all_all_dist_freq_di_AorTdi_bid16 = cbind(dat_chrV_all %>% 
                                                     select(all_of(trinucleotides),
                                                            C0_new),
                                                   (fourier_6_mod_chrV_all)^2,
                                                   dist_freq_di_AorTdi_bid2_chrV_all,
                                                   dist_freq_di_CorGdi_bid2_chrV_all)

all_dist_freq_di_AorTdi_bid16_pred_chrV_all = predict(all_dist_freq_di_AorTdi_bid16_lm, dat_chrV_all_all_dist_freq_di_AorTdi_bid16)

cor(all_dist_freq_di_AorTdi_bid16_pred_chrV_all, y_chrV_all)
# 0.6043654

mean((all_dist_freq_di_AorTdi_bid16_pred_chrV_all - y_chrV_all)^2)
# 0.1851991

dat_yeast_all_all_dist_freq_di_AorTdi_bid16 = cbind(dat_yeast_all %>% 
                                                      select(all_of(trinucleotides),
                                                             C0_new),
                                                    (fourier_6_mod_yeast_all)^2,
                                                    dist_freq_di_AorTdi_bid2_yeast_all,
                                                    dist_freq_di_CorGdi_bid2_yeast_all)

all_dist_freq_di_AorTdi_bid16_pred_yeast_all = predict(all_dist_freq_di_AorTdi_bid16_lm, dat_yeast_all_all_dist_freq_di_AorTdi_bid16)

cor(all_dist_freq_di_AorTdi_bid16_pred_yeast_all, y_yeast_all)
# 0.681135

mean((all_dist_freq_di_AorTdi_bid16_pred_yeast_all - y_yeast_all)^2)
# 0.1169701
```

We get test prediction correlation of  and MSE of 
We get test prediction correlation of  and MSE of  on the Random Library
We get test prediction correlation of 0.6043654 and MSE of 0.1851991 on the ChrV Library
We get test prediction correlation of 0.681135 and MSE of 0.1169701 on the Yeast Library

### Lasso Model

```{r}
X_all_dist_freq_di_AorTdi_bid16 = dat_all_dist_freq_di_AorTdi_bid16 %>%
  select(-C0_new)

x_all_dist_freq_di_AorTdi_bid16 = sparse.model.matrix(~., data=X_all_dist_freq_di_AorTdi_bid16)

set.seed(50)
la.model_all_dist_freq_di_AorTdi_bid16 = cv.glmnet(x_all_dist_freq_di_AorTdi_bid16, y, alpha=1, family="gaussian")

la.all_dist_freq_di_AorTdi_bid16_best_lambda = la.model_all_dist_freq_di_AorTdi_bid16$lambda.min

sum(coef(la.model_all_dist_freq_di_AorTdi_bid16, s=la.all_dist_freq_di_AorTdi_bid16_best_lambda) != 0)
# 

la.all_dist_freq_di_AorTdi_bid16_lambda_1se = la.model_all_dist_freq_di_AorTdi_bid16$lambda.1se

sum(coef(la.model_all_dist_freq_di_AorTdi_bid16, s=la.all_dist_freq_di_AorTdi_bid16_lambda_1se) != 0)
# 

saveRDS(la.model_all_dist_freq_di_AorTdi_bid16, "model/lasso-all_dist_freq_di_AorTdi_bid16.rds")

la.model_all_dist_freq_di_AorTdi_bid16.train_pred = predict(la.model_all_dist_freq_di_AorTdi_bid16, newx = x_all_dist_freq_di_AorTdi_bid16, s=la.all_dist_freq_di_AorTdi_bid16_best_lambda)

cor(la.model_all_dist_freq_di_AorTdi_bid16.train_pred, y, method="pearson")
# 

mean((la.model_all_dist_freq_di_AorTdi_bid16.train_pred - y)^2)
# 

la.model_all_dist_freq_di_AorTdi_bid16.train_pred2 = predict(la.model_all_dist_freq_di_AorTdi_bid16, newx = x_all_dist_freq_di_AorTdi_bid16, s=la.all_dist_freq_di_AorTdi_bid16_lambda_1se)

cor(la.model_all_dist_freq_di_AorTdi_bid16.train_pred2, y, method="pearson")
# 

mean((la.model_all_dist_freq_di_AorTdi_bid16.train_pred2 - y)^2)
# 

X_all_dist_freq_di_AorTdi_bid16_test = dat_test_all_dist_freq_di_AorTdi_bid16 %>%
  select(-C0_new)
x_all_dist_freq_di_AorTdi_bid16_test = sparse.model.matrix(~., data=X_all_dist_freq_di_AorTdi_bid16_test)

# Predict values for test dataset:
la.model_all_dist_freq_di_AorTdi_bid16.pred = predict(la.model_all_dist_freq_di_AorTdi_bid16, newx = x_all_dist_freq_di_AorTdi_bid16_test, s=la.all_dist_freq_di_AorTdi_bid16_best_lambda)

# Prediction accuracy with test data:
cor(la.model_all_dist_freq_di_AorTdi_bid16.pred, y_test, method="pearson")
# 

mean((la.model_all_dist_freq_di_AorTdi_bid16.pred - y_test)^2)
# 

la.model_all_dist_freq_di_AorTdi_bid16.pred2 = predict(la.model_all_dist_freq_di_AorTdi_bid16, newx = x_all_dist_freq_di_AorTdi_bid16_test, s=la.all_dist_freq_di_AorTdi_bid16_lambda_1se)

# Prediction accuracy with test data:
cor(la.model_all_dist_freq_di_AorTdi_bid16.pred2, y_test, method="pearson")
# 

mean((la.model_all_dist_freq_di_AorTdi_bid16.pred2 - y_test)^2)
# 


X_all_dist_freq_di_AorTdi_bid16_random_all = dat_random_all_all_dist_freq_di_AorTdi_bid16 %>%
  select(-C0_new)
x_all_dist_freq_di_AorTdi_bid16_random_all = sparse.model.matrix(~., data=X_all_dist_freq_di_AorTdi_bid16_random_all)

# Predict values for random dataset:
la.model_all_dist_freq_di_AorTdi_bid16.pred_random_all = predict(la.model_all_dist_freq_di_AorTdi_bid16, newx = x_all_dist_freq_di_AorTdi_bid16_random_all, s=la.all_dist_freq_di_AorTdi_bid16_best_lambda)

# Prediction accuracy with random data:
cor(la.model_all_dist_freq_di_AorTdi_bid16.pred_random_all, y_random_all, method="pearson")
# 

mean((la.model_all_dist_freq_di_AorTdi_bid16.pred_random_all - y_random_all)^2)
# 

la.model_all_dist_freq_di_AorTdi_bid16.pred2_random_all = predict(la.model_all_dist_freq_di_AorTdi_bid16, newx = x_all_dist_freq_di_AorTdi_bid16_random_all, s=la.all_dist_freq_di_AorTdi_bid16_lambda_1se)

# Prediction accuracy with random data:
cor(la.model_all_dist_freq_di_AorTdi_bid16.pred2_random_all, y_random_all, method="pearson")
# 

mean((la.model_all_dist_freq_di_AorTdi_bid16.pred2_random_all - y_random_all)^2)
# 
```

We get test prediction correlation of  and MSE of  with min lasso ( nonzero)
We get test prediction correlation of  and MSE of  with lasso 1se ( nonzero)
We get prediction correlation of  on the random library with min lasso
We get prediction correlation of  on the random library with lasso 1se



### LightGBM (tree-based) Model

```{r}
library(lightgbm)
source("scripts/functions/lgbm-helper-functions.R")
set.seed(50)
dat_all_dist_freq_di_AorTdi_bid16.lgb_train_set = dat_all_dist_freq_di_AorTdi_bid16 %>%
  select(-C0_new)
dat_all_dist_freq_di_AorTdi_bid16.lgb_train_rules = lgb.convert_with_rules(data = dat_all_dist_freq_di_AorTdi_bid16.lgb_train_set)
dat_all_dist_freq_di_AorTdi_bid16.lgb_train_data = lgb.Dataset(data = as.matrix(dat_all_dist_freq_di_AorTdi_bid16.lgb_train_rules$data),
                                                               label = dat_all_dist_freq_di_AorTdi_bid16$C0_new,
                                                               categorical_feature = handle_categorical(colnames(dat_all_dist_freq_di_AorTdi_bid16.lgb_train_rules$data)))
dat_all_dist_freq_di_AorTdi_bid16.lgb_test_set = dat_test_all_dist_freq_di_AorTdi_bid16 %>%
  select(-C0_new)
dat_all_dist_freq_di_AorTdi_bid16.lgb_test_matrix = as.matrix(lgb.convert_with_rules(data = dat_all_dist_freq_di_AorTdi_bid16.lgb_test_set, rules = dat_all_dist_freq_di_AorTdi_bid16.lgb_train_rules$rules)$data)
dat_all_dist_freq_di_AorTdi_bid16.lgb_test_data = lgb.Dataset(data = dat_all_dist_freq_di_AorTdi_bid16.lgb_test_matrix,
                                                              label = dat_test_all_dist_freq_di_AorTdi_bid16$C0_new,
                                                              categorical_feature = handle_categorical(colnames(dat_all_dist_freq_di_AorTdi_bid16.lgb_test_matrix)))
dat_all_dist_freq_di_AorTdi_bid16.lgb_obj = lightgbm(data = dat_all_dist_freq_di_AorTdi_bid16.lgb_train_data,
                                                     params = list(learning_rate = c(0.1),
                                                                   objective = c("regression"),
                                                                   min_data_in_leaf = 100,
                                                                   max_depth = c(5),
                                                                   num_leaves = c(1000),
                                                                   lambda_l2 = c(1),
                                                                   boosting = c("gbdt")),
                                                     valids = list(valid = dat_all_dist_freq_di_AorTdi_bid16.lgb_test_data),
                                                     nrounds = 8000,
                                                     early_stopping_rounds = 50)

dat_all_dist_freq_di_AorTdi_bid16.lgb_train_pred = predict(dat_all_dist_freq_di_AorTdi_bid16.lgb_obj, data = as.matrix(dat_all_dist_freq_di_AorTdi_bid16.lgb_train_rules$data))
cor(dat_all_dist_freq_di_AorTdi_bid16.lgb_train_pred, y, method="pearson")
#  (nrounds = )

dat_all_dist_freq_di_AorTdi_bid16.lgb_test_pred = predict(dat_all_dist_freq_di_AorTdi_bid16.lgb_obj, data = dat_all_dist_freq_di_AorTdi_bid16.lgb_test_matrix)

cor(dat_all_dist_freq_di_AorTdi_bid16.lgb_test_pred, y_test, method="pearson")
#  (nrounds = )

mean((dat_all_dist_freq_di_AorTdi_bid16.lgb_test_pred - y_test)^2)
#  (nrounds = )

dat_random_all_all_dist_freq_di_AorTdi_bid16.lgb_test_set = dat_random_all_all_dist_freq_di_AorTdi_bid16 %>%
  select(-C0_new)

dat_random_all_all_dist_freq_di_AorTdi_bid16.lgb_test_matrix = as.matrix(lgb.convert_with_rules(data = dat_random_all_all_dist_freq_di_AorTdi_bid16.lgb_test_set, rules = dat_all_dist_freq_di_AorTdi_bid16.lgb_train_rules$rules)$data)

dat_random_all_all_dist_freq_di_AorTdi_bid16.lgb_test_pred = predict(dat_all_dist_freq_di_AorTdi_bid16.lgb_obj, data = dat_random_all_all_dist_freq_di_AorTdi_bid16.lgb_test_matrix)

cor(dat_random_all_all_dist_freq_di_AorTdi_bid16.lgb_test_pred, y_random_all, method="pearson")
# 

mean((dat_random_all_all_dist_freq_di_AorTdi_bid16.lgb_test_pred - y_random_all)^2)
# 

dat_chrV_all_all_dist_freq_di_AorTdi_bid16.lgb_test_set = dat_chrV_all_all_dist_freq_di_AorTdi_bid16 %>%
  select(-C0_new)

dat_chrV_all_all_dist_freq_di_AorTdi_bid16.lgb_test_matrix = as.matrix(lgb.convert_with_rules(data = dat_chrV_all_all_dist_freq_di_AorTdi_bid16.lgb_test_set, rules = dat_all_dist_freq_di_AorTdi_bid16.lgb_train_rules$rules)$data)

dat_chrV_all_all_dist_freq_di_AorTdi_bid16.lgb_test_pred = predict(dat_all_dist_freq_di_AorTdi_bid16.lgb_obj, data = dat_chrV_all_all_dist_freq_di_AorTdi_bid16.lgb_test_matrix)

cor(dat_chrV_all_all_dist_freq_di_AorTdi_bid16.lgb_test_pred, y_chrV_all, method="pearson")
# 

mean((dat_chrV_all_all_dist_freq_di_AorTdi_bid16.lgb_test_pred - y_chrV_all)^2)
# 


dat_yeast_all_all_dist_freq_di_AorTdi_bid16.lgb_test_set = dat_yeast_all_all_dist_freq_di_AorTdi_bid16 %>%
  select(-C0_new)

dat_yeast_all_all_dist_freq_di_AorTdi_bid16.lgb_test_matrix = as.matrix(lgb.convert_with_rules(data = dat_yeast_all_all_dist_freq_di_AorTdi_bid16.lgb_test_set, rules = dat_all_dist_freq_di_AorTdi_bid16.lgb_train_rules$rules)$data)

dat_yeast_all_all_dist_freq_di_AorTdi_bid16.lgb_test_pred = predict(dat_all_dist_freq_di_AorTdi_bid16.lgb_obj, data = dat_yeast_all_all_dist_freq_di_AorTdi_bid16.lgb_test_matrix)

cor(dat_yeast_all_all_dist_freq_di_AorTdi_bid16.lgb_test_pred, y_yeast_all, method="pearson")
# 

mean((dat_yeast_all_all_dist_freq_di_AorTdi_bid16.lgb_test_pred - y_yeast_all)^2)
# 
```

We get test prediction correlation of  and MSE of 

```{r}
dat_all_dist_freq_di_AorTdi_bid16.feature_importance = as.data.frame(lgb.importance(dat_all_dist_freq_di_AorTdi_bid16.lgb_obj)) %>%
  mutate(Feature = fct_rev(fct_inorder(Feature))) %>%
  dplyr::slice(1:50) %>%
  ggplot(aes(x = Feature, y = Gain)) +
  geom_col(fill = "dodgerblue") +
  coord_flip() +
  theme_bw()
dat_all_dist_freq_di_AorTdi_bid16.feature_importance
```


# Inputs: Position Specific Dinucleotides + Fourier Features Based on all Dinucleotides with h=6 (period 9.8) + Modulus of Difference of Fourier Features Based on all Dinucleotides with h=6 (period 9.8) Calculated using fft + All Distance Frequency Between Dinucleotides and AA/TT/AT/TA or CC/GG/CG/GC Dinucleotides

```{r}
ps2 <- paste0("X", 1:49, "di")

fourier_di_cos = readRDS("data/Created/tiling_fourier_di_cos.rds")
fourier_di_sin = readRDS("data/Created/tiling_fourier_di_sin.rds")
fourier_di_cos_test = readRDS("data/Created/tiling_fourier_di_cos_test.rds")
fourier_di_sin_test = readRDS("data/Created/tiling_fourier_di_sin_test.rds")

fourier_di_cos_6 = as.data.frame(fourier_di_cos) %>% select(ends_with("_6"))
fourier_di_sin_6 = as.data.frame(fourier_di_sin) %>% select(ends_with("_6"))
fourier_di_cos_6_test = as.data.frame(fourier_di_cos_test) %>% select(ends_with("_6"))
fourier_di_sin_6_test = as.data.frame(fourier_di_sin_test) %>% select(ends_with("_6"))

fourier_6_mod = readRDS("data/Created/tiling_fourier_6_mod.rds")
fourier_6_mod_test = readRDS("data/Created/tiling_fourier_6_mod_test.rds")

dist_freq_di_AorTdi_bid2 = readRDS("data/Created/tiling_dist_freq_di_AorTdi_bid2.rds")
dist_freq_di_CorGdi_bid2 = readRDS("data/Created/tiling_dist_freq_di_CorGdi_bid2.rds")
dist_freq_di_AorTdi_bid2_test = readRDS("data/Created/tiling_dist_freq_di_AorTdi_bid2_test.rds")
dist_freq_di_CorGdi_bid2_test = readRDS("data/Created/tiling_dist_freq_di_CorGdi_bid2_test.rds")
```

## Squared value of Fourier features

### Simple Linear Model

```{r}
dat_all_dist_freq_di_AorTdi_bid10 = cbind(dat %>% select(all_of(ps2), C0_new), 
                                          (fourier_di_cos_6)^2, 
                                          (fourier_di_sin_6)^2, 
                                          (fourier_6_mod)^2, 
                                          dist_freq_di_AorTdi_bid2,
                                          dist_freq_di_CorGdi_bid2)

all_dist_freq_di_AorTdi_bid10_lm = lm(C0_new~., data=dat_all_dist_freq_di_AorTdi_bid10)
cor(all_dist_freq_di_AorTdi_bid10_lm$fitted.values, y)
# 0.7654352

dat_test_all_dist_freq_di_AorTdi_bid10 = cbind(dat_test %>% select(all_of(ps2), 
                                                                   C0_new), 
                                               (fourier_di_cos_6_test)^2, 
                                               (fourier_di_sin_6_test)^2, 
                                               (fourier_6_mod_test)^2, 
                                               dist_freq_di_AorTdi_bid2_test,
                                               dist_freq_di_CorGdi_bid2_test)

all_dist_freq_di_AorTdi_bid10_pred = predict(all_dist_freq_di_AorTdi_bid10_lm, dat_test_all_dist_freq_di_AorTdi_bid10)

cor(all_dist_freq_di_AorTdi_bid10_pred, y_test)
# 0.7596893

mean((all_dist_freq_di_AorTdi_bid10_pred - y_test)^2)
# 0.1019475

dat_random_all_all_dist_freq_di_AorTdi_bid10 = cbind(dat_random_all %>% select(all_of(ps2),
                                                                               C0_new),
                                                     (fourier_di_cos_6_random_all)^2,
                                                     (fourier_di_sin_6_random_all)^2,
                                                     (fourier_6_mod_random_all)^2,
                                                     dist_freq_di_AorTdi_bid2_random_all,
                                                     dist_freq_di_CorGdi_bid2_random_all)

all_dist_freq_di_AorTdi_bid10_pred_random_all = predict(all_dist_freq_di_AorTdi_bid10_lm, dat_random_all_all_dist_freq_di_AorTdi_bid10)

cor(all_dist_freq_di_AorTdi_bid10_pred_random_all, y_random_all)
# 0.6838798

mean((all_dist_freq_di_AorTdi_bid10_pred_random_all - y_random_all)^2)
# 0.07890492
```

We get test prediction correlation of 0.7596893 and MSE of 0.1019475
We get test prediction correlation of 0.6838798 and MSE of 0.07890492 on the Random Library

### LightGBM (tree-based) Model

```{r}
library(lightgbm)
source("scripts/functions/lgbm-helper-functions.R")
set.seed(50)
dat_all_dist_freq_di_AorTdi_bid10.lgb_train_set = dat_all_dist_freq_di_AorTdi_bid10 %>%
  select(-C0_new)
dat_all_dist_freq_di_AorTdi_bid10.lgb_train_rules = lgb.convert_with_rules(data = dat_all_dist_freq_di_AorTdi_bid10.lgb_train_set)
dat_all_dist_freq_di_AorTdi_bid10.lgb_train_data = lgb.Dataset(data = as.matrix(dat_all_dist_freq_di_AorTdi_bid10.lgb_train_rules$data),
                                                               label = dat_all_dist_freq_di_AorTdi_bid10$C0_new,
                                                               categorical_feature = handle_categorical(colnames(dat_all_dist_freq_di_AorTdi_bid10.lgb_train_rules$data)))
dat_all_dist_freq_di_AorTdi_bid10.lgb_test_set = dat_test_all_dist_freq_di_AorTdi_bid10 %>%
  select(-C0_new)
dat_all_dist_freq_di_AorTdi_bid10.lgb_test_matrix = as.matrix(lgb.convert_with_rules(data = dat_all_dist_freq_di_AorTdi_bid10.lgb_test_set, rules = dat_all_dist_freq_di_AorTdi_bid10.lgb_train_rules$rules)$data)
dat_all_dist_freq_di_AorTdi_bid10.lgb_test_data = lgb.Dataset(data = dat_all_dist_freq_di_AorTdi_bid10.lgb_test_matrix,
                                                              label = dat_test_all_dist_freq_di_AorTdi_bid10$C0_new,
                                                              categorical_feature = handle_categorical(colnames(dat_all_dist_freq_di_AorTdi_bid10.lgb_test_matrix)))
dat_all_dist_freq_di_AorTdi_bid10.lgb_obj = lightgbm(data = dat_all_dist_freq_di_AorTdi_bid10.lgb_train_data,
                                                     params = list(learning_rate = c(0.1),
                                                                   objective = c("regression"),
                                                                   min_data_in_leaf = 100,
                                                                   max_depth = c(5),
                                                                   num_leaves = c(1000),
                                                                   lambda_l2 = c(1),
                                                                   boosting = c("gbdt")),
                                                     valids = list(valid = dat_all_dist_freq_di_AorTdi_bid10.lgb_test_data),
                                                     nrounds = 8000,
                                                     early_stopping_rounds = 50)

dat_all_dist_freq_di_AorTdi_bid10.lgb_train_pred = predict(dat_all_dist_freq_di_AorTdi_bid10.lgb_obj, data = as.matrix(dat_all_dist_freq_di_AorTdi_bid10.lgb_train_rules$data))
cor(dat_all_dist_freq_di_AorTdi_bid10.lgb_train_pred, y, method="pearson")
# 0.9751298 (nrounds = 1992)

dat_all_dist_freq_di_AorTdi_bid10.lgb_test_pred = predict(dat_all_dist_freq_di_AorTdi_bid10.lgb_obj, data = dat_all_dist_freq_di_AorTdi_bid10.lgb_test_matrix)

cor(dat_all_dist_freq_di_AorTdi_bid10.lgb_test_pred, y_test, method="pearson")
# 0.7501021 (nrounds = 1992)

mean((dat_all_dist_freq_di_AorTdi_bid10.lgb_test_pred - y_test)^2)
# 0.1057021 (nrounds = 1992)
```

We get test prediction correlation of 0.7501021 and MSE of 0.1057021

```{r}
dat_all_dist_freq_di_AorTdi_bid10.feature_importance = as.data.frame(lgb.importance(dat_all_dist_freq_di_AorTdi_bid10.lgb_obj)) %>%
  mutate(Feature = fct_rev(fct_inorder(Feature))) %>%
  dplyr::slice(1:50) %>%
  ggplot(aes(x = Feature, y = Gain)) +
  geom_col(fill = "dodgerblue") +
  coord_flip() +
  theme_bw()
dat_all_dist_freq_di_AorTdi_bid10.feature_importance
```



# Inputs: Position Specific Dinucleotides + Counts of Trinucleotides + Fourier Features Based on all Dinucleotides with h=6 (period 9.8) + Modulus of Difference of Fourier Features Based on all Dinucleotides with h=6 (period 9.8) Calculated using fft + All Distance Frequency Between Dinucleotides and AA/TT/AT/TA or CC/GG/CG/GC Dinucleotides

```{r}
library(Matrix)
library(glmnet)
ps2 <- paste0("X", 1:49, "di")

nucleotides <- c("A", "C", "G", "T")
dinucleotides <- gtools::permutations(n = 4, r = 2, v = nucleotides,
                                      repeats.allowed = TRUE) %>%
  apply(1, paste, collapse = "")
trinucleotides <- gtools::permutations(n = 4, r = 3, v = nucleotides,
                                       repeats.allowed = TRUE) %>%
  apply(1, paste, collapse = "")

fourier_di_cos = readRDS("data/Created/tiling_fourier_di_cos.rds")
fourier_di_sin = readRDS("data/Created/tiling_fourier_di_sin.rds")
fourier_di_cos_test = readRDS("data/Created/tiling_fourier_di_cos_test.rds")
fourier_di_sin_test = readRDS("data/Created/tiling_fourier_di_sin_test.rds")

fourier_di_cos_6 = as.data.frame(fourier_di_cos) %>% select(ends_with("_6"))
fourier_di_sin_6 = as.data.frame(fourier_di_sin) %>% select(ends_with("_6"))
fourier_di_cos_6_test = as.data.frame(fourier_di_cos_test) %>% select(ends_with("_6"))
fourier_di_sin_6_test = as.data.frame(fourier_di_sin_test) %>% select(ends_with("_6"))

fourier_6_mod = readRDS("data/Created/tiling_fourier_6_mod.rds")
fourier_6_mod_test = readRDS("data/Created/tiling_fourier_6_mod_test.rds")

dist_freq_di_AorTdi_bid2 = readRDS("data/Created/tiling_dist_freq_di_AorTdi_bid2.rds")
dist_freq_di_CorGdi_bid2 = readRDS("data/Created/tiling_dist_freq_di_CorGdi_bid2.rds")
dist_freq_di_AorTdi_bid2_test = readRDS("data/Created/tiling_dist_freq_di_AorTdi_bid2_test.rds")
dist_freq_di_CorGdi_bid2_test = readRDS("data/Created/tiling_dist_freq_di_CorGdi_bid2_test.rds")

fourier_di_cos_random = readRDS("data/Created/random_fourier_di_cos.rds")
fourier_di_sin_random = readRDS("data/Created/random_fourier_di_sin.rds")
fourier_di_cos_random_test = readRDS("data/Created/random_fourier_di_cos_test.rds")
fourier_di_sin_random_test = readRDS("data/Created/random_fourier_di_sin_test.rds")

fourier_di_cos_random_all = rbind(fourier_di_cos_random, fourier_di_cos_random_test)
fourier_di_sin_random_all = rbind(fourier_di_sin_random, fourier_di_sin_random_test)

fourier_di_cos_6_random = as.data.frame(fourier_di_cos_random) %>% select(ends_with("_6"))
fourier_di_sin_6_random = as.data.frame(fourier_di_sin_random) %>% select(ends_with("_6"))
fourier_di_cos_6_random_test = as.data.frame(fourier_di_cos_random_test) %>% select(ends_with("_6"))
fourier_di_sin_6_random_test = as.data.frame(fourier_di_sin_random_test) %>% select(ends_with("_6"))

fourier_di_cos_6_random_all = rbind(fourier_di_cos_6_random, fourier_di_cos_6_random_test)
fourier_di_sin_6_random_all = rbind(fourier_di_sin_6_random, fourier_di_sin_6_random_test)

fourier_6_mod_random = readRDS("data/Created/random_fourier_6_mod.rds")
fourier_6_mod_random_test = readRDS("data/Created/random_fourier_6_mod_test.rds")

fourier_6_mod_random_all = rbind(fourier_6_mod_random, fourier_6_mod_random_test)

dist_freq_di_AorTdi_bid2_random_all = readRDS("data/Created/random_all_dist_freq_di_AorTdi_bid2.rds")
dist_freq_di_CorGdi_bid2_random_all = readRDS("data/Created/random_all_dist_freq_di_CorGdi_bid2.rds")

fourier_di_cos_chrV = readRDS("data/Created/chrV_fourier_di_cos.rds")
fourier_di_sin_chrV = readRDS("data/Created/chrV_fourier_di_sin.rds")
fourier_di_cos_chrV_test = readRDS("data/Created/chrV_fourier_di_cos_test.rds")
fourier_di_sin_chrV_test = readRDS("data/Created/chrV_fourier_di_sin_test.rds")

fourier_di_cos_chrV_all = rbind(fourier_di_cos_chrV, fourier_di_cos_chrV_test)
fourier_di_sin_chrV_all = rbind(fourier_di_sin_chrV, fourier_di_sin_chrV_test)

fourier_di_cos_6_chrV = as.data.frame(fourier_di_cos_chrV) %>% select(ends_with("_6"))
fourier_di_sin_6_chrV = as.data.frame(fourier_di_sin_chrV) %>% select(ends_with("_6"))
fourier_di_cos_6_chrV_test = as.data.frame(fourier_di_cos_chrV_test) %>% select(ends_with("_6"))
fourier_di_sin_6_chrV_test = as.data.frame(fourier_di_sin_chrV_test) %>% select(ends_with("_6"))

fourier_di_cos_6_chrV_all = rbind(fourier_di_cos_6_chrV, fourier_di_cos_6_chrV_test)
fourier_di_sin_6_chrV_all = rbind(fourier_di_sin_6_chrV, fourier_di_sin_6_chrV_test)

fourier_6_mod_chrV = readRDS("data/Created/chrV_fourier_6_mod.rds")
fourier_6_mod_chrV_test = readRDS("data/Created/chrV_fourier_6_mod_test.rds")

fourier_6_mod_chrV_all = rbind(fourier_6_mod_chrV, fourier_6_mod_chrV_test)

dist_freq_di_AorTdi_bid2_chrV_all = readRDS("data/Created/chrV_all_dist_freq_di_AorTdi_bid2.rds")
dist_freq_di_CorGdi_bid2_chrV_all = readRDS("data/Created/chrV_all_dist_freq_di_CorGdi_bid2.rds")


fourier_di_cos_yeast = readRDS("data/Created/yeast_fourier_di_cos.rds")
fourier_di_sin_yeast = readRDS("data/Created/yeast_fourier_di_sin.rds")
fourier_di_cos_yeast_test = readRDS("data/Created/yeast_fourier_di_cos_test.rds")
fourier_di_sin_yeast_test = readRDS("data/Created/yeast_fourier_di_sin_test.rds")

fourier_di_cos_yeast_all = rbind(fourier_di_cos_yeast, fourier_di_cos_yeast_test)
fourier_di_sin_yeast_all = rbind(fourier_di_sin_yeast, fourier_di_sin_yeast_test)

fourier_di_cos_6_yeast = as.data.frame(fourier_di_cos_yeast) %>% select(ends_with("_6"))
fourier_di_sin_6_yeast = as.data.frame(fourier_di_sin_yeast) %>% select(ends_with("_6"))
fourier_di_cos_6_yeast_test = as.data.frame(fourier_di_cos_yeast_test) %>% select(ends_with("_6"))
fourier_di_sin_6_yeast_test = as.data.frame(fourier_di_sin_yeast_test) %>% select(ends_with("_6"))

fourier_di_cos_6_yeast_all = rbind(fourier_di_cos_6_yeast, fourier_di_cos_6_yeast_test)
fourier_di_sin_6_yeast_all = rbind(fourier_di_sin_6_yeast, fourier_di_sin_6_yeast_test)

fourier_6_mod_yeast = readRDS("data/Created/yeast_fourier_6_mod.rds")
fourier_6_mod_yeast_test = readRDS("data/Created/yeast_fourier_6_mod_test.rds")

fourier_6_mod_yeast_all = rbind(fourier_6_mod_yeast, fourier_6_mod_yeast_test)

dist_freq_di_AorTdi_bid2_yeast_all = readRDS("data/Created/yeast_all_dist_freq_di_AorTdi_bid2.rds")
dist_freq_di_CorGdi_bid2_yeast_all = readRDS("data/Created/yeast_all_dist_freq_di_CorGdi_bid2.rds")
```

## Squared value of Fourier features

### Simple Linear Model

```{r}
dat_all_dist_freq_di_AorTdi_bid13 = cbind(dat %>% select(all_of(ps2), 
                                                         all_of(trinucleotides), 
                                                         C0_new), 
                                          (fourier_di_cos_6)^2, 
                                          (fourier_di_sin_6)^2, 
                                          (fourier_6_mod)^2, 
                                          dist_freq_di_AorTdi_bid2,
                                          dist_freq_di_CorGdi_bid2)

all_dist_freq_di_AorTdi_bid13_lm = lm(C0_new~., data=dat_all_dist_freq_di_AorTdi_bid13)
cor(all_dist_freq_di_AorTdi_bid13_lm$fitted.values, y)
# 0.7680881

dat_test_all_dist_freq_di_AorTdi_bid13 = cbind(dat_test %>% select(all_of(ps2), 
                                                                   all_of(trinucleotides), 
                                                                   C0_new), 
                                               (fourier_di_cos_6_test)^2, 
                                               (fourier_di_sin_6_test)^2, 
                                               (fourier_6_mod_test)^2, 
                                               dist_freq_di_AorTdi_bid2_test,
                                               dist_freq_di_CorGdi_bid2_test)

all_dist_freq_di_AorTdi_bid13_pred = predict(all_dist_freq_di_AorTdi_bid13_lm, dat_test_all_dist_freq_di_AorTdi_bid13)

cor(all_dist_freq_di_AorTdi_bid13_pred, y_test)
# 0.7617395

mean((all_dist_freq_di_AorTdi_bid13_pred - y_test)^2)
# 0.1012032

dat_random_all_all_dist_freq_di_AorTdi_bid13 = cbind(dat_random_all %>% 
                                                       select(all_of(ps2),
                                                              all_of(trinucleotides),
                                                              C0_new),
                                                     (fourier_di_cos_6_random_all)^2,
                                                     (fourier_di_sin_6_random_all)^2,
                                                     (fourier_6_mod_random_all)^2,
                                                     dist_freq_di_AorTdi_bid2_random_all,
                                                     dist_freq_di_CorGdi_bid2_random_all)

all_dist_freq_di_AorTdi_bid13_pred_random_all = predict(all_dist_freq_di_AorTdi_bid13_lm, dat_random_all_all_dist_freq_di_AorTdi_bid13)

cor(all_dist_freq_di_AorTdi_bid13_pred_random_all, y_random_all)
# 0.6928364

mean((all_dist_freq_di_AorTdi_bid13_pred_random_all - y_random_all)^2)
# 0.07716347

dat_chrV_all_all_dist_freq_di_AorTdi_bid13 = cbind(dat_chrV_all %>% 
                                                     select(all_of(ps2),
                                                            all_of(trinucleotides),
                                                            C0_new),
                                                   (fourier_di_cos_6_chrV_all)^2,
                                                   (fourier_di_sin_6_chrV_all)^2,
                                                   (fourier_6_mod_chrV_all)^2,
                                                   dist_freq_di_AorTdi_bid2_chrV_all,
                                                   dist_freq_di_CorGdi_bid2_chrV_all)

all_dist_freq_di_AorTdi_bid13_pred_chrV_all = predict(all_dist_freq_di_AorTdi_bid13_lm, dat_chrV_all_all_dist_freq_di_AorTdi_bid13)

cor(all_dist_freq_di_AorTdi_bid13_pred_chrV_all, y_chrV_all)
# 0.6202856

mean((all_dist_freq_di_AorTdi_bid13_pred_chrV_all - y_chrV_all)^2)
# 0.1795251

dat_yeast_all_all_dist_freq_di_AorTdi_bid13 = cbind(dat_yeast_all %>% 
                                                      select(all_of(ps2),
                                                             all_of(trinucleotides),
                                                             C0_new),
                                                    (fourier_di_cos_6_yeast_all)^2,
                                                    (fourier_di_sin_6_yeast_all)^2,
                                                    (fourier_6_mod_yeast_all)^2,
                                                    dist_freq_di_AorTdi_bid2_yeast_all,
                                                    dist_freq_di_CorGdi_bid2_yeast_all)

all_dist_freq_di_AorTdi_bid13_pred_yeast_all = predict(all_dist_freq_di_AorTdi_bid13_lm, dat_yeast_all_all_dist_freq_di_AorTdi_bid13)

cor(all_dist_freq_di_AorTdi_bid13_pred_yeast_all, y_yeast_all)
# 0.6953359

mean((all_dist_freq_di_AorTdi_bid13_pred_yeast_all - y_yeast_all)^2)
# 0.1128596
```

We get test prediction correlation of 0.7617395 and MSE of 0.1012032
We get test prediction correlation of 0.6928364 and MSE of 0.07716347 on the Random Library
We get test prediction correlation of 0.6202856 and MSE of 0.1795251 on the ChrV Library
We get test prediction correlation of 0.6953359 and MSE of 0.1128596 on the Yeast Library

### Lasso Model

```{r}
X_all_dist_freq_di_AorTdi_bid13 = dat_all_dist_freq_di_AorTdi_bid13 %>%
  select(-C0_new)

x_all_dist_freq_di_AorTdi_bid13 = sparse.model.matrix(~., data=X_all_dist_freq_di_AorTdi_bid13)

set.seed(50)
la.model_all_dist_freq_di_AorTdi_bid13 = cv.glmnet(x_all_dist_freq_di_AorTdi_bid13, y, alpha=1, family="gaussian")

la.all_dist_freq_di_AorTdi_bid13_best_lambda = la.model_all_dist_freq_di_AorTdi_bid13$lambda.min

sum(coef(la.model_all_dist_freq_di_AorTdi_bid13, s=la.all_dist_freq_di_AorTdi_bid13_best_lambda) != 0)
# 2245

la.all_dist_freq_di_AorTdi_bid13_lambda_1se = la.model_all_dist_freq_di_AorTdi_bid13$lambda.1se

sum(coef(la.model_all_dist_freq_di_AorTdi_bid13, s=la.all_dist_freq_di_AorTdi_bid13_lambda_1se) != 0)
# 1724

saveRDS(la.model_all_dist_freq_di_AorTdi_bid13, "model/lasso-all_dist_freq_di_AorTdi_bid13.rds")

la.model_all_dist_freq_di_AorTdi_bid13.train_pred = predict(la.model_all_dist_freq_di_AorTdi_bid13, newx = x_all_dist_freq_di_AorTdi_bid13, s=la.all_dist_freq_di_AorTdi_bid13_best_lambda)

cor(la.model_all_dist_freq_di_AorTdi_bid13.train_pred, y, method="pearson")
# 0.7673512

mean((la.model_all_dist_freq_di_AorTdi_bid13.train_pred - y)^2)
# 0.09965396

la.model_all_dist_freq_di_AorTdi_bid13.train_pred2 = predict(la.model_all_dist_freq_di_AorTdi_bid13, newx = x_all_dist_freq_di_AorTdi_bid13, s=la.all_dist_freq_di_AorTdi_bid13_lambda_1se)

cor(la.model_all_dist_freq_di_AorTdi_bid13.train_pred2, y, method="pearson")
# 0.7618309

mean((la.model_all_dist_freq_di_AorTdi_bid13.train_pred2 - y)^2)
# 0.101846

X_all_dist_freq_di_AorTdi_bid13_test = dat_test_all_dist_freq_di_AorTdi_bid13 %>%
  select(-C0_new)
x_all_dist_freq_di_AorTdi_bid13_test = sparse.model.matrix(~., data=X_all_dist_freq_di_AorTdi_bid13_test)

# Predict values for test dataset:
la.model_all_dist_freq_di_AorTdi_bid13.pred = predict(la.model_all_dist_freq_di_AorTdi_bid13, newx = x_all_dist_freq_di_AorTdi_bid13_test, s=la.all_dist_freq_di_AorTdi_bid13_best_lambda)

# Prediction accuracy with test data:
cor(la.model_all_dist_freq_di_AorTdi_bid13.pred, y_test, method="pearson")
# 0.7611932

mean((la.model_all_dist_freq_di_AorTdi_bid13.pred - y_test)^2)
# 0.1013791

la.model_all_dist_freq_di_AorTdi_bid13.pred2 = predict(la.model_all_dist_freq_di_AorTdi_bid13, newx = x_all_dist_freq_di_AorTdi_bid13_test, s=la.all_dist_freq_di_AorTdi_bid13_lambda_1se)

# Prediction accuracy with test data:
cor(la.model_all_dist_freq_di_AorTdi_bid13.pred2, y_test, method="pearson")
# 0.757092

mean((la.model_all_dist_freq_di_AorTdi_bid13.pred2 - y_test)^2)
# 0.1029183


X_all_dist_freq_di_AorTdi_bid13_random_all = dat_random_all_all_dist_freq_di_AorTdi_bid13 %>%
  select(-C0_new)
x_all_dist_freq_di_AorTdi_bid13_random_all = sparse.model.matrix(~., data=X_all_dist_freq_di_AorTdi_bid13_random_all)

# Predict values for random dataset:
la.model_all_dist_freq_di_AorTdi_bid13.pred_random_all = predict(la.model_all_dist_freq_di_AorTdi_bid13, newx = x_all_dist_freq_di_AorTdi_bid13_random_all, s=la.all_dist_freq_di_AorTdi_bid13_best_lambda)

# Prediction accuracy with random data:
cor(la.model_all_dist_freq_di_AorTdi_bid13.pred_random_all, y_random_all, method="pearson")
# 0.694014

mean((la.model_all_dist_freq_di_AorTdi_bid13.pred_random_all - y_random_all)^2)
# 0.07677589

la.model_all_dist_freq_di_AorTdi_bid13.pred2_random_all = predict(la.model_all_dist_freq_di_AorTdi_bid13, newx = x_all_dist_freq_di_AorTdi_bid13_random_all, s=la.all_dist_freq_di_AorTdi_bid13_lambda_1se)

# Prediction accuracy with random data:
cor(la.model_all_dist_freq_di_AorTdi_bid13.pred2_random_all, y_random_all, method="pearson")
# 0.6928365

mean((la.model_all_dist_freq_di_AorTdi_bid13.pred2_random_all - y_random_all)^2)
# 0.07643509
```

We get test prediction correlation of 0.7611932 and MSE of 0.1013791 with min lasso (2245 nonzero)
We get test prediction correlation of 0.757092 and MSE of 0.1029183 with lasso 1se (1724 nonzero)
We get prediction correlation of 0.694014 on the random library with min lasso
We get prediction correlation of 0.6928365 on the random library with lasso 1se



### LightGBM (tree-based) Model

```{r}
library(lightgbm)
source("scripts/functions/lgbm-helper-functions.R")
set.seed(50)
dat_all_dist_freq_di_AorTdi_bid13.lgb_train_set = dat_all_dist_freq_di_AorTdi_bid13 %>%
  select(-C0_new)
dat_all_dist_freq_di_AorTdi_bid13.lgb_train_rules = lgb.convert_with_rules(data = dat_all_dist_freq_di_AorTdi_bid13.lgb_train_set)
dat_all_dist_freq_di_AorTdi_bid13.lgb_train_data = lgb.Dataset(data = as.matrix(dat_all_dist_freq_di_AorTdi_bid13.lgb_train_rules$data),
                                                               label = dat_all_dist_freq_di_AorTdi_bid13$C0_new,
                                                               categorical_feature = handle_categorical(colnames(dat_all_dist_freq_di_AorTdi_bid13.lgb_train_rules$data)))
dat_all_dist_freq_di_AorTdi_bid13.lgb_test_set = dat_test_all_dist_freq_di_AorTdi_bid13 %>%
  select(-C0_new)
dat_all_dist_freq_di_AorTdi_bid13.lgb_test_matrix = as.matrix(lgb.convert_with_rules(data = dat_all_dist_freq_di_AorTdi_bid13.lgb_test_set, rules = dat_all_dist_freq_di_AorTdi_bid13.lgb_train_rules$rules)$data)
dat_all_dist_freq_di_AorTdi_bid13.lgb_test_data = lgb.Dataset(data = dat_all_dist_freq_di_AorTdi_bid13.lgb_test_matrix,
                                                              label = dat_test_all_dist_freq_di_AorTdi_bid13$C0_new,
                                                              categorical_feature = handle_categorical(colnames(dat_all_dist_freq_di_AorTdi_bid13.lgb_test_matrix)))
dat_all_dist_freq_di_AorTdi_bid13.lgb_obj = lightgbm(data = dat_all_dist_freq_di_AorTdi_bid13.lgb_train_data,
                                                     params = list(learning_rate = c(0.1),
                                                                   objective = c("regression"),
                                                                   min_data_in_leaf = 100,
                                                                   max_depth = c(5),
                                                                   num_leaves = c(1000),
                                                                   lambda_l2 = c(1),
                                                                   boosting = c("gbdt")),
                                                     valids = list(valid = dat_all_dist_freq_di_AorTdi_bid13.lgb_test_data),
                                                     nrounds = 8000,
                                                     early_stopping_rounds = 50)

dat_all_dist_freq_di_AorTdi_bid13.lgb_train_pred = predict(dat_all_dist_freq_di_AorTdi_bid13.lgb_obj, data = as.matrix(dat_all_dist_freq_di_AorTdi_bid13.lgb_train_rules$data))
cor(dat_all_dist_freq_di_AorTdi_bid13.lgb_train_pred, y, method="pearson")
# 0.9821211 (nrounds = 2327)

dat_all_dist_freq_di_AorTdi_bid13.lgb_test_pred = predict(dat_all_dist_freq_di_AorTdi_bid13.lgb_obj, data = dat_all_dist_freq_di_AorTdi_bid13.lgb_test_matrix)

cor(dat_all_dist_freq_di_AorTdi_bid13.lgb_test_pred, y_test, method="pearson")
# 0.7551599 (nrounds = 2327)

mean((dat_all_dist_freq_di_AorTdi_bid13.lgb_test_pred - y_test)^2)
# 0.1037649 (nrounds = 2327)

dat_random_all_all_dist_freq_di_AorTdi_bid13.lgb_test_set = dat_random_all_all_dist_freq_di_AorTdi_bid13 %>%
  select(-C0_new)

dat_random_all_all_dist_freq_di_AorTdi_bid13.lgb_test_matrix = as.matrix(lgb.convert_with_rules(data = dat_random_all_all_dist_freq_di_AorTdi_bid13.lgb_test_set, rules = dat_all_dist_freq_di_AorTdi_bid13.lgb_train_rules$rules)$data)

dat_random_all_all_dist_freq_di_AorTdi_bid13.lgb_test_pred = predict(dat_all_dist_freq_di_AorTdi_bid13.lgb_obj, data = dat_random_all_all_dist_freq_di_AorTdi_bid13.lgb_test_matrix)

cor(dat_random_all_all_dist_freq_di_AorTdi_bid13.lgb_test_pred, y_random_all, method="pearson")
# 0.6594917

mean((dat_random_all_all_dist_freq_di_AorTdi_bid13.lgb_test_pred - y_random_all)^2)
# 0.081866

dat_chrV_all_all_dist_freq_di_AorTdi_bid13.lgb_test_set = dat_chrV_all_all_dist_freq_di_AorTdi_bid13 %>%
  select(-C0_new)

dat_chrV_all_all_dist_freq_di_AorTdi_bid13.lgb_test_matrix = as.matrix(lgb.convert_with_rules(data = dat_chrV_all_all_dist_freq_di_AorTdi_bid13.lgb_test_set, rules = dat_all_dist_freq_di_AorTdi_bid13.lgb_train_rules$rules)$data)

dat_chrV_all_all_dist_freq_di_AorTdi_bid13.lgb_test_pred = predict(dat_all_dist_freq_di_AorTdi_bid13.lgb_obj, data = dat_chrV_all_all_dist_freq_di_AorTdi_bid13.lgb_test_matrix)

cor(dat_chrV_all_all_dist_freq_di_AorTdi_bid13.lgb_test_pred, y_chrV_all, method="pearson")
# 0.5874605

mean((dat_chrV_all_all_dist_freq_di_AorTdi_bid13.lgb_test_pred - y_chrV_all)^2)
# 0.1903867


dat_yeast_all_all_dist_freq_di_AorTdi_bid13.lgb_test_set = dat_yeast_all_all_dist_freq_di_AorTdi_bid13 %>%
  select(-C0_new)

dat_yeast_all_all_dist_freq_di_AorTdi_bid13.lgb_test_matrix = as.matrix(lgb.convert_with_rules(data = dat_yeast_all_all_dist_freq_di_AorTdi_bid13.lgb_test_set, rules = dat_all_dist_freq_di_AorTdi_bid13.lgb_train_rules$rules)$data)

dat_yeast_all_all_dist_freq_di_AorTdi_bid13.lgb_test_pred = predict(dat_all_dist_freq_di_AorTdi_bid13.lgb_obj, data = dat_yeast_all_all_dist_freq_di_AorTdi_bid13.lgb_test_matrix)

cor(dat_yeast_all_all_dist_freq_di_AorTdi_bid13.lgb_test_pred, y_yeast_all, method="pearson")
# 0.6595687

mean((dat_yeast_all_all_dist_freq_di_AorTdi_bid13.lgb_test_pred - y_yeast_all)^2)
# 0.1221716
```

We get test prediction correlation of 0.7551599 and MSE of 0.1037649

```{r}
dat_all_dist_freq_di_AorTdi_bid13.feature_importance = as.data.frame(lgb.importance(dat_all_dist_freq_di_AorTdi_bid13.lgb_obj)) %>%
  mutate(Feature = fct_rev(fct_inorder(Feature))) %>%
  dplyr::slice(1:50) %>%
  ggplot(aes(x = Feature, y = Gain)) +
  geom_col(fill = "dodgerblue") +
  coord_flip() +
  theme_bw()
dat_all_dist_freq_di_AorTdi_bid13.feature_importance
```


# Inputs: Position Specific Dinucleotides + Counts of Trinucleotides + Fourier Features Based on all Dinucleotides + Modulus of Difference of Fourier Features Based on all Dinucleotides with h=6 (period 9.8) Calculated using fft + All Distance Frequency Between Dinucleotides and AA/TT/AT/TA or CC/GG/CG/GC Dinucleotides

```{r}
library(Matrix)
library(glmnet)

ps2 <- paste0("X", 1:49, "di")

nucleotides <- c("A", "C", "G", "T")
dinucleotides <- gtools::permutations(n = 4, r = 2, v = nucleotides,
                                      repeats.allowed = TRUE) %>%
  apply(1, paste, collapse = "")
trinucleotides <- gtools::permutations(n = 4, r = 3, v = nucleotides,
                                       repeats.allowed = TRUE) %>%
  apply(1, paste, collapse = "")

fourier_di_cos = readRDS("data/Created/tiling_fourier_di_cos.rds")
fourier_di_sin = readRDS("data/Created/tiling_fourier_di_sin.rds")
fourier_di_cos_test = readRDS("data/Created/tiling_fourier_di_cos_test.rds")
fourier_di_sin_test = readRDS("data/Created/tiling_fourier_di_sin_test.rds")

fourier_6_mod = readRDS("data/Created/tiling_fourier_6_mod.rds")
fourier_6_mod_test = readRDS("data/Created/tiling_fourier_6_mod_test.rds")

dist_freq_di_AorTdi_bid2 = readRDS("data/Created/tiling_dist_freq_di_AorTdi_bid2.rds")
dist_freq_di_CorGdi_bid2 = readRDS("data/Created/tiling_dist_freq_di_CorGdi_bid2.rds")
dist_freq_di_AorTdi_bid2_test = readRDS("data/Created/tiling_dist_freq_di_AorTdi_bid2_test.rds")
dist_freq_di_CorGdi_bid2_test = readRDS("data/Created/tiling_dist_freq_di_CorGdi_bid2_test.rds")

fourier_di_cos_random = readRDS("data/Created/random_fourier_di_cos.rds")
fourier_di_sin_random = readRDS("data/Created/random_fourier_di_sin.rds")
fourier_di_cos_random_test = readRDS("data/Created/random_fourier_di_cos_test.rds")
fourier_di_sin_random_test = readRDS("data/Created/random_fourier_di_sin_test.rds")
fourier_di_cos_random_all = rbind(fourier_di_cos_random, fourier_di_cos_random_test)
fourier_di_sin_random_all = rbind(fourier_di_sin_random, fourier_di_sin_random_test)

fourier_6_mod_random = readRDS("data/Created/random_fourier_6_mod.rds")
fourier_6_mod_random_test = readRDS("data/Created/random_fourier_6_mod_test.rds")
fourier_6_mod_random_all = rbind(fourier_6_mod_random, fourier_6_mod_random_test)

dist_freq_di_AorTdi_bid2_random_all = readRDS("data/Created/random_all_dist_freq_di_AorTdi_bid2.rds")
dist_freq_di_CorGdi_bid2_random_all = readRDS("data/Created/random_all_dist_freq_di_CorGdi_bid2.rds")
```

## Squared value of Fourier features

### Simple Linear Model

```{r}
dat_all_dist_freq_di_AorTdi_bid15 = cbind(dat %>% select(all_of(ps2), 
                                                         all_of(trinucleotides), 
                                                         C0_new), 
                                          (fourier_di_cos)^2, 
                                          (fourier_di_sin)^2, 
                                          (fourier_6_mod)^2, 
                                          dist_freq_di_AorTdi_bid2,
                                          dist_freq_di_CorGdi_bid2)

all_dist_freq_di_AorTdi_bid15_lm = lm(C0_new~., data=dat_all_dist_freq_di_AorTdi_bid15)
cor(all_dist_freq_di_AorTdi_bid15_lm$fitted.values, y)
# 0.7734214

dat_test_all_dist_freq_di_AorTdi_bid15 = cbind(dat_test %>% select(all_of(ps2), 
                                                                   all_of(trinucleotides), 
                                                                   C0_new), 
                                               (fourier_di_cos_test)^2, 
                                               (fourier_di_sin_test)^2, 
                                               (fourier_6_mod_test)^2, 
                                               dist_freq_di_AorTdi_bid2_test,
                                               dist_freq_di_CorGdi_bid2_test)

all_dist_freq_di_AorTdi_bid15_pred = predict(all_dist_freq_di_AorTdi_bid15_lm, dat_test_all_dist_freq_di_AorTdi_bid15)

cor(all_dist_freq_di_AorTdi_bid15_pred, y_test)
# 0.7624512

mean((all_dist_freq_di_AorTdi_bid15_pred - y_test)^2)
# 0.1009599

dat_random_all_dist_freq_di_AorTdi_bid15 = cbind(dat_random_all %>% select(all_of(ps2), 
                                                                           all_of(trinucleotides), 
                                                                           C0_new), 
                                                 (fourier_di_cos_random_all)^2, 
                                                 (fourier_di_sin_random_all)^2, 
                                                 (fourier_6_mod_random_all)^2, 
                                                 dist_freq_di_AorTdi_bid2_random_all,
                                                 dist_freq_di_CorGdi_bid2_random_all)

all_dist_freq_di_AorTdi_bid15_pred_random_all = predict(all_dist_freq_di_AorTdi_bid15_lm, dat_random_all_dist_freq_di_AorTdi_bid15)

cor(all_dist_freq_di_AorTdi_bid15_pred_random_all, y_random_all)
# 0.6897165

mean((all_dist_freq_di_AorTdi_bid15_pred_random_all - y_random_all)^2)
# 0.07815438
```

We get test prediction correlation of 0.7624512 and MSE of 0.1009599
We get test prediction correlation of 0.6897165 on the random library

### Lasso Model

```{r}
X_all_dist_freq_di_AorTdi_bid15 = dat_all_dist_freq_di_AorTdi_bid15 %>%
  select(-C0_new)

x_all_dist_freq_di_AorTdi_bid15 = sparse.model.matrix(~., data=X_all_dist_freq_di_AorTdi_bid15)

set.seed(50)
la.model_all_dist_freq_di_AorTdi_bid15 = cv.glmnet(x_all_dist_freq_di_AorTdi_bid15, y, alpha=1, family="gaussian")

la.all_dist_freq_di_AorTdi_bid15_best_lambda = la.model_all_dist_freq_di_AorTdi_bid15$lambda.min

sum(coef(la.model_all_dist_freq_di_AorTdi_bid15, s=la.all_dist_freq_di_AorTdi_bid15_best_lambda) != 0)
# 2843

la.all_dist_freq_di_AorTdi_bid15_lambda_1se = la.model_all_dist_freq_di_AorTdi_bid15$lambda.1se

sum(coef(la.model_all_dist_freq_di_AorTdi_bid15, s=la.all_dist_freq_di_AorTdi_bid15_lambda_1se) != 0)
# 2196

saveRDS(la.model_all_dist_freq_di_AorTdi_bid15, "model/lasso-all_dist_freq_di_AorTdi_bid15.rds")

la.model_all_dist_freq_di_AorTdi_bid15.train_pred = predict(la.model_all_dist_freq_di_AorTdi_bid15, newx = x_all_dist_freq_di_AorTdi_bid15, s=la.all_dist_freq_di_AorTdi_bid15_best_lambda)

cor(la.model_all_dist_freq_di_AorTdi_bid15.train_pred, y, method="pearson")
# 0.7724237
mean((la.model_all_dist_freq_di_AorTdi_bid15.train_pred - y)^2)
# 0.09776919

la.model_all_dist_freq_di_AorTdi_bid15.train_pred2 = predict(la.model_all_dist_freq_di_AorTdi_bid15, newx = x_all_dist_freq_di_AorTdi_bid15, s=la.all_dist_freq_di_AorTdi_bid15_lambda_1se)

cor(la.model_all_dist_freq_di_AorTdi_bid15.train_pred2, y, method="pearson")
# 0.7662748
mean((la.model_all_dist_freq_di_AorTdi_bid15.train_pred2 - y)^2)
# 0.100239

X_all_dist_freq_di_AorTdi_bid15_test = dat_test_all_dist_freq_di_AorTdi_bid15 %>%
  select(-C0_new)
x_all_dist_freq_di_AorTdi_bid15_test = sparse.model.matrix(~., data=X_all_dist_freq_di_AorTdi_bid15_test)

# Predict values for test dataset:
la.model_all_dist_freq_di_AorTdi_bid15.pred = predict(la.model_all_dist_freq_di_AorTdi_bid15, newx = x_all_dist_freq_di_AorTdi_bid15_test, s=la.all_dist_freq_di_AorTdi_bid15_best_lambda)
# Prediction accuracy with test data:
cor(la.model_all_dist_freq_di_AorTdi_bid15.pred, y_test, method="pearson")
# 0.762398
mean((la.model_all_dist_freq_di_AorTdi_bid15.pred - y_test)^2)
# 0.1009338

la.model_all_dist_freq_di_AorTdi_bid15.pred2 = predict(la.model_all_dist_freq_di_AorTdi_bid15, newx = x_all_dist_freq_di_AorTdi_bid15_test, s=la.all_dist_freq_di_AorTdi_bid15_lambda_1se)
# Prediction accuracy with test data:
cor(la.model_all_dist_freq_di_AorTdi_bid15.pred2, y_test, method="pearson")
# 0.7589306
mean((la.model_all_dist_freq_di_AorTdi_bid15.pred2 - y_test)^2)
# 0.1022584


X_all_dist_freq_di_AorTdi_bid15_random_all = dat_random_all_dist_freq_di_AorTdi_bid15 %>%
  select(-C0_new)
x_all_dist_freq_di_AorTdi_bid15_random_all = sparse.model.matrix(~., data=X_all_dist_freq_di_AorTdi_bid15_random_all)

# Predict values for random dataset:
la.model_all_dist_freq_di_AorTdi_bid15.pred_random_all = predict(la.model_all_dist_freq_di_AorTdi_bid15, newx = x_all_dist_freq_di_AorTdi_bid15_random_all, s=la.all_dist_freq_di_AorTdi_bid15_best_lambda)
# Prediction accuracy with random data:
cor(la.model_all_dist_freq_di_AorTdi_bid15.pred_random_all, y_random_all, method="pearson")
# 0.6917298
mean((la.model_all_dist_freq_di_AorTdi_bid15.pred_random_all - y_random_all)^2)
# 0.07732333

la.model_all_dist_freq_di_AorTdi_bid15.pred2_random_all = predict(la.model_all_dist_freq_di_AorTdi_bid15, newx = x_all_dist_freq_di_AorTdi_bid15_random_all, s=la.all_dist_freq_di_AorTdi_bid15_lambda_1se)
# Prediction accuracy with random data:
cor(la.model_all_dist_freq_di_AorTdi_bid15.pred2_random_all, y_random_all, method="pearson")
# 0.6928104
mean((la.model_all_dist_freq_di_AorTdi_bid15.pred2_random_all - y_random_all)^2)
# 0.07622482
```

We get test prediction correlation of 0.762398 and MSE of 0.1009338 with min lasso (2843 nonzero)
We get test prediction correlation of 0.7589306 and MSE of 0.1022584 with lasso 1se (2196 nonzero)
We get prediction correlation of 0.6917298 on the random library with min lasso
We get prediction correlation of 0.6928104 on the random library with lasso 1se

### LightGBM (tree-based) Model

```{r}
library(lightgbm)
source("scripts/functions/lgbm-helper-functions.R")
set.seed(50)
dat_all_dist_freq_di_AorTdi_bid15.lgb_train_set = dat_all_dist_freq_di_AorTdi_bid15 %>%
  select(-C0_new)
dat_all_dist_freq_di_AorTdi_bid15.lgb_train_rules = lgb.convert_with_rules(data = dat_all_dist_freq_di_AorTdi_bid15.lgb_train_set)
dat_all_dist_freq_di_AorTdi_bid15.lgb_train_data = lgb.Dataset(data = as.matrix(dat_all_dist_freq_di_AorTdi_bid15.lgb_train_rules$data),
                                                               label = dat_all_dist_freq_di_AorTdi_bid15$C0_new,
                                                               categorical_feature = handle_categorical(colnames(dat_all_dist_freq_di_AorTdi_bid15.lgb_train_rules$data)))
dat_all_dist_freq_di_AorTdi_bid15.lgb_test_set = dat_test_all_dist_freq_di_AorTdi_bid15 %>%
  select(-C0_new)
dat_all_dist_freq_di_AorTdi_bid15.lgb_test_matrix = as.matrix(lgb.convert_with_rules(data = dat_all_dist_freq_di_AorTdi_bid15.lgb_test_set, rules = dat_all_dist_freq_di_AorTdi_bid15.lgb_train_rules$rules)$data)
dat_all_dist_freq_di_AorTdi_bid15.lgb_test_data = lgb.Dataset(data = dat_all_dist_freq_di_AorTdi_bid15.lgb_test_matrix,
                                                              label = dat_test_all_dist_freq_di_AorTdi_bid15$C0_new,
                                                              categorical_feature = handle_categorical(colnames(dat_all_dist_freq_di_AorTdi_bid15.lgb_test_matrix)))
dat_all_dist_freq_di_AorTdi_bid15.lgb_obj = lightgbm(data = dat_all_dist_freq_di_AorTdi_bid15.lgb_train_data,
                                                     params = list(learning_rate = c(0.1),
                                                                   objective = c("regression"),
                                                                   min_data_in_leaf = 100,
                                                                   max_depth = c(5),
                                                                   num_leaves = c(1000),
                                                                   lambda_l2 = c(1),
                                                                   boosting = c("gbdt")),
                                                     valids = list(valid = dat_all_dist_freq_di_AorTdi_bid15.lgb_test_data),
                                                     nrounds = 8000,
                                                     early_stopping_rounds = 50)

dat_all_dist_freq_di_AorTdi_bid15.lgb_train_pred = predict(dat_all_dist_freq_di_AorTdi_bid15.lgb_obj, data = as.matrix(dat_all_dist_freq_di_AorTdi_bid15.lgb_train_rules$data))
cor(dat_all_dist_freq_di_AorTdi_bid15.lgb_train_pred, y, method="pearson")
# 0.9829136 (nrounds = 2284)

dat_all_dist_freq_di_AorTdi_bid15.lgb_test_pred = predict(dat_all_dist_freq_di_AorTdi_bid15.lgb_obj, data = dat_all_dist_freq_di_AorTdi_bid15.lgb_test_matrix)

cor(dat_all_dist_freq_di_AorTdi_bid15.lgb_test_pred, y_test, method="pearson")
# 0.7519606 (nrounds = 2284)

mean((dat_all_dist_freq_di_AorTdi_bid15.lgb_test_pred - y_test)^2)
# 0.1049941 (nrounds = 2284)
```

We get test prediction correlation of 0.7519606 and MSE of 0.1049941

```{r}
dat_all_dist_freq_di_AorTdi_bid15.feature_importance = as.data.frame(lgb.importance(dat_all_dist_freq_di_AorTdi_bid15.lgb_obj)) %>%
  mutate(Feature = fct_rev(fct_inorder(Feature))) %>%
  dplyr::slice(1:50) %>%
  ggplot(aes(x = Feature, y = Gain)) +
  geom_col(fill = "dodgerblue") +
  coord_flip() +
  theme_bw()
dat_all_dist_freq_di_AorTdi_bid15.feature_importance
```


# Inputs: Distance Frequency Between all Dinucleotides Only

```{r}
dist_freq_di = readRDS("data/Created/tiling_dist_freq_di.rds")
dist_freq_di_test = readRDS("data/Created/tiling_dist_freq_di_test.rds")
```

## Simple Linear Model

```{r}
dat_dist_freq_di = cbind(dist_freq_di, dat %>% select(C0_new))

dist_freq_di_lm = lm(C0_new~., data=dat_dist_freq_di)
cor(dist_freq_di_lm$fitted.values, y)
# 0.6066489

dat_test_dist_freq_di = cbind(dist_freq_di_test, dat_test %>% select(C0_new))

dist_freq_di_pred = predict(dist_freq_di_lm, dat_test_dist_freq_di)

cor(dist_freq_di_pred, y_test)
# 0.606535

mean((dist_freq_di_pred - y_test)^2)
# 0.1523535
```

We get test prediction correlation of 0.606535 and MSE of 0.1523535

## LightGBM (tree-based) Model

```{r}
library(lightgbm)
source("scripts/functions/lgbm-helper-functions.R")
set.seed(50)
dat_dist_freq_di.lgb_train_set = dat_dist_freq_di %>%
  select(-C0_new)
dat_dist_freq_di.lgb_train_rules = lgb.convert_with_rules(data = dat_dist_freq_di.lgb_train_set)
dat_dist_freq_di.lgb_train_data = lgb.Dataset(data = as.matrix(dat_dist_freq_di.lgb_train_rules$data),
                                              label = dat_dist_freq_di$C0_new,
                                              categorical_feature = handle_categorical(colnames(dat_dist_freq_di.lgb_train_rules$data)))
dat_dist_freq_di.lgb_test_set = dat_test_dist_freq_di %>%
  select(-C0_new)
dat_dist_freq_di.lgb_test_matrix = as.matrix(lgb.convert_with_rules(data = dat_dist_freq_di.lgb_test_set, rules = dat_dist_freq_di.lgb_train_rules$rules)$data)
dat_dist_freq_di.lgb_test_data = lgb.Dataset(data = dat_dist_freq_di.lgb_test_matrix,
                                             label = dat_test_dist_freq_di$C0_new,
                                             categorical_feature = handle_categorical(colnames(dat_dist_freq_di.lgb_test_matrix)))
dat_dist_freq_di.lgb_obj = lightgbm(data = dat_dist_freq_di.lgb_train_data,
                                    params = list(learning_rate = c(0.1),
                                                  objective = c("regression"),
                                                  min_data_in_leaf = 100,
                                                  max_depth = c(5),
                                                  num_leaves = c(1000),
                                                  lambda_l2 = c(1),
                                                  boosting = c("gbdt")),
                                    valids = list(valid = dat_dist_freq_di.lgb_test_data),
                                    nrounds = 8000,
                                    early_stopping_rounds = 50)

dat_dist_freq_di.lgb_train_pred = predict(dat_dist_freq_di.lgb_obj, data = as.matrix(dat_dist_freq_di.lgb_train_rules$data))
cor(dat_dist_freq_di.lgb_train_pred, y, method="pearson")
# 0.9604007 (nrounds = 6357)

dat_dist_freq_di.lgb_test_pred = predict(dat_dist_freq_di.lgb_obj, data = dat_dist_freq_di.lgb_test_matrix)

cor(dat_dist_freq_di.lgb_test_pred, y_test, method="pearson")
# 0.7391824 (nrounds = 6357)

mean((dat_dist_freq_di.lgb_test_pred - y_test)^2)
# 0.1093523 (nrounds = 6357)
```

We get test prediction correlation of 0.7391824 and MSE of 0.1093523

```{r}
dat_dist_freq_di.feature_importance = as.data.frame(lgb.importance(dat_dist_freq_di.lgb_obj)) %>%
  mutate(Feature = fct_rev(fct_inorder(Feature))) %>%
  dplyr::slice(1:50) %>%
  ggplot(aes(x = Feature, y = Gain)) +
  geom_col(fill = "dodgerblue") +
  coord_flip() +
  theme_bw()
dat_dist_freq_di.feature_importance
```

# Inputs: Position Specific Dinucleotides + Distance Frequency Between all Dinucleotides

```{r}
ps2 <- paste0("X", 1:49, "di")

dist_freq_di = readRDS("data/Created/tiling_dist_freq_di.rds")
dist_freq_di_test = readRDS("data/Created/tiling_dist_freq_di_test.rds")
```

## Simple Linear Model

```{r}
dat_dist_freq_di5 = cbind(dat %>% select(all_of(ps2), C0_new), 
                          dist_freq_di)

dist_freq_di5_lm = lm(C0_new~., data=dat_dist_freq_di5)
cor(dist_freq_di5_lm$fitted.values, y)
# 0.6235137

dat_test_dist_freq_di5 = cbind(dat_test %>% select(all_of(ps2), C0_new), 
                               dist_freq_di_test)

dist_freq_di5_pred = predict(dist_freq_di5_lm, dat_test_dist_freq_di5)

cor(dist_freq_di5_pred, y_test)
# 0.6185135

mean((dist_freq_di5_pred - y_test)^2)
# 0.1488246
```

We get test prediction correlation of 0.6185135 and MSE of 0.1488246

## LightGBM (tree-based) Model

```{r}
library(lightgbm)
source("scripts/functions/lgbm-helper-functions.R")
set.seed(50)
dat_dist_freq_di5.lgb_train_set = dat_dist_freq_di5 %>%
  select(-C0_new)
dat_dist_freq_di5.lgb_train_rules = lgb.convert_with_rules(data = dat_dist_freq_di5.lgb_train_set)
dat_dist_freq_di5.lgb_train_data = lgb.Dataset(data = as.matrix(dat_dist_freq_di5.lgb_train_rules$data),
                                               label = dat_dist_freq_di5$C0_new,
                                               categorical_feature = handle_categorical(colnames(dat_dist_freq_di5.lgb_train_rules$data)))
dat_dist_freq_di5.lgb_test_set = dat_test_dist_freq_di5 %>%
  select(-C0_new)
dat_dist_freq_di5.lgb_test_matrix = as.matrix(lgb.convert_with_rules(data = dat_dist_freq_di5.lgb_test_set, rules = dat_dist_freq_di5.lgb_train_rules$rules)$data)
dat_dist_freq_di5.lgb_test_data = lgb.Dataset(data = dat_dist_freq_di5.lgb_test_matrix,
                                              label = dat_test_dist_freq_di5$C0_new,
                                              categorical_feature = handle_categorical(colnames(dat_dist_freq_di5.lgb_test_matrix)))
dat_dist_freq_di5.lgb_obj = lightgbm(data = dat_dist_freq_di5.lgb_train_data,
                                     params = list(learning_rate = c(0.1),
                                                   objective = c("regression"),
                                                   min_data_in_leaf = 100,
                                                   max_depth = c(5),
                                                   num_leaves = c(1000),
                                                   lambda_l2 = c(1),
                                                   boosting = c("gbdt")),
                                     valids = list(valid = dat_dist_freq_di5.lgb_test_data),
                                     nrounds = 8000,
                                     early_stopping_rounds = 50)

dat_dist_freq_di5.lgb_train_pred = predict(dat_dist_freq_di5.lgb_obj, data = as.matrix(dat_dist_freq_di5.lgb_train_rules$data))
cor(dat_dist_freq_di5.lgb_train_pred, y, method="pearson")
# 0.9923355 (nrounds = 4055)

dat_dist_freq_di5.lgb_test_pred = predict(dat_dist_freq_di5.lgb_obj, data = dat_dist_freq_di5.lgb_test_matrix)

cor(dat_dist_freq_di5.lgb_test_pred, y_test, method="pearson")
# 0.7013586 (nrounds = 4055)

mean((dat_dist_freq_di5.lgb_test_pred - y_test)^2)
# 0.1229249 (nrounds = 4055)
```

We get test prediction correlation of 0.7013586 and MSE of 0.1229249

```{r}
dat_dist_freq_di5.feature_importance = as.data.frame(lgb.importance(dat_dist_freq_di5.lgb_obj)) %>%
  mutate(Feature = fct_rev(fct_inorder(Feature))) %>%
  dplyr::slice(1:50) %>%
  ggplot(aes(x = Feature, y = Gain)) +
  geom_col(fill = "dodgerblue") +
  coord_flip() +
  theme_bw()
dat_dist_freq_di5.feature_importance
```



# Inputs: Counts of dinucleotides + Distance Frequency Between all Dinucleotides

```{r}
nucleotides <- c("A", "C", "G", "T")
dinucleotides <- gtools::permutations(n = 4, r = 2, v = nucleotides,
                                      repeats.allowed = TRUE) %>%
  apply(1, paste, collapse = "")

dist_freq_di = readRDS("data/Created/tiling_dist_freq_di.rds")
dist_freq_di_test = readRDS("data/Created/tiling_dist_freq_di_test.rds")
```

## Simple Linear Model

```{r}
dat_dist_freq_di2 = cbind(dat %>% select(all_of(dinucleotides), C0_new), 
                          dist_freq_di)

dist_freq_di2_lm = lm(C0_new~., data=dat_dist_freq_di2)
cor(dist_freq_di2_lm$fitted.values, y)
# 0.6070884

dat_test_dist_freq_di2 = cbind(dat_test %>% select(all_of(dinucleotides), C0_new), 
                               dist_freq_di_test)

dist_freq_di2_pred = predict(dist_freq_di2_lm, dat_test_dist_freq_di2)

cor(dist_freq_di2_pred, y_test)
# 0.6066121

mean((dist_freq_di2_pred - y_test)^2)
# 0.1523307
```

We get test prediction correlation of 0.6066121 and MSE of 0.1523307

## LightGBM (tree-based) Model

```{r}
library(lightgbm)
source("scripts/functions/lgbm-helper-functions.R")
set.seed(50)
dat_dist_freq_di2.lgb_train_set = dat_dist_freq_di2 %>%
  select(-C0_new)
dat_dist_freq_di2.lgb_train_rules = lgb.convert_with_rules(data = dat_dist_freq_di2.lgb_train_set)
dat_dist_freq_di2.lgb_train_data = lgb.Dataset(data = as.matrix(dat_dist_freq_di2.lgb_train_rules$data),
                                               label = dat_dist_freq_di2$C0_new,
                                               categorical_feature = handle_categorical(colnames(dat_dist_freq_di2.lgb_train_rules$data)))
dat_dist_freq_di2.lgb_test_set = dat_test_dist_freq_di2 %>%
  select(-C0_new)
dat_dist_freq_di2.lgb_test_matrix = as.matrix(lgb.convert_with_rules(data = dat_dist_freq_di2.lgb_test_set, rules = dat_dist_freq_di2.lgb_train_rules$rules)$data)
dat_dist_freq_di2.lgb_test_data = lgb.Dataset(data = dat_dist_freq_di2.lgb_test_matrix,
                                              label = dat_test_dist_freq_di2$C0_new,
                                              categorical_feature = handle_categorical(colnames(dat_dist_freq_di2.lgb_test_matrix)))
dat_dist_freq_di2.lgb_obj = lightgbm(data = dat_dist_freq_di2.lgb_train_data,
                                     params = list(learning_rate = c(0.1),
                                                   objective = c("regression"),
                                                   min_data_in_leaf = 100,
                                                   max_depth = c(5),
                                                   num_leaves = c(1000),
                                                   lambda_l2 = c(1),
                                                   boosting = c("gbdt")),
                                     valids = list(valid = dat_dist_freq_di2.lgb_test_data),
                                     nrounds = 8000,
                                     early_stopping_rounds = 50)

dat_dist_freq_di2.lgb_train_pred = predict(dat_dist_freq_di2.lgb_obj, data = as.matrix(dat_dist_freq_di2.lgb_train_rules$data))
cor(dat_dist_freq_di2.lgb_train_pred, y, method="pearson")
# 0.9697259 (nrounds = 7459)

dat_dist_freq_di2.lgb_test_pred = predict(dat_dist_freq_di2.lgb_obj, data = dat_dist_freq_di2.lgb_test_matrix)

cor(dat_dist_freq_di2.lgb_test_pred, y_test, method="pearson")
# 0.740517 (nrounds = 7459)

mean((dat_dist_freq_di2.lgb_test_pred - y_test)^2)
# 0.1088587 (nrounds = 7459)
```

We get test prediction correlation of 0.740517 and MSE of 0.1088587

```{r}
dat_dist_freq_di2.feature_importance = as.data.frame(lgb.importance(dat_dist_freq_di2.lgb_obj)) %>%
  mutate(Feature = fct_rev(fct_inorder(Feature))) %>%
  dplyr::slice(1:50) %>%
  ggplot(aes(x = Feature, y = Gain)) +
  geom_col(fill = "dodgerblue") +
  coord_flip() +
  theme_bw()
dat_dist_freq_di2.feature_importance
```


# Inputs: Counts of trinucleotides + Distance Frequency Between all Dinucleotides

```{r}
nucleotides <- c("A", "C", "G", "T")
dinucleotides <- gtools::permutations(n = 4, r = 2, v = nucleotides,
                                      repeats.allowed = TRUE) %>%
  apply(1, paste, collapse = "")
trinucleotides <- gtools::permutations(n = 4, r = 3, v = nucleotides,
                                       repeats.allowed = TRUE) %>%
  apply(1, paste, collapse = "")

dist_freq_di = readRDS("data/Created/tiling_dist_freq_di.rds")
dist_freq_di_test = readRDS("data/Created/tiling_dist_freq_di_test.rds")
```

## Simple Linear Model

```{r}
dat_dist_freq_di3 = cbind(dat %>% select(all_of(trinucleotides), C0_new), 
                          dist_freq_di)

dist_freq_di3_lm = lm(C0_new~., data=dat_dist_freq_di3)
cor(dist_freq_di3_lm$fitted.values, y)
# 0.6220043

dat_test_dist_freq_di3 = cbind(dat_test %>% select(all_of(trinucleotides), C0_new), 
                               dist_freq_di_test)

dist_freq_di3_pred = predict(dist_freq_di3_lm, dat_test_dist_freq_di3)

cor(dist_freq_di3_pred, y_test)
# 0.6192672

mean((dist_freq_di3_pred - y_test)^2)
# 0.1485935
```

We get test prediction correlation of 0.6192672 and MSE of 0.1485935

## LightGBM (tree-based) Model

```{r}
library(lightgbm)
source("scripts/functions/lgbm-helper-functions.R")
set.seed(50)
dat_dist_freq_di3.lgb_train_set = dat_dist_freq_di3 %>%
  select(-C0_new)
dat_dist_freq_di3.lgb_train_rules = lgb.convert_with_rules(data = dat_dist_freq_di3.lgb_train_set)
dat_dist_freq_di3.lgb_train_data = lgb.Dataset(data = as.matrix(dat_dist_freq_di3.lgb_train_rules$data),
                                               label = dat_dist_freq_di3$C0_new,
                                               categorical_feature = handle_categorical(colnames(dat_dist_freq_di3.lgb_train_rules$data)))
dat_dist_freq_di3.lgb_test_set = dat_test_dist_freq_di3 %>%
  select(-C0_new)
dat_dist_freq_di3.lgb_test_matrix = as.matrix(lgb.convert_with_rules(data = dat_dist_freq_di3.lgb_test_set, rules = dat_dist_freq_di3.lgb_train_rules$rules)$data)
dat_dist_freq_di3.lgb_test_data = lgb.Dataset(data = dat_dist_freq_di3.lgb_test_matrix,
                                              label = dat_test_dist_freq_di3$C0_new,
                                              categorical_feature = handle_categorical(colnames(dat_dist_freq_di3.lgb_test_matrix)))
dat_dist_freq_di3.lgb_obj = lightgbm(data = dat_dist_freq_di3.lgb_train_data,
                                     params = list(learning_rate = c(0.1),
                                                   objective = c("regression"),
                                                   min_data_in_leaf = 100,
                                                   max_depth = c(5),
                                                   num_leaves = c(1000),
                                                   lambda_l2 = c(1),
                                                   boosting = c("gbdt")),
                                     valids = list(valid = dat_dist_freq_di3.lgb_test_data),
                                     nrounds = 8000,
                                     early_stopping_rounds = 50)

dat_dist_freq_di3.lgb_train_pred = predict(dat_dist_freq_di3.lgb_obj, data = as.matrix(dat_dist_freq_di3.lgb_train_rules$data))
cor(dat_dist_freq_di3.lgb_train_pred, y, method="pearson")
# 0.9539661 (nrounds = 5118)

dat_dist_freq_di3.lgb_test_pred = predict(dat_dist_freq_di3.lgb_obj, data = dat_dist_freq_di3.lgb_test_matrix)

cor(dat_dist_freq_di3.lgb_test_pred, y_test, method="pearson")
# 0.7458787 (nrounds = 5118)

mean((dat_dist_freq_di3.lgb_test_pred - y_test)^2)
# 0.1069788 (nrounds = 5118)
```

We get test prediction correlation of 0.7458787 and MSE of 0.1069788

```{r}
dat_dist_freq_di3.feature_importance = as.data.frame(lgb.importance(dat_dist_freq_di3.lgb_obj)) %>%
  mutate(Feature = fct_rev(fct_inorder(Feature))) %>%
  dplyr::slice(1:50) %>%
  ggplot(aes(x = Feature, y = Gain)) +
  geom_col(fill = "dodgerblue") +
  coord_flip() +
  theme_bw()
dat_dist_freq_di3.feature_importance
```


# Inputs: Counts of trinucleotides + Distance Frequency Between all Dinucleotides + Markov Ratio

```{r}
nucleotides <- c("A", "C", "G", "T")
dinucleotides <- gtools::permutations(n = 4, r = 2, v = nucleotides,
                                      repeats.allowed = TRUE) %>%
  apply(1, paste, collapse = "")
trinucleotides <- gtools::permutations(n = 4, r = 3, v = nucleotides,
                                       repeats.allowed = TRUE) %>%
  apply(1, paste, collapse = "")

dist_freq_di = readRDS("data/Created/tiling_dist_freq_di.rds")
dist_freq_di_test = readRDS("data/Created/tiling_dist_freq_di_test.rds")
```

## Simple Linear Model

```{r}
dat_dist_freq_di4 = cbind(dat %>% select(all_of(trinucleotides), 
                                         ratio_score_2nd, C0_new), 
                          dist_freq_di)

dist_freq_di4_lm = lm(C0_new~., data=dat_dist_freq_di4)
cor(dist_freq_di4_lm$fitted.values, y)
# 0.6346639

dat_test_dist_freq_di4 = cbind(dat_test %>% select(all_of(trinucleotides), 
                                                   ratio_score_2nd, C0_new), 
                               dist_freq_di_test)

dist_freq_di4_pred = predict(dist_freq_di4_lm, dat_test_dist_freq_di4)

cor(dist_freq_di4_pred, y_test)
# 0.670381

mean((dist_freq_di4_pred - y_test)^2)
# 0.1372496
```

We get test prediction correlation of 0.670381 and MSE of 0.1372496

## LightGBM (tree-based) Model

```{r}
library(lightgbm)
source("scripts/functions/lgbm-helper-functions.R")
set.seed(50)
dat_dist_freq_di4.lgb_train_set = dat_dist_freq_di4 %>%
  select(-C0_new)
dat_dist_freq_di4.lgb_train_rules = lgb.convert_with_rules(data = dat_dist_freq_di4.lgb_train_set)
dat_dist_freq_di4.lgb_train_data = lgb.Dataset(data = as.matrix(dat_dist_freq_di4.lgb_train_rules$data),
                                               label = dat_dist_freq_di4$C0_new,
                                               categorical_feature = handle_categorical(colnames(dat_dist_freq_di4.lgb_train_rules$data)))
dat_dist_freq_di4.lgb_test_set = dat_test_dist_freq_di4 %>%
  select(-C0_new)
dat_dist_freq_di4.lgb_test_matrix = as.matrix(lgb.convert_with_rules(data = dat_dist_freq_di4.lgb_test_set, rules = dat_dist_freq_di4.lgb_train_rules$rules)$data)
dat_dist_freq_di4.lgb_test_data = lgb.Dataset(data = dat_dist_freq_di4.lgb_test_matrix,
                                              label = dat_test_dist_freq_di4$C0_new,
                                              categorical_feature = handle_categorical(colnames(dat_dist_freq_di4.lgb_test_matrix)))
dat_dist_freq_di4.lgb_obj = lightgbm(data = dat_dist_freq_di4.lgb_train_data,
                                     params = list(learning_rate = c(0.1),
                                                   objective = c("regression"),
                                                   min_data_in_leaf = 100,
                                                   max_depth = c(10),
                                                   num_leaves = c(1000),
                                                   lambda_l2 = c(1),
                                                   boosting = c("gbdt")),
                                     valids = list(valid = dat_dist_freq_di4.lgb_test_data),
                                     nrounds = 8000,
                                     early_stopping_rounds = 50)

dat_dist_freq_di4.lgb_train_pred = predict(dat_dist_freq_di4.lgb_obj, data = as.matrix(dat_dist_freq_di4.lgb_train_rules$data))
cor(dat_dist_freq_di4.lgb_train_pred, y, method="pearson")
# 0.9802109 (nrounds = 1637)

dat_dist_freq_di4.lgb_test_pred = predict(dat_dist_freq_di4.lgb_obj, data = dat_dist_freq_di4.lgb_test_matrix)

cor(dat_dist_freq_di4.lgb_test_pred, y_test, method="pearson")
# 0.7646044 (nrounds = 1637)

mean((dat_dist_freq_di4.lgb_test_pred - y_test)^2)
# 0.1012478 (nrounds = 1637)
```

We get test prediction correlation of 0.7646044 and MSE of 0.1012478

```{r}
dat_dist_freq_di4.feature_importance = as.data.frame(lgb.importance(dat_dist_freq_di4.lgb_obj)) %>%
  mutate(Feature = fct_rev(fct_inorder(Feature))) %>%
  dplyr::slice(1:50) %>%
  ggplot(aes(x = Feature, y = Gain)) +
  geom_col(fill = "dodgerblue") +
  coord_flip() +
  theme_bw()
dat_dist_freq_di4.feature_importance
```

# Inputs: Fourier Features Based on all Dinucleotides with h=6 (period 9.8) Calculated using fft + Distance Frequency Between all Dinucleotides

```{r}
fourier_di_cos = readRDS("data/Created/tiling_fourier_di_cos.rds")
fourier_di_sin = readRDS("data/Created/tiling_fourier_di_sin.rds")
fourier_di_cos_test = readRDS("data/Created/tiling_fourier_di_cos_test.rds")
fourier_di_sin_test = readRDS("data/Created/tiling_fourier_di_sin_test.rds")

fourier_di_cos_6 = as.data.frame(fourier_di_cos) %>% select(ends_with("_6"))
fourier_di_sin_6 = as.data.frame(fourier_di_sin) %>% select(ends_with("_6"))
fourier_di_cos_6_test = as.data.frame(fourier_di_cos_test) %>% select(ends_with("_6"))
fourier_di_sin_6_test = as.data.frame(fourier_di_sin_test) %>% select(ends_with("_6"))

dist_freq_di = readRDS("data/Created/tiling_dist_freq_di.rds")
dist_freq_di_test = readRDS("data/Created/tiling_dist_freq_di_test.rds")
```

## Squared value of Fourier features

### Simple Linear Model

```{r}
dat_dist_freq_di6 = cbind(dat %>% select(C0_new), 
                          (fourier_di_cos_6)^2, (fourier_di_sin_6)^2, 
                          dist_freq_di)

dist_freq_di6_lm = lm(C0_new~., data=dat_dist_freq_di6)
cor(dist_freq_di6_lm$fitted.values, y)
# 0.6146488

dat_test_dist_freq_di6 = cbind(dat_test %>% select(C0_new), 
                               (fourier_di_cos_6_test)^2, (fourier_di_sin_6_test)^2, 
                               dist_freq_di_test)

dist_freq_di6_pred = predict(dist_freq_di6_lm, dat_test_dist_freq_di6)

cor(dist_freq_di6_pred, y_test)
# 0.6137473

mean((dist_freq_di6_pred - y_test)^2)
# 0.150229
```

We get test prediction correlation of 0.6137473 and MSE of 0.150229

### LightGBM (tree-based) Model

```{r}
library(lightgbm)
source("scripts/functions/lgbm-helper-functions.R")
set.seed(50)
dat_dist_freq_di6.lgb_train_set = dat_dist_freq_di6 %>%
  select(-C0_new)
dat_dist_freq_di6.lgb_train_rules = lgb.convert_with_rules(data = dat_dist_freq_di6.lgb_train_set)
dat_dist_freq_di6.lgb_train_data = lgb.Dataset(data = as.matrix(dat_dist_freq_di6.lgb_train_rules$data),
                                               label = dat_dist_freq_di6$C0_new,
                                               categorical_feature = handle_categorical(colnames(dat_dist_freq_di6.lgb_train_rules$data)))
dat_dist_freq_di6.lgb_test_set = dat_test_dist_freq_di6 %>%
  select(-C0_new)
dat_dist_freq_di6.lgb_test_matrix = as.matrix(lgb.convert_with_rules(data = dat_dist_freq_di6.lgb_test_set, rules = dat_dist_freq_di6.lgb_train_rules$rules)$data)
dat_dist_freq_di6.lgb_test_data = lgb.Dataset(data = dat_dist_freq_di6.lgb_test_matrix,
                                              label = dat_test_dist_freq_di6$C0_new,
                                              categorical_feature = handle_categorical(colnames(dat_dist_freq_di6.lgb_test_matrix)))
dat_dist_freq_di6.lgb_obj = lightgbm(data = dat_dist_freq_di6.lgb_train_data,
                                     params = list(learning_rate = c(0.1),
                                                   objective = c("regression"),
                                                   min_data_in_leaf = 100,
                                                   max_depth = c(5),
                                                   num_leaves = c(1000),
                                                   lambda_l2 = c(1),
                                                   boosting = c("gbdt")),
                                     valids = list(valid = dat_dist_freq_di6.lgb_test_data),
                                     nrounds = 8000,
                                     early_stopping_rounds = 50)

dat_dist_freq_di6.lgb_train_pred = predict(dat_dist_freq_di6.lgb_obj, data = as.matrix(dat_dist_freq_di6.lgb_train_rules$data))
cor(dat_dist_freq_di6.lgb_train_pred, y, method="pearson")
# 0.9189923 (nrounds = 2491)

dat_dist_freq_di6.lgb_test_pred = predict(dat_dist_freq_di6.lgb_obj, data = dat_dist_freq_di6.lgb_test_matrix)

cor(dat_dist_freq_di6.lgb_test_pred, y_test, method="pearson")
# 0.6993943 (nrounds = 2491)

mean((dat_dist_freq_di6.lgb_test_pred - y_test)^2)
# 0.1233709 (nrounds = 2491)
```

We get test prediction correlation of 0.6993943 and MSE of 0.1233709

```{r}
dat_dist_freq_di6.feature_importance = as.data.frame(lgb.importance(dat_dist_freq_di6.lgb_obj)) %>%
  mutate(Feature = fct_rev(fct_inorder(Feature))) %>%
  dplyr::slice(1:50) %>%
  ggplot(aes(x = Feature, y = Gain)) +
  geom_col(fill = "dodgerblue") +
  coord_flip() +
  theme_bw()
dat_dist_freq_di6.feature_importance
```


# Inputs: Modulus of Difference of Fourier Features Based on all Dinucleotides with h=6 (period 9.8) Calculated using fft + Distance Frequency Between all Dinucleotides

```{r}
fourier_6_mod = readRDS("data/Created/tiling_fourier_6_mod.rds")
fourier_6_mod_test = readRDS("data/Created/tiling_fourier_6_mod_test.rds")

dist_freq_di = readRDS("data/Created/tiling_dist_freq_di.rds")
dist_freq_di_test = readRDS("data/Created/tiling_dist_freq_di_test.rds")
```

## Squared value of Fourier features

### Simple Linear Model

```{r}
dat_dist_freq_di7 = cbind(dat %>% select(C0_new),
                          (fourier_6_mod)^2, dist_freq_di)

dist_freq_di7_lm = lm(C0_new~., data=dat_dist_freq_di7)
cor(dist_freq_di7_lm$fitted.values, y)
# 0.6282015

dat_test_dist_freq_di7 = cbind(dat_test %>% select(C0_new), 
                               (fourier_6_mod_test)^2, dist_freq_di_test)

dist_freq_di7_pred = predict(dist_freq_di7_lm, dat_test_dist_freq_di7)

cor(dist_freq_di7_pred, y_test)
# 0.6264508

mean((dist_freq_di7_pred - y_test)^2)
# 0.1464345
```

We get test prediction correlation of 0.6264508 and MSE of 0.1464345

### LightGBM (tree-based) Model

```{r}
library(lightgbm)
source("scripts/functions/lgbm-helper-functions.R")
set.seed(50)
dat_dist_freq_di7.lgb_train_set = dat_dist_freq_di7 %>%
  select(-C0_new)
dat_dist_freq_di7.lgb_train_rules = lgb.convert_with_rules(data = dat_dist_freq_di7.lgb_train_set)
dat_dist_freq_di7.lgb_train_data = lgb.Dataset(data = as.matrix(dat_dist_freq_di7.lgb_train_rules$data),
                                               label = dat_dist_freq_di7$C0_new,
                                               categorical_feature = handle_categorical(colnames(dat_dist_freq_di7.lgb_train_rules$data)))
dat_dist_freq_di7.lgb_test_set = dat_test_dist_freq_di7 %>%
  select(-C0_new)
dat_dist_freq_di7.lgb_test_matrix = as.matrix(lgb.convert_with_rules(data = dat_dist_freq_di7.lgb_test_set, rules = dat_dist_freq_di7.lgb_train_rules$rules)$data)
dat_dist_freq_di7.lgb_test_data = lgb.Dataset(data = dat_dist_freq_di7.lgb_test_matrix,
                                              label = dat_test_dist_freq_di7$C0_new,
                                              categorical_feature = handle_categorical(colnames(dat_dist_freq_di7.lgb_test_matrix)))
dat_dist_freq_di7.lgb_obj = lightgbm(data = dat_dist_freq_di7.lgb_train_data,
                                     params = list(learning_rate = c(0.1),
                                                   objective = c("regression"),
                                                   min_data_in_leaf = 100,
                                                   max_depth = c(5),
                                                   num_leaves = c(1000),
                                                   lambda_l2 = c(1),
                                                   boosting = c("gbdt")),
                                     valids = list(valid = dat_dist_freq_di7.lgb_test_data),
                                     nrounds = 8000,
                                     early_stopping_rounds = 50)

dat_dist_freq_di7.lgb_train_pred = predict(dat_dist_freq_di7.lgb_obj, data = as.matrix(dat_dist_freq_di7.lgb_train_rules$data))
cor(dat_dist_freq_di7.lgb_train_pred, y, method="pearson")
# 0.9692366 (nrounds = 3724)

dat_dist_freq_di7.lgb_test_pred = predict(dat_dist_freq_di7.lgb_obj, data = dat_dist_freq_di7.lgb_test_matrix)

cor(dat_dist_freq_di7.lgb_test_pred, y_test, method="pearson")
# 0.7035811 (nrounds = 3724)

mean((dat_dist_freq_di7.lgb_test_pred - y_test)^2)
# 0.121785 (nrounds = 3724)
```

We get test prediction correlation of 0.7035811 and MSE of 0.121785

```{r}
dat_dist_freq_di7.feature_importance = as.data.frame(lgb.importance(dat_dist_freq_di7.lgb_obj)) %>%
  mutate(Feature = fct_rev(fct_inorder(Feature))) %>%
  dplyr::slice(1:50) %>%
  ggplot(aes(x = Feature, y = Gain)) +
  geom_col(fill = "dodgerblue") +
  coord_flip() +
  theme_bw()
dat_dist_freq_di7.feature_importance
```


# Inputs: Fourier Features Based on all Dinucleotides with h=6 (period 9.8) + Modulus of Difference of Fourier Features Based on all Dinucleotides with h=6 (period 9.8) Calculated using fft + Distance Frequency Between all Dinucleotides

```{r}
fourier_di_cos = readRDS("data/Created/tiling_fourier_di_cos.rds")
fourier_di_sin = readRDS("data/Created/tiling_fourier_di_sin.rds")
fourier_di_cos_test = readRDS("data/Created/tiling_fourier_di_cos_test.rds")
fourier_di_sin_test = readRDS("data/Created/tiling_fourier_di_sin_test.rds")

fourier_di_cos_6 = as.data.frame(fourier_di_cos) %>% select(ends_with("_6"))
fourier_di_sin_6 = as.data.frame(fourier_di_sin) %>% select(ends_with("_6"))
fourier_di_cos_6_test = as.data.frame(fourier_di_cos_test) %>% select(ends_with("_6"))
fourier_di_sin_6_test = as.data.frame(fourier_di_sin_test) %>% select(ends_with("_6"))

fourier_6_mod = readRDS("data/Created/tiling_fourier_6_mod.rds")
fourier_6_mod_test = readRDS("data/Created/tiling_fourier_6_mod_test.rds")

dist_freq_di = readRDS("data/Created/tiling_dist_freq_di.rds")
dist_freq_di_test = readRDS("data/Created/tiling_dist_freq_di_test.rds")
```

## Squared value of Fourier features

### Simple Linear Model

```{r}
dat_dist_freq_di8 = cbind(dat %>% select(C0_new), 
                          (fourier_di_cos_6)^2, (fourier_di_sin_6)^2, 
                          (fourier_6_mod)^2, dist_freq_di)

dist_freq_di8_lm = lm(C0_new~., data=dat_dist_freq_di8)
cor(dist_freq_di8_lm$fitted.values, y)
# 0.6311358

dat_test_dist_freq_di8 = cbind(dat_test %>% select(C0_new), 
                               (fourier_di_cos_6_test)^2, (fourier_di_sin_6_test)^2, 
                               (fourier_6_mod_test)^2, dist_freq_di_test)

dist_freq_di8_pred = predict(dist_freq_di8_lm, dat_test_dist_freq_di8)

cor(dist_freq_di8_pred, y_test)
# 0.6287405

mean((dist_freq_di8_pred - y_test)^2)
# 0.1457455
```

We get test prediction correlation of 0.6287405 and MSE of 0.1457455

### LightGBM (tree-based) Model

```{r}
library(lightgbm)
source("scripts/functions/lgbm-helper-functions.R")
set.seed(50)
dat_dist_freq_di8.lgb_train_set = dat_dist_freq_di8 %>%
  select(-C0_new)
dat_dist_freq_di8.lgb_train_rules = lgb.convert_with_rules(data = dat_dist_freq_di8.lgb_train_set)
dat_dist_freq_di8.lgb_train_data = lgb.Dataset(data = as.matrix(dat_dist_freq_di8.lgb_train_rules$data),
                                               label = dat_dist_freq_di8$C0_new,
                                               categorical_feature = handle_categorical(colnames(dat_dist_freq_di8.lgb_train_rules$data)))
dat_dist_freq_di8.lgb_test_set = dat_test_dist_freq_di8 %>%
  select(-C0_new)
dat_dist_freq_di8.lgb_test_matrix = as.matrix(lgb.convert_with_rules(data = dat_dist_freq_di8.lgb_test_set, rules = dat_dist_freq_di8.lgb_train_rules$rules)$data)
dat_dist_freq_di8.lgb_test_data = lgb.Dataset(data = dat_dist_freq_di8.lgb_test_matrix,
                                              label = dat_test_dist_freq_di8$C0_new,
                                              categorical_feature = handle_categorical(colnames(dat_dist_freq_di8.lgb_test_matrix)))
dat_dist_freq_di8.lgb_obj = lightgbm(data = dat_dist_freq_di8.lgb_train_data,
                                     params = list(learning_rate = c(0.1),
                                                   objective = c("regression"),
                                                   min_data_in_leaf = 100,
                                                   max_depth = c(5),
                                                   num_leaves = c(1000),
                                                   lambda_l2 = c(1),
                                                   boosting = c("gbdt")),
                                     valids = list(valid = dat_dist_freq_di8.lgb_test_data),
                                     nrounds = 8000,
                                     early_stopping_rounds = 50)

dat_dist_freq_di8.lgb_train_pred = predict(dat_dist_freq_di8.lgb_obj, data = as.matrix(dat_dist_freq_di8.lgb_train_rules$data))
cor(dat_dist_freq_di8.lgb_train_pred, y, method="pearson")
# 0.9845237 (nrounds = 4841)

dat_dist_freq_di8.lgb_test_pred = predict(dat_dist_freq_di8.lgb_obj, data = dat_dist_freq_di8.lgb_test_matrix)

cor(dat_dist_freq_di8.lgb_test_pred, y_test, method="pearson")
# 0.7028651 (nrounds = 4841)

mean((dat_dist_freq_di8.lgb_test_pred - y_test)^2)
# 0.1219733 (nrounds = 4841)
```

We get test prediction correlation of 0.7028651 and MSE of 0.1219733

```{r}
dat_dist_freq_di8.feature_importance = as.data.frame(lgb.importance(dat_dist_freq_di8.lgb_obj)) %>%
  mutate(Feature = fct_rev(fct_inorder(Feature))) %>%
  dplyr::slice(1:50) %>%
  ggplot(aes(x = Feature, y = Gain)) +
  geom_col(fill = "dodgerblue") +
  coord_flip() +
  theme_bw()
dat_dist_freq_di8.feature_importance
```


# Inputs: Position Specific Dinucleotides + Fourier Features Based on all Dinucleotides with h=6 (period 9.8) + Modulus of Difference of Fourier Features Based on all Dinucleotides with h=6 (period 9.8) Calculated using fft + Distance Frequency Between all Dinucleotides

```{r}
ps2 <- paste0("X", 1:49, "di")

fourier_di_cos = readRDS("data/Created/tiling_fourier_di_cos.rds")
fourier_di_sin = readRDS("data/Created/tiling_fourier_di_sin.rds")
fourier_di_cos_test = readRDS("data/Created/tiling_fourier_di_cos_test.rds")
fourier_di_sin_test = readRDS("data/Created/tiling_fourier_di_sin_test.rds")

fourier_di_cos_6 = as.data.frame(fourier_di_cos) %>% select(ends_with("_6"))
fourier_di_sin_6 = as.data.frame(fourier_di_sin) %>% select(ends_with("_6"))
fourier_di_cos_6_test = as.data.frame(fourier_di_cos_test) %>% select(ends_with("_6"))
fourier_di_sin_6_test = as.data.frame(fourier_di_sin_test) %>% select(ends_with("_6"))

fourier_6_mod = readRDS("data/Created/tiling_fourier_6_mod.rds")
fourier_6_mod_test = readRDS("data/Created/tiling_fourier_6_mod_test.rds")

dist_freq_di = readRDS("data/Created/tiling_dist_freq_di.rds")
dist_freq_di_test = readRDS("data/Created/tiling_dist_freq_di_test.rds")
```

## Squared value of Fourier features

### Simple Linear Model

```{r}
dat_dist_freq_di11 = cbind(dat %>% select(all_of(ps2), C0_new), 
                           (fourier_di_cos_6)^2, (fourier_di_sin_6)^2, 
                           (fourier_6_mod)^2, dist_freq_di)

dist_freq_di11_lm = lm(C0_new~., data=dat_dist_freq_di11)
cor(dist_freq_di11_lm$fitted.values, y)
# 0.6467081

dat_test_dist_freq_di11 = cbind(dat_test %>% select(all_of(ps2), C0_new), 
                                (fourier_di_cos_6_test)^2, (fourier_di_sin_6_test)^2, 
                                (fourier_6_mod_test)^2, dist_freq_di_test)

dist_freq_di11_pred = predict(dist_freq_di11_lm, dat_test_dist_freq_di11)

cor(dist_freq_di11_pred, y_test)
# 0.640689

mean((dist_freq_di11_pred - y_test)^2)
# 0.1421002
```

We get test prediction correlation of 0.640689 and MSE of 0.1421002

### LightGBM (tree-based) Model

```{r}
library(lightgbm)
source("scripts/functions/lgbm-helper-functions.R")
set.seed(50)
dat_dist_freq_di11.lgb_train_set = dat_dist_freq_di11 %>%
  select(-C0_new)
dat_dist_freq_di11.lgb_train_rules = lgb.convert_with_rules(data = dat_dist_freq_di11.lgb_train_set)
dat_dist_freq_di11.lgb_train_data = lgb.Dataset(data = as.matrix(dat_dist_freq_di11.lgb_train_rules$data),
                                                label = dat_dist_freq_di11$C0_new,
                                                categorical_feature = handle_categorical(colnames(dat_dist_freq_di11.lgb_train_rules$data)))
dat_dist_freq_di11.lgb_test_set = dat_test_dist_freq_di11 %>%
  select(-C0_new)
dat_dist_freq_di11.lgb_test_matrix = as.matrix(lgb.convert_with_rules(data = dat_dist_freq_di11.lgb_test_set, rules = dat_dist_freq_di11.lgb_train_rules$rules)$data)
dat_dist_freq_di11.lgb_test_data = lgb.Dataset(data = dat_dist_freq_di11.lgb_test_matrix,
                                               label = dat_test_dist_freq_di11$C0_new,
                                               categorical_feature = handle_categorical(colnames(dat_dist_freq_di11.lgb_test_matrix)))
dat_dist_freq_di11.lgb_obj = lightgbm(data = dat_dist_freq_di11.lgb_train_data,
                                      params = list(learning_rate = c(0.1),
                                                    objective = c("regression"),
                                                    min_data_in_leaf = 100,
                                                    max_depth = c(5),
                                                    num_leaves = c(1000),
                                                    lambda_l2 = c(1),
                                                    boosting = c("gbdt")),
                                      valids = list(valid = dat_dist_freq_di11.lgb_test_data),
                                      nrounds = 8000,
                                      early_stopping_rounds = 50)

dat_dist_freq_di11.lgb_train_pred = predict(dat_dist_freq_di11.lgb_obj, data = as.matrix(dat_dist_freq_di11.lgb_train_rules$data))
cor(dat_dist_freq_di11.lgb_train_pred, y, method="pearson")
# 0.98877 (nrounds = 3095)

dat_dist_freq_di11.lgb_test_pred = predict(dat_dist_freq_di11.lgb_obj, data = dat_dist_freq_di11.lgb_test_matrix)

cor(dat_dist_freq_di11.lgb_test_pred, y_test, method="pearson")
# 0.6936371 (nrounds = 3095)

mean((dat_dist_freq_di11.lgb_test_pred - y_test)^2)
# 0.1253393 (nrounds = 3095)
```

We get test prediction correlation of 0.6936371 and MSE of 0.1253393

```{r}
dat_dist_freq_di11.feature_importance = as.data.frame(lgb.importance(dat_dist_freq_di11.lgb_obj)) %>%
  mutate(Feature = fct_rev(fct_inorder(Feature))) %>%
  dplyr::slice(1:50) %>%
  ggplot(aes(x = Feature, y = Gain)) +
  geom_col(fill = "dodgerblue") +
  coord_flip() +
  theme_bw()
dat_dist_freq_di11.feature_importance
```


# Inputs: Counts of Dinucleotides + Fourier Features Based on all Dinucleotides with h=6 (period 9.8) + Modulus of Difference of Fourier Features Based on all Dinucleotides with h=6 (period 9.8) Calculated using fft + Distance Frequency Between all Dinucleotides

```{r}
nucleotides <- c("A", "C", "G", "T")
dinucleotides <- gtools::permutations(n = 4, r = 2, v = nucleotides,
                                      repeats.allowed = TRUE) %>%
  apply(1, paste, collapse = "")

fourier_di_cos = readRDS("data/Created/tiling_fourier_di_cos.rds")
fourier_di_sin = readRDS("data/Created/tiling_fourier_di_sin.rds")
fourier_di_cos_test = readRDS("data/Created/tiling_fourier_di_cos_test.rds")
fourier_di_sin_test = readRDS("data/Created/tiling_fourier_di_sin_test.rds")

fourier_di_cos_6 = as.data.frame(fourier_di_cos) %>% select(ends_with("_6"))
fourier_di_sin_6 = as.data.frame(fourier_di_sin) %>% select(ends_with("_6"))
fourier_di_cos_6_test = as.data.frame(fourier_di_cos_test) %>% select(ends_with("_6"))
fourier_di_sin_6_test = as.data.frame(fourier_di_sin_test) %>% select(ends_with("_6"))

fourier_6_mod = readRDS("data/Created/tiling_fourier_6_mod.rds")
fourier_6_mod_test = readRDS("data/Created/tiling_fourier_6_mod_test.rds")

dist_freq_di = readRDS("data/Created/tiling_dist_freq_di.rds")
dist_freq_di_test = readRDS("data/Created/tiling_dist_freq_di_test.rds")
```

## Squared value of Fourier features

### Simple Linear Model

```{r}
dat_dist_freq_di9 = cbind(dat %>% select(all_of(dinucleotides), C0_new), 
                          (fourier_di_cos_6)^2, (fourier_di_sin_6)^2, 
                          (fourier_6_mod)^2, dist_freq_di)

dist_freq_di9_lm = lm(C0_new~., data=dat_dist_freq_di9)
cor(dist_freq_di9_lm$fitted.values, y)
# 0.6316018

dat_test_dist_freq_di9 = cbind(dat_test %>% select(all_of(dinucleotides), C0_new), 
                               (fourier_di_cos_6_test)^2, (fourier_di_sin_6_test)^2, 
                               (fourier_6_mod_test)^2, dist_freq_di_test)

dist_freq_di9_pred = predict(dist_freq_di9_lm, dat_test_dist_freq_di9)

cor(dist_freq_di9_pred, y_test)
# 0.6288471

mean((dist_freq_di9_pred - y_test)^2)
# 0.1457129
```

We get test prediction correlation of 0.6288471 and MSE of 0.1457129

### LightGBM (tree-based) Model

```{r}
library(lightgbm)
source("scripts/functions/lgbm-helper-functions.R")
set.seed(50)
dat_dist_freq_di9.lgb_train_set = dat_dist_freq_di9 %>%
  select(-C0_new)
dat_dist_freq_di9.lgb_train_rules = lgb.convert_with_rules(data = dat_dist_freq_di9.lgb_train_set)
dat_dist_freq_di9.lgb_train_data = lgb.Dataset(data = as.matrix(dat_dist_freq_di9.lgb_train_rules$data),
                                               label = dat_dist_freq_di9$C0_new,
                                               categorical_feature = handle_categorical(colnames(dat_dist_freq_di9.lgb_train_rules$data)))
dat_dist_freq_di9.lgb_test_set = dat_test_dist_freq_di9 %>%
  select(-C0_new)
dat_dist_freq_di9.lgb_test_matrix = as.matrix(lgb.convert_with_rules(data = dat_dist_freq_di9.lgb_test_set, rules = dat_dist_freq_di9.lgb_train_rules$rules)$data)
dat_dist_freq_di9.lgb_test_data = lgb.Dataset(data = dat_dist_freq_di9.lgb_test_matrix,
                                              label = dat_test_dist_freq_di9$C0_new,
                                              categorical_feature = handle_categorical(colnames(dat_dist_freq_di9.lgb_test_matrix)))
dat_dist_freq_di9.lgb_obj = lightgbm(data = dat_dist_freq_di9.lgb_train_data,
                                     params = list(learning_rate = c(0.1),
                                                   objective = c("regression"),
                                                   min_data_in_leaf = 100,
                                                   max_depth = c(5),
                                                   num_leaves = c(1000),
                                                   lambda_l2 = c(1),
                                                   boosting = c("gbdt")),
                                     valids = list(valid = dat_dist_freq_di9.lgb_test_data),
                                     nrounds = 8000,
                                     early_stopping_rounds = 50)

dat_dist_freq_di9.lgb_train_pred = predict(dat_dist_freq_di9.lgb_obj, data = as.matrix(dat_dist_freq_di9.lgb_train_rules$data))
cor(dat_dist_freq_di9.lgb_train_pred, y, method="pearson")
# 0.9627053 (nrounds = 3118)

dat_dist_freq_di9.lgb_test_pred = predict(dat_dist_freq_di9.lgb_obj, data = dat_dist_freq_di9.lgb_test_matrix)

cor(dat_dist_freq_di9.lgb_test_pred, y_test, method="pearson")
# 0.7002353 (nrounds = 3118)

mean((dat_dist_freq_di9.lgb_test_pred - y_test)^2)
# 0.1229447 (nrounds = 3118)
```

We get test prediction correlation of 0.7002353 and MSE of 0.1229447

```{r}
dat_dist_freq_di9.feature_importance = as.data.frame(lgb.importance(dat_dist_freq_di9.lgb_obj)) %>%
  mutate(Feature = fct_rev(fct_inorder(Feature))) %>%
  dplyr::slice(1:50) %>%
  ggplot(aes(x = Feature, y = Gain)) +
  geom_col(fill = "dodgerblue") +
  coord_flip() +
  theme_bw()
dat_dist_freq_di9.feature_importance
```


# Inputs: Counts of Trinucleotides + Fourier Features Based on all Dinucleotides with h=6 (period 9.8) + Modulus of Difference of Fourier Features Based on all Dinucleotides with h=6 (period 9.8) Calculated using fft + Distance Frequency Between all Dinucleotides

```{r}
nucleotides <- c("A", "C", "G", "T")
dinucleotides <- gtools::permutations(n = 4, r = 2, v = nucleotides,
                                      repeats.allowed = TRUE) %>%
  apply(1, paste, collapse = "")
trinucleotides <- gtools::permutations(n = 4, r = 3, v = nucleotides,
                                       repeats.allowed = TRUE) %>%
  apply(1, paste, collapse = "")

fourier_di_cos = readRDS("data/Created/tiling_fourier_di_cos.rds")
fourier_di_sin = readRDS("data/Created/tiling_fourier_di_sin.rds")
fourier_di_cos_test = readRDS("data/Created/tiling_fourier_di_cos_test.rds")
fourier_di_sin_test = readRDS("data/Created/tiling_fourier_di_sin_test.rds")

fourier_di_cos_6 = as.data.frame(fourier_di_cos) %>% select(ends_with("_6"))
fourier_di_sin_6 = as.data.frame(fourier_di_sin) %>% select(ends_with("_6"))
fourier_di_cos_6_test = as.data.frame(fourier_di_cos_test) %>% select(ends_with("_6"))
fourier_di_sin_6_test = as.data.frame(fourier_di_sin_test) %>% select(ends_with("_6"))

fourier_6_mod = readRDS("data/Created/tiling_fourier_6_mod.rds")
fourier_6_mod_test = readRDS("data/Created/tiling_fourier_6_mod_test.rds")

dist_freq_di = readRDS("data/Created/tiling_dist_freq_di.rds")
dist_freq_di_test = readRDS("data/Created/tiling_dist_freq_di_test.rds")
```

## Squared value of Fourier features

### Simple Linear Model

```{r}
dat_dist_freq_di10 = cbind(dat %>% select(all_of(trinucleotides), C0_new), 
                           (fourier_di_cos_6)^2, (fourier_di_sin_6)^2, 
                           (fourier_6_mod)^2, dist_freq_di)

dist_freq_di10_lm = lm(C0_new~., data=dat_dist_freq_di10)
cor(dist_freq_di10_lm$fitted.values, y)
# 0.6431757

dat_test_dist_freq_di10 = cbind(dat_test %>% select(all_of(trinucleotides), C0_new), 
                                (fourier_di_cos_6_test)^2, (fourier_di_sin_6_test)^2, 
                                (fourier_6_mod_test)^2, dist_freq_di_test)

dist_freq_di10_pred = predict(dist_freq_di10_lm, dat_test_dist_freq_di10)

cor(dist_freq_di10_pred, y_test)
# 0.6399864

mean((dist_freq_di10_pred - y_test)^2)
# 0.1423107
```

We get test prediction correlation of 0.6399864 and MSE of 0.1423107

### LightGBM (tree-based) Model

```{r}
library(lightgbm)
source("scripts/functions/lgbm-helper-functions.R")
set.seed(50)
dat_dist_freq_di10.lgb_train_set = dat_dist_freq_di10 %>%
  select(-C0_new)
dat_dist_freq_di10.lgb_train_rules = lgb.convert_with_rules(data = dat_dist_freq_di10.lgb_train_set)
dat_dist_freq_di10.lgb_train_data = lgb.Dataset(data = as.matrix(dat_dist_freq_di10.lgb_train_rules$data),
                                                label = dat_dist_freq_di10$C0_new,
                                                categorical_feature = handle_categorical(colnames(dat_dist_freq_di10.lgb_train_rules$data)))
dat_dist_freq_di10.lgb_test_set = dat_test_dist_freq_di10 %>%
  select(-C0_new)
dat_dist_freq_di10.lgb_test_matrix = as.matrix(lgb.convert_with_rules(data = dat_dist_freq_di10.lgb_test_set, rules = dat_dist_freq_di10.lgb_train_rules$rules)$data)
dat_dist_freq_di10.lgb_test_data = lgb.Dataset(data = dat_dist_freq_di10.lgb_test_matrix,
                                               label = dat_test_dist_freq_di10$C0_new,
                                               categorical_feature = handle_categorical(colnames(dat_dist_freq_di10.lgb_test_matrix)))
dat_dist_freq_di10.lgb_obj = lightgbm(data = dat_dist_freq_di10.lgb_train_data,
                                      params = list(learning_rate = c(0.1),
                                                    objective = c("regression"),
                                                    min_data_in_leaf = 100,
                                                    max_depth = c(5),
                                                    num_leaves = c(1000),
                                                    lambda_l2 = c(1),
                                                    boosting = c("gbdt")),
                                      valids = list(valid = dat_dist_freq_di10.lgb_test_data),
                                      nrounds = 8000,
                                      early_stopping_rounds = 50)

dat_dist_freq_di10.lgb_train_pred = predict(dat_dist_freq_di10.lgb_obj, data = as.matrix(dat_dist_freq_di10.lgb_train_rules$data))
cor(dat_dist_freq_di10.lgb_train_pred, y, method="pearson")
# 0.9510004 (nrounds = 2553)

dat_dist_freq_di10.lgb_test_pred = predict(dat_dist_freq_di10.lgb_obj, data = dat_dist_freq_di10.lgb_test_matrix)

cor(dat_dist_freq_di10.lgb_test_pred, y_test, method="pearson")
# 0.7105321 (nrounds = 2553)

mean((dat_dist_freq_di10.lgb_test_pred - y_test)^2)
# 0.1195405 (nrounds = 2553)
```

We get test prediction correlation of 0.7105321 and MSE of 0.1195405

```{r}
dat_dist_freq_di10.feature_importance = as.data.frame(lgb.importance(dat_dist_freq_di10.lgb_obj)) %>%
  mutate(Feature = fct_rev(fct_inorder(Feature))) %>%
  dplyr::slice(1:50) %>%
  ggplot(aes(x = Feature, y = Gain)) +
  geom_col(fill = "dodgerblue") +
  coord_flip() +
  theme_bw()
dat_dist_freq_di10.feature_importance
```


# Inputs: Position Specific Dinucleotides + Counts of Trinucleotides + Fourier Features Based on all Dinucleotides with h=6 (period 9.8) + Modulus of Difference of Fourier Features Based on all Dinucleotides with h=6 (period 9.8) Calculated using fft + Distance Frequency Between all Dinucleotides

```{r}
ps2 <- paste0("X", 1:49, "di")

nucleotides <- c("A", "C", "G", "T")
dinucleotides <- gtools::permutations(n = 4, r = 2, v = nucleotides,
                                      repeats.allowed = TRUE) %>%
  apply(1, paste, collapse = "")
trinucleotides <- gtools::permutations(n = 4, r = 3, v = nucleotides,
                                       repeats.allowed = TRUE) %>%
  apply(1, paste, collapse = "")

fourier_di_cos = readRDS("data/Created/tiling_fourier_di_cos.rds")
fourier_di_sin = readRDS("data/Created/tiling_fourier_di_sin.rds")
fourier_di_cos_test = readRDS("data/Created/tiling_fourier_di_cos_test.rds")
fourier_di_sin_test = readRDS("data/Created/tiling_fourier_di_sin_test.rds")

fourier_di_cos_6 = as.data.frame(fourier_di_cos) %>% select(ends_with("_6"))
fourier_di_sin_6 = as.data.frame(fourier_di_sin) %>% select(ends_with("_6"))
fourier_di_cos_6_test = as.data.frame(fourier_di_cos_test) %>% select(ends_with("_6"))
fourier_di_sin_6_test = as.data.frame(fourier_di_sin_test) %>% select(ends_with("_6"))

fourier_6_mod = readRDS("data/Created/tiling_fourier_6_mod.rds")
fourier_6_mod_test = readRDS("data/Created/tiling_fourier_6_mod_test.rds")

dist_freq_di = readRDS("data/Created/tiling_dist_freq_di.rds")
dist_freq_di_test = readRDS("data/Created/tiling_dist_freq_di_test.rds")
```

## Squared value of Fourier features

### Simple Linear Model

```{r}
dat_dist_freq_di12 = cbind(dat %>% select(all_of(ps2), 
                                          all_of(trinucleotides), C0_new), 
                           (fourier_di_cos_6)^2, (fourier_di_sin_6)^2, 
                           (fourier_6_mod)^2, dist_freq_di)

dist_freq_di12_lm = lm(C0_new~., data=dat_dist_freq_di12)
cor(dist_freq_di12_lm$fitted.values, y)
# 0.6574249

dat_test_dist_freq_di12 = cbind(dat_test %>% select(all_of(ps2), 
                                                    all_of(trinucleotides), C0_new), 
                                (fourier_di_cos_6_test)^2, (fourier_di_sin_6_test)^2, 
                                (fourier_6_mod_test)^2, dist_freq_di_test)

dist_freq_di12_pred = predict(dist_freq_di12_lm, dat_test_dist_freq_di12)

cor(dist_freq_di12_pred, y_test)
# 0.6515767

mean((dist_freq_di12_pred - y_test)^2)
# 0.1387127
```

We get test prediction correlation of 0.6515767 and MSE of 0.1387127

### LightGBM (tree-based) Model

```{r}
library(lightgbm)
source("scripts/functions/lgbm-helper-functions.R")
set.seed(50)
dat_dist_freq_di12.lgb_train_set = dat_dist_freq_di12 %>%
  select(-C0_new)
dat_dist_freq_di12.lgb_train_rules = lgb.convert_with_rules(data = dat_dist_freq_di12.lgb_train_set)
dat_dist_freq_di12.lgb_train_data = lgb.Dataset(data = as.matrix(dat_dist_freq_di12.lgb_train_rules$data),
                                                label = dat_dist_freq_di12$C0_new,
                                                categorical_feature = handle_categorical(colnames(dat_dist_freq_di12.lgb_train_rules$data)))
dat_dist_freq_di12.lgb_test_set = dat_test_dist_freq_di12 %>%
  select(-C0_new)
dat_dist_freq_di12.lgb_test_matrix = as.matrix(lgb.convert_with_rules(data = dat_dist_freq_di12.lgb_test_set, rules = dat_dist_freq_di12.lgb_train_rules$rules)$data)
dat_dist_freq_di12.lgb_test_data = lgb.Dataset(data = dat_dist_freq_di12.lgb_test_matrix,
                                               label = dat_test_dist_freq_di12$C0_new,
                                               categorical_feature = handle_categorical(colnames(dat_dist_freq_di12.lgb_test_matrix)))
dat_dist_freq_di12.lgb_obj = lightgbm(data = dat_dist_freq_di12.lgb_train_data,
                                      params = list(learning_rate = c(0.1),
                                                    objective = c("regression"),
                                                    min_data_in_leaf = 100,
                                                    max_depth = c(5),
                                                    num_leaves = c(1000),
                                                    lambda_l2 = c(1),
                                                    boosting = c("gbdt")),
                                      valids = list(valid = dat_dist_freq_di12.lgb_test_data),
                                      nrounds = 8000,
                                      early_stopping_rounds = 50)

dat_dist_freq_di12.lgb_train_pred = predict(dat_dist_freq_di12.lgb_obj, data = as.matrix(dat_dist_freq_di12.lgb_train_rules$data))
cor(dat_dist_freq_di12.lgb_train_pred, y, method="pearson")
# 0.9703838 (nrounds = 2085)

dat_dist_freq_di12.lgb_test_pred = predict(dat_dist_freq_di12.lgb_obj, data = dat_dist_freq_di12.lgb_test_matrix)

cor(dat_dist_freq_di12.lgb_test_pred, y_test, method="pearson")
# 0.6982313 (nrounds = 2085)

mean((dat_dist_freq_di12.lgb_test_pred - y_test)^2)
# 0.1237693 (nrounds = 2085)
```

We get test prediction correlation of 0.6982313 and MSE of 0.1237693

```{r}
dat_dist_freq_di12.feature_importance = as.data.frame(lgb.importance(dat_dist_freq_di12.lgb_obj)) %>%
  mutate(Feature = fct_rev(fct_inorder(Feature))) %>%
  dplyr::slice(1:50) %>%
  ggplot(aes(x = Feature, y = Gain)) +
  geom_col(fill = "dodgerblue") +
  coord_flip() +
  theme_bw()
dat_dist_freq_di12.feature_importance
```


# Inputs: Position Specific Dinucleotides + Counts of Trinucleotides + Fourier Features Based on all Dinucleotides with h=6 (period 9.8) + Modulus of Difference of Fourier Features Based on all Dinucleotides with h=6 (period 9.8) Calculated using fft + Distance Frequency Between all Dinucleotides + Markov Ratio

```{r}
ps2 <- paste0("X", 1:49, "di")

nucleotides <- c("A", "C", "G", "T")
dinucleotides <- gtools::permutations(n = 4, r = 2, v = nucleotides,
                                      repeats.allowed = TRUE) %>%
  apply(1, paste, collapse = "")
trinucleotides <- gtools::permutations(n = 4, r = 3, v = nucleotides,
                                       repeats.allowed = TRUE) %>%
  apply(1, paste, collapse = "")

fourier_di_cos = readRDS("data/Created/tiling_fourier_di_cos.rds")
fourier_di_sin = readRDS("data/Created/tiling_fourier_di_sin.rds")
fourier_di_cos_test = readRDS("data/Created/tiling_fourier_di_cos_test.rds")
fourier_di_sin_test = readRDS("data/Created/tiling_fourier_di_sin_test.rds")

fourier_di_cos_6 = as.data.frame(fourier_di_cos) %>% select(ends_with("_6"))
fourier_di_sin_6 = as.data.frame(fourier_di_sin) %>% select(ends_with("_6"))
fourier_di_cos_6_test = as.data.frame(fourier_di_cos_test) %>% select(ends_with("_6"))
fourier_di_sin_6_test = as.data.frame(fourier_di_sin_test) %>% select(ends_with("_6"))

fourier_6_mod = readRDS("data/Created/tiling_fourier_6_mod.rds")
fourier_6_mod_test = readRDS("data/Created/tiling_fourier_6_mod_test.rds")

dist_freq_di = readRDS("data/Created/tiling_dist_freq_di.rds")
dist_freq_di_test = readRDS("data/Created/tiling_dist_freq_di_test.rds")
```

## Squared value of Fourier features

### Simple Linear Model

```{r}
dat_dist_freq_di13 = cbind(dat %>% select(all_of(ps2), all_of(trinucleotides), 
                                          ratio_score_2nd, C0_new), 
                           (fourier_di_cos_6)^2, (fourier_di_sin_6)^2, 
                           (fourier_6_mod)^2, dist_freq_di)

dist_freq_di13_lm = lm(C0_new~., data=dat_dist_freq_di13)
cor(dist_freq_di13_lm$fitted.values, y)
# 0.6634805

dat_test_dist_freq_di13 = cbind(dat_test %>% select(all_of(ps2), all_of(trinucleotides), 
                                                    ratio_score_2nd, C0_new), 
                                (fourier_di_cos_6_test)^2, (fourier_di_sin_6_test)^2, 
                                (fourier_6_mod_test)^2, dist_freq_di_test)

dist_freq_di13_pred = predict(dist_freq_di13_lm, dat_test_dist_freq_di13)

cor(dist_freq_di13_pred, y_test)
# 0.6951059

mean((dist_freq_di13_pred - y_test)^2)
# 0.1278607
```

We get test prediction correlation of 0.6951059 and MSE of 0.1278607

### LightGBM (tree-based) Model

```{r}
library(lightgbm)
source("scripts/functions/lgbm-helper-functions.R")
set.seed(50)
dat_dist_freq_di13.lgb_train_set = dat_dist_freq_di13 %>%
  select(-C0_new)
dat_dist_freq_di13.lgb_train_rules = lgb.convert_with_rules(data = dat_dist_freq_di13.lgb_train_set)
dat_dist_freq_di13.lgb_train_data = lgb.Dataset(data = as.matrix(dat_dist_freq_di13.lgb_train_rules$data),
                                                label = dat_dist_freq_di13$C0_new,
                                                categorical_feature = handle_categorical(colnames(dat_dist_freq_di13.lgb_train_rules$data)))
dat_dist_freq_di13.lgb_test_set = dat_test_dist_freq_di13 %>%
  select(-C0_new)
dat_dist_freq_di13.lgb_test_matrix = as.matrix(lgb.convert_with_rules(data = dat_dist_freq_di13.lgb_test_set, rules = dat_dist_freq_di13.lgb_train_rules$rules)$data)
dat_dist_freq_di13.lgb_test_data = lgb.Dataset(data = dat_dist_freq_di13.lgb_test_matrix,
                                               label = dat_test_dist_freq_di13$C0_new,
                                               categorical_feature = handle_categorical(colnames(dat_dist_freq_di13.lgb_test_matrix)))
dat_dist_freq_di13.lgb_obj = lightgbm(data = dat_dist_freq_di13.lgb_train_data,
                                      params = list(learning_rate = c(0.1),
                                                    objective = c("regression"),
                                                    min_data_in_leaf = 100,
                                                    max_depth = c(5),
                                                    num_leaves = c(1000),
                                                    lambda_l2 = c(1),
                                                    boosting = c("gbdt")),
                                      valids = list(valid = dat_dist_freq_di13.lgb_test_data),
                                      nrounds = 8000,
                                      early_stopping_rounds = 50)

dat_dist_freq_di13.lgb_train_pred = predict(dat_dist_freq_di13.lgb_obj, data = as.matrix(dat_dist_freq_di13.lgb_train_rules$data))
cor(dat_dist_freq_di13.lgb_train_pred, y, method="pearson")
# 0.9728155 (nrounds = 2177)

dat_dist_freq_di13.lgb_test_pred = predict(dat_dist_freq_di13.lgb_obj, data = dat_dist_freq_di13.lgb_test_matrix)

cor(dat_dist_freq_di13.lgb_test_pred, y_test, method="pearson")
# 0.7287331 (nrounds = 2177)

mean((dat_dist_freq_di13.lgb_test_pred - y_test)^2)
# 0.114151 (nrounds = 2177)
```

We get test prediction correlation of 0.7287331 and MSE of 0.114151

```{r}
dat_dist_freq_di13.feature_importance = as.data.frame(lgb.importance(dat_dist_freq_di13.lgb_obj)) %>%
  mutate(Feature = fct_rev(fct_inorder(Feature))) %>%
  dplyr::slice(1:50) %>%
  ggplot(aes(x = Feature, y = Gain)) +
  geom_col(fill = "dodgerblue") +
  coord_flip() +
  theme_bw()
dat_dist_freq_di13.feature_importance
```


# Inputs: Position Specific Dinucleotides + Counts of Trinucleotides + Fourier Features Based on all Dinucleotides + Modulus of Difference of Fourier Features Based on all Dinucleotides with h=6 (period 9.8) Calculated using fft + Distance Frequency Between all Dinucleotides

TODO

```{r}
ps2 <- paste0("X", 1:49, "di")

nucleotides <- c("A", "C", "G", "T")
dinucleotides <- gtools::permutations(n = 4, r = 2, v = nucleotides,
                                      repeats.allowed = TRUE) %>%
  apply(1, paste, collapse = "")
trinucleotides <- gtools::permutations(n = 4, r = 3, v = nucleotides,
                                       repeats.allowed = TRUE) %>%
  apply(1, paste, collapse = "")

fourier_di_cos = readRDS("data/Created/tiling_fourier_di_cos.rds")
fourier_di_sin = readRDS("data/Created/tiling_fourier_di_sin.rds")
fourier_di_cos_test = readRDS("data/Created/tiling_fourier_di_cos_test.rds")
fourier_di_sin_test = readRDS("data/Created/tiling_fourier_di_sin_test.rds")

fourier_6_mod = readRDS("data/Created/tiling_fourier_6_mod.rds")
fourier_6_mod_test = readRDS("data/Created/tiling_fourier_6_mod_test.rds")

dist_freq_di = readRDS("data/Created/tiling_dist_freq_di.rds")
dist_freq_di_test = readRDS("data/Created/tiling_dist_freq_di_test.rds")
```

## Squared value of Fourier features

### Simple Linear Model

```{r}
dat_dist_freq_di14 = cbind(dat %>% select(all_of(ps2), 
                                          all_of(trinucleotides), C0_new), 
                           (fourier_di_cos)^2, (fourier_di_sin)^2, 
                           (fourier_6_mod)^2, dist_freq_di)

dist_freq_di14_lm = lm(C0_new~., data=dat_dist_freq_di14)
cor(dist_freq_di14_lm$fitted.values, y)
# 

dat_test_dist_freq_di14 = cbind(dat_test %>% select(all_of(ps2), 
                                                    all_of(trinucleotides), C0_new), 
                                (fourier_di_cos_test)^2, (fourier_di_sin_test)^2, 
                                (fourier_6_mod_test)^2, dist_freq_di_test)

dist_freq_di14_pred = predict(dist_freq_di14_lm, dat_test_dist_freq_di14)

cor(dist_freq_di14_pred, y_test)
# 

mean((dist_freq_di14_pred - y_test)^2)
# 
```

We get test prediction correlation of  and MSE of 

### LightGBM (tree-based) Model

```{r}
library(lightgbm)
source("scripts/functions/lgbm-helper-functions.R")
set.seed(50)
dat_dist_freq_di14.lgb_train_set = dat_dist_freq_di14 %>%
  select(-C0_new)
dat_dist_freq_di14.lgb_train_rules = lgb.convert_with_rules(data = dat_dist_freq_di14.lgb_train_set)
dat_dist_freq_di14.lgb_train_data = lgb.Dataset(data = as.matrix(dat_dist_freq_di14.lgb_train_rules$data),
                                                label = dat_dist_freq_di14$C0_new,
                                                categorical_feature = handle_categorical(colnames(dat_dist_freq_di14.lgb_train_rules$data)))
dat_dist_freq_di14.lgb_test_set = dat_test_dist_freq_di14 %>%
  select(-C0_new)
dat_dist_freq_di14.lgb_test_matrix = as.matrix(lgb.convert_with_rules(data = dat_dist_freq_di14.lgb_test_set, rules = dat_dist_freq_di14.lgb_train_rules$rules)$data)
dat_dist_freq_di14.lgb_test_data = lgb.Dataset(data = dat_dist_freq_di14.lgb_test_matrix,
                                               label = dat_test_dist_freq_di14$C0_new,
                                               categorical_feature = handle_categorical(colnames(dat_dist_freq_di14.lgb_test_matrix)))
dat_dist_freq_di14.lgb_obj = lightgbm(data = dat_dist_freq_di14.lgb_train_data,
                                      params = list(learning_rate = c(0.1),
                                                    objective = c("regression"),
                                                    min_data_in_leaf = 100,
                                                    max_depth = c(5),
                                                    num_leaves = c(1000),
                                                    lambda_l2 = c(1),
                                                    boosting = c("gbdt")),
                                      valids = list(valid = dat_dist_freq_di14.lgb_test_data),
                                      nrounds = 8000,
                                      early_stopping_rounds = 50)

dat_dist_freq_di14.lgb_train_pred = predict(dat_dist_freq_di14.lgb_obj, data = as.matrix(dat_dist_freq_di14.lgb_train_rules$data))
cor(dat_dist_freq_di14.lgb_train_pred, y, method="pearson")
#  (nrounds = )

dat_dist_freq_di14.lgb_test_pred = predict(dat_dist_freq_di14.lgb_obj, data = dat_dist_freq_di14.lgb_test_matrix)

cor(dat_dist_freq_di14.lgb_test_pred, y_test, method="pearson")
#  (nrounds = )

mean((dat_dist_freq_di14.lgb_test_pred - y_test)^2)
#  (nrounds = )
```

We get test prediction correlation of  and MSE of 

```{r}
dat_dist_freq_di14.feature_importance = as.data.frame(lgb.importance(dat_dist_freq_di14.lgb_obj)) %>%
  mutate(Feature = fct_rev(fct_inorder(Feature))) %>%
  dplyr::slice(1:50) %>%
  ggplot(aes(x = Feature, y = Gain)) +
  geom_col(fill = "dodgerblue") +
  coord_flip() +
  theme_bw()
dat_dist_freq_di14.feature_importance
```


# Inputs: All Distance Frequency Between all Dinucleotides Only

```{r}
library(Matrix)
library(glmnet)
library(sparsegl)

dist_freq_di_di_bid2 = readRDS("data/Created/tiling_dist_freq_di_di_bid2.rds")
dist_freq_di_di_bid2_test = readRDS("data/Created/tiling_dist_freq_di_di_bid2_test.rds")

dist_freq_di_di_bid2_random_all = readRDS("data/Created/random_all_dist_freq_di_di_bid2.rds")

dist_freq_di_di_bid2_chrV_all = readRDS("data/Created/chrV_all_dist_freq_di_di_bid2.rds")

dist_freq_di_di_bid2_yeast_all = readRDS("data/Created/yeast_all_dist_freq_di_di_bid2.rds")
```

## Simple Linear Model

```{r}
dat_all_dist_freq_di = cbind(dist_freq_di_di_bid2, dat %>% select(C0_new))

all_dist_freq_di_lm = lm(C0_new~., data=dat_all_dist_freq_di)
cor(all_dist_freq_di_lm$fitted.values, y)
# 0.8011437

dat_test_all_dist_freq_di = cbind(dist_freq_di_di_bid2_test, dat_test %>% select(C0_new))

all_dist_freq_di_pred = predict(all_dist_freq_di_lm, dat_test_all_dist_freq_di)

cor(all_dist_freq_di_pred, y_test)
# 0.7666998

mean((all_dist_freq_di_pred - y_test)^2)
# 0.09974896


dat_all_dist_freq_di_random_all = cbind(dist_freq_di_di_bid2_random_all, dat_random_all %>% select(C0_new))

all_dist_freq_di_pred_random_all = predict(all_dist_freq_di_lm, dat_all_dist_freq_di_random_all)

cor(all_dist_freq_di_pred_random_all, y_random_all)
# 0.6755148

mean((all_dist_freq_di_pred_random_all - y_random_all)^2)
# 0.08419158


dat_all_dist_freq_di_chrV_all = cbind(dist_freq_di_di_bid2_chrV_all, dat_chrV_all %>% select(C0_new))

all_dist_freq_di_pred_chrV_all = predict(all_dist_freq_di_lm, dat_all_dist_freq_di_chrV_all)

cor(all_dist_freq_di_pred_chrV_all, y_chrV_all)
# 0.6108426

mean((all_dist_freq_di_pred_chrV_all - y_chrV_all)^2)
# 0.184584


dat_all_dist_freq_di_yeast_all = cbind(dist_freq_di_di_bid2_yeast_all, dat_yeast_all %>% select(C0_new))

all_dist_freq_di_pred_yeast_all = predict(all_dist_freq_di_lm, dat_all_dist_freq_di_yeast_all)

cor(all_dist_freq_di_pred_yeast_all, y_yeast_all)
# 0.6876693

mean((all_dist_freq_di_pred_yeast_all - y_yeast_all)^2)
# 0.1172056
```

We get test prediction correlation of 0.7666998 and MSE of 0.09974896
We get test prediction correlation of 0.6755148 and MSE of 0.08419158 on the random library
We get test prediction correlation of 0.6108426 and MSE of 0.184584 on the chrV library
We get test prediction correlation of 0.6876693 and MSE of 0.1172056 on the yeast library

## Lasso Model

```{r}
X_all_dist_freq_di = dat_all_dist_freq_di %>%
  select(-C0_new)

x_all_dist_freq_di = sparse.model.matrix(~., data=X_all_dist_freq_di)

set.seed(50)
la.model_all_dist_freq_di = cv.glmnet(x_all_dist_freq_di, y, alpha=1, family="gaussian")

la.all_dist_freq_di_best_lambda = la.model_all_dist_freq_di$lambda.min

sum(coef(la.model_all_dist_freq_di, s=la.all_dist_freq_di_best_lambda) != 0)
# 5367

la.all_dist_freq_di_lambda_1se = la.model_all_dist_freq_di$lambda.1se

sum(coef(la.model_all_dist_freq_di, s=la.all_dist_freq_di_lambda_1se) != 0)
# 4025

saveRDS(la.model_all_dist_freq_di, "model/lasso-all_dist_freq_di.rds")

la.model_all_dist_freq_di.train_pred = predict(la.model_all_dist_freq_di, newx = x_all_dist_freq_di, s=la.all_dist_freq_di_best_lambda)

cor(la.model_all_dist_freq_di.train_pred, y, method="pearson")
# 0.7974977

mean((la.model_all_dist_freq_di.train_pred - y)^2)
# 0.08826534

la.model_all_dist_freq_di.train_pred2 = predict(la.model_all_dist_freq_di, newx = x_all_dist_freq_di, s=la.all_dist_freq_di_lambda_1se)

cor(la.model_all_dist_freq_di.train_pred2, y, method="pearson")
# 0.7880057

mean((la.model_all_dist_freq_di.train_pred2 - y)^2)
# 0.09216665

X_all_dist_freq_di_test = dat_test_all_dist_freq_di %>%
  select(-C0_new)
x_all_dist_freq_di_test = sparse.model.matrix(~., data=X_all_dist_freq_di_test)

# Predict values for test dataset:
la.model_all_dist_freq_di.pred = predict(la.model_all_dist_freq_di, newx = x_all_dist_freq_di_test, s=la.all_dist_freq_di_best_lambda)

# Prediction accuracy with test data:
cor(la.model_all_dist_freq_di.pred, y_test, method="pearson")
# 0.7693824

mean((la.model_all_dist_freq_di.pred - y_test)^2)
# 0.09842909

la.model_all_dist_freq_di.pred2 = predict(la.model_all_dist_freq_di, newx = x_all_dist_freq_di_test, s=la.all_dist_freq_di_lambda_1se)

# Prediction accuracy with test data:
cor(la.model_all_dist_freq_di.pred2, y_test, method="pearson")
# 0.7668234

mean((la.model_all_dist_freq_di.pred2 - y_test)^2)
# 0.09933138


X_all_dist_freq_di_random_all = dat_all_dist_freq_di_random_all %>%
  select(-C0_new)
x_all_dist_freq_di_random_all = sparse.model.matrix(~., data=X_all_dist_freq_di_random_all)

# Predict values for random dataset:
la.model_all_dist_freq_di.pred_random_all = predict(la.model_all_dist_freq_di, newx = x_all_dist_freq_di_random_all, s=la.all_dist_freq_di_best_lambda)

# Prediction accuracy with random data:
cor(la.model_all_dist_freq_di.pred_random_all, y_random_all, method="pearson")
# 0.6838314

mean((la.model_all_dist_freq_di.pred_random_all - y_random_all)^2)
# 0.08032954

la.model_all_dist_freq_di.pred2_random_all = predict(la.model_all_dist_freq_di, newx = x_all_dist_freq_di_random_all, s=la.all_dist_freq_di_lambda_1se)

# Prediction accuracy with random data:
cor(la.model_all_dist_freq_di.pred2_random_all, y_random_all, method="pearson")
# 0.685367

mean((la.model_all_dist_freq_di.pred2_random_all - y_random_all)^2)
# 0.07791932
```

We get test prediction correlation of 0.7693824 and MSE of 0.09842909 with min lasso (5367 nonzero)
We get test prediction correlation of 0.7668234 and MSE of 0.09933138 with lasso 1se (4025 nonzero)
We get prediction correlation of 0.6838314 on the random library with min lasso
We get prediction correlation of 0.685367 on the random library with lasso 1se

## Group Lasso Model

### Groupings based on pairs of Dinucleotides and Dinucleotide Groups (136 groups)

```{r}
X_all_dist_freq_di = dat_all_dist_freq_di %>%
  select(-C0_new)

x_all_dist_freq_di = sparse.model.matrix(~., data=X_all_dist_freq_di)

gla.di_groups_all_dist_freq_di = c(1, rep(2:137, times=47))

set.seed(50)
gla.model_all_dist_freq_di = cv.sparsegl(x_all_dist_freq_di, y, group=gla.di_groups_all_dist_freq_di, family="gaussian")

gla.all_dist_freq_di_best_lambda = gla.model_all_dist_freq_di$lambda.min

sum(coef(gla.model_all_dist_freq_di, s=gla.all_dist_freq_di_best_lambda) != 0)
# 6393

gla.all_dist_freq_di_lambda_1se = gla.model_all_dist_freq_di$lambda.1se

sum(coef(gla.model_all_dist_freq_di, s=gla.all_dist_freq_di_lambda_1se) != 0)
# 6392

saveRDS(gla.model_all_dist_freq_di, "model/group-lasso-all_dist_freq_di.rds")

gla.model_all_dist_freq_di.train_pred = predict(gla.model_all_dist_freq_di, newx = x_all_dist_freq_di, s=gla.all_dist_freq_di_best_lambda)

cor(gla.model_all_dist_freq_di.train_pred, y, method="pearson")
# 0.7938812
mean((gla.model_all_dist_freq_di.train_pred - y)^2)
# 0.08964997

gla.model_all_dist_freq_di.train_pred2 = predict(gla.model_all_dist_freq_di, newx = x_all_dist_freq_di, s=gla.all_dist_freq_di_lambda_1se)

cor(gla.model_all_dist_freq_di.train_pred2, y, method="pearson")
# 0.08964997
mean((gla.model_all_dist_freq_di.train_pred2 - y)^2)
# 0.09144637

X_all_dist_freq_di_test = dat_test_all_dist_freq_di %>%
  select(-C0_new)
x_all_dist_freq_di_test = sparse.model.matrix(~., data=X_all_dist_freq_di_test)

# Predict values for test dataset:
gla.model_all_dist_freq_di.pred = predict(gla.model_all_dist_freq_di, newx = x_all_dist_freq_di_test, s=gla.all_dist_freq_di_best_lambda)

# Prediction accuracy with test data:
cor(gla.model_all_dist_freq_di.pred, y_test, method="pearson")
# 0.765834
mean((gla.model_all_dist_freq_di.pred - y_test)^2)
# 0.09974131

gla.model_all_dist_freq_di.pred2 = predict(gla.model_all_dist_freq_di, newx = x_all_dist_freq_di_test, s=gla.all_dist_freq_di_lambda_1se)

# Prediction accuracy with test data:
cor(gla.model_all_dist_freq_di.pred2, y_test, method="pearson")
# 0.763749
mean((gla.model_all_dist_freq_di.pred2 - y_test)^2)
# 0.1004296

X_all_dist_freq_di_random_all = dat_random_all_dist_freq_di %>%
  select(-C0_new)
x_all_dist_freq_di_random_all = sparse.model.matrix(~., data=X_all_dist_freq_di_random_all)

# Predict values for random dataset:
gla.model_all_dist_freq_di.pred_random_all = predict(gla.model_all_dist_freq_di, newx = x_all_dist_freq_di_random_all, s=gla.all_dist_freq_di_best_lambda)

# Prediction accuracy with random data:
cor(gla.model_all_dist_freq_di.pred_random_all, y_random_all, method="pearson")
# 0.6772085

mean((gla.model_all_dist_freq_di.pred_random_all - y_random_all)^2)
# 0.08180621

gla.model_all_dist_freq_di.pred2_random_all = predict(gla.model_all_dist_freq_di, newx = x_all_dist_freq_di_random_all, s=gla.all_dist_freq_di_lambda_1se)

# Prediction accuracy with random data:
cor(gla.model_all_dist_freq_di.pred2_random_all, y_random_all, method="pearson")
# 0.6756004

mean((gla.model_all_dist_freq_di.pred2_random_all - y_random_all)^2)
# 0.08112464
```

We get test prediction correlation of 0.765834 and MSE of 0.09974131 with min lasso (6393 nonzero)
We get test prediction correlation of 0.763749 and MSE of 0.1004296 with lasso 1se (6392 nonzero)
We get prediction correlation of 0.6772085 on the random library with min lasso
We get prediction correlation of 0.6756004 on the random library with lasso 1se


### Groupings based on distances (47 groups)

```{r}
# X_all_dist_freq_di = dat_all_dist_freq_di %>%
#   select(-C0_new)
# 
# x_all_dist_freq_di = sparse.model.matrix(~., data=X_all_dist_freq_di)

gla2.di_groups_all_dist_freq_di = c(1, rep(2:48, each=136))

set.seed(50)
gla2.model_all_dist_freq_di = cv.sparsegl(x_all_dist_freq_di, y, group=gla2.di_groups_all_dist_freq_di, family="gaussian")

gla2.all_dist_freq_di_best_lambda = gla2.model_all_dist_freq_di$lambda.min

sum(coef(gla2.model_all_dist_freq_di, s=gla2.all_dist_freq_di_best_lambda) != 0)
# 6393

gla2.all_dist_freq_di_lambda_1se = gla2.model_all_dist_freq_di$lambda.1se

sum(coef(gla2.model_all_dist_freq_di, s=gla2.all_dist_freq_di_lambda_1se) != 0)
# 6393

saveRDS(gla2.model_all_dist_freq_di, "model/group-lasso-2-all_dist_freq_di.rds")

gla2.model_all_dist_freq_di.train_pred = predict(gla2.model_all_dist_freq_di, newx = x_all_dist_freq_di, s=gla2.all_dist_freq_di_best_lambda)

cor(gla2.model_all_dist_freq_di.train_pred, y, method="pearson")
# 0.7856578

mean((gla2.model_all_dist_freq_di.train_pred - y)^2)
# 0.09298675

gla2.model_all_dist_freq_di.train_pred2 = predict(gla2.model_all_dist_freq_di, newx = x_all_dist_freq_di, s=gla2.all_dist_freq_di_lambda_1se)

cor(gla2.model_all_dist_freq_di.train_pred2, y, method="pearson")
# 0.7825192
mean((gla2.model_all_dist_freq_di.train_pred2 - y)^2)
# 0.09433751

# X_all_dist_freq_di_test = dat_test_all_dist_freq_di %>%
#   select(-C0_new)
# x_all_dist_freq_di_test = sparse.model.matrix(~., data=X_all_dist_freq_di_test)

# Predict values for test dataset:
gla2.model_all_dist_freq_di.pred = predict(gla2.model_all_dist_freq_di, newx = x_all_dist_freq_di_test, s=gla2.all_dist_freq_di_best_lambda)

# Prediction accuracy with test data:
cor(gla2.model_all_dist_freq_di.pred, y_test, method="pearson")
# 0.7598365

mean((gla2.model_all_dist_freq_di.pred - y_test)^2)
# 0.1018714

gla2.model_all_dist_freq_di.pred2 = predict(gla2.model_all_dist_freq_di, newx = x_all_dist_freq_di_test, s=gla2.all_dist_freq_di_lambda_1se)

# Prediction accuracy with test data:
cor(gla2.model_all_dist_freq_di.pred2, y_test, method="pearson")
# 0.7577191

mean((gla2.model_all_dist_freq_di.pred2 - y_test)^2)
# 0.1027054

# Predict values for random dataset:
gla2.model_all_dist_freq_di.pred_random_all = predict(gla2.model_all_dist_freq_di, newx = x_all_dist_freq_di_random_all, s=gla2.all_dist_freq_di_best_lambda)

# Prediction accuracy with random data:
cor(gla2.model_all_dist_freq_di.pred_random_all, y_random_all, method="pearson")
# 0.6708896

mean((gla2.model_all_dist_freq_di.pred_random_all - y_random_all)^2)
# 0.08178617

gla2.model_all_dist_freq_di.pred2_random_all = predict(gla2.model_all_dist_freq_di, newx = x_all_dist_freq_di_random_all, s=gla2.all_dist_freq_di_lambda_1se)

# Prediction accuracy with random data:
cor(gla2.model_all_dist_freq_di.pred2_random_all, y_random_all, method="pearson")
# 0.6697395

mean((gla2.model_all_dist_freq_di.pred2_random_all - y_random_all)^2)
# 0.08150704
```

We get test prediction correlation of 0.7598365 and MSE of 0.1018714 with min lasso (6393 nonzero)
We get test prediction correlation of 0.7577191 and MSE of 0.1027054 with lasso 1se (6393 nonzero)
We get prediction correlation of 0.6708896 on the random library with min lasso
We get prediction correlation of 0.6697395 on the random library with lasso 1se

## LightGBM (tree-based) Model

```{r}
library(lightgbm)
source("scripts/functions/lgbm-helper-functions.R")
set.seed(50)
dat_all_dist_freq_di.lgb_train_set = dat_all_dist_freq_di %>%
  select(-C0_new)
dat_all_dist_freq_di.lgb_train_rules = lgb.convert_with_rules(data = dat_all_dist_freq_di.lgb_train_set)
dat_all_dist_freq_di.lgb_train_data = lgb.Dataset(data = as.matrix(dat_all_dist_freq_di.lgb_train_rules$data),
                                                  label = dat_all_dist_freq_di$C0_new,
                                                  categorical_feature = handle_categorical(colnames(dat_all_dist_freq_di.lgb_train_rules$data)))
dat_all_dist_freq_di.lgb_test_set = dat_test_all_dist_freq_di %>%
  select(-C0_new)
dat_all_dist_freq_di.lgb_test_matrix = as.matrix(lgb.convert_with_rules(data = dat_all_dist_freq_di.lgb_test_set, rules = dat_all_dist_freq_di.lgb_train_rules$rules)$data)
dat_all_dist_freq_di.lgb_test_data = lgb.Dataset(data = dat_all_dist_freq_di.lgb_test_matrix,
                                                 label = dat_test_all_dist_freq_di$C0_new,
                                                 categorical_feature = handle_categorical(colnames(dat_all_dist_freq_di.lgb_test_matrix)))
dat_all_dist_freq_di.lgb_obj = lightgbm(data = dat_all_dist_freq_di.lgb_train_data,
                                        params = list(learning_rate = c(0.1),
                                                      objective = c("regression"),
                                                      min_data_in_leaf = 100,
                                                      max_depth = c(5),
                                                      num_leaves = c(1000),
                                                      lambda_l2 = c(1),
                                                      boosting = c("gbdt")),
                                        valids = list(valid = dat_all_dist_freq_di.lgb_test_data),
                                        nrounds = 8000,
                                        early_stopping_rounds = 50)

dat_all_dist_freq_di.lgb_train_pred = predict(dat_all_dist_freq_di.lgb_obj, data = as.matrix(dat_all_dist_freq_di.lgb_train_rules$data))
cor(dat_all_dist_freq_di.lgb_train_pred, y, method="pearson")
# 0.9839357 (nrounds = 5506)

dat_all_dist_freq_di.lgb_test_pred = predict(dat_all_dist_freq_di.lgb_obj, data = dat_all_dist_freq_di.lgb_test_matrix)

cor(dat_all_dist_freq_di.lgb_test_pred, y_test, method="pearson")
# 0.7977623 (nrounds = 5506)

mean((dat_all_dist_freq_di.lgb_test_pred - y_test)^2)
# 0.08789541 (nrounds = 5506)


# Predict on random:
dat_all_dist_freq_di.lgb_random_all_set = dat_all_dist_freq_di_random_all %>%
  select(-C0_new)
dat_all_dist_freq_di.lgb_random_all_matrix = as.matrix(lgb.convert_with_rules(data = dat_all_dist_freq_di.lgb_random_all_set, rules = dat_all_dist_freq_di.lgb_train_rules$rules)$data)


dat_all_dist_freq_di.lgb_random_all_pred = predict(dat_all_dist_freq_di.lgb_obj, data = dat_all_dist_freq_di.lgb_random_all_matrix)

cor(dat_all_dist_freq_di.lgb_random_all_pred, y_random_all, method="pearson")
# 0.6461621

mean((dat_all_dist_freq_di.lgb_random_all_pred - y_random_all)^2)
# 0.08371405


# Predict on chrV:
dat_all_dist_freq_di.lgb_chrV_all_set = dat_all_dist_freq_di_chrV_all %>%
  select(-C0_new)
dat_all_dist_freq_di.lgb_chrV_all_matrix = as.matrix(lgb.convert_with_rules(data = dat_all_dist_freq_di.lgb_chrV_all_set, rules = dat_all_dist_freq_di.lgb_train_rules$rules)$data)


dat_all_dist_freq_di.lgb_chrV_all_pred = predict(dat_all_dist_freq_di.lgb_obj, data = dat_all_dist_freq_di.lgb_chrV_all_matrix)

cor(dat_all_dist_freq_di.lgb_chrV_all_pred, y_chrV_all, method="pearson")
# 0.5844058

mean((dat_all_dist_freq_di.lgb_chrV_all_pred - y_chrV_all)^2)
# 0.1913997


# Predict on yeast:
dat_all_dist_freq_di.lgb_yeast_all_set = dat_all_dist_freq_di_yeast_all %>%
  select(-C0_new)
dat_all_dist_freq_di.lgb_yeast_all_matrix = as.matrix(lgb.convert_with_rules(data = dat_all_dist_freq_di.lgb_yeast_all_set, rules = dat_all_dist_freq_di.lgb_train_rules$rules)$data)


dat_all_dist_freq_di.lgb_yeast_all_pred = predict(dat_all_dist_freq_di.lgb_obj, data = dat_all_dist_freq_di.lgb_yeast_all_matrix)

cor(dat_all_dist_freq_di.lgb_yeast_all_pred, y_yeast_all, method="pearson")
# 0.6654294

mean((dat_all_dist_freq_di.lgb_yeast_all_pred - y_yeast_all)^2)
# 0.1196029
```

We get test prediction correlation of 0.7977623 and MSE of 0.08789541

```{r}
dat_all_dist_freq_di.feature_importance = as.data.frame(lgb.importance(dat_all_dist_freq_di.lgb_obj)) %>%
  mutate(Feature = fct_rev(fct_inorder(Feature))) %>%
  dplyr::slice(1:50) %>%
  ggplot(aes(x = Feature, y = Gain)) +
  geom_col(fill = "dodgerblue") +
  coord_flip() +
  theme_bw()
dat_all_dist_freq_di.feature_importance
```

# Inputs: HRI Only

```{r}
HRI = readRDS("data/Created/tiling_HRI.rds")
HRI_test = readRDS("data/Created/tiling_HRI_test.rds")
```

## Simple Linear Model

```{r}
dat_HRI = cbind(HRI, dat %>% select(C0_new))

HRI_lm = lm(C0_new~., data=dat_HRI)
cor(HRI_lm$fitted.values, y)
# 0.4694983

dat_test_HRI = cbind(HRI_test, dat_test %>% select(C0_new))

HRI_pred = predict(HRI_lm, dat_test_HRI)

cor(HRI_pred, y_test)
# 0.47547

mean((HRI_pred - y_test)^2)
# 0.1865211
```

We get test prediction correlation of 0.47547 and MSE of 0.1865211

## LightGBM (tree-based) Model

```{r}
library(lightgbm)
source("scripts/functions/lgbm-helper-functions.R")
set.seed(50)
dat_HRI.lgb_train_set = dat_HRI %>%
  select(-C0_new)
dat_HRI.lgb_train_rules = lgb.convert_with_rules(data = dat_HRI.lgb_train_set)
dat_HRI.lgb_train_data = lgb.Dataset(data = as.matrix(dat_HRI.lgb_train_rules$data),
                                     label = dat_HRI$C0_new,
                                     categorical_feature = handle_categorical(colnames(dat_HRI.lgb_train_rules$data)))
dat_HRI.lgb_test_set = dat_test_HRI %>%
  select(-C0_new)
dat_HRI.lgb_test_matrix = as.matrix(lgb.convert_with_rules(data = dat_HRI.lgb_test_set, rules = dat_HRI.lgb_train_rules$rules)$data)
dat_HRI.lgb_test_data = lgb.Dataset(data = dat_HRI.lgb_test_matrix,
                                    label = dat_test_HRI$C0_new,
                                    categorical_feature = handle_categorical(colnames(dat_HRI.lgb_test_matrix)))
dat_HRI.lgb_obj = lightgbm(data = dat_HRI.lgb_train_data,
                           params = list(learning_rate = c(0.1),
                                         objective = c("regression"),
                                         min_data_in_leaf = 100,
                                         max_depth = c(5),
                                         num_leaves = c(1000),
                                         lambda_l2 = c(1),
                                         boosting = c("gbdt")),
                           valids = list(valid = dat_HRI.lgb_test_data),
                           nrounds = 8000,
                           early_stopping_rounds = 50)

dat_HRI.lgb_train_pred = predict(dat_HRI.lgb_obj, data = as.matrix(dat_HRI.lgb_train_rules$data))
cor(dat_HRI.lgb_train_pred, y, method="pearson")
# 0.899341 (nrounds = 4435)

dat_HRI.lgb_test_pred = predict(dat_HRI.lgb_obj, data = dat_HRI.lgb_test_matrix)

cor(dat_HRI.lgb_test_pred, y_test, method="pearson")
# 0.6368633 (nrounds = 4435)

mean((dat_HRI.lgb_test_pred - y_test)^2)
# 0.143255 (nrounds = 4435)
```

We get test prediction correlation of 0.6368633 and MSE of 0.143255

```{r}
dat_HRI.feature_importance = as.data.frame(lgb.importance(dat_HRI.lgb_obj)) %>%
  mutate(Feature = fct_rev(fct_inorder(Feature))) %>%
  dplyr::slice(1:50) %>%
  ggplot(aes(x = Feature, y = Gain)) +
  geom_col(fill = "dodgerblue") +
  coord_flip() +
  theme_bw()
dat_HRI.feature_importance
```



# Inputs: Counts of dinucleotides + HRI

```{r}
nucleotides <- c("A", "C", "G", "T")
dinucleotides <- gtools::permutations(n = 4, r = 2, v = nucleotides,
                                      repeats.allowed = TRUE) %>%
  apply(1, paste, collapse = "")

HRI = readRDS("data/Created/tiling_HRI.rds")
HRI_test = readRDS("data/Created/tiling_HRI_test.rds")
```

## Simple Linear Model

```{r}
dat_HRI2 = cbind(dat %>% select(all_of(dinucleotides), C0_new), 
                 HRI)

HRI2_lm = lm(C0_new~., data=dat_HRI2)
cor(HRI2_lm$fitted.values, y)
# 0.5479661

dat_test_HRI2 = cbind(dat_test %>% select(all_of(dinucleotides), C0_new),
                      HRI_test)

HRI2_pred = predict(HRI2_lm, dat_test_HRI2)

cor(HRI2_pred, y_test)
# 0.5516976

mean((HRI2_pred - y_test)^2)
# 0.167674
```

We get test prediction correlation of 0.5516976 and MSE of 0.167674

## LightGBM (tree-based) Model

```{r}
library(lightgbm)
source("scripts/functions/lgbm-helper-functions.R")
set.seed(50)
dat_HRI2.lgb_train_set = dat_HRI2 %>%
  select(-C0_new)
dat_HRI2.lgb_train_rules = lgb.convert_with_rules(data = dat_HRI2.lgb_train_set)
dat_HRI2.lgb_train_data = lgb.Dataset(data = as.matrix(dat_HRI2.lgb_train_rules$data),
                                      label = dat_HRI2$C0_new,
                                      categorical_feature = handle_categorical(colnames(dat_HRI2.lgb_train_rules$data)))
dat_HRI2.lgb_test_set = dat_test_HRI2 %>%
  select(-C0_new)
dat_HRI2.lgb_test_matrix = as.matrix(lgb.convert_with_rules(data = dat_HRI2.lgb_test_set, rules = dat_HRI2.lgb_train_rules$rules)$data)
dat_HRI2.lgb_test_data = lgb.Dataset(data = dat_HRI2.lgb_test_matrix,
                                     label = dat_test_HRI2$C0_new,
                                     categorical_feature = handle_categorical(colnames(dat_HRI2.lgb_test_matrix)))
dat_HRI2.lgb_obj = lightgbm(data = dat_HRI2.lgb_train_data,
                            params = list(learning_rate = c(0.1),
                                          objective = c("regression"),
                                          min_data_in_leaf = 100,
                                          max_depth = c(5),
                                          num_leaves = c(1000),
                                          lambda_l2 = c(1),
                                          boosting = c("gbdt")),
                            valids = list(valid = dat_HRI2.lgb_test_data),
                            nrounds = 8000,
                            early_stopping_rounds = 50)

dat_HRI2.lgb_train_pred = predict(dat_HRI2.lgb_obj, data = as.matrix(dat_HRI2.lgb_train_rules$data))
cor(dat_HRI2.lgb_train_pred, y, method="pearson")
# 0.9121191 (nrounds = 3989)

dat_HRI2.lgb_test_pred = predict(dat_HRI2.lgb_obj, data = dat_HRI2.lgb_test_matrix)

cor(dat_HRI2.lgb_test_pred, y_test, method="pearson")
# 0.6717866 (nrounds = 3989)

mean((dat_HRI2.lgb_test_pred - y_test)^2)
# 0.1322409 (nrounds = 3989)
```

We get test prediction correlation of 0.6717866 and MSE of 0.1322409

```{r}
dat_HRI2.feature_importance = as.data.frame(lgb.importance(dat_HRI2.lgb_obj)) %>%
  mutate(Feature = fct_rev(fct_inorder(Feature))) %>%
  dplyr::slice(1:50) %>%
  ggplot(aes(x = Feature, y = Gain)) +
  geom_col(fill = "dodgerblue") +
  coord_flip() +
  theme_bw()
dat_HRI2.feature_importance
```


# Inputs: Counts of triuncleotides + HRI

```{r}
nucleotides <- c("A", "C", "G", "T")
dinucleotides <- gtools::permutations(n = 4, r = 2, v = nucleotides,
                                      repeats.allowed = TRUE) %>%
  apply(1, paste, collapse = "")
trinucleotides <- gtools::permutations(n = 4, r = 3, v = nucleotides,
                                       repeats.allowed = TRUE) %>%
  apply(1, paste, collapse = "")

HRI = readRDS("data/Created/tiling_HRI.rds")
HRI_test = readRDS("data/Created/tiling_HRI_test.rds")
```

## Simple Linear Model

```{r}
dat_HRI3 = cbind(dat %>% select(all_of(trinucleotides), C0_new), 
                 HRI)

HRI3_lm = lm(C0_new~., data=dat_HRI3)
cor(HRI3_lm$fitted.values, y)
# 0.5649414

dat_test_HRI3 = cbind(dat_test %>% select(all_of(trinucleotides), C0_new),
                      HRI_test)

HRI3_pred = predict(HRI3_lm, dat_test_HRI3)

cor(HRI3_pred, y_test)
# 0.5675546

mean((HRI3_pred - y_test)^2)
# 0.1634117
```

We get test prediction correlation of 0.5675546 and MSE of 0.1634117

## LightGBM (tree-based) Model

```{r}
library(lightgbm)
source("scripts/functions/lgbm-helper-functions.R")
set.seed(50)
dat_HRI3.lgb_train_set = dat_HRI3 %>%
  select(-C0_new)
dat_HRI3.lgb_train_rules = lgb.convert_with_rules(data = dat_HRI3.lgb_train_set)
dat_HRI3.lgb_train_data = lgb.Dataset(data = as.matrix(dat_HRI3.lgb_train_rules$data),
                                      label = dat_HRI3$C0_new,
                                      categorical_feature = handle_categorical(colnames(dat_HRI3.lgb_train_rules$data)))
dat_HRI3.lgb_test_set = dat_test_HRI3 %>%
  select(-C0_new)
dat_HRI3.lgb_test_matrix = as.matrix(lgb.convert_with_rules(data = dat_HRI3.lgb_test_set, rules = dat_HRI3.lgb_train_rules$rules)$data)
dat_HRI3.lgb_test_data = lgb.Dataset(data = dat_HRI3.lgb_test_matrix,
                                     label = dat_test_HRI3$C0_new,
                                     categorical_feature = handle_categorical(colnames(dat_HRI3.lgb_test_matrix)))
dat_HRI3.lgb_obj = lightgbm(data = dat_HRI3.lgb_train_data,
                            params = list(learning_rate = c(0.1),
                                          objective = c("regression"),
                                          min_data_in_leaf = 100,
                                          max_depth = c(5),
                                          num_leaves = c(1000),
                                          lambda_l2 = c(1),
                                          boosting = c("gbdt")),
                            valids = list(valid = dat_HRI3.lgb_test_data),
                            nrounds = 8000,
                            early_stopping_rounds = 50)

dat_HRI3.lgb_train_pred = predict(dat_HRI3.lgb_obj, data = as.matrix(dat_HRI3.lgb_train_rules$data))
cor(dat_HRI3.lgb_train_pred, y, method="pearson")
# 0.9312832 (nrounds = 4317)

dat_HRI3.lgb_test_pred = predict(dat_HRI3.lgb_obj, data = dat_HRI3.lgb_test_matrix)

cor(dat_HRI3.lgb_test_pred, y_test, method="pearson")
# 0.7123504 (nrounds = 4317)

mean((dat_HRI3.lgb_test_pred - y_test)^2)
# 0.1187569 (nrounds = 4317)
```

We get test prediction correlation of 0.7123504 and MSE of 0.1187569

```{r}
dat_HRI3.feature_importance = as.data.frame(lgb.importance(dat_HRI3.lgb_obj)) %>%
  mutate(Feature = fct_rev(fct_inorder(Feature))) %>%
  dplyr::slice(1:50) %>%
  ggplot(aes(x = Feature, y = Gain)) +
  geom_col(fill = "dodgerblue") +
  coord_flip() +
  theme_bw()
dat_HRI3.feature_importance
```

# Inputs: Counts of triuncleotides + HRI + Markov Ratio

```{r}
nucleotides <- c("A", "C", "G", "T")
dinucleotides <- gtools::permutations(n = 4, r = 2, v = nucleotides,
                                      repeats.allowed = TRUE) %>%
  apply(1, paste, collapse = "")
trinucleotides <- gtools::permutations(n = 4, r = 3, v = nucleotides,
                                       repeats.allowed = TRUE) %>%
  apply(1, paste, collapse = "")

HRI = readRDS("data/Created/tiling_HRI.rds")
HRI_test = readRDS("data/Created/tiling_HRI_test.rds")
```

## Simple Linear Model

```{r}
dat_HRI4 = cbind(dat %>% select(all_of(trinucleotides), C0_new, ratio_score_2nd), 
                 HRI)

HRI4_lm = lm(C0_new~., data=dat_HRI4)
cor(HRI4_lm$fitted.values, y)
# 0.5844412

dat_test_HRI4 = cbind(dat_test %>% select(all_of(trinucleotides), C0_new, ratio_score_2nd),
                      HRI_test)

HRI4_pred = predict(HRI4_lm, dat_test_HRI4)

cor(HRI4_pred, y_test)
# 0.6393723

mean((HRI4_pred - y_test)^2)
# 0.1471987
```

We get test prediction correlation of 0.6393723 and MSE of 0.1471987

## LightGBM (tree-based) Model

```{r}
library(lightgbm)
source("scripts/functions/lgbm-helper-functions.R")
set.seed(50)
dat_HRI4.lgb_train_set = dat_HRI4 %>%
  select(-C0_new)
dat_HRI4.lgb_train_rules = lgb.convert_with_rules(data = dat_HRI4.lgb_train_set)
dat_HRI4.lgb_train_data = lgb.Dataset(data = as.matrix(dat_HRI4.lgb_train_rules$data),
                                      label = dat_HRI4$C0_new,
                                      categorical_feature = handle_categorical(colnames(dat_HRI4.lgb_train_rules$data)))
dat_HRI4.lgb_test_set = dat_test_HRI4 %>%
  select(-C0_new)
dat_HRI4.lgb_test_matrix = as.matrix(lgb.convert_with_rules(data = dat_HRI4.lgb_test_set, rules = dat_HRI4.lgb_train_rules$rules)$data)
dat_HRI4.lgb_test_data = lgb.Dataset(data = dat_HRI4.lgb_test_matrix,
                                     label = dat_test_HRI4$C0_new,
                                     categorical_feature = handle_categorical(colnames(dat_HRI4.lgb_test_matrix)))
dat_HRI4.lgb_obj = lightgbm(data = dat_HRI4.lgb_train_data,
                            params = list(learning_rate = c(0.1),
                                          objective = c("regression"),
                                          min_data_in_leaf = 100,
                                          max_depth = c(5),
                                          num_leaves = c(1000),
                                          lambda_l2 = c(1),
                                          boosting = c("gbdt")),
                            valids = list(valid = dat_HRI4.lgb_test_data),
                            nrounds = 4000,
                            early_stopping_rounds = 50)

dat_HRI4.lgb_train_pred = predict(dat_HRI4.lgb_obj, data = as.matrix(dat_HRI4.lgb_train_rules$data))
cor(dat_HRI4.lgb_train_pred, y, method="pearson")
# 0.9236494 (nrounds = 3932)

dat_HRI4.lgb_test_pred = predict(dat_HRI4.lgb_obj, data = dat_HRI4.lgb_test_matrix)

cor(dat_HRI4.lgb_test_pred, y_test, method="pearson")
# 0.7335643 (nrounds = 3932)

mean((dat_HRI4.lgb_test_pred - y_test)^2)
# 0.113678 (nrounds = 3932)
```

We get test prediction correlation of 0.7335643 and MSE of 0.113678

```{r}
dat_HRI4.feature_importance = as.data.frame(lgb.importance(dat_HRI4.lgb_obj)) %>%
  mutate(Feature = fct_rev(fct_inorder(Feature))) %>%
  dplyr::slice(1:50) %>%
  ggplot(aes(x = Feature, y = Gain)) +
  geom_col(fill = "dodgerblue") +
  coord_flip() +
  theme_bw()
dat_HRI4.feature_importance
```

# Inputs: Counts of nucleotides and di/triuncleotides + HRI

```{r}
nucleotides <- c("A", "C", "G", "T")
dinucleotides <- gtools::permutations(n = 4, r = 2, v = nucleotides,
                                      repeats.allowed = TRUE) %>%
  apply(1, paste, collapse = "")
trinucleotides <- gtools::permutations(n = 4, r = 3, v = nucleotides,
                                       repeats.allowed = TRUE) %>%
  apply(1, paste, collapse = "")

HRI = readRDS("data/Created/tiling_HRI.rds")
HRI_test = readRDS("data/Created/tiling_HRI_test.rds")
```

## Simple Linear Model

```{r}
dat_HRI7 = cbind(dat %>% select(all_of(nucleotides), all_of(dinucleotides), 
                                all_of(trinucleotides), C0_new), HRI)

HRI7_lm = lm(C0_new~., data=dat_HRI7)
cor(HRI7_lm$fitted.values, y)
# 0.5661075

dat_test_HRI7 = cbind(dat_test %>% select(all_of(nucleotides), all_of(dinucleotides), 
                                          all_of(trinucleotides), C0_new), HRI_test)

HRI7_pred = predict(HRI7_lm, dat_test_HRI7)

cor(HRI7_pred, y_test)
# 0.5672827

mean((HRI7_pred - y_test)^2)
# 0.1634931
```

We get test prediction correlation of 0.5672827 and MSE of 0.1634931

## LightGBM (tree-based) Model

```{r}
library(lightgbm)
source("scripts/functions/lgbm-helper-functions.R")
set.seed(50)
dat_HRI7.lgb_train_set = dat_HRI7 %>%
  select(-C0_new)
dat_HRI7.lgb_train_rules = lgb.convert_with_rules(data = dat_HRI7.lgb_train_set)
dat_HRI7.lgb_train_data = lgb.Dataset(data = as.matrix(dat_HRI7.lgb_train_rules$data),
                                      label = dat_HRI7$C0_new,
                                      categorical_feature = handle_categorical(colnames(dat_HRI7.lgb_train_rules$data)))
dat_HRI7.lgb_test_set = dat_test_HRI7 %>%
  select(-C0_new)
dat_HRI7.lgb_test_matrix = as.matrix(lgb.convert_with_rules(data = dat_HRI7.lgb_test_set, rules = dat_HRI7.lgb_train_rules$rules)$data)
dat_HRI7.lgb_test_data = lgb.Dataset(data = dat_HRI7.lgb_test_matrix,
                                     label = dat_test_HRI7$C0_new,
                                     categorical_feature = handle_categorical(colnames(dat_HRI7.lgb_test_matrix)))
dat_HRI7.lgb_obj = lightgbm(data = dat_HRI7.lgb_train_data,
                            params = list(learning_rate = c(0.1),
                                          objective = c("regression"),
                                          min_data_in_leaf = 100,
                                          max_depth = c(5),
                                          num_leaves = c(1000),
                                          lambda_l2 = c(1),
                                          boosting = c("gbdt")),
                            valids = list(valid = dat_HRI7.lgb_test_data),
                            nrounds = 8000,
                            early_stopping_rounds = 50)

dat_HRI7.lgb_train_pred = predict(dat_HRI7.lgb_obj, data = as.matrix(dat_HRI7.lgb_train_rules$data))
cor(dat_HRI7.lgb_train_pred, y, method="pearson")
# 0.938575 (nrounds = 4521)

dat_HRI7.lgb_test_pred = predict(dat_HRI7.lgb_obj, data = dat_HRI7.lgb_test_matrix)

cor(dat_HRI7.lgb_test_pred, y_test, method="pearson")
# 0.7062482 (nrounds = 4521)

mean((dat_HRI7.lgb_test_pred - y_test)^2)
# 0.1208159 (nrounds = 4521)
```

We get test prediction correlation of 0.7062482 and MSE of 0.1208159

```{r}
dat_HRI7.feature_importance = as.data.frame(lgb.importance(dat_HRI7.lgb_obj)) %>%
  mutate(Feature = fct_rev(fct_inorder(Feature))) %>%
  dplyr::slice(1:50) %>%
  ggplot(aes(x = Feature, y = Gain)) +
  geom_col(fill = "dodgerblue") +
  coord_flip() +
  theme_bw()
dat_HRI7.feature_importance
```

# Inputs: Position Specific Dinucleotides + Counts of trinucleotides + HRI

```{r}
library(lightgbm)
source("scripts/functions/lgbm-helper-functions.R")
ps2 <- paste0("X", 1:49, "di")
nucleotides <- c("A", "C", "G", "T")
dinucleotides <- gtools::permutations(n = 4, r = 2, v = nucleotides,
                                      repeats.allowed = TRUE) %>%
  apply(1, paste, collapse = "")
trinucleotides <- gtools::permutations(n = 4, r = 3, v = nucleotides,
                                       repeats.allowed = TRUE) %>%
  apply(1, paste, collapse = "")

HRI = readRDS("data/Created/tiling_HRI.rds")
HRI_test = readRDS("data/Created/tiling_HRI_test.rds")
```

## Simple Linear Model

```{r}
dat_HRI5 = cbind(dat %>%
                   select(all_of(ps2), all_of(trinucleotides), C0_new),
                 HRI)
HRI5 = lm(C0_new~., data = dat_HRI5)
cor(HRI5$fitted.values, y)
# 0.5914231

dat_test_HRI5 = cbind(dat_test %>%
                        select(all_of(ps2), all_of(trinucleotides), C0_new),
                      HRI_test)
HRI5_pred = predict(HRI5, dat_test_HRI5)
cor(HRI5_pred, y_test)
# 0.5866729

mean((HRI5_pred - y_test)^2)
# 0.1581352
```

We get test prediction correlation of 0.5866729 and MSE of 0.1581352

## LightGBM (tree-based) Model

```{r}
set.seed(50)
dat_HRI5.lgb_train_set = dat_HRI5 %>%
  select(-C0_new)
dat_HRI5.lgb_train_rules = lgb.convert_with_rules(data = dat_HRI5.lgb_train_set)
dat_HRI5.lgb_train_data = lgb.Dataset(data = as.matrix(dat_HRI5.lgb_train_rules$data),
                                      label = dat_HRI5$C0_new,
                                      categorical_feature = handle_categorical(colnames(dat_HRI5.lgb_train_rules$data)))
dat_HRI5.lgb_test_set = dat_test_HRI5 %>%
  select(-C0_new)
dat_HRI5.lgb_test_matrix = as.matrix(lgb.convert_with_rules(data = dat_HRI5.lgb_test_set, rules = dat_HRI5.lgb_train_rules$rules)$data)
dat_HRI5.lgb_test_data = lgb.Dataset(data = dat_HRI5.lgb_test_matrix,
                                     label = dat_test_HRI5$C0_new,
                                     categorical_feature = handle_categorical(colnames(dat_HRI5.lgb_test_matrix)))
dat_HRI5.lgb_obj = lightgbm(data = dat_HRI5.lgb_train_data,
                            params = list(learning_rate = c(0.1),
                                          objective = c("regression"),
                                          min_data_in_leaf = 100,
                                          max_depth = c(5),
                                          num_leaves = c(1000),
                                          lambda_l2 = c(1),
                                          boosting = c("gbdt")),
                            valids = list(valid = dat_HRI5.lgb_test_data),
                            nrounds = 2000,
                            early_stopping_rounds = 50)

dat_HRI5.lgb_train_pred = predict(dat_HRI5.lgb_obj, data = as.matrix(dat_HRI5.lgb_train_rules$data))
cor(dat_HRI5.lgb_train_pred, y, method="pearson")
# 0.9120553 (nrounds = 1221)

dat_HRI5.lgb_test_pred = predict(dat_HRI5.lgb_obj, data = dat_HRI5.lgb_test_matrix)

cor(dat_HRI5.lgb_test_pred, y_test, method="pearson")
# 0.661506 (nrounds = 1221)

mean((dat_HRI5.lgb_test_pred - y_test)^2)
# 0.1357419
```

We get test prediction correlation of 0.661506 and MSE of 0.1357419

```{r}
dat_HRI5.feature_importance = as.data.frame(lgb.importance(dat_HRI5.lgb_obj)) %>%
  mutate(Feature = fct_rev(fct_inorder(Feature))) %>%
  dplyr::slice(1:50) %>%
  ggplot(aes(x = Feature, y = Gain)) +
  geom_col(fill = "dodgerblue") +
  coord_flip() +
  theme_bw()
dat_HRI5.feature_importance
```



# Inputs: Position Specific Dinucleotides + Counts of trinucleotides + HRI + Markov Ratio

```{r}
library(lightgbm)
source("scripts/functions/lgbm-helper-functions.R")
ps2 <- paste0("X", 1:49, "di")
nucleotides <- c("A", "C", "G", "T")
dinucleotides <- gtools::permutations(n = 4, r = 2, v = nucleotides,
                                      repeats.allowed = TRUE) %>%
  apply(1, paste, collapse = "")
trinucleotides <- gtools::permutations(n = 4, r = 3, v = nucleotides,
                                       repeats.allowed = TRUE) %>%
  apply(1, paste, collapse = "")

HRI = readRDS("data/Created/tiling_HRI.rds")
HRI_test = readRDS("data/Created/tiling_HRI_test.rds")
```

## Simple Linear Model

```{r}
dat_HRI6 = cbind(dat %>% select(all_of(ps2), all_of(trinucleotides), 
                                ratio_score_2nd, C0_new), HRI)
HRI6 = lm(C0_new~., data = dat_HRI6)
cor(HRI6$fitted.values, y)
# 0.5992928

dat_test_HRI6 = cbind(dat_test %>% select(all_of(ps2), all_of(trinucleotides), 
                                          ratio_score_2nd, C0_new), HRI_test)
HRI6_pred = predict(HRI6, dat_test_HRI6)
cor(HRI6_pred, y_test)
# 0.6516297

mean((HRI6_pred - y_test)^2)
# 0.141762
```

We get test prediction correlation of 0.6516297 and MSE of 0.141762

## LightGBM (tree-based) Model

```{r}
set.seed(50)
dat_HRI6.lgb_train_set = dat_HRI6 %>%
  select(-C0_new)
dat_HRI6.lgb_train_rules = lgb.convert_with_rules(data = dat_HRI6.lgb_train_set)
dat_HRI6.lgb_train_data = lgb.Dataset(data = as.matrix(dat_HRI6.lgb_train_rules$data),
                                      label = dat_HRI6$C0_new,
                                      categorical_feature = handle_categorical(colnames(dat_HRI6.lgb_train_rules$data)))
dat_HRI6.lgb_test_set = dat_test_HRI6 %>%
  select(-C0_new)
dat_HRI6.lgb_test_matrix = as.matrix(lgb.convert_with_rules(data = dat_HRI6.lgb_test_set, rules = dat_HRI6.lgb_train_rules$rules)$data)
dat_HRI6.lgb_test_data = lgb.Dataset(data = dat_HRI6.lgb_test_matrix,
                                     label = dat_test_HRI6$C0_new,
                                     categorical_feature = handle_categorical(colnames(dat_HRI6.lgb_test_matrix)))
dat_HRI6.lgb_obj = lightgbm(data = dat_HRI6.lgb_train_data,
                            params = list(learning_rate = c(0.1),
                                          objective = c("regression"),
                                          min_data_in_leaf = 100,
                                          max_depth = c(5),
                                          num_leaves = c(1000),
                                          lambda_l2 = c(1),
                                          boosting = c("gbdt")),
                            valids = list(valid = dat_HRI6.lgb_test_data),
                            nrounds = 2000,
                            early_stopping_rounds = 50)

dat_HRI6.lgb_train_pred = predict(dat_HRI6.lgb_obj, data = as.matrix(dat_HRI6.lgb_train_rules$data))
cor(dat_HRI6.lgb_train_pred, y, method="pearson")
# 0.8869726 (nrounds = 958)

dat_HRI6.lgb_test_pred = predict(dat_HRI6.lgb_obj, data = dat_HRI6.lgb_test_matrix)

cor(dat_HRI6.lgb_test_pred, y_test, method="pearson")
# 0.6964806 (nrounds = 958)

mean((dat_HRI6.lgb_test_pred - y_test)^2)
# 0.1254062
```

We get test prediction correlation of 0.6964806 and MSE of 0.1254062

```{r}
dat_HRI6.feature_importance = as.data.frame(lgb.importance(dat_HRI6.lgb_obj)) %>%
  mutate(Feature = fct_rev(fct_inorder(Feature))) %>%
  dplyr::slice(1:50) %>%
  ggplot(aes(x = Feature, y = Gain)) +
  geom_col(fill = "dodgerblue") +
  coord_flip() +
  theme_bw()
dat_HRI6.feature_importance
```



# Inputs: Fourier Features Based on A/T Nucleotides Calculated from scratch + HRI

```{r}
Xone_AT_fourier_cos = readRDS("data/Created/tiling_Xone_AT_fourier_cos.rds")
Xone_AT_fourier_sin = readRDS("data/Created/tiling_Xone_AT_fourier_sin.rds")
Xone_AT_fourier_cos_test = readRDS("data/Created/tiling_Xone_AT_fourier_cos_test.rds")
Xone_AT_fourier_sin_test = readRDS("data/Created/tiling_Xone_AT_fourier_sin_test.rds")

HRI = readRDS("data/Created/tiling_HRI.rds")
HRI_test = readRDS("data/Created/tiling_HRI_test.rds")
```

## Squared value of Fourier features

### Simple Linear Model

```{r}
dat_fourier_HRI = cbind(Xone_AT_fourier_cos^2, Xone_AT_fourier_sin^2, 
                        HRI, dat %>% select(C0_new))
fourier_HRI_lm = lm(C0_new~., data = dat_fourier_HRI)
cor(fourier_HRI_lm$fitted.values, y)
# 0.5421405

dat_test_fourier_HRI = cbind(Xone_AT_fourier_cos_test^2, Xone_AT_fourier_sin_test^2, 
                             HRI_test, dat_test %>% select(C0_new))
fourier_HRI_pred = predict(fourier_HRI_lm, dat_test_fourier_HRI)
cor(fourier_HRI_pred, y_test)
# 0.5433585

mean((fourier_HRI_pred - y_test)^2)
# 0.1698538
```

We get test prediction correlation of 0.5433585 and MSE of 0.1698538

### LightGBM (tree-based) Model

```{r}
set.seed(50)
dat_fourier_HRI.lgb_train_set = dat_fourier_HRI %>%
  select(-C0_new)
dat_fourier_HRI.lgb_train_rules = lgb.convert_with_rules(data = dat_fourier_HRI.lgb_train_set)
dat_fourier_HRI.lgb_train_data = lgb.Dataset(data = as.matrix(dat_fourier_HRI.lgb_train_rules$data),
                                             label = dat_fourier_HRI$C0_new,
                                             categorical_feature = handle_categorical(colnames(dat_fourier_HRI.lgb_train_rules$data)))
dat_fourier_HRI.lgb_test_set = dat_test_fourier_HRI %>%
  select(-C0_new)
dat_fourier_HRI.lgb_test_matrix = as.matrix(lgb.convert_with_rules(data = dat_fourier_HRI.lgb_test_set, rules = dat_fourier_HRI.lgb_train_rules$rules)$data)
dat_fourier_HRI.lgb_test_data = lgb.Dataset(data = dat_fourier_HRI.lgb_test_matrix,
                                            label = dat_test_fourier_HRI$C0_new,
                                            categorical_feature = handle_categorical(colnames(dat_fourier_HRI.lgb_test_matrix)))
dat_fourier_HRI.lgb_obj = lightgbm(data = dat_fourier_HRI.lgb_train_data,
                                   params = list(learning_rate = c(0.1),
                                                 objective = c("regression"),
                                                 min_data_in_leaf = 100,
                                                 max_depth = c(5),
                                                 num_leaves = c(1000),
                                                 lambda_l2 = c(1),
                                                 boosting = c("gbdt")),
                                   valids = list(valid = dat_fourier_HRI.lgb_test_data),
                                   nrounds = 2000,
                                   early_stopping_rounds = 50)

dat_fourier_HRI.lgb_train_pred = predict(dat_fourier_HRI.lgb_obj, data = as.matrix(dat_fourier_HRI.lgb_train_rules$data))
cor(dat_fourier_HRI.lgb_train_pred, y, method="pearson")
# 0.8192174 (nrounds = 1185)

dat_fourier_HRI.lgb_test_pred = predict(dat_fourier_HRI.lgb_obj, data = dat_fourier_HRI.lgb_test_matrix)

cor(dat_fourier_HRI.lgb_test_pred, y_test, method="pearson")
# 0.6146788 (nrounds = 1185)

mean((dat_fourier_HRI.lgb_test_pred - y_test)^2)
# 0.1499589
```

We get test prediction correlation of 0.6146788 and MSE of 0.1499589

```{r}
dat_fourier_HRI.feature_importance = as.data.frame(lgb.importance(dat_fourier_HRI.lgb_obj)) %>%
  mutate(Feature = fct_rev(fct_inorder(Feature))) %>%
  dplyr::slice(1:50) %>%
  ggplot(aes(x = Feature, y = Gain)) +
  geom_col(fill = "dodgerblue") +
  coord_flip() +
  theme_bw()
dat_fourier_HRI.feature_importance
```


# Inputs: Fourier Features Based on AA/TT/AT/TA Dinucleotides Calculated from scratch + HRI

```{r}
Xtwo_AT_fourier_cos = readRDS("data/Created/tiling_Xtwo_AT_fourier_cos.rds")
Xtwo_AT_fourier_sin = readRDS("data/Created/tiling_Xtwo_AT_fourier_sin.rds")
Xtwo_AT_fourier_cos_test = readRDS("data/Created/tiling_Xtwo_AT_fourier_cos_test.rds")
Xtwo_AT_fourier_sin_test = readRDS("data/Created/tiling_Xtwo_AT_fourier_sin_test.rds")

HRI = readRDS("data/Created/tiling_HRI.rds")
HRI_test = readRDS("data/Created/tiling_HRI_test.rds")
```

## Squared value of Fourier features

### Simple Linear Model

```{r}
dat_fourier_HRI2 = cbind(Xtwo_AT_fourier_cos^2, Xtwo_AT_fourier_sin^2, 
                         HRI, dat %>% select(C0_new))
fourier_HRI2_lm = lm(C0_new~., data = dat_fourier_HRI2)
cor(fourier_HRI2_lm$fitted.values, y)
# 0.5471932

dat_test_fourier_HRI2 = cbind(Xtwo_AT_fourier_cos_test^2, Xtwo_AT_fourier_sin_test^2, 
                              HRI_test, dat_test %>% select(C0_new))
fourier_HRI2_pred = predict(fourier_HRI2_lm, dat_test_fourier_HRI2)
cor(fourier_HRI2_pred, y_test)
# 0.5492694

mean((fourier_HRI2_pred - y_test)^2)
# 0.1683035
```

We get test prediction correlation of 0.5492694 and MSE of 0.1683035

### LightGBM (tree-based) Model

```{r}
set.seed(50)
dat_fourier_HRI2.lgb_train_set = dat_fourier_HRI2 %>%
  select(-C0_new)
dat_fourier_HRI2.lgb_train_rules = lgb.convert_with_rules(data = dat_fourier_HRI2.lgb_train_set)
dat_fourier_HRI2.lgb_train_data = lgb.Dataset(data = as.matrix(dat_fourier_HRI2.lgb_train_rules$data),
                                              label = dat_fourier_HRI2$C0_new,
                                              categorical_feature = handle_categorical(colnames(dat_fourier_HRI2.lgb_train_rules$data)))
dat_fourier_HRI2.lgb_test_set = dat_test_fourier_HRI2 %>%
  select(-C0_new)
dat_fourier_HRI2.lgb_test_matrix = as.matrix(lgb.convert_with_rules(data = dat_fourier_HRI2.lgb_test_set, rules = dat_fourier_HRI2.lgb_train_rules$rules)$data)
dat_fourier_HRI2.lgb_test_data = lgb.Dataset(data = dat_fourier_HRI2.lgb_test_matrix,
                                             label = dat_test_fourier_HRI2$C0_new,
                                             categorical_feature = handle_categorical(colnames(dat_fourier_HRI2.lgb_test_matrix)))
dat_fourier_HRI2.lgb_obj = lightgbm(data = dat_fourier_HRI2.lgb_train_data,
                                    params = list(learning_rate = c(0.1),
                                                  objective = c("regression"),
                                                  min_data_in_leaf = 100,
                                                  max_depth = c(5),
                                                  num_leaves = c(1000),
                                                  lambda_l2 = c(1),
                                                  boosting = c("gbdt")),
                                    valids = list(valid = dat_fourier_HRI2.lgb_test_data),
                                    nrounds = 2000,
                                    early_stopping_rounds = 50)

dat_fourier_HRI2.lgb_train_pred = predict(dat_fourier_HRI2.lgb_obj, data = as.matrix(dat_fourier_HRI2.lgb_train_rules$data))
cor(dat_fourier_HRI2.lgb_train_pred, y, method="pearson")
# 0.781974 (nrounds = 882)

dat_fourier_HRI2.lgb_test_pred = predict(dat_fourier_HRI2.lgb_obj, data = dat_fourier_HRI2.lgb_test_matrix)

cor(dat_fourier_HRI2.lgb_test_pred, y_test, method="pearson")
# 0.6135652 (nrounds = 882)

mean((dat_fourier_HRI2.lgb_test_pred - y_test)^2)
# 0.1502946
```

We get test prediction correlation of 0.6135652 and MSE of 0.1502946

```{r}
dat_fourier_HRI2.feature_importance = as.data.frame(lgb.importance(dat_fourier_HRI2.lgb_obj)) %>%
  mutate(Feature = fct_rev(fct_inorder(Feature))) %>%
  dplyr::slice(1:50) %>%
  ggplot(aes(x = Feature, y = Gain)) +
  geom_col(fill = "dodgerblue") +
  coord_flip() +
  theme_bw()
dat_fourier_HRI2.feature_importance
```


# Inputs: Fourier Features Based on all Dinucleotides with h=6 (period 9.8) + Modulus of Difference of Fourier Features Based on all Dinucleotides with h=6 (period 9.8) Calculated using fft + HRI

```{r}
fourier_di_cos = readRDS("data/Created/tiling_fourier_di_cos.rds")
fourier_di_sin = readRDS("data/Created/tiling_fourier_di_sin.rds")
fourier_di_cos_test = readRDS("data/Created/tiling_fourier_di_cos_test.rds")
fourier_di_sin_test = readRDS("data/Created/tiling_fourier_di_sin_test.rds")

fourier_di_cos_6 = as.data.frame(fourier_di_cos) %>% select(ends_with("_6"))
fourier_di_sin_6 = as.data.frame(fourier_di_sin) %>% select(ends_with("_6"))
fourier_di_cos_6_test = as.data.frame(fourier_di_cos_test) %>% select(ends_with("_6"))
fourier_di_sin_6_test = as.data.frame(fourier_di_sin_test) %>% select(ends_with("_6"))

fourier_6_mod = readRDS("data/Created/tiling_fourier_6_mod.rds")
fourier_6_mod_test = readRDS("data/Created/tiling_fourier_6_mod_test.rds")

HRI = readRDS("data/Created/tiling_HRI.rds")
HRI_test = readRDS("data/Created/tiling_HRI_test.rds")
```

## Squared value of Fourier features calculated using fft

### Simple Linear Model

```{r}
dat_fourier_HRI3 = cbind((fourier_di_cos_6)^2, (fourier_di_sin_6)^2, 
                         (fourier_6_mod)^2, HRI, dat %>% select(C0_new))

fourier_HRI3_lm = lm(C0_new~., data=dat_fourier_HRI3)
cor(fourier_HRI3_lm$fitted.values, y)
# 0.5834668

dat_test_fourier_HRI3 = cbind((fourier_di_cos_6_test)^2, (fourier_di_sin_6_test)^2, 
                              (fourier_6_mod_test)^2, HRI_test, dat_test %>% select(C0_new))

fourier_HRI3_pred = predict(fourier_HRI3_lm, dat_test_fourier_HRI3)

cor(fourier_HRI3_pred, y_test)
# 0.5869127

mean((fourier_HRI3_pred - y_test)^2)
# 0.1579926
```

We get test prediction correlation of 0.5869127 and MSE of 0.1579926

### LightGBM (tree-based) Model

```{r}
library(lightgbm)
source("scripts/functions/lgbm-helper-functions.R")
set.seed(50)
dat_fourier_HRI3.lgb_train_set = dat_fourier_HRI3 %>%
  select(-C0_new)
dat_fourier_HRI3.lgb_train_rules = lgb.convert_with_rules(data = dat_fourier_HRI3.lgb_train_set)
dat_fourier_HRI3.lgb_train_data = lgb.Dataset(data = as.matrix(dat_fourier_HRI3.lgb_train_rules$data),
                                              label = dat_fourier_HRI3$C0_new,
                                              categorical_feature = handle_categorical(colnames(dat_fourier_HRI3.lgb_train_rules$data)))
dat_fourier_HRI3.lgb_test_set = dat_test_fourier_HRI3 %>%
  select(-C0_new)
dat_fourier_HRI3.lgb_test_matrix = as.matrix(lgb.convert_with_rules(data = dat_fourier_HRI3.lgb_test_set, rules = dat_fourier_HRI3.lgb_train_rules$rules)$data)
dat_fourier_HRI3.lgb_test_data = lgb.Dataset(data = dat_fourier_HRI3.lgb_test_matrix,
                                             label = dat_test_fourier_HRI3$C0_new,
                                             categorical_feature = handle_categorical(colnames(dat_fourier_HRI3.lgb_test_matrix)))
dat_fourier_HRI3.lgb_obj = lightgbm(data = dat_fourier_HRI3.lgb_train_data,
                                    params = list(learning_rate = c(0.1),
                                                  objective = c("regression"),
                                                  min_data_in_leaf = 100,
                                                  max_depth = c(5),
                                                  num_leaves = c(1000),
                                                  lambda_l2 = c(1),
                                                  boosting = c("gbdt")),
                                    valids = list(valid = dat_fourier_HRI3.lgb_test_data),
                                    nrounds = 2000,
                                    early_stopping_rounds = 50)

dat_fourier_HRI3.lgb_train_pred = predict(dat_fourier_HRI3.lgb_obj, data = as.matrix(dat_fourier_HRI3.lgb_train_rules$data))
cor(dat_fourier_HRI3.lgb_train_pred, y, method="pearson")
# 0.9082159 (nrounds = 1779)

dat_fourier_HRI3.lgb_test_pred = predict(dat_fourier_HRI3.lgb_obj, data = dat_fourier_HRI3.lgb_test_matrix)

cor(dat_fourier_HRI3.lgb_test_pred, y_test, method="pearson")
# 0.6429661 (nrounds = 1779)

mean((dat_fourier_HRI3.lgb_test_pred - y_test)^2)
# 0.1414311 (nrounds = 1779)
```

We get test prediction correlation of 0.6429661 and MSE of 0.1414311

```{r}
dat_fourier_HRI3.feature_importance = as.data.frame(lgb.importance(dat_fourier_HRI3.lgb_obj)) %>%
  mutate(Feature = fct_rev(fct_inorder(Feature))) %>%
  dplyr::slice(1:50) %>%
  ggplot(aes(x = Feature, y = Gain)) +
  geom_col(fill = "dodgerblue") +
  coord_flip() +
  theme_bw()
dat_fourier_HRI3.feature_importance
```


# Inputs: Counts of triuncleotides + Fourier Features Based on AA/TT/AT/TA Dinucleotides Calculated from scratch + HRI

```{r}
nucleotides <- c("A", "C", "G", "T")
dinucleotides <- gtools::permutations(n = 4, r = 2, v = nucleotides,
                                      repeats.allowed = TRUE) %>%
  apply(1, paste, collapse = "")
trinucleotides <- gtools::permutations(n = 4, r = 3, v = nucleotides,
                                       repeats.allowed = TRUE) %>%
  apply(1, paste, collapse = "")

Xtwo_AT_fourier_cos = readRDS("data/Created/tiling_Xtwo_AT_fourier_cos.rds")
Xtwo_AT_fourier_sin = readRDS("data/Created/tiling_Xtwo_AT_fourier_sin.rds")
Xtwo_AT_fourier_cos_test = readRDS("data/Created/tiling_Xtwo_AT_fourier_cos_test.rds")
Xtwo_AT_fourier_sin_test = readRDS("data/Created/tiling_Xtwo_AT_fourier_sin_test.rds")

HRI = readRDS("data/Created/tiling_HRI.rds")
HRI_test = readRDS("data/Created/tiling_HRI_test.rds")
```

## Squared value of Fourier features

### Simple Linear Model

```{r}
dat_HRI8 = cbind(dat %>% select(all_of(trinucleotides), C0_new), 
                 Xtwo_AT_fourier_cos^2, Xtwo_AT_fourier_sin^2, HRI)

HRI8_lm = lm(C0_new~., data=dat_HRI8)
cor(HRI8_lm$fitted.values, y)
# 0.6300405

dat_test_HRI8 = cbind(dat_test %>% select(all_of(trinucleotides), C0_new),
                      Xtwo_AT_fourier_cos_test^2, Xtwo_AT_fourier_sin_test^2, HRI_test)

HRI8_pred = predict(HRI8_lm, dat_test_HRI8)

cor(HRI8_pred, y_test)
# 0.629215

mean((HRI8_pred - y_test)^2)
# 0.1456236
```

We get test prediction correlation of 0.629215 and MSE of 0.1456236

### LightGBM (tree-based) Model

```{r}
library(lightgbm)
source("scripts/functions/lgbm-helper-functions.R")
set.seed(50)
dat_HRI8.lgb_train_set = dat_HRI8 %>%
  select(-C0_new)
dat_HRI8.lgb_train_rules = lgb.convert_with_rules(data = dat_HRI8.lgb_train_set)
dat_HRI8.lgb_train_data = lgb.Dataset(data = as.matrix(dat_HRI8.lgb_train_rules$data),
                                      label = dat_HRI8$C0_new,
                                      categorical_feature = handle_categorical(colnames(dat_HRI8.lgb_train_rules$data)))
dat_HRI8.lgb_test_set = dat_test_HRI8 %>%
  select(-C0_new)
dat_HRI8.lgb_test_matrix = as.matrix(lgb.convert_with_rules(data = dat_HRI8.lgb_test_set, rules = dat_HRI8.lgb_train_rules$rules)$data)
dat_HRI8.lgb_test_data = lgb.Dataset(data = dat_HRI8.lgb_test_matrix,
                                     label = dat_test_HRI8$C0_new,
                                     categorical_feature = handle_categorical(colnames(dat_HRI8.lgb_test_matrix)))
dat_HRI8.lgb_obj = lightgbm(data = dat_HRI8.lgb_train_data,
                            params = list(learning_rate = c(0.1),
                                          objective = c("regression"),
                                          min_data_in_leaf = 100,
                                          max_depth = c(5),
                                          num_leaves = c(1000),
                                          lambda_l2 = c(1),
                                          boosting = c("gbdt")),
                            valids = list(valid = dat_HRI8.lgb_test_data),
                            nrounds = 2000,
                            early_stopping_rounds = 50)

dat_HRI8.lgb_train_pred = predict(dat_HRI8.lgb_obj, data = as.matrix(dat_HRI8.lgb_train_rules$data))
cor(dat_HRI8.lgb_train_pred, y, method="pearson")
# 0.8688078 (nrounds = 1450)

dat_HRI8.lgb_test_pred = predict(dat_HRI8.lgb_obj, data = dat_HRI8.lgb_test_matrix)

cor(dat_HRI8.lgb_test_pred, y_test, method="pearson")
# 0.6817151 (nrounds = 1450)

mean((dat_HRI8.lgb_test_pred - y_test)^2)
# 0.1290112 (nrounds = 1450)
```

We get test prediction correlation of 0.6817151 and MSE of 0.1290112

```{r}
dat_HRI8.feature_importance = as.data.frame(lgb.importance(dat_HRI8.lgb_obj)) %>%
  mutate(Feature = fct_rev(fct_inorder(Feature))) %>%
  dplyr::slice(1:50) %>%
  ggplot(aes(x = Feature, y = Gain)) +
  geom_col(fill = "dodgerblue") +
  coord_flip() +
  theme_bw()
dat_HRI8.feature_importance
```


# Inputs: Counts of triuncleotides + Fourier Features Based on all Dinucleotides with h=6 (period 9.8) + Modulus of Difference of Fourier Features Based on all Dinucleotides with h=6 (period 9.8) Calculated using fft + HRI

```{r}
nucleotides <- c("A", "C", "G", "T")
dinucleotides <- gtools::permutations(n = 4, r = 2, v = nucleotides,
                                      repeats.allowed = TRUE) %>%
  apply(1, paste, collapse = "")
trinucleotides <- gtools::permutations(n = 4, r = 3, v = nucleotides,
                                       repeats.allowed = TRUE) %>%
  apply(1, paste, collapse = "")

fourier_di_cos = readRDS("data/Created/tiling_fourier_di_cos.rds")
fourier_di_sin = readRDS("data/Created/tiling_fourier_di_sin.rds")
fourier_di_cos_test = readRDS("data/Created/tiling_fourier_di_cos_test.rds")
fourier_di_sin_test = readRDS("data/Created/tiling_fourier_di_sin_test.rds")

fourier_di_cos_6 = as.data.frame(fourier_di_cos) %>% select(ends_with("_6"))
fourier_di_sin_6 = as.data.frame(fourier_di_sin) %>% select(ends_with("_6"))
fourier_di_cos_6_test = as.data.frame(fourier_di_cos_test) %>% select(ends_with("_6"))
fourier_di_sin_6_test = as.data.frame(fourier_di_sin_test) %>% select(ends_with("_6"))

fourier_6_mod = readRDS("data/Created/tiling_fourier_6_mod.rds")
fourier_6_mod_test = readRDS("data/Created/tiling_fourier_6_mod_test.rds")

HRI = readRDS("data/Created/tiling_HRI.rds")
HRI_test = readRDS("data/Created/tiling_HRI_test.rds")

HRI = readRDS("data/Created/tiling_HRI.rds")
HRI_test = readRDS("data/Created/tiling_HRI_test.rds")
```

## Squared value of Fourier features calculated using fft

### Simple Linear Model

```{r}
dat_fourier_HRI4 = cbind(dat %>% select(all_of(trinucleotides), C0_new), 
                         (fourier_di_cos_6)^2, (fourier_di_sin_6)^2, 
                         (fourier_6_mod)^2, HRI)

fourier_HRI4_lm = lm(C0_new~., data=dat_fourier_HRI4)
cor(fourier_HRI4_lm$fitted.values, y)
# 0.9254985

dat_test_fourier_HRI4 = cbind(dat_test %>% select(all_of(trinucleotides), C0_new), 
                              (fourier_di_cos_6_test)^2, (fourier_di_sin_6_test)^2, 
                              (fourier_6_mod_test)^2, HRI_test)

fourier_HRI4_pred = predict(fourier_HRI4_lm, dat_test_fourier_HRI4)

cor(fourier_HRI4_pred, y_test)
# 0.6289278

mean((fourier_HRI4_pred - y_test)^2)
# 0.1456991
```

We get test prediction correlation of 0.6289278 and MSE of 0.1456991

### LightGBM (tree-based) Model

```{r}
library(lightgbm)
source("scripts/functions/lgbm-helper-functions.R")
set.seed(50)
dat_fourier_HRI4.lgb_train_set = dat_fourier_HRI4 %>%
  select(-C0_new)
dat_fourier_HRI4.lgb_train_rules = lgb.convert_with_rules(data = dat_fourier_HRI4.lgb_train_set)
dat_fourier_HRI4.lgb_train_data = lgb.Dataset(data = as.matrix(dat_fourier_HRI4.lgb_train_rules$data),
                                              label = dat_fourier_HRI4$C0_new,
                                              categorical_feature = handle_categorical(colnames(dat_fourier_HRI4.lgb_train_rules$data)))
dat_fourier_HRI4.lgb_test_set = dat_test_fourier_HRI4 %>%
  select(-C0_new)
dat_fourier_HRI4.lgb_test_matrix = as.matrix(lgb.convert_with_rules(data = dat_fourier_HRI4.lgb_test_set, rules = dat_fourier_HRI4.lgb_train_rules$rules)$data)
dat_fourier_HRI4.lgb_test_data = lgb.Dataset(data = dat_fourier_HRI4.lgb_test_matrix,
                                             label = dat_test_fourier_HRI4$C0_new,
                                             categorical_feature = handle_categorical(colnames(dat_fourier_HRI4.lgb_test_matrix)))
dat_fourier_HRI4.lgb_obj = lightgbm(data = dat_fourier_HRI4.lgb_train_data,
                                    params = list(learning_rate = c(0.1),
                                                  objective = c("regression"),
                                                  min_data_in_leaf = 100,
                                                  max_depth = c(5),
                                                  num_leaves = c(1000),
                                                  lambda_l2 = c(1),
                                                  boosting = c("gbdt")),
                                    valids = list(valid = dat_fourier_HRI4.lgb_test_data),
                                    nrounds = 2000,
                                    early_stopping_rounds = 50)

dat_fourier_HRI4.lgb_train_pred = predict(dat_fourier_HRI4.lgb_obj, data = as.matrix(dat_fourier_HRI4.lgb_train_rules$data))
cor(dat_fourier_HRI4.lgb_train_pred, y, method="pearson")
# 0.9007432 (nrounds = 1544)

dat_fourier_HRI4.lgb_test_pred = predict(dat_fourier_HRI4.lgb_obj, data = dat_fourier_HRI4.lgb_test_matrix)

cor(dat_fourier_HRI4.lgb_test_pred, y_test, method="pearson")
# 0.6850342 (nrounds = 1544)

mean((dat_fourier_HRI4.lgb_test_pred - y_test)^2)
# 0.1279804 (nrounds = 1544)
```

We get test prediction correlation of 0.6850342 and MSE of 0.1279804

```{r}
dat_fourier_HRI4.feature_importance = as.data.frame(lgb.importance(dat_fourier_HRI4.lgb_obj)) %>%
  mutate(Feature = fct_rev(fct_inorder(Feature))) %>%
  dplyr::slice(1:50) %>%
  ggplot(aes(x = Feature, y = Gain)) +
  geom_col(fill = "dodgerblue") +
  coord_flip() +
  theme_bw()
dat_fourier_HRI4.feature_importance
```

# Inputs: Counts of triuncleotides + Fourier Features Based on AA/TT/AT/TA Dinucleotides Calculated from scratch + HRI + Markov Ratio

```{r}
nucleotides <- c("A", "C", "G", "T")
dinucleotides <- gtools::permutations(n = 4, r = 2, v = nucleotides,
                                      repeats.allowed = TRUE) %>%
  apply(1, paste, collapse = "")
trinucleotides <- gtools::permutations(n = 4, r = 3, v = nucleotides,
                                       repeats.allowed = TRUE) %>%
  apply(1, paste, collapse = "")

Xtwo_AT_fourier_cos = readRDS("data/Created/tiling_Xtwo_AT_fourier_cos.rds")
Xtwo_AT_fourier_sin = readRDS("data/Created/tiling_Xtwo_AT_fourier_sin.rds")
Xtwo_AT_fourier_cos_test = readRDS("data/Created/tiling_Xtwo_AT_fourier_cos_test.rds")
Xtwo_AT_fourier_sin_test = readRDS("data/Created/tiling_Xtwo_AT_fourier_sin_test.rds")

HRI = readRDS("data/Created/tiling_HRI.rds")
HRI_test = readRDS("data/Created/tiling_HRI_test.rds")
```

## Squared value of Fourier features

### Simple Linear Model

```{r}
dat_HRI9 = cbind(dat %>% select(all_of(trinucleotides), ratio_score_2nd, C0_new), 
                 Xtwo_AT_fourier_cos^2, Xtwo_AT_fourier_sin^2, HRI)

HRI9_lm = lm(C0_new~., data=dat_HRI9)
cor(HRI9_lm$fitted.values, y)
# 0.6431831

dat_test_HRI9 = cbind(dat_test %>% select(all_of(trinucleotides), ratio_score_2nd, C0_new),
                      Xtwo_AT_fourier_cos_test^2, Xtwo_AT_fourier_sin_test^2, HRI_test)

HRI9_pred = predict(HRI9_lm, dat_test_HRI9)

cor(HRI9_pred, y_test)
# 0.6820877

mean((HRI9_pred - y_test)^2)
# 0.132475
```

We get test prediction correlation of 0.6820877 and MSE of 0.132475

### LightGBM (tree-based) Model

```{r}
library(lightgbm)
source("scripts/functions/lgbm-helper-functions.R")
set.seed(50)
dat_HRI9.lgb_train_set = dat_HRI9 %>%
  select(-C0_new)
dat_HRI9.lgb_train_rules = lgb.convert_with_rules(data = dat_HRI9.lgb_train_set)
dat_HRI9.lgb_train_data = lgb.Dataset(data = as.matrix(dat_HRI9.lgb_train_rules$data),
                                      label = dat_HRI9$C0_new,
                                      categorical_feature = handle_categorical(colnames(dat_HRI9.lgb_train_rules$data)))
dat_HRI9.lgb_test_set = dat_test_HRI9 %>%
  select(-C0_new)
dat_HRI9.lgb_test_matrix = as.matrix(lgb.convert_with_rules(data = dat_HRI9.lgb_test_set, rules = dat_HRI9.lgb_train_rules$rules)$data)
dat_HRI9.lgb_test_data = lgb.Dataset(data = dat_HRI9.lgb_test_matrix,
                                     label = dat_test_HRI9$C0_new,
                                     categorical_feature = handle_categorical(colnames(dat_HRI9.lgb_test_matrix)))
dat_HRI9.lgb_obj = lightgbm(data = dat_HRI9.lgb_train_data,
                            params = list(learning_rate = c(0.1),
                                          objective = c("regression"),
                                          min_data_in_leaf = 100,
                                          max_depth = c(5),
                                          num_leaves = c(1000),
                                          lambda_l2 = c(1),
                                          boosting = c("gbdt")),
                            valids = list(valid = dat_HRI9.lgb_test_data),
                            nrounds = 2000,
                            early_stopping_rounds = 50)

dat_HRI9.lgb_train_pred = predict(dat_HRI9.lgb_obj, data = as.matrix(dat_HRI9.lgb_train_rules$data))
cor(dat_HRI9.lgb_train_pred, y, method="pearson")
# 0.8308603 (nrounds = 951)

dat_HRI9.lgb_test_pred = predict(dat_HRI9.lgb_obj, data = dat_HRI9.lgb_test_matrix)

cor(dat_HRI9.lgb_test_pred, y_test, method="pearson")
# 0.7156314 (nrounds = 951)

mean((dat_HRI9.lgb_test_pred - y_test)^2)
# 0.1188663 (nrounds = 951)
```

We get test prediction correlation of 0.7156314 and MSE of 0.1188663

```{r}
dat_HRI9.feature_importance = as.data.frame(lgb.importance(dat_HRI9.lgb_obj)) %>%
  mutate(Feature = fct_rev(fct_inorder(Feature))) %>%
  dplyr::slice(1:50) %>%
  ggplot(aes(x = Feature, y = Gain)) +
  geom_col(fill = "dodgerblue") +
  coord_flip() +
  theme_bw()
dat_HRI9.feature_importance
```


# Inputs: Position Specific Dinucleotides + Counts of trinucleotides + Fourier Features Based on AA/TT/AT/TA Dinucleotides Calculated from scratch + HRI

```{r}
ps2 <- paste0("X", 1:49, "di")
nucleotides <- c("A", "C", "G", "T")
dinucleotides <- gtools::permutations(n = 4, r = 2, v = nucleotides,
                                      repeats.allowed = TRUE) %>%
  apply(1, paste, collapse = "")
trinucleotides <- gtools::permutations(n = 4, r = 3, v = nucleotides,
                                       repeats.allowed = TRUE) %>%
  apply(1, paste, collapse = "")

Xtwo_AT_fourier_cos = readRDS("data/Created/tiling_Xtwo_AT_fourier_cos.rds")
Xtwo_AT_fourier_sin = readRDS("data/Created/tiling_Xtwo_AT_fourier_sin.rds")
Xtwo_AT_fourier_cos_test = readRDS("data/Created/tiling_Xtwo_AT_fourier_cos_test.rds")
Xtwo_AT_fourier_sin_test = readRDS("data/Created/tiling_Xtwo_AT_fourier_sin_test.rds")

HRI = readRDS("data/Created/tiling_HRI.rds")
HRI_test = readRDS("data/Created/tiling_HRI_test.rds")
```

## Squared value of Fourier features

### Simple Linear Model

```{r}
dat_HRI10 = cbind(dat %>% select(all_of(ps2), all_of(trinucleotides), C0_new),
                  Xtwo_AT_fourier_cos^2, Xtwo_AT_fourier_sin^2, HRI)
HRI10 = lm(C0_new~., data = dat_HRI10)
cor(HRI10$fitted.values, y)
# 0.6529509

dat_test_HRI10 = cbind(dat_test %>% select(all_of(ps2), all_of(trinucleotides), C0_new),
                       Xtwo_AT_fourier_cos_test^2, Xtwo_AT_fourier_sin_test^2, HRI_test)
HRI10_pred = predict(HRI10, dat_test_HRI10)
cor(HRI10_pred, y_test)
# 0.6490584

mean((HRI10_pred - y_test)^2)
# 0.1395255
```

We get test prediction correlation of 0.6490584 and MSE of 0.1395255

### LightGBM (tree-based) Model

```{r}
set.seed(50)
dat_HRI10.lgb_train_set = dat_HRI10 %>%
  select(-C0_new)
dat_HRI10.lgb_train_rules = lgb.convert_with_rules(data = dat_HRI10.lgb_train_set)
dat_HRI10.lgb_train_data = lgb.Dataset(data = as.matrix(dat_HRI10.lgb_train_rules$data),
                                       label = dat_HRI10$C0_new,
                                       categorical_feature = handle_categorical(colnames(dat_HRI10.lgb_train_rules$data)))
dat_HRI10.lgb_test_set = dat_test_HRI10 %>%
  select(-C0_new)
dat_HRI10.lgb_test_matrix = as.matrix(lgb.convert_with_rules(data = dat_HRI10.lgb_test_set, rules = dat_HRI10.lgb_train_rules$rules)$data)
dat_HRI10.lgb_test_data = lgb.Dataset(data = dat_HRI10.lgb_test_matrix,
                                      label = dat_test_HRI10$C0_new,
                                      categorical_feature = handle_categorical(colnames(dat_HRI10.lgb_test_matrix)))
dat_HRI10.lgb_obj = lightgbm(data = dat_HRI10.lgb_train_data,
                             params = list(learning_rate = c(0.1),
                                           objective = c("regression"),
                                           min_data_in_leaf = 100,
                                           max_depth = c(5),
                                           num_leaves = c(1000),
                                           lambda_l2 = c(1),
                                           boosting = c("gbdt")),
                             valids = list(valid = dat_HRI10.lgb_test_data),
                             nrounds = 2000,
                             early_stopping_rounds = 50)

dat_HRI10.lgb_train_pred = predict(dat_HRI10.lgb_obj, data = as.matrix(dat_HRI10.lgb_train_rules$data))
cor(dat_HRI10.lgb_train_pred, y, method="pearson")
# 0.9090473 (nrounds = 1059)

dat_HRI10.lgb_test_pred = predict(dat_HRI10.lgb_obj, data = dat_HRI10.lgb_test_matrix)

cor(dat_HRI10.lgb_test_pred, y_test, method="pearson")
# 0.6838792 (nrounds = 1059)

mean((dat_HRI10.lgb_test_pred - y_test)^2)
# 0.1283498
```

We get test prediction correlation of 0.6838792 and MSE of 0.1283498

```{r}
dat_HRI10.feature_importance = as.data.frame(lgb.importance(dat_HRI10.lgb_obj)) %>%
  mutate(Feature = fct_rev(fct_inorder(Feature))) %>%
  dplyr::slice(1:50) %>%
  ggplot(aes(x = Feature, y = Gain)) +
  geom_col(fill = "dodgerblue") +
  coord_flip() +
  theme_bw()
dat_HRI10.feature_importance
```


# Inputs: Position Specific Dinucleotides + Counts of trinucleotides + Fourier Features Based on AA/TT/AT/TA Dinucleotides Calculated from scratch + HRI + Markov Ratio

```{r}
ps2 <- paste0("X", 1:49, "di")
nucleotides <- c("A", "C", "G", "T")
dinucleotides <- gtools::permutations(n = 4, r = 2, v = nucleotides,
                                      repeats.allowed = TRUE) %>%
  apply(1, paste, collapse = "")
trinucleotides <- gtools::permutations(n = 4, r = 3, v = nucleotides,
                                       repeats.allowed = TRUE) %>%
  apply(1, paste, collapse = "")

Xtwo_AT_fourier_cos = readRDS("data/Created/tiling_Xtwo_AT_fourier_cos.rds")
Xtwo_AT_fourier_sin = readRDS("data/Created/tiling_Xtwo_AT_fourier_sin.rds")
Xtwo_AT_fourier_cos_test = readRDS("data/Created/tiling_Xtwo_AT_fourier_cos_test.rds")
Xtwo_AT_fourier_sin_test = readRDS("data/Created/tiling_Xtwo_AT_fourier_sin_test.rds")

HRI = readRDS("data/Created/tiling_HRI.rds")
HRI_test = readRDS("data/Created/tiling_HRI_test.rds")
```

## Squared value of Fourier features

### Simple Linear Model

```{r}
dat_HRI15 = cbind(dat %>% 
                    select(all_of(ps2), all_of(trinucleotides), ratio_score_2nd, C0_new),
                  Xtwo_AT_fourier_cos^2, Xtwo_AT_fourier_sin^2, HRI)
HRI15 = lm(C0_new~., data = dat_HRI15)
cor(HRI15$fitted.values, y)
# 0.6586756

dat_test_HRI15 = cbind(dat_test %>% 
                         select(all_of(ps2), all_of(trinucleotides), ratio_score_2nd, C0_new),
                       Xtwo_AT_fourier_cos_test^2, Xtwo_AT_fourier_sin_test^2, HRI_test)
HRI15_pred = predict(HRI15, dat_test_HRI15)
cor(HRI15_pred, y_test)
# 0.6951627

mean((HRI15_pred - y_test)^2)
# 0.1274094
```

We get test prediction correlation of 0.6951627 and MSE of 0.1274094

### LightGBM (tree-based) Model

```{r}
set.seed(50)
dat_HRI15.lgb_train_set = dat_HRI15 %>%
  select(-C0_new)
dat_HRI15.lgb_train_rules = lgb.convert_with_rules(data = dat_HRI15.lgb_train_set)
dat_HRI15.lgb_train_data = lgb.Dataset(data = as.matrix(dat_HRI15.lgb_train_rules$data),
                                       label = dat_HRI15$C0_new,
                                       categorical_feature = handle_categorical(colnames(dat_HRI15.lgb_train_rules$data)))
dat_HRI15.lgb_test_set = dat_test_HRI15 %>%
  select(-C0_new)
dat_HRI15.lgb_test_matrix = as.matrix(lgb.convert_with_rules(data = dat_HRI15.lgb_test_set, rules = dat_HRI15.lgb_train_rules$rules)$data)
dat_HRI15.lgb_test_data = lgb.Dataset(data = dat_HRI15.lgb_test_matrix,
                                      label = dat_test_HRI15$C0_new,
                                      categorical_feature = handle_categorical(colnames(dat_HRI15.lgb_test_matrix)))
dat_HRI15.lgb_obj = lightgbm(data = dat_HRI15.lgb_train_data,
                             params = list(learning_rate = c(0.1),
                                           objective = c("regression"),
                                           min_data_in_leaf = 100,
                                           max_depth = c(5),
                                           num_leaves = c(1000),
                                           lambda_l2 = c(1),
                                           boosting = c("gbdt")),
                             valids = list(valid = dat_HRI15.lgb_test_data),
                             nrounds = 2000,
                             early_stopping_rounds = 50)

dat_HRI15.lgb_train_pred = predict(dat_HRI15.lgb_obj, data = as.matrix(dat_HRI15.lgb_train_rules$data))
cor(dat_HRI15.lgb_train_pred, y, method="pearson")
# 0.8424156 (nrounds = 572)

dat_HRI15.lgb_test_pred = predict(dat_HRI15.lgb_obj, data = dat_HRI15.lgb_test_matrix)

cor(dat_HRI15.lgb_test_pred, y_test, method="pearson")
# 0.7134178 (nrounds = 572)

mean((dat_HRI15.lgb_test_pred - y_test)^2)
# 0.1195655
```

We get test prediction correlation of 0.7134178 and MSE of 0.1195655

```{r}
dat_HRI15.feature_importance = as.data.frame(lgb.importance(dat_HRI15.lgb_obj)) %>%
  mutate(Feature = fct_rev(fct_inorder(Feature))) %>%
  dplyr::slice(1:50) %>%
  ggplot(aes(x = Feature, y = Gain)) +
  geom_col(fill = "dodgerblue") +
  coord_flip() +
  theme_bw()
dat_HRI15.feature_importance
```


# Inputs: Position Specific Dinucleotides + Counts of trinucleotides + Fourier distance feature Based on AA/TT/AT/TA and CC/GG/CG/GC Dinucleotides Calculated from scratch + HRI

```{r}
ps2 <- paste0("X", 1:49, "di")
nucleotides <- c("A", "C", "G", "T")
dinucleotides <- gtools::permutations(n = 4, r = 2, v = nucleotides,
                                      repeats.allowed = TRUE) %>%
  apply(1, paste, collapse = "")
trinucleotides <- gtools::permutations(n = 4, r = 3, v = nucleotides,
                                       repeats.allowed = TRUE) %>%
  apply(1, paste, collapse = "")

Xtwo_fourier_distance = readRDS("data/Created/tiling_Xtwo_fourier_distance.rds")
Xtwo_fourier_distance_test = readRDS("data/Created/tiling_Xtwo_fourier_distance_test.rds")

HRI = readRDS("data/Created/tiling_HRI.rds")
HRI_test = readRDS("data/Created/tiling_HRI_test.rds")
```

## Simple Linear Model

```{r}
dat_HRI11 = cbind(dat %>% select(all_of(ps2), all_of(trinucleotides), C0_new),
                  Xtwo_fourier_distance, HRI)
HRI11 = lm(C0_new~., data = dat_HRI11)
cor(HRI11$fitted.values, y)
# 0.6361447

dat_test_HRI11 = cbind(dat_test %>% select(all_of(ps2), all_of(trinucleotides), C0_new),
                       Xtwo_fourier_distance_test, HRI_test)
HRI11_pred = predict(HRI11, dat_test_HRI11)
cor(HRI11_pred, y_test)
# 0.6324607

mean((HRI11_pred - y_test)^2)
# 0.1446386
```

We get test prediction correlation of 0.6324607 and MSE of 0.1446386

## LightGBM (tree-based) Model

```{r}
set.seed(50)
dat_HRI11.lgb_train_set = dat_HRI11 %>%
  select(-C0_new)
dat_HRI11.lgb_train_rules = lgb.convert_with_rules(data = dat_HRI11.lgb_train_set)
dat_HRI11.lgb_train_data = lgb.Dataset(data = as.matrix(dat_HRI11.lgb_train_rules$data),
                                       label = dat_HRI11$C0_new,
                                       categorical_feature = handle_categorical(colnames(dat_HRI11.lgb_train_rules$data)))
dat_HRI11.lgb_test_set = dat_test_HRI11 %>%
  select(-C0_new)
dat_HRI11.lgb_test_matrix = as.matrix(lgb.convert_with_rules(data = dat_HRI11.lgb_test_set, rules = dat_HRI11.lgb_train_rules$rules)$data)
dat_HRI11.lgb_test_data = lgb.Dataset(data = dat_HRI11.lgb_test_matrix,
                                      label = dat_test_HRI11$C0_new,
                                      categorical_feature = handle_categorical(colnames(dat_HRI11.lgb_test_matrix)))
dat_HRI11.lgb_obj = lightgbm(data = dat_HRI11.lgb_train_data,
                             params = list(learning_rate = c(0.1),
                                           objective = c("regression"),
                                           min_data_in_leaf = 100,
                                           max_depth = c(5),
                                           num_leaves = c(1000),
                                           lambda_l2 = c(1),
                                           boosting = c("gbdt")),
                             valids = list(valid = dat_HRI11.lgb_test_data),
                             nrounds = 2000,
                             early_stopping_rounds = 50)

dat_HRI11.lgb_train_pred = predict(dat_HRI11.lgb_obj, data = as.matrix(dat_HRI11.lgb_train_rules$data))
cor(dat_HRI11.lgb_train_pred, y, method="pearson")
# 0.9110221 (nrounds = 1116)

dat_HRI11.lgb_test_pred = predict(dat_HRI11.lgb_obj, data = dat_HRI11.lgb_test_matrix)

cor(dat_HRI11.lgb_test_pred, y_test, method="pearson")
# 0.682391 (nrounds = 1116)

mean((dat_HRI11.lgb_test_pred - y_test)^2)
# 0.1288428
```

We get test prediction correlation of 0.682391 and MSE of 0.1288428

```{r}
dat_HRI11.feature_importance = as.data.frame(lgb.importance(dat_HRI11.lgb_obj)) %>%
  mutate(Feature = fct_rev(fct_inorder(Feature))) %>%
  dplyr::slice(1:50) %>%
  ggplot(aes(x = Feature, y = Gain)) +
  geom_col(fill = "dodgerblue") +
  coord_flip() +
  theme_bw()
dat_HRI11.feature_importance
```


# Inputs: Position Specific Dinucleotides + Counts of trinucleotides + Fourier distance feature Based on AA/TT/AT/TA and CC/GG/CG/GC Dinucleotides Calculated from scratch + HRI + Markov Ratio

```{r}
ps2 <- paste0("X", 1:49, "di")
nucleotides <- c("A", "C", "G", "T")
dinucleotides <- gtools::permutations(n = 4, r = 2, v = nucleotides,
                                      repeats.allowed = TRUE) %>%
  apply(1, paste, collapse = "")
trinucleotides <- gtools::permutations(n = 4, r = 3, v = nucleotides,
                                       repeats.allowed = TRUE) %>%
  apply(1, paste, collapse = "")

Xtwo_fourier_distance = readRDS("data/Created/tiling_Xtwo_fourier_distance.rds")
Xtwo_fourier_distance_test = readRDS("data/Created/tiling_Xtwo_fourier_distance_test.rds")

HRI = readRDS("data/Created/tiling_HRI.rds")
HRI_test = readRDS("data/Created/tiling_HRI_test.rds")
```

## Simple Linear Model

```{r}
dat_HRI16 = cbind(dat %>% 
                    select(all_of(ps2), all_of(trinucleotides), ratio_score_2nd, C0_new),
                  Xtwo_fourier_distance, HRI)
HRI16 = lm(C0_new~., data = dat_HRI16)
cor(HRI16$fitted.values, y)
# 0.6424287

dat_test_HRI16 = cbind(dat_test %>% 
                         select(all_of(ps2), all_of(trinucleotides), ratio_score_2nd, C0_new),
                       Xtwo_fourier_distance_test, HRI_test)
HRI16_pred = predict(HRI16, dat_test_HRI16)
cor(HRI16_pred, y_test)
# 0.6822989

mean((HRI16_pred - y_test)^2)
# 0.1317434
```

We get test prediction correlation of 0.6822989 and MSE of 0.1317434

## LightGBM (tree-based) Model

```{r}
set.seed(50)
dat_HRI16.lgb_train_set = dat_HRI16 %>%
  select(-C0_new)
dat_HRI16.lgb_train_rules = lgb.convert_with_rules(data = dat_HRI16.lgb_train_set)
dat_HRI16.lgb_train_data = lgb.Dataset(data = as.matrix(dat_HRI16.lgb_train_rules$data),
                                       label = dat_HRI16$C0_new,
                                       categorical_feature = handle_categorical(colnames(dat_HRI16.lgb_train_rules$data)))
dat_HRI16.lgb_test_set = dat_test_HRI16 %>%
  select(-C0_new)
dat_HRI16.lgb_test_matrix = as.matrix(lgb.convert_with_rules(data = dat_HRI16.lgb_test_set, rules = dat_HRI16.lgb_train_rules$rules)$data)
dat_HRI16.lgb_test_data = lgb.Dataset(data = dat_HRI16.lgb_test_matrix,
                                      label = dat_test_HRI16$C0_new,
                                      categorical_feature = handle_categorical(colnames(dat_HRI16.lgb_test_matrix)))
dat_HRI16.lgb_obj = lightgbm(data = dat_HRI16.lgb_train_data,
                             params = list(learning_rate = c(0.1),
                                           objective = c("regression"),
                                           min_data_in_leaf = 100,
                                           max_depth = c(5),
                                           num_leaves = c(1000),
                                           lambda_l2 = c(1),
                                           boosting = c("gbdt")),
                             valids = list(valid = dat_HRI16.lgb_test_data),
                             nrounds = 2000,
                             early_stopping_rounds = 50)

dat_HRI16.lgb_train_pred = predict(dat_HRI16.lgb_obj, data = as.matrix(dat_HRI16.lgb_train_rules$data))
cor(dat_HRI16.lgb_train_pred, y, method="pearson")
# 0.8980592 (nrounds = 1005)

dat_HRI16.lgb_test_pred = predict(dat_HRI16.lgb_obj, data = dat_HRI16.lgb_test_matrix)

cor(dat_HRI16.lgb_test_pred, y_test, method="pearson")
# 0.7152783 (nrounds = 1005)

mean((dat_HRI16.lgb_test_pred - y_test)^2)
# 0.1190415
```

We get test prediction correlation of 0.7152783 and MSE of 0.1190415

```{r}
dat_HRI16.feature_importance = as.data.frame(lgb.importance(dat_HRI16.lgb_obj)) %>%
  mutate(Feature = fct_rev(fct_inorder(Feature))) %>%
  dplyr::slice(1:50) %>%
  ggplot(aes(x = Feature, y = Gain)) +
  geom_col(fill = "dodgerblue") +
  coord_flip() +
  theme_bw()
dat_HRI16.feature_importance
```



# Inputs: Position Specific Dinucleotides + Counts of trinucleotides + Fourier Features Based on AA/TT/AT/TA and CC/GG/CG/GC Dinucleotides Calculated from scratch + HRI

```{r}
ps2 <- paste0("X", 1:49, "di")
nucleotides <- c("A", "C", "G", "T")
dinucleotides <- gtools::permutations(n = 4, r = 2, v = nucleotides,
                                      repeats.allowed = TRUE) %>%
  apply(1, paste, collapse = "")
trinucleotides <- gtools::permutations(n = 4, r = 3, v = nucleotides,
                                       repeats.allowed = TRUE) %>%
  apply(1, paste, collapse = "")

Xtwo_AT_fourier_cos = readRDS("data/Created/tiling_Xtwo_AT_fourier_cos.rds")
Xtwo_AT_fourier_sin = readRDS("data/Created/tiling_Xtwo_AT_fourier_sin.rds")
Xtwo_AT_fourier_cos_test = readRDS("data/Created/tiling_Xtwo_AT_fourier_cos_test.rds")
Xtwo_AT_fourier_sin_test = readRDS("data/Created/tiling_Xtwo_AT_fourier_sin_test.rds")

Xtwo_CG_fourier_cos = readRDS("data/Created/tiling_Xtwo_CG_fourier_cos.rds")
Xtwo_CG_fourier_sin = readRDS("data/Created/tiling_Xtwo_CG_fourier_sin.rds")
Xtwo_CG_fourier_cos_test = readRDS("data/Created/tiling_Xtwo_CG_fourier_cos_test.rds")
Xtwo_CG_fourier_sin_test = readRDS("data/Created/tiling_Xtwo_CG_fourier_sin_test.rds")

HRI = readRDS("data/Created/tiling_HRI.rds")
HRI_test = readRDS("data/Created/tiling_HRI_test.rds")
```

## Squared value of Fourier features

### Simple Linear Model

```{r}
dat_HRI12 = cbind(dat %>% select(all_of(ps2), all_of(trinucleotides), C0_new),
                  Xtwo_AT_fourier_cos^2, Xtwo_AT_fourier_sin^2,
                  Xtwo_CG_fourier_cos^2, Xtwo_CG_fourier_sin^2, HRI)
HRI12 = lm(C0_new~., data = dat_HRI12)
cor(HRI12$fitted.values, y)
# 0.6540727

dat_test_HRI12 = cbind(dat_test %>% select(all_of(ps2), all_of(trinucleotides), C0_new),
                       Xtwo_AT_fourier_cos_test^2, Xtwo_AT_fourier_sin_test^2,
                       Xtwo_CG_fourier_cos_test^2, Xtwo_CG_fourier_sin_test^2, HRI_test)
HRI12_pred = predict(HRI12, dat_test_HRI12)
cor(HRI12_pred, y_test)
# 0.6499767

mean((HRI12_pred - y_test)^2)
# 0.1392354
```

We get test prediction correlation of 0.6499767 and MSE of 0.1392354

### LightGBM (tree-based) Model

```{r}
set.seed(50)
dat_HRI12.lgb_train_set = dat_HRI12 %>%
  select(-C0_new)
dat_HRI12.lgb_train_rules = lgb.convert_with_rules(data = dat_HRI12.lgb_train_set)
dat_HRI12.lgb_train_data = lgb.Dataset(data = as.matrix(dat_HRI12.lgb_train_rules$data),
                                       label = dat_HRI12$C0_new,
                                       categorical_feature = handle_categorical(colnames(dat_HRI12.lgb_train_rules$data)))
dat_HRI12.lgb_test_set = dat_test_HRI12 %>%
  select(-C0_new)
dat_HRI12.lgb_test_matrix = as.matrix(lgb.convert_with_rules(data = dat_HRI12.lgb_test_set, rules = dat_HRI12.lgb_train_rules$rules)$data)
dat_HRI12.lgb_test_data = lgb.Dataset(data = dat_HRI12.lgb_test_matrix,
                                      label = dat_test_HRI12$C0_new,
                                      categorical_feature = handle_categorical(colnames(dat_HRI12.lgb_test_matrix)))
dat_HRI12.lgb_obj = lightgbm(data = dat_HRI12.lgb_train_data,
                             params = list(learning_rate = c(0.1),
                                           objective = c("regression"),
                                           min_data_in_leaf = 100,
                                           max_depth = c(5),
                                           num_leaves = c(1000),
                                           lambda_l2 = c(1),
                                           boosting = c("gbdt")),
                             valids = list(valid = dat_HRI12.lgb_test_data),
                             nrounds = 2000,
                             early_stopping_rounds = 50)

dat_HRI12.lgb_train_pred = predict(dat_HRI12.lgb_obj, data = as.matrix(dat_HRI12.lgb_train_rules$data))
cor(dat_HRI12.lgb_train_pred, y, method="pearson")
# 0.9180896 (nrounds = 1129)

dat_HRI12.lgb_test_pred = predict(dat_HRI12.lgb_obj, data = dat_HRI12.lgb_test_matrix)

cor(dat_HRI12.lgb_test_pred, y_test, method="pearson")
# 0.6815342 (nrounds = 1129)

mean((dat_HRI12.lgb_test_pred - y_test)^2)
# 0.1290762
```

We get test prediction correlation of 0.6815342 and MSE of 0.1290762

```{r}
dat_HRI12.feature_importance = as.data.frame(lgb.importance(dat_HRI12.lgb_obj)) %>%
  mutate(Feature = fct_rev(fct_inorder(Feature))) %>%
  dplyr::slice(1:50) %>%
  ggplot(aes(x = Feature, y = Gain)) +
  geom_col(fill = "dodgerblue") +
  coord_flip() +
  theme_bw()
dat_HRI12.feature_importance
```


# Inputs: Position Specific Dinucleotides + Counts of trinucleotides + Fourier Features Based on AA/TT/AT/TA and CC/GG/CG/GC Dinucleotides Calculated from scratch + HRI + Markov Ratio

```{r}
ps2 <- paste0("X", 1:49, "di")
nucleotides <- c("A", "C", "G", "T")
dinucleotides <- gtools::permutations(n = 4, r = 2, v = nucleotides,
                                      repeats.allowed = TRUE) %>%
  apply(1, paste, collapse = "")
trinucleotides <- gtools::permutations(n = 4, r = 3, v = nucleotides,
                                       repeats.allowed = TRUE) %>%
  apply(1, paste, collapse = "")

Xtwo_AT_fourier_cos = readRDS("data/Created/tiling_Xtwo_AT_fourier_cos.rds")
Xtwo_AT_fourier_sin = readRDS("data/Created/tiling_Xtwo_AT_fourier_sin.rds")
Xtwo_AT_fourier_cos_test = readRDS("data/Created/tiling_Xtwo_AT_fourier_cos_test.rds")
Xtwo_AT_fourier_sin_test = readRDS("data/Created/tiling_Xtwo_AT_fourier_sin_test.rds")

Xtwo_CG_fourier_cos = readRDS("data/Created/tiling_Xtwo_CG_fourier_cos.rds")
Xtwo_CG_fourier_sin = readRDS("data/Created/tiling_Xtwo_CG_fourier_sin.rds")
Xtwo_CG_fourier_cos_test = readRDS("data/Created/tiling_Xtwo_CG_fourier_cos_test.rds")
Xtwo_CG_fourier_sin_test = readRDS("data/Created/tiling_Xtwo_CG_fourier_sin_test.rds")

HRI = readRDS("data/Created/tiling_HRI.rds")
HRI_test = readRDS("data/Created/tiling_HRI_test.rds")
```

## Squared value of Fourier features

### Simple Linear Model

```{r}
dat_HRI17 = cbind(dat %>% 
                    select(all_of(ps2), all_of(trinucleotides), ratio_score_2nd, C0_new),
                  Xtwo_AT_fourier_cos^2, Xtwo_AT_fourier_sin^2,
                  Xtwo_CG_fourier_cos^2, Xtwo_CG_fourier_sin^2, HRI)
HRI17 = lm(C0_new~., data = dat_HRI17)
cor(HRI17$fitted.values, y)
# 0.6597469

dat_test_HRI17 = cbind(dat_test %>% 
                         select(all_of(ps2), all_of(trinucleotides), ratio_score_2nd, C0_new),
                       Xtwo_AT_fourier_cos_test^2, Xtwo_AT_fourier_sin_test^2,
                       Xtwo_CG_fourier_cos_test^2, Xtwo_CG_fourier_sin_test^2, HRI_test)
HRI17_pred = predict(HRI17, dat_test_HRI17)
cor(HRI17_pred, y_test)
# 0.6956399

mean((HRI17_pred - y_test)^2)
# 0.1272417
```

We get test prediction correlation of 0.6956399 and MSE of 0.1272417

### LightGBM (tree-based) Model

```{r}
set.seed(50)
dat_HRI17.lgb_train_set = dat_HRI17 %>%
  select(-C0_new)
dat_HRI17.lgb_train_rules = lgb.convert_with_rules(data = dat_HRI17.lgb_train_set)
dat_HRI17.lgb_train_data = lgb.Dataset(data = as.matrix(dat_HRI17.lgb_train_rules$data),
                                       label = dat_HRI17$C0_new,
                                       categorical_feature = handle_categorical(colnames(dat_HRI17.lgb_train_rules$data)))
dat_HRI17.lgb_test_set = dat_test_HRI17 %>%
  select(-C0_new)
dat_HRI17.lgb_test_matrix = as.matrix(lgb.convert_with_rules(data = dat_HRI17.lgb_test_set, rules = dat_HRI17.lgb_train_rules$rules)$data)
dat_HRI17.lgb_test_data = lgb.Dataset(data = dat_HRI17.lgb_test_matrix,
                                      label = dat_test_HRI17$C0_new,
                                      categorical_feature = handle_categorical(colnames(dat_HRI17.lgb_test_matrix)))
dat_HRI17.lgb_obj = lightgbm(data = dat_HRI17.lgb_train_data,
                             params = list(learning_rate = c(0.1),
                                           objective = c("regression"),
                                           min_data_in_leaf = 100,
                                           max_depth = c(5),
                                           num_leaves = c(1000),
                                           lambda_l2 = c(1),
                                           boosting = c("gbdt")),
                             valids = list(valid = dat_HRI17.lgb_test_data),
                             nrounds = 2000,
                             early_stopping_rounds = 50)

dat_HRI17.lgb_train_pred = predict(dat_HRI17.lgb_obj, data = as.matrix(dat_HRI17.lgb_train_rules$data))
cor(dat_HRI17.lgb_train_pred, y, method="pearson")
# 0.8699982 (nrounds = 719)

dat_HRI17.lgb_test_pred = predict(dat_HRI17.lgb_obj, data = dat_HRI17.lgb_test_matrix)

cor(dat_HRI17.lgb_test_pred, y_test, method="pearson")
# 0.7162112 (nrounds = 719)

mean((dat_HRI17.lgb_test_pred - y_test)^2)
# 0.1186991
```

We get test prediction correlation of 0.7162112 and MSE of 0.1186991

```{r}
dat_HRI17.feature_importance = as.data.frame(lgb.importance(dat_HRI17.lgb_obj)) %>%
  mutate(Feature = fct_rev(fct_inorder(Feature))) %>%
  dplyr::slice(1:50) %>%
  ggplot(aes(x = Feature, y = Gain)) +
  geom_col(fill = "dodgerblue") +
  coord_flip() +
  theme_bw()
dat_HRI17.feature_importance
```

# Inputs: Position Specific Dinucleotides + Counts of trinucleotides + Fourier Features Based on AA/TT/AT/TA and CC/GG/CG/GC Dinucleotides + Distance between them Calcualted from scratch + HRI

```{r}
ps2 <- paste0("X", 1:49, "di")
nucleotides <- c("A", "C", "G", "T")
dinucleotides <- gtools::permutations(n = 4, r = 2, v = nucleotides,
                                      repeats.allowed = TRUE) %>%
  apply(1, paste, collapse = "")
trinucleotides <- gtools::permutations(n = 4, r = 3, v = nucleotides,
                                       repeats.allowed = TRUE) %>%
  apply(1, paste, collapse = "")

Xtwo_AT_fourier_cos = readRDS("data/Created/tiling_Xtwo_AT_fourier_cos.rds")
Xtwo_AT_fourier_sin = readRDS("data/Created/tiling_Xtwo_AT_fourier_sin.rds")
Xtwo_AT_fourier_cos_test = readRDS("data/Created/tiling_Xtwo_AT_fourier_cos_test.rds")
Xtwo_AT_fourier_sin_test = readRDS("data/Created/tiling_Xtwo_AT_fourier_sin_test.rds")

Xtwo_CG_fourier_cos = readRDS("data/Created/tiling_Xtwo_CG_fourier_cos.rds")
Xtwo_CG_fourier_sin = readRDS("data/Created/tiling_Xtwo_CG_fourier_sin.rds")
Xtwo_CG_fourier_cos_test = readRDS("data/Created/tiling_Xtwo_CG_fourier_cos_test.rds")
Xtwo_CG_fourier_sin_test = readRDS("data/Created/tiling_Xtwo_CG_fourier_sin_test.rds")

Xtwo_fourier_distance = readRDS("data/Created/tiling_Xtwo_fourier_distance.rds")
Xtwo_fourier_distance_test = readRDS("data/Created/tiling_Xtwo_fourier_distance_test.rds")

HRI = readRDS("data/Created/tiling_HRI.rds")
HRI_test = readRDS("data/Created/tiling_HRI_test.rds")
```

## Squared value of Fourier features

### Simple Linear Model

```{r}
dat_HRI13 = cbind(dat %>% select(all_of(ps2), all_of(trinucleotides), C0_new),
                  Xtwo_AT_fourier_cos^2, Xtwo_AT_fourier_sin^2,
                  Xtwo_CG_fourier_cos^2, Xtwo_CG_fourier_sin^2,
                  Xtwo_fourier_distance, HRI)
HRI13 = lm(C0_new~., data = dat_HRI13)
cor(HRI13$fitted.values, y)
# 0.6562597

dat_test_HRI13 = cbind(dat_test %>% select(all_of(ps2), all_of(trinucleotides), C0_new),
                       Xtwo_AT_fourier_cos_test^2, Xtwo_AT_fourier_sin_test^2,
                       Xtwo_CG_fourier_cos_test^2, Xtwo_CG_fourier_sin_test^2,
                       Xtwo_fourier_distance_test, HRI_test)
HRI13_pred = predict(HRI13, dat_test_HRI13)
cor(HRI13_pred, y_test)
# 0.6522779

mean((HRI13_pred - y_test)^2)
# 0.1385076
```

We get test prediction correlation of 0.6522779 and MSE of 0.1385076

### LightGBM (tree-based) Model

```{r}
set.seed(50)
dat_HRI13.lgb_train_set = dat_HRI13 %>%
  select(-C0_new)
dat_HRI13.lgb_train_rules = lgb.convert_with_rules(data = dat_HRI13.lgb_train_set)
dat_HRI13.lgb_train_data = lgb.Dataset(data = as.matrix(dat_HRI13.lgb_train_rules$data),
                                       label = dat_HRI13$C0_new,
                                       categorical_feature = handle_categorical(colnames(dat_HRI13.lgb_train_rules$data)))
dat_HRI13.lgb_test_set = dat_test_HRI13 %>%
  select(-C0_new)
dat_HRI13.lgb_test_matrix = as.matrix(lgb.convert_with_rules(data = dat_HRI13.lgb_test_set, rules = dat_HRI13.lgb_train_rules$rules)$data)
dat_HRI13.lgb_test_data = lgb.Dataset(data = dat_HRI13.lgb_test_matrix,
                                      label = dat_test_HRI13$C0_new,
                                      categorical_feature = handle_categorical(colnames(dat_HRI13.lgb_test_matrix)))
dat_HRI13.lgb_obj = lightgbm(data = dat_HRI13.lgb_train_data,
                             params = list(learning_rate = c(0.1),
                                           objective = c("regression"),
                                           min_data_in_leaf = 100,
                                           max_depth = c(5),
                                           num_leaves = c(1000),
                                           lambda_l2 = c(1),
                                           boosting = c("gbdt")),
                             valids = list(valid = dat_HRI13.lgb_test_data),
                             nrounds = 2000,
                             early_stopping_rounds = 50)

dat_HRI13.lgb_train_pred = predict(dat_HRI13.lgb_obj, data = as.matrix(dat_HRI13.lgb_train_rules$data))
cor(dat_HRI13.lgb_train_pred, y, method="pearson")
# 0.9065805 (nrounds = 1005)

dat_HRI13.lgb_test_pred = predict(dat_HRI13.lgb_obj, data = dat_HRI13.lgb_test_matrix)

cor(dat_HRI13.lgb_test_pred, y_test, method="pearson")
# 0.6850875 (nrounds = 1005)

mean((dat_HRI13.lgb_test_pred - y_test)^2)
# 0.1279586
```

We get test prediction correlation of 0.6850875 and MSE of 0.1279586

```{r}
dat_HRI13.feature_importance = as.data.frame(lgb.importance(dat_HRI13.lgb_obj)) %>%
  mutate(Feature = fct_rev(fct_inorder(Feature))) %>%
  dplyr::slice(1:50) %>%
  ggplot(aes(x = Feature, y = Gain)) +
  geom_col(fill = "dodgerblue") +
  coord_flip() +
  theme_bw()
dat_HRI13.feature_importance
```


# Inputs: Position Specific Dinucleotides + Counts of trinucleotides + Fourier Features Based on AA/TT/AT/TA and CC/GG/CG/GC Dinucleotides + Distance between them Calculated from scratch + HRI + Markov Ratio

```{r}
ps2 <- paste0("X", 1:49, "di")
nucleotides <- c("A", "C", "G", "T")
dinucleotides <- gtools::permutations(n = 4, r = 2, v = nucleotides,
                                      repeats.allowed = TRUE) %>%
  apply(1, paste, collapse = "")
trinucleotides <- gtools::permutations(n = 4, r = 3, v = nucleotides,
                                       repeats.allowed = TRUE) %>%
  apply(1, paste, collapse = "")

Xtwo_AT_fourier_cos = readRDS("data/Created/tiling_Xtwo_AT_fourier_cos.rds")
Xtwo_AT_fourier_sin = readRDS("data/Created/tiling_Xtwo_AT_fourier_sin.rds")
Xtwo_AT_fourier_cos_test = readRDS("data/Created/tiling_Xtwo_AT_fourier_cos_test.rds")
Xtwo_AT_fourier_sin_test = readRDS("data/Created/tiling_Xtwo_AT_fourier_sin_test.rds")

Xtwo_CG_fourier_cos = readRDS("data/Created/tiling_Xtwo_CG_fourier_cos.rds")
Xtwo_CG_fourier_sin = readRDS("data/Created/tiling_Xtwo_CG_fourier_sin.rds")
Xtwo_CG_fourier_cos_test = readRDS("data/Created/tiling_Xtwo_CG_fourier_cos_test.rds")
Xtwo_CG_fourier_sin_test = readRDS("data/Created/tiling_Xtwo_CG_fourier_sin_test.rds")

Xtwo_fourier_distance = readRDS("data/Created/tiling_Xtwo_fourier_distance.rds")
Xtwo_fourier_distance_test = readRDS("data/Created/tiling_Xtwo_fourier_distance_test.rds")

HRI = readRDS("data/Created/tiling_HRI.rds")
HRI_test = readRDS("data/Created/tiling_HRI_test.rds")
```

## Squared value of Fourier features

### Simple Linear Model

```{r}
dat_HRI18 = cbind(dat %>% 
                    select(all_of(ps2), all_of(trinucleotides), ratio_score_2nd, C0_new),
                  Xtwo_AT_fourier_cos^2, Xtwo_AT_fourier_sin^2,
                  Xtwo_CG_fourier_cos^2, Xtwo_CG_fourier_sin^2,
                  Xtwo_fourier_distance, HRI)
HRI18 = lm(C0_new~., data = dat_HRI18)
cor(HRI18$fitted.values, y)
# 0.6618491

dat_test_HRI18 = cbind(dat_test %>% 
                         select(all_of(ps2), all_of(trinucleotides), ratio_score_2nd, C0_new),
                       Xtwo_AT_fourier_cos_test^2, Xtwo_AT_fourier_sin_test^2,
                       Xtwo_CG_fourier_cos_test^2, Xtwo_CG_fourier_sin_test^2,
                       Xtwo_fourier_distance_test, HRI_test)
HRI18_pred = predict(HRI18, dat_test_HRI18)
cor(HRI18_pred, y_test)
# 0.6971144

mean((HRI18_pred - y_test)^2)
# 0.1267063
```

We get test prediction correlation of 0.6971144 and MSE of 0.1267063

### LightGBM (tree-based) Model

```{r}
set.seed(50)
dat_HRI18.lgb_train_set = dat_HRI18 %>%
  select(-C0_new)
dat_HRI18.lgb_train_rules = lgb.convert_with_rules(data = dat_HRI18.lgb_train_set)
dat_HRI18.lgb_train_data = lgb.Dataset(data = as.matrix(dat_HRI18.lgb_train_rules$data),
                                       label = dat_HRI18$C0_new,
                                       categorical_feature = handle_categorical(colnames(dat_HRI18.lgb_train_rules$data)))
dat_HRI18.lgb_test_set = dat_test_HRI18 %>%
  select(-C0_new)
dat_HRI18.lgb_test_matrix = as.matrix(lgb.convert_with_rules(data = dat_HRI18.lgb_test_set, rules = dat_HRI18.lgb_train_rules$rules)$data)
dat_HRI18.lgb_test_data = lgb.Dataset(data = dat_HRI18.lgb_test_matrix,
                                      label = dat_test_HRI18$C0_new,
                                      categorical_feature = handle_categorical(colnames(dat_HRI18.lgb_test_matrix)))
dat_HRI18.lgb_obj = lightgbm(data = dat_HRI18.lgb_train_data,
                             params = list(learning_rate = c(0.1),
                                           objective = c("regression"),
                                           min_data_in_leaf = 100,
                                           max_depth = c(5),
                                           num_leaves = c(1000),
                                           lambda_l2 = c(1),
                                           boosting = c("gbdt")),
                             valids = list(valid = dat_HRI18.lgb_test_data),
                             nrounds = 2000,
                             early_stopping_rounds = 50)

dat_HRI18.lgb_train_pred = predict(dat_HRI18.lgb_obj, data = as.matrix(dat_HRI18.lgb_train_rules$data))
cor(dat_HRI18.lgb_train_pred, y, method="pearson")
# 0.8653311 (nrounds = 695)

dat_HRI18.lgb_test_pred = predict(dat_HRI18.lgb_obj, data = dat_HRI18.lgb_test_matrix)

cor(dat_HRI18.lgb_test_pred, y_test, method="pearson")
# 0.7166713 (nrounds = 695)

mean((dat_HRI18.lgb_test_pred - y_test)^2)
# 0.1184899
```

We get test prediction correlation of 0.7166713 and MSE of 0.1184899

```{r}
dat_HRI18.feature_importance = as.data.frame(lgb.importance(dat_HRI18.lgb_obj)) %>%
  mutate(Feature = fct_rev(fct_inorder(Feature))) %>%
  dplyr::slice(1:50) %>%
  ggplot(aes(x = Feature, y = Gain)) +
  geom_col(fill = "dodgerblue") +
  coord_flip() +
  theme_bw()
dat_HRI18.feature_importance
```


# Inputs: Position Specific Dinucleotides + Counts of trinucleotides + Amplitude of Fourier Features Based on AA/TT/AT/TA Dinucleotides + Fourier distance feature Based on AA/TT/AT/TA and CC/GG/CG/GC Dinucleotides Calculated from scratch + HRI

```{r}
ps2 <- paste0("X", 1:49, "di")
nucleotides <- c("A", "C", "G", "T")
dinucleotides <- gtools::permutations(n = 4, r = 2, v = nucleotides,
                                      repeats.allowed = TRUE) %>%
  apply(1, paste, collapse = "")
trinucleotides <- gtools::permutations(n = 4, r = 3, v = nucleotides,
                                       repeats.allowed = TRUE) %>%
  apply(1, paste, collapse = "")

Xtwo_AT_fourier_amp = readRDS("data/Created/tiling_Xtwo_AT_fourier_amp.rds")
Xtwo_AT_fourier_amp_test = readRDS("data/Created/tiling_Xtwo_AT_fourier_amp_test.rds")

Xtwo_fourier_distance = readRDS("data/Created/tiling_Xtwo_fourier_distance.rds")
Xtwo_fourier_distance_test = readRDS("data/Created/tiling_Xtwo_fourier_distance_test.rds")

HRI = readRDS("data/Created/tiling_HRI.rds")
HRI_test = readRDS("data/Created/tiling_HRI_test.rds")
```

## Simple Linear Model

```{r}
dat_HRI14 = cbind(dat %>% select(all_of(ps2), all_of(trinucleotides), C0_new),
                  Xtwo_AT_fourier_amp, Xtwo_fourier_distance, HRI)
HRI14 = lm(C0_new~., data = dat_HRI14)
cor(HRI14$fitted.values, y)
# 0.6440976

dat_test_HRI14 = cbind(dat_test %>% select(all_of(ps2), all_of(trinucleotides), C0_new),
                       Xtwo_AT_fourier_amp_test, Xtwo_fourier_distance_test, HRI_test)
HRI14_pred = predict(HRI14, dat_test_HRI14)
cor(HRI14_pred, y_test)
# 0.6407966

mean((HRI14_pred - y_test)^2)
# 0.1420931
```

We get test prediction correlation of 0.6407966 and MSE of 0.1420931

## LightGBM (tree-based) Model

```{r}
set.seed(50)
dat_HRI14.lgb_train_set = dat_HRI14 %>%
  select(-C0_new)
dat_HRI14.lgb_train_rules = lgb.convert_with_rules(data = dat_HRI14.lgb_train_set)
dat_HRI14.lgb_train_data = lgb.Dataset(data = as.matrix(dat_HRI14.lgb_train_rules$data),
                                       label = dat_HRI14$C0_new,
                                       categorical_feature = handle_categorical(colnames(dat_HRI14.lgb_train_rules$data)))
dat_HRI14.lgb_test_set = dat_test_HRI14 %>%
  select(-C0_new)
dat_HRI14.lgb_test_matrix = as.matrix(lgb.convert_with_rules(data = dat_HRI14.lgb_test_set, rules = dat_HRI14.lgb_train_rules$rules)$data)
dat_HRI14.lgb_test_data = lgb.Dataset(data = dat_HRI14.lgb_test_matrix,
                                      label = dat_test_HRI14$C0_new,
                                      categorical_feature = handle_categorical(colnames(dat_HRI14.lgb_test_matrix)))
dat_HRI14.lgb_obj = lightgbm(data = dat_HRI14.lgb_train_data,
                             params = list(learning_rate = c(0.1),
                                           objective = c("regression"),
                                           min_data_in_leaf = 100,
                                           max_depth = c(5),
                                           num_leaves = c(1000),
                                           lambda_l2 = c(1),
                                           boosting = c("gbdt")),
                             valids = list(valid = dat_HRI14.lgb_test_data),
                             nrounds = 4000,
                             early_stopping_rounds = 50)

dat_HRI14.lgb_train_pred = predict(dat_HRI14.lgb_obj, data = as.matrix(dat_HRI14.lgb_train_rules$data))
cor(dat_HRI14.lgb_train_pred, y, method="pearson")
# 0.9804854 (nrounds = 2581)

dat_HRI14.lgb_test_pred = predict(dat_HRI14.lgb_obj, data = dat_HRI14.lgb_test_matrix)

cor(dat_HRI14.lgb_test_pred, y_test, method="pearson")
# 0.6934862 (nrounds = 2581)

mean((dat_HRI14.lgb_test_pred - y_test)^2)
# 0.1251037
```

We get test prediction correlation of 0.6934862 and MSE of 0.1251037

```{r}
dat_HRI14.feature_importance = as.data.frame(lgb.importance(dat_HRI14.lgb_obj)) %>%
  mutate(Feature = fct_rev(fct_inorder(Feature))) %>%
  dplyr::slice(1:50) %>%
  ggplot(aes(x = Feature, y = Gain)) +
  geom_col(fill = "dodgerblue") +
  coord_flip() +
  theme_bw()
dat_HRI14.feature_importance
```


# Inputs: Position Specific Dinucleotides + Counts of trinucleotides + Amplitude of Fourier Features Based on AA/TT/AT/TA Dinucleotides + Fourier distance feature Based on AA/TT/AT/TA and CC/GG/CG/GC Dinucleotides Calculated from scratch + HRI + Markov Ratio

```{r}
ps2 <- paste0("X", 1:49, "di")
nucleotides <- c("A", "C", "G", "T")
dinucleotides <- gtools::permutations(n = 4, r = 2, v = nucleotides,
                                      repeats.allowed = TRUE) %>%
  apply(1, paste, collapse = "")
trinucleotides <- gtools::permutations(n = 4, r = 3, v = nucleotides,
                                       repeats.allowed = TRUE) %>%
  apply(1, paste, collapse = "")

Xtwo_AT_fourier_amp = readRDS("data/Created/tiling_Xtwo_AT_fourier_amp.rds")
Xtwo_AT_fourier_amp_test = readRDS("data/Created/tiling_Xtwo_AT_fourier_amp_test.rds")

Xtwo_fourier_distance = readRDS("data/Created/tiling_Xtwo_fourier_distance.rds")
Xtwo_fourier_distance_test = readRDS("data/Created/tiling_Xtwo_fourier_distance_test.rds")

HRI = readRDS("data/Created/tiling_HRI.rds")
HRI_test = readRDS("data/Created/tiling_HRI_test.rds")
```

## Simple Linear Model

```{r}
dat_HRI19 = cbind(dat %>% 
                    select(all_of(ps2), all_of(trinucleotides), ratio_score_2nd, C0_new),
                  Xtwo_AT_fourier_amp, Xtwo_fourier_distance, HRI)
HRI19 = lm(C0_new~., data = dat_HRI19)
cor(HRI19$fitted.values, y)
# 0.6500909

dat_test_HRI19 = cbind(dat_test %>% 
                         select(all_of(ps2), all_of(trinucleotides), ratio_score_2nd, C0_new),
                       Xtwo_AT_fourier_amp_test, Xtwo_fourier_distance_test, HRI_test)
HRI19_pred = predict(HRI19, dat_test_HRI19)
cor(HRI19_pred, y_test)
# 0.6881178

mean((HRI19_pred - y_test)^2)
# 0.1298944
```

We get test prediction correlation of 0.6881178 and MSE of 0.1298944

## LightGBM (tree-based) Model

```{r}
set.seed(50)
dat_HRI19.lgb_train_set = dat_HRI19 %>%
  select(-C0_new)
dat_HRI19.lgb_train_rules = lgb.convert_with_rules(data = dat_HRI19.lgb_train_set)
dat_HRI19.lgb_train_data = lgb.Dataset(data = as.matrix(dat_HRI19.lgb_train_rules$data),
                                       label = dat_HRI19$C0_new,
                                       categorical_feature = handle_categorical(colnames(dat_HRI19.lgb_train_rules$data)))
dat_HRI19.lgb_test_set = dat_test_HRI19 %>%
  select(-C0_new)
dat_HRI19.lgb_test_matrix = as.matrix(lgb.convert_with_rules(data = dat_HRI19.lgb_test_set, rules = dat_HRI19.lgb_train_rules$rules)$data)
dat_HRI19.lgb_test_data = lgb.Dataset(data = dat_HRI19.lgb_test_matrix,
                                      label = dat_test_HRI19$C0_new,
                                      categorical_feature = handle_categorical(colnames(dat_HRI19.lgb_test_matrix)))
dat_HRI19.lgb_obj = lightgbm(data = dat_HRI19.lgb_train_data,
                             params = list(learning_rate = c(0.1),
                                           objective = c("regression"),
                                           min_data_in_leaf = 100,
                                           max_depth = c(5),
                                           num_leaves = c(1000),
                                           lambda_l2 = c(1),
                                           boosting = c("gbdt")),
                             valids = list(valid = dat_HRI19.lgb_test_data),
                             nrounds = 2000,
                             early_stopping_rounds = 50)

dat_HRI19.lgb_train_pred = predict(dat_HRI19.lgb_obj, data = as.matrix(dat_HRI19.lgb_train_rules$data))
cor(dat_HRI19.lgb_train_pred, y, method="pearson")
# 0.8844382 (nrounds = 856)

dat_HRI19.lgb_test_pred = predict(dat_HRI19.lgb_obj, data = dat_HRI19.lgb_test_matrix)

cor(dat_HRI19.lgb_test_pred, y_test, method="pearson")
# 0.7175047 (nrounds = 856)

mean((dat_HRI19.lgb_test_pred - y_test)^2)
# 0.1182934
```

We get test prediction correlation of 0.7175047 and MSE of 0.1182934

```{r}
dat_HRI19.feature_importance = as.data.frame(lgb.importance(dat_HRI19.lgb_obj)) %>%
  mutate(Feature = fct_rev(fct_inorder(Feature))) %>%
  dplyr::slice(1:50) %>%
  ggplot(aes(x = Feature, y = Gain)) +
  geom_col(fill = "dodgerblue") +
  coord_flip() +
  theme_bw()
dat_HRI19.feature_importance
```


# Inputs: Position Specific Dinucleotides + Counts of trinucleotides + Fourier Features Based on AA/TT/AT/TA Dinucleotides Calculated using fft + HRI + Markov Ratio

```{r}
ps2 <- paste0("X", 1:49, "di")
nucleotides <- c("A", "C", "G", "T")
dinucleotides <- gtools::permutations(n = 4, r = 2, v = nucleotides,
                                      repeats.allowed = TRUE) %>%
  apply(1, paste, collapse = "")
trinucleotides <- gtools::permutations(n = 4, r = 3, v = nucleotides,
                                       repeats.allowed = TRUE) %>%
  apply(1, paste, collapse = "")

Xtwo_AorT_fourier_cos = readRDS("data/Created/tiling_Xtwo_AorT_fourier_cos.rds")
Xtwo_AorT_fourier_sin = readRDS("data/Created/tiling_Xtwo_AorT_fourier_sin.rds")
Xtwo_AorT_fourier_cos_test = readRDS("data/Created/tiling_Xtwo_AorT_fourier_cos_test.rds")
Xtwo_AorT_fourier_sin_test = readRDS("data/Created/tiling_Xtwo_AorT_fourier_sin_test.rds")

HRI = readRDS("data/Created/tiling_HRI.rds")
HRI_test = readRDS("data/Created/tiling_HRI_test.rds")
```

## Squared value of Fourier features

### Simple Linear Model

```{r}
dat_HRI20 = cbind(dat %>% 
                    select(all_of(ps2), all_of(trinucleotides), ratio_score_2nd, C0_new),
                  Xtwo_AorT_fourier_cos^2, Xtwo_AorT_fourier_sin^2, HRI)
HRI20 = lm(C0_new~., data = dat_HRI20)
cor(HRI20$fitted.values, y)
# 0.634958

dat_test_HRI20 = cbind(dat_test %>% 
                         select(all_of(ps2), all_of(trinucleotides), ratio_score_2nd, C0_new),
                       Xtwo_AorT_fourier_cos_test^2, Xtwo_AorT_fourier_sin_test^2, HRI_test)
HRI20_pred = predict(HRI20, dat_test_HRI20)
cor(HRI20_pred, y_test)
# 0.678416

mean((HRI20_pred - y_test)^2)
# 0.1330495
```

We get test prediction correlation of 0.678416 and MSE of 0.1330495

### LightGBM (tree-based) Model

```{r}
set.seed(50)
dat_HRI20.lgb_train_set = dat_HRI20 %>%
  select(-C0_new)
dat_HRI20.lgb_train_rules = lgb.convert_with_rules(data = dat_HRI20.lgb_train_set)
dat_HRI20.lgb_train_data = lgb.Dataset(data = as.matrix(dat_HRI20.lgb_train_rules$data),
                                       label = dat_HRI20$C0_new,
                                       categorical_feature = handle_categorical(colnames(dat_HRI20.lgb_train_rules$data)))
dat_HRI20.lgb_test_set = dat_test_HRI20 %>%
  select(-C0_new)
dat_HRI20.lgb_test_matrix = as.matrix(lgb.convert_with_rules(data = dat_HRI20.lgb_test_set, rules = dat_HRI20.lgb_train_rules$rules)$data)
dat_HRI20.lgb_test_data = lgb.Dataset(data = dat_HRI20.lgb_test_matrix,
                                      label = dat_test_HRI20$C0_new,
                                      categorical_feature = handle_categorical(colnames(dat_HRI20.lgb_test_matrix)))
dat_HRI20.lgb_obj = lightgbm(data = dat_HRI20.lgb_train_data,
                             params = list(learning_rate = c(0.1),
                                           objective = c("regression"),
                                           min_data_in_leaf = 100,
                                           max_depth = c(5),
                                           num_leaves = c(1000),
                                           lambda_l2 = c(1),
                                           boosting = c("gbdt")),
                             valids = list(valid = dat_HRI20.lgb_test_data),
                             nrounds = 2000,
                             early_stopping_rounds = 50)

dat_HRI20.lgb_train_pred = predict(dat_HRI20.lgb_obj, data = as.matrix(dat_HRI20.lgb_train_rules$data))
cor(dat_HRI20.lgb_train_pred, y, method="pearson")
# 0.9487405 (nrounds = 1650)

dat_HRI20.lgb_test_pred = predict(dat_HRI20.lgb_obj, data = dat_HRI20.lgb_test_matrix)

cor(dat_HRI20.lgb_test_pred, y_test, method="pearson")
# 0.7122282 (nrounds = 1650)

mean((dat_HRI20.lgb_test_pred - y_test)^2)
# 0.120486
```

We get test prediction correlation of 0.7122282 and MSE of 0.120486

```{r}
dat_HRI20.feature_importance = as.data.frame(lgb.importance(dat_HRI20.lgb_obj)) %>%
  mutate(Feature = fct_rev(fct_inorder(Feature))) %>%
  dplyr::slice(1:50) %>%
  ggplot(aes(x = Feature, y = Gain)) +
  geom_col(fill = "dodgerblue") +
  coord_flip() +
  theme_bw()
dat_HRI20.feature_importance
```



# Inputs: Global Alternating Scores A/T Only

```{r}
library(Matrix)
library(glmnet)
library(sparsegl)

global_alternating_scores_AorT_train = readRDS("data/Created/tiling_global_alternating_scores_AorT_train.rds")
global_alternating_scores_AorT_test = readRDS("data/Created/tiling_global_alternating_scores_AorT_test.rds")
global_alternating_scores_AorT_random_all = readRDS("data/Created/random_all_global_alternating_scores_AorT.rds")
```

## Simple Linear Model

```{r}
dat_global_alternating_AorT = cbind(global_alternating_scores_AorT_train,
                                    dat %>% select(C0_new))

global_alternating_AorT_lm = lm(C0_new~., data=dat_global_alternating_AorT)
cor(global_alternating_AorT_lm$fitted.values, y)
# 0.3966627

dat_test_global_alternating_AorT = cbind(global_alternating_scores_AorT_test,
                                         dat_test %>% select(C0_new))

global_alternating_AorT_pred = predict(global_alternating_AorT_lm, 
                                       dat_test_global_alternating_AorT)

cor(global_alternating_AorT_pred, y_test)
# 0.3929419

mean((global_alternating_AorT_pred - y_test)^2)
# 0.2037986

dat_random_all_global_alternating_AorT = cbind(global_alternating_scores_AorT_random_all,
                                                dat_random_all %>% select(C0_new))

global_alternating_AorT_pred_random_all = predict(global_alternating_AorT_lm,
                                                   dat_random_all_global_alternating_AorT)

cor(global_alternating_AorT_pred_random_all, y_random_all)
# 0.3354695

mean((global_alternating_AorT_pred_random_all - y_random_all)^2)
# 0.135561
```

We get test prediction correlation of 0.3929419 and MSE of 0.2037986
We get test prediction correlation of 0.3354695 and MSE of 0.135561 on the Random Library


## Lasso Model

```{r}
X_global_alternating_AorT = dat_global_alternating_AorT %>%
  select(-C0_new)

x_global_alternating_AorT = sparse.model.matrix(~., data=X_global_alternating_AorT)

set.seed(50)
la.model_global_alternating_AorT = cv.glmnet(x_global_alternating_AorT, y, alpha=1, family="gaussian")

la.global_alternating_AorT_best_lambda = la.model_global_alternating_AorT$lambda.min

sum(coef(la.model_global_alternating_AorT, s=la.global_alternating_AorT_best_lambda) != 0)
# 4

la.global_alternating_AorT_lambda_1se = la.model_global_alternating_AorT$lambda.1se

sum(coef(la.model_global_alternating_AorT, s=la.global_alternating_AorT_lambda_1se) != 0)
# 3

saveRDS(la.model_global_alternating_AorT, "model/lasso-global_alternating_AorT.rds")

la.model_global_alternating_AorT.train_pred = predict(la.model_global_alternating_AorT, newx = x_global_alternating_AorT, s=la.global_alternating_AorT_best_lambda)

cor(la.model_global_alternating_AorT.train_pred, y, method="pearson")
# 0.396656
mean((la.model_global_alternating_AorT.train_pred - y)^2)
# 0.2042173

la.model_global_alternating_AorT.train_pred2 = predict(la.model_global_alternating_AorT, newx = x_global_alternating_AorT, s=la.global_alternating_AorT_lambda_1se)

cor(la.model_global_alternating_AorT.train_pred2, y, method="pearson")
# 0.3951711
mean((la.model_global_alternating_AorT.train_pred2 - y)^2)
# 0.2054393

X_global_alternating_AorT_test = dat_test_global_alternating_AorT %>%
  select(-C0_new)
x_global_alternating_AorT_test = sparse.model.matrix(~., data=X_global_alternating_AorT_test)

# Predict values for test dataset:
la.model_global_alternating_AorT.pred = predict(la.model_global_alternating_AorT, newx = x_global_alternating_AorT_test, s=la.global_alternating_AorT_best_lambda)
# Prediction accuracy with test data:
cor(la.model_global_alternating_AorT.pred, y_test, method="pearson")
# 0.3929481
mean((la.model_global_alternating_AorT.pred - y_test)^2)
# 0.2037954

la.model_global_alternating_AorT.pred2 = predict(la.model_global_alternating_AorT, newx = x_global_alternating_AorT_test, s=la.global_alternating_AorT_lambda_1se)
# Prediction accuracy with test data:
cor(la.model_global_alternating_AorT.pred2, y_test, method="pearson")
# 0.3916418
mean((la.model_global_alternating_AorT.pred2 - y_test)^2)
# 0.2048655


X_global_alternating_AorT_random_all = dat_random_all_global_alternating_AorT %>%
  select(-C0_new)
x_global_alternating_AorT_random_all = sparse.model.matrix(~., data=X_global_alternating_AorT_random_all)

# Predict values for random dataset:
la.model_global_alternating_AorT.pred_random_all = predict(la.model_global_alternating_AorT, newx = x_global_alternating_AorT_random_all, s=la.global_alternating_AorT_best_lambda)
# Prediction accuracy with random data:
cor(la.model_global_alternating_AorT.pred_random_all, y_random_all, method="pearson")
# 0.3354103
mean((la.model_global_alternating_AorT.pred_random_all - y_random_all)^2)
# 0.1354627

la.model_global_alternating_AorT.pred2_random_all = predict(la.model_global_alternating_AorT, newx = x_global_alternating_AorT_random_all, s=la.global_alternating_AorT_lambda_1se)
# Prediction accuracy with random data:
cor(la.model_global_alternating_AorT.pred2_random_all, y_random_all, method="pearson")
# 0.3335554
mean((la.model_global_alternating_AorT.pred2_random_all - y_random_all)^2)
# 0.1325015
```

We get test prediction correlation of 0.3929481 and MSE of 0.2037954 with min lasso (4 nonzero)
We get test prediction correlation of 0.3916418 and MSE of 0.2048655 with lasso 1se (3 nonzero)
We get prediction correlation of 0.3354103 on the random library with min lasso
We get prediction correlation of 0.3335554 on the random library with lasso 1se

# Inputs: All Distance Frequency Between AA/TT/AT/TA and CC/GG/CG/GC Dinucleotides Only

```{r}
dist_freq_AorTdi_AorTdi_bid2 = readRDS("data/Created/tiling_dist_freq_AorTdi_AorTdi_bid2.rds")
dist_freq_AorTdi_CorGdi_bid2 = readRDS("data/Created/tiling_dist_freq_AorTdi_CorGdi_bid2.rds")
dist_freq_CorGdi_CorGdi_bid2 = readRDS("data/Created/tiling_dist_freq_CorGdi_CorGdi_bid2.rds")
dist_freq_AorTdi_AorTdi_bid2_test = readRDS("data/Created/tiling_dist_freq_AorTdi_AorTdi_bid2_test.rds")
dist_freq_AorTdi_CorGdi_bid2_test = readRDS("data/Created/tiling_dist_freq_AorTdi_CorGdi_bid2_test.rds")
dist_freq_CorGdi_CorGdi_bid2_test = readRDS("data/Created/tiling_dist_freq_CorGdi_CorGdi_bid2_test.rds")
dist_freq_AorTdi_AorTdi_bid2_random_all = readRDS("data/Created/random_all_dist_freq_AorTdi_AorTdi_bid2.rds")
dist_freq_AorTdi_CorGdi_bid2_random_all = readRDS("data/Created/random_all_dist_freq_AorTdi_CorGdi_bid2.rds")
dist_freq_CorGdi_CorGdi_bid2_random_all = readRDS("data/Created/random_all_dist_freq_CorGdi_CorGdi_bid2.rds")

global_alternating_scores_AorT_train = readRDS("data/Created/tiling_global_alternating_scores_AorT_train.rds")
global_alternating_scores_AorT_test = readRDS("data/Created/tiling_global_alternating_scores_AorT_test.rds")
global_alternating_scores_AorT_random_all = readRDS("data/Created/random_all_global_alternating_scores_AorT.rds")
```

## Simple Linear Model

```{r}
dat_global_alternating_AorT5 = cbind(dist_freq_AorTdi_AorTdi_bid2, 
                                     dist_freq_AorTdi_CorGdi_bid2,
                                     dist_freq_CorGdi_CorGdi_bid2,
                                     global_alternating_scores_AorT_train,
                                     dat %>% select(C0_new))

global_alternating_AorT5_lm = lm(C0_new~., data=dat_global_alternating_AorT5)
cor(global_alternating_AorT5_lm$fitted.values, y)
# 0.5043347

dat_test_global_alternating_AorT5 = cbind(dist_freq_AorTdi_AorTdi_bid2_test,
                                          dist_freq_AorTdi_CorGdi_bid2_test,
                                          dist_freq_CorGdi_CorGdi_bid2_test,
                                          global_alternating_scores_AorT_test,
                                          dat_test %>% select(C0_new))

global_alternating_AorT5_pred = predict(global_alternating_AorT5_lm, 
                                        dat_test_global_alternating_AorT5)

cor(global_alternating_AorT5_pred, y_test)
# 0.5019851

mean((global_alternating_AorT5_pred - y_test)^2)
# 0.1802768

dat_random_all_global_alternating_AorT5 = cbind(dist_freq_AorTdi_AorTdi_bid2_random_all,
                                                dist_freq_AorTdi_CorGdi_bid2_random_all,
                                                dist_freq_CorGdi_CorGdi_bid2_random_all,
                                                global_alternating_scores_AorT_random_all,
                                                dat_random_all %>% select(C0_new))

global_alternating_AorT5_pred_random_all = predict(global_alternating_AorT5_lm, 
                                                   dat_random_all_global_alternating_AorT5)

cor(global_alternating_AorT5_pred_random_all, y_random_all)
# 0.4065005

mean((global_alternating_AorT5_pred_random_all - y_random_all)^2)
# 0.126445
```

We get test prediction correlation of 0.5019851 and MSE of 0.1802768
We get test prediction correlation of 0.4065005 and MSE of 0.126445 on the Random Library

## Lasso Model

```{r}
X_global_alternating_AorT5 = dat_global_alternating_AorT5 %>%
  select(-C0_new)

x_global_alternating_AorT5 = sparse.model.matrix(~., data=X_global_alternating_AorT5)

set.seed(50)
la.model_global_alternating_AorT5 = cv.glmnet(x_global_alternating_AorT5, y, alpha=1, family="gaussian")

la.global_alternating_AorT5_best_lambda = la.model_global_alternating_AorT5$lambda.min

sum(coef(la.model_global_alternating_AorT5, s=la.global_alternating_AorT5_best_lambda) != 0)
# 144

la.global_alternating_AorT5_lambda_1se = la.model_global_alternating_AorT5$lambda.1se

sum(coef(la.model_global_alternating_AorT5, s=la.global_alternating_AorT5_lambda_1se) != 0)
# 81

saveRDS(la.model_global_alternating_AorT5, "model/lasso-global_alternating_AorT5.rds")

la.model_global_alternating_AorT5.train_pred = predict(la.model_global_alternating_AorT5, newx = x_global_alternating_AorT5, s=la.global_alternating_AorT5_best_lambda)

cor(la.model_global_alternating_AorT5.train_pred, y, method="pearson")
# 0.5042084
mean((la.model_global_alternating_AorT5.train_pred - y)^2)
# 0.180736

la.model_global_alternating_AorT5.train_pred2 = predict(la.model_global_alternating_AorT5, newx = x_global_alternating_AorT5, s=la.global_alternating_AorT5_lambda_1se)

cor(la.model_global_alternating_AorT5.train_pred2, y, method="pearson")
# 0.4987573
mean((la.model_global_alternating_AorT5.train_pred2 - y)^2)
# 0.1822772

X_global_alternating_AorT5_test = dat_test_global_alternating_AorT5 %>%
  select(-C0_new)
x_global_alternating_AorT5_test = sparse.model.matrix(~., data=X_global_alternating_AorT5_test)

# Predict values for test dataset:
la.model_global_alternating_AorT5.pred = predict(la.model_global_alternating_AorT5, newx = x_global_alternating_AorT5_test, s=la.global_alternating_AorT5_best_lambda)
# Prediction accuracy with test data:
cor(la.model_global_alternating_AorT5.pred, y_test, method="pearson")
# 0.5019447
mean((la.model_global_alternating_AorT5.pred - y_test)^2)
# 0.1802874

la.model_global_alternating_AorT5.pred2 = predict(la.model_global_alternating_AorT5, newx = x_global_alternating_AorT5_test, s=la.global_alternating_AorT5_lambda_1se)
# Prediction accuracy with test data:
cor(la.model_global_alternating_AorT5.pred2, y_test, method="pearson")
# 0.4968217
mean((la.model_global_alternating_AorT5.pred2 - y_test)^2)
# 0.1817556


X_global_alternating_AorT5_random_all = dat_random_all_global_alternating_AorT5 %>%
  select(-C0_new)
x_global_alternating_AorT5_random_all = sparse.model.matrix(~., data=X_global_alternating_AorT5_random_all)

# Predict values for random dataset:
la.model_global_alternating_AorT5.pred_random_all = predict(la.model_global_alternating_AorT5, newx = x_global_alternating_AorT5_random_all, s=la.global_alternating_AorT5_best_lambda)
# Prediction accuracy with random data:
cor(la.model_global_alternating_AorT5.pred_random_all, y_random_all, method="pearson")
# 0.4067501
mean((la.model_global_alternating_AorT5.pred_random_all - y_random_all)^2)
# 0.1263629

la.model_global_alternating_AorT5.pred2_random_all = predict(la.model_global_alternating_AorT5, newx = x_global_alternating_AorT5_random_all, s=la.global_alternating_AorT5_lambda_1se)
# Prediction accuracy with random data:
cor(la.model_global_alternating_AorT5.pred2_random_all, y_random_all, method="pearson")
# 0.4053231
mean((la.model_global_alternating_AorT5.pred2_random_all - y_random_all)^2)
# 0.1256557
```

We get test prediction correlation of 0.5019447 and MSE of 0.1802874 with min lasso (144 nonzero)
We get test prediction correlation of 0.4968217 and MSE of 0.1817556 with lasso 1se (81 nonzero)
We get prediction correlation of 0.4067501 on the random library with min lasso
We get prediction correlation of 0.4053231 on the random library with lasso 1se

## LightGBM (tree-based) Model

```{r}
library(lightgbm)
source("scripts/functions/lgbm-helper-functions.R")
set.seed(50)
dat_global_alternating_AorT5.lgb_train_set = dat_global_alternating_AorT5 %>%
  select(-C0_new)
dat_global_alternating_AorT5.lgb_train_rules = lgb.convert_with_rules(data = dat_global_alternating_AorT5.lgb_train_set)
dat_global_alternating_AorT5.lgb_train_data = lgb.Dataset(data = as.matrix(dat_global_alternating_AorT5.lgb_train_rules$data),
                                                          label = dat_global_alternating_AorT5$C0_new,
                                                          categorical_feature = handle_categorical(colnames(dat_global_alternating_AorT5.lgb_train_rules$data)))
dat_global_alternating_AorT5.lgb_test_set = dat_test_global_alternating_AorT5 %>%
  select(-C0_new)
dat_global_alternating_AorT5.lgb_test_matrix = as.matrix(lgb.convert_with_rules(data = dat_global_alternating_AorT5.lgb_test_set, rules = dat_global_alternating_AorT5.lgb_train_rules$rules)$data)
dat_global_alternating_AorT5.lgb_test_data = lgb.Dataset(data = dat_global_alternating_AorT5.lgb_test_matrix,
                                                         label = dat_test_global_alternating_AorT5$C0_new,
                                                         categorical_feature = handle_categorical(colnames(dat_global_alternating_AorT5.lgb_test_matrix)))
dat_global_alternating_AorT5.lgb_obj = lightgbm(data = dat_global_alternating_AorT5.lgb_train_data,
                                                params = list(learning_rate = c(0.1),
                                                              objective = c("regression"),
                                                              min_data_in_leaf = 100,
                                                              max_depth = c(5),
                                                              num_leaves = c(1000),
                                                              lambda_l2 = c(1),
                                                              boosting = c("gbdt")),
                                                valids = list(valid = dat_global_alternating_AorT5.lgb_test_data),
                                                nrounds = 8000,
                                                early_stopping_rounds = 50)

dat_global_alternating_AorT5.lgb_train_pred = predict(dat_global_alternating_AorT5.lgb_obj, data = as.matrix(dat_global_alternating_AorT5.lgb_train_rules$data))
cor(dat_global_alternating_AorT5.lgb_train_pred, y, method="pearson")
#  (nrounds = )

dat_global_alternating_AorT5.lgb_test_pred = predict(dat_global_alternating_AorT5.lgb_obj, data = dat_global_alternating_AorT5.lgb_test_matrix)

cor(dat_global_alternating_AorT5.lgb_test_pred, y_test, method="pearson")
#  (nrounds = )

mean((dat_global_alternating_AorT5.lgb_test_pred - y_test)^2)
#  (nrounds = )
```

We get test prediction correlation of  and MSE of 

```{r}
dat_global_alternating_AorT5.feature_importance = as.data.frame(lgb.importance(dat_global_alternating_AorT5.lgb_obj)) %>%
  mutate(Feature = fct_rev(fct_inorder(Feature))) %>%
  dplyr::slice(1:50) %>%
  ggplot(aes(x = Feature, y = Gain)) +
  geom_col(fill = "dodgerblue") +
  coord_flip() +
  theme_bw()
dat_global_alternating_AorT5.feature_importance
```



# Inputs: Counts of Trinucleotides + All Distance Frequency Between Dinucleotides and AA/TT/AT/TA or CC/GG/CG/GC Dinucleotides + Global Alternating Scores A/T

```{r}
nucleotides <- c("A", "C", "G", "T")
dinucleotides <- gtools::permutations(n = 4, r = 2, v = nucleotides,
                                      repeats.allowed = TRUE) %>%
  apply(1, paste, collapse = "")
trinucleotides <- gtools::permutations(n = 4, r = 3, v = nucleotides,
                                       repeats.allowed = TRUE) %>%
  apply(1, paste, collapse = "")

dist_freq_di_AorTdi_bid2 = readRDS("data/Created/tiling_dist_freq_di_AorTdi_bid2.rds")
dist_freq_di_CorGdi_bid2 = readRDS("data/Created/tiling_dist_freq_di_CorGdi_bid2.rds")
dist_freq_di_AorTdi_bid2_test = readRDS("data/Created/tiling_dist_freq_di_AorTdi_bid2_test.rds")
dist_freq_di_CorGdi_bid2_test = readRDS("data/Created/tiling_dist_freq_di_CorGdi_bid2_test.rds")
dist_freq_di_AorTdi_bid2_random_all = readRDS("data/Created/random_all_dist_freq_di_AorTdi_bid2.rds")
dist_freq_di_CorGdi_bid2_random_all = readRDS("data/Created/random_all_dist_freq_di_CorGdi_bid2.rds")

global_alternating_scores_AorT_train = readRDS("data/Created/tiling_global_alternating_scores_AorT_train.rds")
global_alternating_scores_AorT_test = readRDS("data/Created/tiling_global_alternating_scores_AorT_test.rds")
global_alternating_scores_AorT_random_all = readRDS("data/Created/random_all_global_alternating_scores_AorT.rds")
```

## Simple Linear Model

```{r}
dat_global_alternating_AorT4 = cbind(dat %>% 
                                       select(all_of(trinucleotides), C0_new), 
                                     dist_freq_di_AorTdi_bid2,
                                     dist_freq_di_CorGdi_bid2,
                                     global_alternating_scores_AorT_train)

global_alternating_AorT4_lm = lm(C0_new~., data=dat_global_alternating_AorT4)
cor(global_alternating_AorT4_lm$fitted.values, y)
# 0.7420275

dat_test_global_alternating_AorT4 = cbind(dat_test %>% 
                                            select(all_of(trinucleotides), C0_new), 
                                          dist_freq_di_AorTdi_bid2_test,
                                          dist_freq_di_CorGdi_bid2_test,
                                          global_alternating_scores_AorT_test)

global_alternating_AorT4_pred = predict(global_alternating_AorT4_lm, dat_test_global_alternating_AorT4)

cor(global_alternating_AorT4_pred, y_test)
# 0.7398471

mean((global_alternating_AorT4_pred - y_test)^2)
# 0.1091149

dat_random_all_global_alternating_AorT4 = cbind(dat_random_all %>% 
                                                  select(all_of(trinucleotides), C0_new),
                                                dist_freq_di_AorTdi_bid2_random_all,
                                                dist_freq_di_CorGdi_bid2_random_all,
                                                global_alternating_scores_AorT_random_all)

global_alternating_AorT4_pred_random_all = predict(global_alternating_AorT4_lm, dat_random_all_global_alternating_AorT4)

cor(global_alternating_AorT4_pred_random_all, y_random_all)
# 0.6663292

mean((global_alternating_AorT4_pred_random_all - y_random_all)^2)
# 0.08268774
```

We get test prediction correlation of 0.7398471 and MSE of 0.1091149
We get test prediction correlation of 0.6663292 and MSE of 0.08268774 on the Random Library

## LightGBM (tree-based) Model

```{r}
library(lightgbm)
source("scripts/functions/lgbm-helper-functions.R")
set.seed(50)
dat_global_alternating_AorT4.lgb_train_set = dat_global_alternating_AorT4 %>%
  select(-C0_new)
dat_global_alternating_AorT4.lgb_train_rules = lgb.convert_with_rules(data = dat_global_alternating_AorT4.lgb_train_set)
dat_global_alternating_AorT4.lgb_train_data = lgb.Dataset(data = as.matrix(dat_global_alternating_AorT4.lgb_train_rules$data),
                                                          label = dat_global_alternating_AorT4$C0_new,
                                                          categorical_feature = handle_categorical(colnames(dat_global_alternating_AorT4.lgb_train_rules$data)))
dat_global_alternating_AorT4.lgb_test_set = dat_test_global_alternating_AorT4 %>%
  select(-C0_new)
dat_global_alternating_AorT4.lgb_test_matrix = as.matrix(lgb.convert_with_rules(data = dat_global_alternating_AorT4.lgb_test_set, rules = dat_global_alternating_AorT4.lgb_train_rules$rules)$data)
dat_global_alternating_AorT4.lgb_test_data = lgb.Dataset(data = dat_global_alternating_AorT4.lgb_test_matrix,
                                                         label = dat_test_global_alternating_AorT4$C0_new,
                                                         categorical_feature = handle_categorical(colnames(dat_global_alternating_AorT4.lgb_test_matrix)))
dat_global_alternating_AorT4.lgb_obj = lightgbm(data = dat_global_alternating_AorT4.lgb_train_data,
                                                params = list(learning_rate = c(0.1),
                                                              objective = c("regression"),
                                                              min_data_in_leaf = 100,
                                                              max_depth = c(5),
                                                              num_leaves = c(1000),
                                                              lambda_l2 = c(1),
                                                              boosting = c("gbdt")),
                                                valids = list(valid = dat_global_alternating_AorT4.lgb_test_data),
                                                nrounds = 8000,
                                                early_stopping_rounds = 50)

dat_global_alternating_AorT4.lgb_train_pred = predict(dat_global_alternating_AorT4.lgb_obj, data = as.matrix(dat_global_alternating_AorT4.lgb_train_rules$data))
cor(dat_global_alternating_AorT4.lgb_train_pred, y, method="pearson")
# 0.9668618 (nrounds = 3113)

dat_global_alternating_AorT4.lgb_test_pred = predict(dat_global_alternating_AorT4.lgb_obj, data = dat_global_alternating_AorT4.lgb_test_matrix)

cor(dat_global_alternating_AorT4.lgb_test_pred, y_test, method="pearson")
# 0.7676247 (nrounds = 3113)

mean((dat_global_alternating_AorT4.lgb_test_pred - y_test)^2)
# 0.09915998 (nrounds = 3113)

dat_global_alternating_AorT4.lgb_random_all_set = dat_random_all_global_alternating_AorT4 %>%
  select(-C0_new)
dat_global_alternating_AorT4.lgb_random_all_matrix = as.matrix(lgb.convert_with_rules(data = dat_global_alternating_AorT4.lgb_random_all_set, rules = dat_global_alternating_AorT4.lgb_train_rules$rules)$data)

dat_global_alternating_AorT4.lgb_random_all_pred = predict(dat_global_alternating_AorT4.lgb_obj, data = dat_global_alternating_AorT4.lgb_random_all_matrix)

cor(dat_global_alternating_AorT4.lgb_random_all_pred, y_random_all, method="pearson")
# 0.6355069 (nrounds = 3113)

mean((dat_global_alternating_AorT4.lgb_random_all_pred - y_random_all)^2)
# 0.08654615 (nrounds = 3113)
```

We get test prediction correlation of 0.7676247 and MSE of 0.09915998
We get test prediction correlation of 0.6355069 and MSE of 0.08654615 on the Random Library


```{r}
dat_global_alternating_AorT4.feature_importance = as.data.frame(lgb.importance(dat_global_alternating_AorT4.lgb_obj)) %>%
  mutate(Feature = fct_rev(fct_inorder(Feature))) %>%
  dplyr::slice(1:50) %>%
  ggplot(aes(x = Feature, y = Gain)) +
  geom_col(fill = "dodgerblue") +
  coord_flip() +
  theme_bw()
dat_global_alternating_AorT4.feature_importance
```


# Inputs: HRI + Global Alternating Scores A/T

```{r}
HRI = readRDS("data/Created/tiling_HRI.rds")
HRI_test = readRDS("data/Created/tiling_HRI_test.rds")

global_alternating_scores_AorT_train = readRDS("data/Created/tiling_global_alternating_scores_AorT_train.rds")
global_alternating_scores_AorT_test = readRDS("data/Created/tiling_global_alternating_scores_AorT_test.rds")
```

## Simple Linear Model

```{r}
dat_global_alternating_AorT2 = cbind(HRI, global_alternating_scores_AorT_train,
                                     dat %>% select(C0_new))

global_alternating_AorT2_lm = lm(C0_new~., data=dat_global_alternating_AorT2)
cor(global_alternating_AorT2_lm$fitted.values, y)
# 0.5230486

dat_test_global_alternating_AorT2 = cbind(HRI_test, global_alternating_scores_AorT_test,
                                          dat_test %>% select(C0_new))

global_alternating_AorT2_pred = predict(global_alternating_AorT2_lm, dat_test_global_alternating_AorT2)

cor(global_alternating_AorT2_pred, y_test)
# 0.5248339

mean((global_alternating_AorT2_pred - y_test)^2)
# 0.1746287
```

We get test prediction correlation of 0.5248339 and MSE of 0.1746287

## LightGBM (tree-based) Model

```{r}
library(lightgbm)
source("scripts/functions/lgbm-helper-functions.R")
set.seed(50)
dat_global_alternating_AorT2.lgb_train_set = dat_global_alternating_AorT2 %>%
  select(-C0_new)
dat_global_alternating_AorT2.lgb_train_rules = lgb.convert_with_rules(data = dat_global_alternating_AorT2.lgb_train_set)
dat_global_alternating_AorT2.lgb_train_data = lgb.Dataset(data = as.matrix(dat_global_alternating_AorT2.lgb_train_rules$data),
                                     label = dat_global_alternating_AorT2$C0_new,
                                     categorical_feature = handle_categorical(colnames(dat_global_alternating_AorT2.lgb_train_rules$data)))
dat_global_alternating_AorT2.lgb_test_set = dat_test_global_alternating_AorT2 %>%
  select(-C0_new)
dat_global_alternating_AorT2.lgb_test_matrix = as.matrix(lgb.convert_with_rules(data = dat_global_alternating_AorT2.lgb_test_set, rules = dat_global_alternating_AorT2.lgb_train_rules$rules)$data)
dat_global_alternating_AorT2.lgb_test_data = lgb.Dataset(data = dat_global_alternating_AorT2.lgb_test_matrix,
                                    label = dat_test_global_alternating_AorT2$C0_new,
                                    categorical_feature = handle_categorical(colnames(dat_global_alternating_AorT2.lgb_test_matrix)))
dat_global_alternating_AorT2.lgb_obj = lightgbm(data = dat_global_alternating_AorT2.lgb_train_data,
                           params = list(learning_rate = c(0.1),
                                         objective = c("regression"),
                                         min_data_in_leaf = 100,
                                         max_depth = c(5),
                                         num_leaves = c(1000),
                                         lambda_l2 = c(1),
                                         boosting = c("gbdt")),
                           valids = list(valid = dat_global_alternating_AorT2.lgb_test_data),
                           nrounds = 8000,
                           early_stopping_rounds = 50)

dat_global_alternating_AorT2.lgb_train_pred = predict(dat_global_alternating_AorT2.lgb_obj, data = as.matrix(dat_global_alternating_AorT2.lgb_train_rules$data))
cor(dat_global_alternating_AorT2.lgb_train_pred, y, method="pearson")
# 0.9118887 (nrounds = 4697)

dat_global_alternating_AorT2.lgb_test_pred = predict(dat_global_alternating_AorT2.lgb_obj, data = dat_global_alternating_AorT2.lgb_test_matrix)

cor(dat_global_alternating_AorT2.lgb_test_pred, y_test, method="pearson")
# 0.6634254 (nrounds = 4697)

mean((dat_global_alternating_AorT2.lgb_test_pred - y_test)^2)
# 0.1349398 (nrounds = 4697)
```

We get test prediction correlation of 0.6634254 and MSE of 0.1349398

```{r}
dat_global_alternating_AorT2.feature_importance = as.data.frame(lgb.importance(dat_global_alternating_AorT2.lgb_obj)) %>%
  mutate(Feature = fct_rev(fct_inorder(Feature))) %>%
  dplyr::slice(1:50) %>%
  ggplot(aes(x = Feature, y = Gain)) +
  geom_col(fill = "dodgerblue") +
  coord_flip() +
  theme_bw()
dat_global_alternating_AorT2.feature_importance
```

# Inputs: Counts of Trinucleotides + HRI + Global Alternating Scores A/T

```{r}
nucleotides <- c("A", "C", "G", "T")
dinucleotides <- gtools::permutations(n = 4, r = 2, v = nucleotides,
                                      repeats.allowed = TRUE) %>%
  apply(1, paste, collapse = "")
trinucleotides <- gtools::permutations(n = 4, r = 3, v = nucleotides,
                                       repeats.allowed = TRUE) %>%
  apply(1, paste, collapse = "")

HRI = readRDS("data/Created/tiling_HRI.rds")
HRI_test = readRDS("data/Created/tiling_HRI_test.rds")

global_alternating_scores_AorT_train = readRDS("data/Created/tiling_global_alternating_scores_AorT_train.rds")
global_alternating_scores_AorT_test = readRDS("data/Created/tiling_global_alternating_scores_AorT_test.rds")
```

## Simple Linear Model

```{r}
dat_global_alternating_AorT3 = cbind(dat %>% select(all_of(trinucleotides), C0_new), 
                                     HRI, global_alternating_scores_AorT_train)

global_alternating_AorT3_lm = lm(C0_new~., data=dat_global_alternating_AorT3)
cor(global_alternating_AorT3_lm$fitted.values, y)
# 0.6031277

dat_test_global_alternating_AorT3 = cbind(dat_test %>% select(all_of(trinucleotides), C0_new),
                                          HRI_test, global_alternating_scores_AorT_test)

global_alternating_AorT3_pred = predict(global_alternating_AorT3_lm, dat_test_global_alternating_AorT3)

cor(global_alternating_AorT3_pred, y_test)
# 0.6050628

mean((global_alternating_AorT3_pred - y_test)^2)
# 0.1527946
```

We get test prediction correlation of 0.6050628 and MSE of 0.1527946

## LightGBM (tree-based) Model

```{r}
library(lightgbm)
source("scripts/functions/lgbm-helper-functions.R")
set.seed(50)
dat_global_alternating_AorT3.lgb_train_set = dat_global_alternating_AorT3 %>%
  select(-C0_new)
dat_global_alternating_AorT3.lgb_train_rules = lgb.convert_with_rules(data = dat_global_alternating_AorT3.lgb_train_set)
dat_global_alternating_AorT3.lgb_train_data = lgb.Dataset(data = as.matrix(dat_global_alternating_AorT3.lgb_train_rules$data),
                                     label = dat_global_alternating_AorT3$C0_new,
                                     categorical_feature = handle_categorical(colnames(dat_global_alternating_AorT3.lgb_train_rules$data)))
dat_global_alternating_AorT3.lgb_test_set = dat_test_global_alternating_AorT3 %>%
  select(-C0_new)
dat_global_alternating_AorT3.lgb_test_matrix = as.matrix(lgb.convert_with_rules(data = dat_global_alternating_AorT3.lgb_test_set, rules = dat_global_alternating_AorT3.lgb_train_rules$rules)$data)
dat_global_alternating_AorT3.lgb_test_data = lgb.Dataset(data = dat_global_alternating_AorT3.lgb_test_matrix,
                                    label = dat_test_global_alternating_AorT3$C0_new,
                                    categorical_feature = handle_categorical(colnames(dat_global_alternating_AorT3.lgb_test_matrix)))
dat_global_alternating_AorT3.lgb_obj = lightgbm(data = dat_global_alternating_AorT3.lgb_train_data,
                           params = list(learning_rate = c(0.1),
                                         objective = c("regression"),
                                         min_data_in_leaf = 100,
                                         max_depth = c(5),
                                         num_leaves = c(1000),
                                         lambda_l2 = c(1),
                                         boosting = c("gbdt")),
                           valids = list(valid = dat_global_alternating_AorT3.lgb_test_data),
                           nrounds = 8000,
                           early_stopping_rounds = 50)

dat_global_alternating_AorT3.lgb_train_pred = predict(dat_global_alternating_AorT3.lgb_obj, data = as.matrix(dat_global_alternating_AorT3.lgb_train_rules$data))
cor(dat_global_alternating_AorT3.lgb_train_pred, y, method="pearson")
# 0.9243835 (nrounds = 3744)

dat_global_alternating_AorT3.lgb_test_pred = predict(dat_global_alternating_AorT3.lgb_obj, data = dat_global_alternating_AorT3.lgb_test_matrix)

cor(dat_global_alternating_AorT3.lgb_test_pred, y_test, method="pearson")
# 0.7172798 (nrounds = 3744)

mean((dat_global_alternating_AorT3.lgb_test_pred - y_test)^2)
# 0.1170154 (nrounds = 3744)
```

We get test prediction correlation of 0.7172798 and MSE of 0.1170154

```{r}
dat_global_alternating_AorT3.feature_importance = as.data.frame(lgb.importance(dat_global_alternating_AorT3.lgb_obj)) %>%
  mutate(Feature = fct_rev(fct_inorder(Feature))) %>%
  dplyr::slice(1:50) %>%
  ggplot(aes(x = Feature, y = Gain)) +
  geom_col(fill = "dodgerblue") +
  coord_flip() +
  theme_bw()
dat_global_alternating_AorT3.feature_importance
```

# Inputs: Global Alternating Scores A/T mono/di Only

```{r}
library(Matrix)
library(glmnet)
library(sparsegl)

global_alternating_scores_AorT_monodi_train = readRDS("data/Created/tiling_global_alternating_scores_AorT_monodi_train.rds")
global_alternating_scores_AorT_monodi_test = readRDS("data/Created/tiling_global_alternating_scores_AorT_monodi_test.rds")
global_alternating_scores_AorT_monodi_random_all = readRDS("data/Created/random_all_global_alternating_scores_AorT_monodi.rds")
```

## Simple Linear Model

```{r}
dat_global_alternating_AorT_monodi = cbind(global_alternating_scores_AorT_monodi_train,
                                    dat %>% select(C0_new))

global_alternating_AorT_monodi_lm = lm(C0_new~., data=dat_global_alternating_AorT_monodi)
cor(global_alternating_AorT_monodi_lm$fitted.values, y)
# 0.3631306

dat_test_global_alternating_AorT_monodi = cbind(global_alternating_scores_AorT_monodi_test,
                                         dat_test %>% select(C0_new))

global_alternating_AorT_monodi_pred = predict(global_alternating_AorT_monodi_lm, 
                                       dat_test_global_alternating_AorT_monodi)

cor(global_alternating_AorT_monodi_pred, y_test)
# 0.3577585

mean((global_alternating_AorT_monodi_pred - y_test)^2)
# 0.2101618

dat_random_all_global_alternating_AorT_monodi = cbind(global_alternating_scores_AorT_monodi_random_all,
                                                dat_random_all %>% select(C0_new))

global_alternating_AorT_monodi_pred_random_all = predict(global_alternating_AorT_monodi_lm,
                                                   dat_random_all_global_alternating_AorT_monodi)

cor(global_alternating_AorT_monodi_pred_random_all, y_random_all)
# 0.3180481

mean((global_alternating_AorT_monodi_pred_random_all - y_random_all)^2)
# 0.1381091
```

We get test prediction correlation of 0.3577585 and MSE of 0.2101618
We get test prediction correlation of 0.3180481 and MSE of 0.1381091 on the Random Library

## LightGBM (tree-based) Model

```{r}
library(lightgbm)
source("scripts/functions/lgbm-helper-functions.R")
set.seed(50)
dat_global_alternating_AorT_monodi.lgb_train_set = dat_global_alternating_AorT_monodi %>%
  select(-C0_new)
dat_global_alternating_AorT_monodi.lgb_train_rules = lgb.convert_with_rules(data = dat_global_alternating_AorT_monodi.lgb_train_set)
dat_global_alternating_AorT_monodi.lgb_train_data = lgb.Dataset(data = as.matrix(dat_global_alternating_AorT_monodi.lgb_train_rules$data),
                                     label = dat_global_alternating_AorT_monodi$C0_new,
                                     categorical_feature = handle_categorical(colnames(dat_global_alternating_AorT_monodi.lgb_train_rules$data)))
dat_global_alternating_AorT_monodi.lgb_test_set = dat_test_global_alternating_AorT_monodi %>%
  select(-C0_new)
dat_global_alternating_AorT_monodi.lgb_test_matrix = as.matrix(lgb.convert_with_rules(data = dat_global_alternating_AorT_monodi.lgb_test_set, rules = dat_global_alternating_AorT_monodi.lgb_train_rules$rules)$data)
dat_global_alternating_AorT_monodi.lgb_test_data = lgb.Dataset(data = dat_global_alternating_AorT_monodi.lgb_test_matrix,
                                    label = dat_test_global_alternating_AorT_monodi$C0_new,
                                    categorical_feature = handle_categorical(colnames(dat_global_alternating_AorT_monodi.lgb_test_matrix)))
dat_global_alternating_AorT_monodi.lgb_obj = lightgbm(data = dat_global_alternating_AorT_monodi.lgb_train_data,
                           params = list(learning_rate = c(0.1),
                                         objective = c("regression"),
                                         min_data_in_leaf = 100,
                                         max_depth = c(5),
                                         num_leaves = c(1000),
                                         lambda_l2 = c(1),
                                         boosting = c("gbdt")),
                           valids = list(valid = dat_global_alternating_AorT_monodi.lgb_test_data),
                           nrounds = 8000,
                           early_stopping_rounds = 50)

dat_global_alternating_AorT_monodi.lgb_train_pred = predict(dat_global_alternating_AorT_monodi.lgb_obj, data = as.matrix(dat_global_alternating_AorT_monodi.lgb_train_rules$data))
cor(dat_global_alternating_AorT_monodi.lgb_train_pred, y, method="pearson")
# 0.3769492 (nrounds = )

dat_global_alternating_AorT_monodi.lgb_test_pred = predict(dat_global_alternating_AorT_monodi.lgb_obj, data = dat_global_alternating_AorT_monodi.lgb_test_matrix)

cor(dat_global_alternating_AorT_monodi.lgb_test_pred, y_test, method="pearson")
# 0.3662814 (nrounds = )

mean((dat_global_alternating_AorT_monodi.lgb_test_pred - y_test)^2)
# 0.2086723 (nrounds = )
```

We get test prediction correlation of 0.3662814 and MSE of 0.2086723

```{r}
dat_global_alternating_AorT_monodi.feature_importance = as.data.frame(lgb.importance(dat_global_alternating_AorT_monodi.lgb_obj)) %>%
  mutate(Feature = fct_rev(fct_inorder(Feature))) %>%
  dplyr::slice(1:50) %>%
  ggplot(aes(x = Feature, y = Gain)) +
  geom_col(fill = "dodgerblue") +
  coord_flip() +
  theme_bw()
dat_global_alternating_AorT_monodi.feature_importance
```


# Inputs: Global Alternating Scores A/T + Global Alternating Scores A/T mono/di Only

```{r}
library(Matrix)
library(glmnet)
library(sparsegl)

global_alternating_scores_AorT_train = readRDS("data/Created/tiling_global_alternating_scores_AorT_train.rds")
global_alternating_scores_AorT_test = readRDS("data/Created/tiling_global_alternating_scores_AorT_test.rds")
global_alternating_scores_AorT_random_all = readRDS("data/Created/random_all_global_alternating_scores_AorT.rds")

global_alternating_scores_AorT_monodi_train = readRDS("data/Created/tiling_global_alternating_scores_AorT_monodi_train.rds")
global_alternating_scores_AorT_monodi_test = readRDS("data/Created/tiling_global_alternating_scores_AorT_monodi_test.rds")
global_alternating_scores_AorT_monodi_random_all = readRDS("data/Created/random_all_global_alternating_scores_AorT_monodi.rds")
```

## Simple Linear Model

```{r}
dat_global_alternating_AorT_monodi2 = cbind(global_alternating_scores_AorT_train,
                                            global_alternating_scores_AorT_monodi_train,
                                    dat %>% select(C0_new))

global_alternating_AorT_monodi2_lm = lm(C0_new~., data=dat_global_alternating_AorT_monodi2)
cor(global_alternating_AorT_monodi2_lm$fitted.values, y)
# 0.3969212

dat_test_global_alternating_AorT_monodi2 = cbind(global_alternating_scores_AorT_test,
                                                 global_alternating_scores_AorT_monodi_test,
                                         dat_test %>% select(C0_new))

global_alternating_AorT_monodi2_pred = predict(global_alternating_AorT_monodi2_lm, 
                                       dat_test_global_alternating_AorT_monodi2)

cor(global_alternating_AorT_monodi2_pred, y_test)
# 0.3935163

mean((global_alternating_AorT_monodi2_pred - y_test)^2)
# 0.203689

dat_random_all_global_alternating_AorT_monodi2 = cbind(global_alternating_scores_AorT_random_all,
                                                       global_alternating_scores_AorT_monodi_random_all,
                                                dat_random_all %>% select(C0_new))

global_alternating_AorT_monodi2_pred_random_all = predict(global_alternating_AorT_monodi2_lm,
                                                   dat_random_all_global_alternating_AorT_monodi2)

cor(global_alternating_AorT_monodi2_pred_random_all, y_random_all)
# 0.3356963

mean((global_alternating_AorT_monodi2_pred_random_all - y_random_all)^2)
# 0.1354882
```

We get test prediction correlation of 0.3935163 and MSE of 0.203689
We get test prediction correlation of 0.3356963 and MSE of 0.1354882 on the Random Library

## LightGBM (tree-based) Model

```{r}
library(lightgbm)
source("scripts/functions/lgbm-helper-functions.R")
set.seed(50)
dat_global_alternating_AorT_monodi2.lgb_train_set = dat_global_alternating_AorT_monodi2 %>%
  select(-C0_new)
dat_global_alternating_AorT_monodi2.lgb_train_rules = lgb.convert_with_rules(data = dat_global_alternating_AorT_monodi2.lgb_train_set)
dat_global_alternating_AorT_monodi2.lgb_train_data = lgb.Dataset(data = as.matrix(dat_global_alternating_AorT_monodi2.lgb_train_rules$data),
                                     label = dat_global_alternating_AorT_monodi2$C0_new,
                                     categorical_feature = handle_categorical(colnames(dat_global_alternating_AorT_monodi2.lgb_train_rules$data)))
dat_global_alternating_AorT_monodi2.lgb_test_set = dat_test_global_alternating_AorT_monodi2 %>%
  select(-C0_new)
dat_global_alternating_AorT_monodi2.lgb_test_matrix = as.matrix(lgb.convert_with_rules(data = dat_global_alternating_AorT_monodi2.lgb_test_set, rules = dat_global_alternating_AorT_monodi2.lgb_train_rules$rules)$data)
dat_global_alternating_AorT_monodi2.lgb_test_data = lgb.Dataset(data = dat_global_alternating_AorT_monodi2.lgb_test_matrix,
                                    label = dat_test_global_alternating_AorT_monodi2$C0_new,
                                    categorical_feature = handle_categorical(colnames(dat_global_alternating_AorT_monodi2.lgb_test_matrix)))
dat_global_alternating_AorT_monodi2.lgb_obj = lightgbm(data = dat_global_alternating_AorT_monodi2.lgb_train_data,
                           params = list(learning_rate = c(0.1),
                                         objective = c("regression"),
                                         min_data_in_leaf = 100,
                                         max_depth = c(5),
                                         num_leaves = c(1000),
                                         lambda_l2 = c(1),
                                         boosting = c("gbdt")),
                           valids = list(valid = dat_global_alternating_AorT_monodi2.lgb_test_data),
                           nrounds = 8000,
                           early_stopping_rounds = 50)

dat_global_alternating_AorT_monodi2.lgb_train_pred = predict(dat_global_alternating_AorT_monodi2.lgb_obj, data = as.matrix(dat_global_alternating_AorT_monodi2.lgb_train_rules$data))
cor(dat_global_alternating_AorT_monodi2.lgb_train_pred, y, method="pearson")
#  (nrounds = )

dat_global_alternating_AorT_monodi2.lgb_test_pred = predict(dat_global_alternating_AorT_monodi2.lgb_obj, data = dat_global_alternating_AorT_monodi2.lgb_test_matrix)

cor(dat_global_alternating_AorT_monodi2.lgb_test_pred, y_test, method="pearson")
#  (nrounds = )

mean((dat_global_alternating_AorT_monodi2.lgb_test_pred - y_test)^2)
#  (nrounds = )
```

We get test prediction correlation of  and MSE of 

```{r}
dat_global_alternating_AorT_monodi2.feature_importance = as.data.frame(lgb.importance(dat_global_alternating_AorT_monodi2.lgb_obj)) %>%
  mutate(Feature = fct_rev(fct_inorder(Feature))) %>%
  dplyr::slice(1:50) %>%
  ggplot(aes(x = Feature, y = Gain)) +
  geom_col(fill = "dodgerblue") +
  coord_flip() +
  theme_bw()
dat_global_alternating_AorT_monodi2.feature_importance
```


# Inputs: Deep Learning Outputs Only

## First Convolutional Layer (48 features with a 3x4 kernel)

### Full IR+LSTM

```{r}
dat_first_conv = readRDS("data/Created/tiling_tiling_first_conv_output_train.rds")
dat_first_conv_test = readRDS("data/Created/tiling_tiling_first_conv_output_test.rds")
dat_first_conv_random_test = readRDS("data/Created/tiling_random_first_conv_output_test.rds")
```


```{r}
dat_first_conv$Y = y
dat_first_conv_test$Y = y_test

lm.model_first_conv = lm(Y~., data = dat_first_conv)

# Prediction accuracy with train data:
cor(lm.model_first_conv$fitted.values, y, method="pearson")
# 0.4284545
mean((lm.model_first_conv$fitted.values - y)^2)
# 0.1978583

# Predict values for test dataset:
lm.model_first_conv.pred = predict(lm.model_first_conv, newdata = dat_first_conv_test)

# Prediction accuracy with test data:
cor(lm.model_first_conv.pred, y_test, method="pearson")
# 0.3750475
mean((lm.model_first_conv.pred - y_test)^2)
# 0.2080921

# Predict values for random test dataset:
lm.model_first_conv.pred_random = predict(lm.model_first_conv, newdata = dat_first_conv_random_test)

# Prediction accuracy with random test data:
cor(lm.model_first_conv.pred_random, dat_random_test$C0_new, method="pearson")
# 0.3475562
mean((lm.model_first_conv.pred_random - dat_random_test$C0_new)^2)
# 0.1415637
```

We get test prediction correlation of 0.3750475 and MSE of 0.2080921


### 1 Convolutional Layer Only

```{r}
dat_first_conv.conv_only = readRDS("data/Created/tiling_tiling_first_conv_output_train_conv_only.rds")
dat_first_conv_test.conv_only = readRDS("data/Created/tiling_tiling_first_conv_output_test_conv_only.rds")
dat_first_conv_random_test.conv_only = readRDS("data/Created/tiling_random_first_conv_output_test_conv_only.rds")
```

```{r}
dat_first_conv.conv_only$Y = y
dat_first_conv_test.conv_only$Y = y_test

lm.model_first_conv.conv_only = lm(Y~., data = dat_first_conv.conv_only)

# Prediction accuracy with train data:
cor(lm.model_first_conv.conv_only$fitted.values, y, method="pearson")
# 0.3893855
mean((lm.model_first_conv.conv_only$fitted.values - y)^2)
# 0.2056017

# Predict values for test dataset:
lm.model_first_conv.conv_only.pred = predict(lm.model_first_conv.conv_only, newdata = dat_first_conv_test.conv_only)

# Prediction accuracy with test data:
cor(lm.model_first_conv.conv_only.pred, y_test, method="pearson")
# 0.382352
mean((lm.model_first_conv.conv_only.pred - y_test)^2)
# 0.2058592

# Predict values for random test dataset:
lm.model_first_conv.conv_only.pred_random = predict(lm.model_first_conv.conv_only, newdata = dat_first_conv_random_test.conv_only)

# Prediction accuracy with random test data:
cor(lm.model_first_conv.conv_only.pred_random, dat_random_test$C0_new, method="pearson")
# 0.3646981
mean((lm.model_first_conv.conv_only.pred_random - dat_random_test$C0_new)^2)
# 0.1365954
```

We get test prediction correlation of 0.382352 and MSE of 0.2058592


### 2 Convolutional Layers Only

```{r}
dat_first_conv.2conv_only = readRDS("data/Created/tiling_tiling_first_conv_output_train_2conv_only.rds")
dat_first_conv_test.2conv_only = readRDS("data/Created/tiling_tiling_first_conv_output_test_2conv_only.rds")
dat_first_conv_random_test.2conv_only = readRDS("data/Created/tiling_random_first_conv_output_test_2conv_only.rds")
```

```{r}
dat_first_conv.2conv_only$Y = y
dat_first_conv_test.2conv_only$Y = y_test

lm.model_first_conv.2conv_only = lm(Y~., data = dat_first_conv.2conv_only)

# Prediction accuracy with train data:
cor(lm.model_first_conv.2conv_only$fitted.values, y, method="pearson")
# 0.4280499
mean((lm.model_first_conv.2conv_only$fitted.values - y)^2)
# 0.1979422

# Predict values for test dataset:
lm.model_first_conv.2conv_only.pred = predict(lm.model_first_conv.2conv_only, newdata = dat_first_conv_test.2conv_only)

# Prediction accuracy with test data:
cor(lm.model_first_conv.2conv_only.pred, y_test, method="pearson")
# 0.3752532
mean((lm.model_first_conv.2conv_only.pred - y_test)^2)
# 0.2080177

# Predict values for random test dataset:
lm.model_first_conv.2conv_only.pred_random = predict(lm.model_first_conv.2conv_only, newdata = dat_first_conv_random_test.2conv_only)

# Prediction accuracy with random test data:
cor(lm.model_first_conv.2conv_only.pred_random, dat_random_test$C0_new, method="pearson")
# 0.3480044
mean((lm.model_first_conv.2conv_only.pred_random - dat_random_test$C0_new)^2)
# 0.1413333
```

We get test prediction correlation of 0.3752532 and MSE of 0.2080177

### 1 Convolutional Layer + LSTM

```{r}
dat_first_conv.1conv_lstm = readRDS("data/Created/tiling_tiling_first_conv_output_train_1conv_lstm.rds")
dat_first_conv_test.1conv_lstm = readRDS("data/Created/tiling_tiling_first_conv_output_test_1conv_lstm.rds")
dat_first_conv_random_test.1conv_lstm = readRDS("data/Created/tiling_random_first_conv_output_test_1conv_lstm.rds")
```

```{r}
dat_first_conv.1conv_lstm$C0_new = y
dat_first_conv_test.1conv_lstm$C0_new = y_test

lm.model_first_conv.1conv_lstm = lm(C0_new~., data = dat_first_conv.1conv_lstm)

# Prediction accuracy with train data:
cor(lm.model_first_conv.1conv_lstm$fitted.values, y, method="pearson")
# 0.413474
mean((lm.model_first_conv.1conv_lstm$fitted.values - y)^2)
# 0.2009148

# Predict values for test dataset:
lm.model_first_conv.1conv_lstm.pred = predict(lm.model_first_conv.1conv_lstm, newdata = dat_first_conv_test.1conv_lstm)

# Prediction accuracy with test data:
cor(lm.model_first_conv.1conv_lstm.pred, y_test, method="pearson")
# 0.3791699
mean((lm.model_first_conv.1conv_lstm.pred - y_test)^2)
# 0.2068505

# Predict values for random test dataset:
lm.model_first_conv.1conv_lstm.pred_random = predict(lm.model_first_conv.1conv_lstm, newdata = dat_first_conv_random_test.1conv_lstm)

# Prediction accuracy with random test data:
cor(lm.model_first_conv.1conv_lstm.pred_random, dat_random_test$C0_new, method="pearson")
# 0.3628867
mean((lm.model_first_conv.1conv_lstm.pred_random - dat_random_test$C0_new)^2)
# 0.1374215
```

We get test prediction correlation of 0.3791699 and MSE of 0.2068505



## First Convolutional Layer (16 features with a 3x4 kernel)

### 1 Convolutional Layer Only

```{r}
dat_first_conv.conv_only_2 = readRDS("data/Created/tiling_tiling_first_conv_output_train_conv_only_2.rds")
dat_test_first_conv.conv_only_2 = readRDS("data/Created/tiling_tiling_first_conv_output_test_conv_only_2.rds")
dat_first_conv_random_test.conv_only_2 = readRDS("data/Created/tiling_random_first_conv_output_test_conv_only_2.rds")
```

#### Simple Linear Model

```{r}
dat_first_conv.conv_only_2$C0_new = y
dat_test_first_conv.conv_only_2$C0_new = y_test

lm.model_first_conv.conv_only_2 = lm(C0_new~., data = dat_first_conv.conv_only_2)

# Prediction accuracy with train data:
cor(lm.model_first_conv.conv_only_2$fitted.values, y, method="pearson")
# 0.3885772
mean((lm.model_first_conv.conv_only_2$fitted.values - y)^2)
# 0.2057541

# Predict values for test dataset:
lm.model_first_conv.conv_only_2.pred = predict(lm.model_first_conv.conv_only_2, newdata = dat_first_conv_test.conv_only_2)

# Prediction accuracy with test data:
cor(lm.model_first_conv.conv_only_2.pred, y_test, method="pearson")
# 0.3783012
mean((lm.model_first_conv.conv_only_2.pred - y_test)^2)
# 0.2066198

# Predict values for random test dataset:
lm.model_first_conv.conv_only_2.pred_random = predict(lm.model_first_conv.conv_only_2, newdata = dat_first_conv_random_test.conv_only_2)

# Prediction accuracy with random test data:
cor(lm.model_first_conv.conv_only_2.pred_random, dat_random_test$C0_new, method="pearson")
# 0.3758269
mean((lm.model_first_conv.conv_only_2.pred_random - dat_random_test$C0_new)^2)
# 0.1341676
```

We get test prediction correlation of 0.3783012 and MSE of 0.2066198

#### LightGBM (tree-based) Model

```{r}
library(lightgbm)
source("scripts/functions/lgbm-helper-functions.R")
set.seed(50)
dat_first_conv.conv_only_2.lgb_train_set = dat_first_conv.conv_only_2 %>%
  select(-C0_new)
dat_first_conv.conv_only_2.lgb_train_rules = lgb.convert_with_rules(data = dat_first_conv.conv_only_2.lgb_train_set)
dat_first_conv.conv_only_2.lgb_train_data = lgb.Dataset(data = as.matrix(dat_first_conv.conv_only_2.lgb_train_rules$data),
                                                        label = dat_first_conv.conv_only_2$C0_new)
dat_first_conv.conv_only_2.lgb_test_set = dat_test_first_conv.conv_only_2 %>%
  select(-C0_new)
dat_first_conv.conv_only_2.lgb_test_matrix = as.matrix(lgb.convert_with_rules(data = dat_first_conv.conv_only_2.lgb_test_set, rules = dat_first_conv.conv_only_2.lgb_train_rules$rules)$data)
dat_first_conv.conv_only_2.lgb_test_data = lgb.Dataset(data = dat_first_conv.conv_only_2.lgb_test_matrix,
                                                       label = dat_test_first_conv.conv_only_2$C0_new,
                                                       categorical_feature = handle_categorical(colnames(dat_first_conv.conv_only_2.lgb_test_matrix)))
dat_first_conv.conv_only_2.lgb_obj = lightgbm(data = dat_first_conv.conv_only_2.lgb_train_data,
                                              params = list(learning_rate = c(0.1),
                                                            objective = c("regression"),
                                                            min_data_in_leaf = 100,
                                                            max_depth = c(5),
                                                            num_leaves = c(1000),
                                                            lambda_l2 = c(1),
                                                            boosting = c("gbdt")),
                                              valids = list(valid = dat_first_conv.conv_only_2.lgb_test_data),
                                              nrounds = 4000,
                                              early_stopping_rounds = 50)

dat_first_conv.conv_only_2.lgb_train_pred = predict(dat_first_conv.conv_only_2.lgb_obj, data = as.matrix(dat_first_conv.conv_only_2.lgb_train_rules$data))
cor(dat_first_conv.conv_only_2.lgb_train_pred, y, method="pearson")
# 0.9795161 (nrounds = 4000)

dat_first_conv.conv_only_2.lgb_test_pred = predict(dat_first_conv.conv_only_2.lgb_obj, data = dat_first_conv.conv_only_2.lgb_test_matrix)

cor(dat_first_conv.conv_only_2.lgb_test_pred, y_test, method="pearson")
# 0.6947794 (nround = 4000)

mean((dat_first_conv.conv_only_2.lgb_test_pred - y_test)^2)
# 0.1257686 (nround = 4000)

dat_first_conv.conv_only_2.lgb_random_test_set = dat_first_conv_random_test.conv_only_2
dat_first_conv.conv_only_2.lgb_random_test_matrix = as.matrix(lgb.convert_with_rules(data = dat_first_conv.conv_only_2.lgb_random_test_set, rules = dat_first_conv.conv_only_2.lgb_train_rules$rules)$data)

dat_first_conv.conv_only_2.lgb_random_test_pred = predict(dat_first_conv.conv_only_2.lgb_obj, data = dat_first_conv.conv_only_2.lgb_random_test_matrix)

cor(dat_first_conv.conv_only_2.lgb_random_test_pred, y_random_test, method="pearson")
# 0.6155096 (nround = 4000)

mean((dat_first_conv.conv_only_2.lgb_random_test_pred - y_random_test)^2)
# 0.09554299 (nround = 4000)
```

We get test prediction correlation of 0.6947794 and MSE of 0.1257686

```{r}
as.data.frame(lgb.importance(dat_first_conv.conv_only_2.lgb_obj)) %>%
  mutate(Feature = fct_rev(fct_inorder(Feature))) %>%
  dplyr::slice(1:50) %>%
  ggplot(aes(x = Feature, y = Gain)) +
  geom_col(fill = "dodgerblue") +
  coord_flip() +
  theme_bw()
```


#### Polynomial Regression Model

```{r}
poly2.model_fist_conv.conv_only_2.features = colnames(dat_first_conv.conv_only_2)[which(apply(dat_first_conv.conv_only_2, 2, function(col){
  length(unique(col))
}) > 2)]
poly2.model_fist_conv.conv_only_2.formula = as.formula(paste0("Y~",paste(paste0("poly(", poly2.model_fist_conv.conv_only_2.features[-length(poly2.model_fist_conv.conv_only_2.features)], ", 2)"), collapse = "+")))

poly2.model_first_conv.conv_only_2 = lm(poly2.model_fist_conv.conv_only_2.formula, data=dat_first_conv.conv_only_2)

# Prediction accuracy with train data:
cor(poly2.model_first_conv.conv_only_2$fitted.values, y, method="pearson")
# 0.4005887
mean((poly2.model_first_conv.conv_only_2$fitted.values - y)^2)
# 0.2034569

# Predict values for test dataset:
poly2.model_first_conv.conv_only_2.pred = predict(poly2.model_first_conv.conv_only_2, newdata = dat_first_conv_test.conv_only_2)

# Prediction accuracy with test data:
cor(poly2.model_first_conv.conv_only_2.pred, y_test, method="pearson")
# 0.3722718
mean((poly2.model_first_conv.conv_only_2.pred - y_test)^2)
# 0.2079499

# Predict values for random test dataset:
poly2.model_first_conv.conv_only_2.pred_random = predict(poly2.model_first_conv.conv_only_2, newdata = dat_first_conv_random_test.conv_only_2)

# Prediction accuracy with random test data:
cor(poly2.model_first_conv.conv_only_2.pred_random, dat_random_test$C0_new, method="pearson")
# 0.3605024
mean((poly2.model_first_conv.conv_only_2.pred_random - dat_random_test$C0_new)^2)
# 0.1362268
```

We get test prediction correlation of  and MSE of 


## First Convolutional Layer (8 features with a 3x4 kernel)

### 1 Convolutional Layer Only

```{r}
dat_first_conv.conv_only_5 = readRDS("data/Created/tiling_tiling_first_conv_output_train_conv_only_5.rds")
dat_test_first_conv.conv_only_5 = readRDS("data/Created/tiling_tiling_first_conv_output_test_conv_only_5.rds")
dat_first_conv_random_test.conv_only_5 = readRDS("data/Created/tiling_random_first_conv_output_test_conv_only_5.rds")
```

#### Simple Linear Model

```{r}
dat_first_conv.conv_only_5$C0_new = y
dat_test_first_conv.conv_only_5$C0_new = y_test

lm.model_first_conv.conv_only_5 = lm(C0_new~., data = dat_first_conv.conv_only_5)

# Prediction accuracy with train data:
cor(lm.model_first_conv.conv_only_5$fitted.values, y, method="pearson")
# 0.3753569
mean((lm.model_first_conv.conv_only_5$fitted.values - y)^2)
# 0.2082017

# Predict values for test dataset:
lm.model_first_conv.conv_only_5.pred = predict(lm.model_first_conv.conv_only_5, newdata = dat_test_first_conv.conv_only_5)

# Prediction accuracy with test data:
cor(lm.model_first_conv.conv_only_5.pred, y_test, method="pearson")
# 0.3735964
mean((lm.model_first_conv.conv_only_5.pred - y_test)^2)
# 0.2074167

# Predict values for random test dataset:
lm.model_first_conv.conv_only_5.pred_random = predict(lm.model_first_conv.conv_only_5, newdata = dat_first_conv_random_test.conv_only_5)

# Prediction accuracy with random test data:
cor(lm.model_first_conv.conv_only_5.pred_random, dat_random_test$C0_new, method="pearson")
# 0.3728421
mean((lm.model_first_conv.conv_only_5.pred_random - dat_random_test$C0_new)^2)
# 0.1349768
```

We get test prediction correlation of 0.3735964 and MSE of 0.2074167

#### LightGBM (tree-based) Model

```{r}
library(lightgbm)
source("scripts/functions/lgbm-helper-functions.R")
set.seed(50)
dat_first_conv.conv_only_5.lgb_train_set = dat_first_conv.conv_only_5 %>%
  select(-C0_new)
dat_first_conv.conv_only_5.lgb_train_rules = lgb.convert_with_rules(data = dat_first_conv.conv_only_5.lgb_train_set)
dat_first_conv.conv_only_5.lgb_train_data = lgb.Dataset(data = as.matrix(dat_first_conv.conv_only_5.lgb_train_rules$data),
                                                        label = dat_first_conv.conv_only_5$C0_new)
dat_first_conv.conv_only_5.lgb_test_set = dat_test_first_conv.conv_only_5 %>%
  select(-C0_new)
dat_first_conv.conv_only_5.lgb_test_matrix = as.matrix(lgb.convert_with_rules(data = dat_first_conv.conv_only_5.lgb_test_set, rules = dat_first_conv.conv_only_5.lgb_train_rules$rules)$data)
dat_first_conv.conv_only_5.lgb_test_data = lgb.Dataset(data = dat_first_conv.conv_only_5.lgb_test_matrix,
                                                       label = dat_test_first_conv.conv_only_5$C0_new,
                                                       categorical_feature = handle_categorical(colnames(dat_first_conv.conv_only_5.lgb_test_matrix)))
dat_first_conv.conv_only_5.lgb_obj = lightgbm(data = dat_first_conv.conv_only_5.lgb_train_data,
                                              params = list(learning_rate = c(0.1),
                                                            objective = c("regression"),
                                                            min_data_in_leaf = 100,
                                                            max_depth = c(5),
                                                            num_leaves = c(1000),
                                                            lambda_l2 = c(1),
                                                            boosting = c("gbdt")),
                                              valids = list(valid = dat_first_conv.conv_only_5.lgb_test_data),
                                              nrounds = 4000,
                                              early_stopping_rounds = 50)

dat_first_conv.conv_only_5.lgb_train_pred = predict(dat_first_conv.conv_only_5.lgb_obj, data = as.matrix(dat_first_conv.conv_only_5.lgb_train_rules$data))
cor(dat_first_conv.conv_only_5.lgb_train_pred, y, method="pearson")
# 0.9769374 (nrounds = 4000)

dat_first_conv.conv_only_5.lgb_test_pred = predict(dat_first_conv.conv_only_5.lgb_obj, data = dat_first_conv.conv_only_5.lgb_test_matrix)

cor(dat_first_conv.conv_only_5.lgb_test_pred, y_test, method="pearson")
# 0.6074975 (nround = 4000)

mean((dat_first_conv.conv_only_5.lgb_test_pred - y_test)^2)
# 0.1524462 (nround = 4000)
```

We get test prediction correlation of 0.6074975 and MSE of 0.1524462

```{r}
as.data.frame(lgb.importance(dat_first_conv.conv_only_5.lgb_obj)) %>%
  mutate(Feature = fct_rev(fct_inorder(Feature))) %>%
  dplyr::slice(1:50) %>%
  ggplot(aes(x = Feature, y = Gain)) +
  geom_col(fill = "dodgerblue") +
  coord_flip() +
  theme_bw()
```



## First Convolutional Layer (4 features with a 3x4 kernel)

### 1 Convolutional Layer Only

```{r}
dat_first_conv.conv_only_4 = readRDS("data/Created/tiling_tiling_first_conv_output_train_conv_only_4.rds")
dat_test_first_conv.conv_only_4 = readRDS("data/Created/tiling_tiling_first_conv_output_test_conv_only_4.rds")
dat_first_conv_random_test.conv_only_4 = readRDS("data/Created/tiling_random_first_conv_output_test_conv_only_4.rds")
```

#### Simple Linear Model

```{r}
dat_first_conv.conv_only_4$C0_new = y
dat_test_first_conv.conv_only_4$C0_new = y_test

lm.model_first_conv.conv_only_4 = lm(C0_new~., data = dat_first_conv.conv_only_4)

# Prediction accuracy with train data:
cor(lm.model_first_conv.conv_only_4$fitted.values, y, method="pearson")
# 0.3521216
mean((lm.model_first_conv.conv_only_4$fitted.values - y)^2)
# 0.2122981

# Predict values for test dataset:
lm.model_first_conv.conv_only_4.pred = predict(lm.model_first_conv.conv_only_4, newdata = dat_test_first_conv.conv_only_4)

# Prediction accuracy with test data:
cor(lm.model_first_conv.conv_only_4.pred, y_test, method="pearson")
# 0.3573703
mean((lm.model_first_conv.conv_only_4.pred - y_test)^2)
# 0.2102263

# Predict values for random test dataset:
lm.model_first_conv.conv_only_4.pred_random = predict(lm.model_first_conv.conv_only_4, newdata = dat_first_conv_random_test.conv_only_4)

# Prediction accuracy with random test data:
cor(lm.model_first_conv.conv_only_4.pred_random, dat_random_test$C0_new, method="pearson")
# 0.351004
mean((lm.model_first_conv.conv_only_4.pred_random - dat_random_test$C0_new)^2)
# 0.1365978
```

We get test prediction correlation of 0.3573703 and MSE of 0.2102263

#### LightGBM (tree-based) Model

```{r}
library(lightgbm)
source("scripts/functions/lgbm-helper-functions.R")
set.seed(50)
dat_first_conv.conv_only_4.lgb_train_set = dat_first_conv.conv_only_4 %>%
  select(-C0_new)
dat_first_conv.conv_only_4.lgb_train_rules = lgb.convert_with_rules(data = dat_first_conv.conv_only_4.lgb_train_set)
dat_first_conv.conv_only_4.lgb_train_data = lgb.Dataset(data = as.matrix(dat_first_conv.conv_only_4.lgb_train_rules$data),
                                                        label = dat_first_conv.conv_only_4$C0_new)
dat_first_conv.conv_only_4.lgb_test_set = dat_test_first_conv.conv_only_4 %>%
  select(-C0_new)
dat_first_conv.conv_only_4.lgb_test_matrix = as.matrix(lgb.convert_with_rules(data = dat_first_conv.conv_only_4.lgb_test_set, rules = dat_first_conv.conv_only_4.lgb_train_rules$rules)$data)
dat_first_conv.conv_only_4.lgb_test_data = lgb.Dataset(data = dat_first_conv.conv_only_4.lgb_test_matrix,
                                                       label = dat_test_first_conv.conv_only_4$C0_new,
                                                       categorical_feature = handle_categorical(colnames(dat_first_conv.conv_only_4.lgb_test_matrix)))
dat_first_conv.conv_only_4.lgb_obj = lightgbm(data = dat_first_conv.conv_only_4.lgb_train_data,
                                              params = list(learning_rate = c(0.1),
                                                            objective = c("regression"),
                                                            min_data_in_leaf = 100,
                                                            max_depth = c(5),
                                                            num_leaves = c(1000),
                                                            lambda_l2 = c(1),
                                                            boosting = c("gbdt")),
                                              valids = list(valid = dat_first_conv.conv_only_4.lgb_test_data),
                                              nrounds = 4000,
                                              early_stopping_rounds = 50)

dat_first_conv.conv_only_4.lgb_train_pred = predict(dat_first_conv.conv_only_4.lgb_obj, data = as.matrix(dat_first_conv.conv_only_4.lgb_train_rules$data))
cor(dat_first_conv.conv_only_4.lgb_train_pred, y, method="pearson")
# 0.9739504 (nrounds = 4000)

dat_first_conv.conv_only_4.lgb_test_pred = predict(dat_first_conv.conv_only_4.lgb_obj, data = dat_first_conv.conv_only_4.lgb_test_matrix)

cor(dat_first_conv.conv_only_4.lgb_test_pred, y_test, method="pearson")
# 0.6209095 (nround = 4000)

mean((dat_first_conv.conv_only_4.lgb_test_pred - y_test)^2)
# 0.1486317 (nround = 4000)
```

We get test prediction correlation of 0.6209095 and MSE of 0.1486317

```{r}
as.data.frame(lgb.importance(dat_first_conv.conv_only_4.lgb_obj)) %>%
  mutate(Feature = fct_rev(fct_inorder(Feature))) %>%
  dplyr::slice(1:50) %>%
  ggplot(aes(x = Feature, y = Gain)) +
  geom_col(fill = "dodgerblue") +
  coord_flip() +
  theme_bw()
```


## First Convolutional Layer (48 features with a 5x4 kernel)

### 1 Convolutional Layer Only

```{r}
dat_first_conv.conv_only_3 = readRDS("data/Created/tiling_tiling_first_conv_output_train_conv_only_3.rds")
dat_test_first_conv.conv_only_3 = readRDS("data/Created/tiling_tiling_first_conv_output_test_conv_only_3.rds")
dat_first_conv_random_test.conv_only_3 = readRDS("data/Created/tiling_random_first_conv_output_test_conv_only_3.rds")
```

#### Simple Linear Model

```{r}
dat_first_conv.conv_only_3$C0_new = y
dat_test_first_conv.conv_only_3$C0_new = y_test

lm.model_first_conv.conv_only_3 = lm(C0_new~., data = dat_first_conv.conv_only_3)

# Prediction accuracy with train data:
cor(lm.model_first_conv.conv_only_3$fitted.values, y, method="pearson")
# 0.4422794
mean((lm.model_first_conv.conv_only_3$fitted.values - y)^2)
# 0.1949409

# Predict values for test dataset:
lm.model_first_conv.conv_only_3.pred = predict(lm.model_first_conv.conv_only_3, newdata = dat_test_first_conv.conv_only_3)

# Prediction accuracy with test data:
cor(lm.model_first_conv.conv_only_3.pred, y_test, method="pearson")
# 0.4450278
mean((lm.model_first_conv.conv_only_3.pred - y_test)^2)
# 0.1932971

# Predict values for random test dataset:
lm.model_first_conv.conv_only_3.pred_random = predict(lm.model_first_conv.conv_only_3, newdata = dat_first_conv_random_test.conv_only_3)

# Prediction accuracy with random test data:
cor(lm.model_first_conv.conv_only_3.pred_random, dat_random_test$C0_new, method="pearson")
# 0.4253016
mean((lm.model_first_conv.conv_only_3.pred_random - dat_random_test$C0_new)^2)
# 0.1279992
```

We get test prediction correlation of 0.4450278 and MSE of 0.1932971

#### LightGBM (tree-based) Model

```{r}
library(lightgbm)
source("scripts/functions/lgbm-helper-functions.R")
set.seed(50)
dat_first_conv.conv_only_3.lgb_train_set = dat_first_conv.conv_only_3 %>%
  select(-C0_new)
dat_first_conv.conv_only_3.lgb_train_rules = lgb.convert_with_rules(data = dat_first_conv.conv_only_3.lgb_train_set)
dat_first_conv.conv_only_3.lgb_train_data = lgb.Dataset(data = as.matrix(dat_first_conv.conv_only_3.lgb_train_rules$data),
                                                        label = dat_first_conv.conv_only_3$C0_new)
dat_first_conv.conv_only_3.lgb_test_set = dat_test_first_conv.conv_only_3 %>%
  select(-C0_new)
dat_first_conv.conv_only_3.lgb_test_matrix = as.matrix(lgb.convert_with_rules(data = dat_first_conv.conv_only_3.lgb_test_set, rules = dat_first_conv.conv_only_3.lgb_train_rules$rules)$data)
dat_first_conv.conv_only_3.lgb_test_data = lgb.Dataset(data = dat_first_conv.conv_only_3.lgb_test_matrix,
                                                       label = dat_test_first_conv.conv_only_3$C0_new,
                                                       categorical_feature = handle_categorical(colnames(dat_first_conv.conv_only_3.lgb_test_matrix)))
dat_first_conv.conv_only_3.lgb_obj = lightgbm(data = dat_first_conv.conv_only_3.lgb_train_data,
                                              params = list(learning_rate = c(0.1),
                                                            objective = c("regression"),
                                                            min_data_in_leaf = 100,
                                                            max_depth = c(5),
                                                            num_leaves = c(1000),
                                                            lambda_l2 = c(1),
                                                            boosting = c("gbdt")),
                                              valids = list(valid = dat_first_conv.conv_only_3.lgb_test_data),
                                              nrounds = 4000,
                                              early_stopping_rounds = 50)

dat_first_conv.conv_only_3.lgb_train_pred = predict(dat_first_conv.conv_only_3.lgb_obj, data = as.matrix(dat_first_conv.conv_only_3.lgb_train_rules$data))
cor(dat_first_conv.conv_only_3.lgb_train_pred, y, method="pearson")
# 0.9677265 (nrounds = 4000)

dat_first_conv.conv_only_3.lgb_test_pred = predict(dat_first_conv.conv_only_3.lgb_obj, data = dat_first_conv.conv_only_3.lgb_test_matrix)

cor(dat_first_conv.conv_only_3.lgb_test_pred, y_test, method="pearson")
# 0.6471225 (nround = 4000)

mean((dat_first_conv.conv_only_3.lgb_test_pred - y_test)^2)
# 0.140736 (nround = 4000)
```

We get test prediction correlation of 0.6471225 and MSE of 0.140736

```{r}
as.data.frame(lgb.importance(dat_first_conv.conv_only_3.lgb_obj)) %>%
  mutate(Feature = fct_rev(fct_inorder(Feature))) %>%
  dplyr::slice(1:50) %>%
  ggplot(aes(x = Feature, y = Gain)) +
  geom_col(fill = "dodgerblue") +
  coord_flip() +
  theme_bw()
```
## Second Convolutional layer (48 features with an 11x1 kernel), following 48 with 3x4

```{r}
dat_second_conv.2conv_only = readRDS("data/Created/tiling_tiling_second_conv_output_train_2conv_only.rds")
dat_second_conv_test.2conv_only = readRDS("data/Created/tiling_tiling_second_conv_output_test_2conv_only.rds")
dat_second_conv_random_test.2conv_only = readRDS("data/Created/tiling_random_second_conv_output_test_2conv_only.rds")
```

```{r}
dat_second_conv.2conv_only$Y = y
dat_second_conv_test.2conv_only$Y = y_test

lm.model_second_conv.2conv_only = lm(Y~., data = dat_second_conv.2conv_only)

# Prediction accuracy with train data:
cor(lm.model_second_conv.2conv_only$fitted.values, y, method="pearson")
# 0.8006348
mean((lm.model_second_conv.2conv_only$fitted.values - y)^2)
# 0.08699853

# Predict values for test dataset:
lm.model_second_conv.2conv_only.pred = predict(lm.model_second_conv.2conv_only, newdata = dat_second_conv_test.2conv_only)

# Prediction accuracy with test data:
cor(lm.model_second_conv.2conv_only.pred, y_test, method="pearson")
# 0.8014844
mean((lm.model_second_conv.2conv_only.pred - y_test)^2)
# 0.08621262

# Predict values for random test dataset:
lm.model_second_conv.2conv_only.pred_random = predict(lm.model_second_conv.2conv_only, newdata = dat_second_conv_random_test.2conv_only)

# Prediction accuracy with random test data:
cor(lm.model_second_conv.2conv_only.pred_random, dat_random_test$C0_new, method="pearson")
# 0.8030556
mean((lm.model_second_conv.2conv_only.pred_random - dat_random_test$C0_new)^2)
# 0.05458259
```

We get test prediction correlation of 0.8014844 and MSE of 0.08621262

## Second Convolutional layer (48 features with a 21x1 kernel), following 48 with 3x4

```{r}
dat_second_conv.2conv_only_2 = readRDS("data/Created/tiling_tiling_second_conv_output_train_2conv_only_2.rds")
dat_second_conv_test.2conv_only_2 = readRDS("data/Created/tiling_tiling_second_conv_output_test_2conv_only_2.rds")
dat_second_conv_random_test.2conv_only_2 = readRDS("data/Created/tiling_random_second_conv_output_test_2conv_only_2.rds")
```

```{r}
dat_second_conv.2conv_only_2$Y = y
dat_second_conv_test.2conv_only_2$Y = y_test

lm.model_second_conv.2conv_only_2 = lm(Y~., data = dat_second_conv.2conv_only_2)

# Prediction accuracy with train data:
cor(lm.model_second_conv.2conv_only_2$fitted.values, y, method="pearson")
# 0.8902643
mean((lm.model_second_conv.2conv_only_2$fitted.values - y)^2)
# 0.05026981

# Predict values for test dataset:
lm.model_second_conv.2conv_only_2.pred = predict(lm.model_second_conv.2conv_only_2, newdata = dat_second_conv_test.2conv_only_2)

# Prediction accuracy with test data:
cor(lm.model_second_conv.2conv_only_2.pred, y_test, method="pearson")
# 0.8942199
mean((lm.model_second_conv.2conv_only_2.pred - y_test)^2)
# 0.04830218

# Predict values for random test dataset:
lm.model_second_conv.2conv_only_2.pred_random = predict(lm.model_second_conv.2conv_only_2, newdata = dat_second_conv_random_test.2conv_only_2)

# Prediction accuracy with random test data:
cor(lm.model_second_conv.2conv_only_2.pred_random, dat_random_test$C0_new, method="pearson")
# 0.8899358
mean((lm.model_second_conv.2conv_only_2.pred_random - dat_random_test$C0_new)^2)
# 0.03234057
```

We get test prediction correlation of 0.8942199 and MSE of 0.04830218

## Second Convolutional layer (48 features with a 31x1 kernel), following 48 with 3x4

```{r}
dat_second_conv.2conv_only_3 = readRDS("data/Created/tiling_tiling_second_conv_output_train_2conv_only_3.rds")
dat_second_conv_test.2conv_only_3 = readRDS("data/Created/tiling_tiling_second_conv_output_test_2conv_only_3.rds")
dat_second_conv_random_test.2conv_only_3 = readRDS("data/Created/tiling_random_second_conv_output_test_2conv_only_3.rds")
```

```{r}
dat_second_conv.2conv_only_3$Y = y
dat_second_conv_test.2conv_only_3$Y = y_test

lm.model_second_conv.2conv_only_3 = lm(Y~., data = dat_second_conv.2conv_only_3)

# Prediction accuracy with train data:
cor(lm.model_second_conv.2conv_only_3$fitted.values, y, method="pearson")
# 0.9010778
mean((lm.model_second_conv.2conv_only_3$fitted.values - y)^2)
# 0.04557542

# Predict values for test dataset:
lm.model_second_conv.2conv_only_3.pred = predict(lm.model_second_conv.2conv_only_3, newdata = dat_second_conv_test.2conv_only_3)

# Prediction accuracy with test data:
cor(lm.model_second_conv.2conv_only_3.pred, y_test, method="pearson")
# 0.903489
mean((lm.model_second_conv.2conv_only_3.pred - y_test)^2)
# 0.0442904

# Predict values for random test dataset:
lm.model_second_conv.2conv_only_3.pred_random = predict(lm.model_second_conv.2conv_only_3, newdata = dat_second_conv_random_test.2conv_only_3)

# Prediction accuracy with random test data:
cor(lm.model_second_conv.2conv_only_3.pred_random, dat_random_test$C0_new, method="pearson")
# 0.9012312
mean((lm.model_second_conv.2conv_only_3.pred_random - dat_random_test$C0_new)^2)
# 0.02906046
```

We get test prediction correlation of 0.903489 and MSE of 0.0442904

## Second Convolutional layer (48 features with a 41x1 kernel), following 48 with 3x4

```{r}
dat_second_conv.2conv_only_4 = readRDS("data/Created/tiling_tiling_second_conv_output_train_2conv_only_4.rds")
dat_second_conv_test.2conv_only_4 = readRDS("data/Created/tiling_tiling_second_conv_output_test_2conv_only_4.rds")
dat_second_conv_random_test.2conv_only_4 = readRDS("data/Created/tiling_random_second_conv_output_test_2conv_only_4.rds")
```

```{r}
dat_second_conv.2conv_only_4$Y = y
dat_second_conv_test.2conv_only_4$Y = y_test

lm.model_second_conv.2conv_only_4 = lm(Y~., data = dat_second_conv.2conv_only_4)

# Prediction accuracy with train data:
cor(lm.model_second_conv.2conv_only_4$fitted.values, y, method="pearson")
# 0.0442904
mean((lm.model_second_conv.2conv_only_4$fitted.values - y)^2)
# 0.04394489

# Predict values for test dataset:
lm.model_second_conv.2conv_only_4.pred = predict(lm.model_second_conv.2conv_only_4, newdata = dat_second_conv_test.2conv_only_4)

# Prediction accuracy with test data:
cor(lm.model_second_conv.2conv_only_4.pred, y_test, method="pearson")
# 0.9074146
mean((lm.model_second_conv.2conv_only_4.pred - y_test)^2)
# 0.04256688

# Predict values for random test dataset:
lm.model_second_conv.2conv_only_4.pred_random = predict(lm.model_second_conv.2conv_only_4, newdata = dat_second_conv_random_test.2conv_only_4)

# Prediction accuracy with random test data:
cor(lm.model_second_conv.2conv_only_4.pred_random, dat_random_test$C0_new, method="pearson")
# 0.897062
mean((lm.model_second_conv.2conv_only_4.pred_random - dat_random_test$C0_new)^2)
# 0.03023094
```

We get test prediction correlation of 0.9074146 and MSE of 0.04256688

## First in Parallel Line 1 (48 features with a 3x1 kernel)

```{r}
dat_second_conv = readRDS("data/Created/tiling_tiling_second_conv_output_train.rds")
dat_second_conv_test = readRDS("data/Created/tiling_tiling_second_conv_output_test.rds")
dat_second_conv_random_test = readRDS("data/Created/tiling_random_second_conv_output_test.rds")
```


```{r}
dat_second_conv$Y = y
dat_second_conv_test$Y = y_test

lm.model_second_conv = lm(Y~., data = dat_second_conv)

# Prediction accuracy with train data:
cor(lm.model_second_conv$fitted.values, y, method="pearson")
# 0.4851576
mean((lm.model_second_conv$fitted.values - y)^2)
# 0.1853036

# Predict values for test dataset:
lm.model_second_conv.pred = predict(lm.model_second_conv, newdata = dat_second_conv_test)

# Prediction accuracy with test data:
cor(lm.model_second_conv.pred, y_test, method="pearson")
# 0.4566429
mean((lm.model_second_conv.pred - y_test)^2)
# 0.1909542

# Predict values for random test dataset:
lm.model_second_conv.pred_random = predict(lm.model_second_conv, newdata = dat_second_conv_random_test)

# Prediction accuracy with random test data:
cor(lm.model_second_conv.pred_random, dat_random_test$C0_new, method="pearson")
# 0.4442778
mean((lm.model_second_conv.pred_random - dat_random_test$C0_new)^2)
# 0.1246821
```

We get test prediction correlation of 0.4566429 and MSE of 0.1909542

## Second in Parallel Line 1 (48 features with a 3x1 kernel)

```{r}
dat_third_conv = readRDS("data/Created/tiling_tiling_third_conv_output_train.rds")
dat_third_conv_test = readRDS("data/Created/tiling_tiling_third_conv_output_test.rds")
dat_third_conv_random_test = readRDS("data/Created/tiling_random_third_conv_output_test.rds")
```

```{r}
dat_third_conv$Y = y
dat_third_conv_test$Y = y_test

lm.model_third_conv = lm(Y~., data = dat_third_conv)

# Prediction accuracy with train data:
cor(lm.model_third_conv$fitted.values, y, method="pearson")
# 0.523296
mean((lm.model_third_conv$fitted.values - y)^2)
# 0.1759827

# Predict values for test dataset:
lm.model_third_conv.pred = predict(lm.model_third_conv, newdata = dat_third_conv_test)

# Prediction accuracy with test data:
cor(lm.model_third_conv.pred, y_test, method="pearson")
# 0.4940378
mean((lm.model_third_conv.pred - y_test)^2)
# 0.1822615

# Predict values for random test dataset:
lm.model_third_conv.pred_random = predict(lm.model_third_conv, newdata = dat_third_conv_random_test)

# Prediction accuracy with random test data:
cor(lm.model_third_conv.pred_random, dat_random_test$C0_new, method="pearson")
# 0.4834918
mean((lm.model_third_conv.pred_random - dat_random_test$C0_new)^2)
# 0.1186414
```

We get test prediction correlation of 0.4940378 and MSE of 0.1822615

## First in Parallel Line 2 (48 features with an 11x1 kernel)

```{r}
dat_fourth_conv = readRDS("data/Created/tiling_tiling_fourth_conv_output_train.rds")
dat_fourth_conv_test = readRDS("data/Created/tiling_tiling_fourth_conv_output_test.rds")
dat_fourth_conv_random_test = readRDS("data/Created/tiling_random_fourth_conv_output_test.rds")
```

```{r}
dat_fourth_conv$Y = y
dat_fourth_conv_test$Y = y_test

lm.model_fourth_conv = lm(Y~., data = dat_fourth_conv)

# Prediction accuracy with train data:
cor(lm.model_fourth_conv$fitted.values, y, method="pearson")
# 0.7115308
mean((lm.model_fourth_conv$fitted.values - y)^2)
# 0.1196523

# Predict values for test dataset:
lm.model_fourth_conv.pred = predict(lm.model_fourth_conv, newdata = dat_fourth_conv_test)

# Prediction accuracy with test data:
cor(lm.model_fourth_conv.pred, y_test, method="pearson")
# 0.7040543
mean((lm.model_fourth_conv.pred - y_test)^2)
# 0.1215889

# Predict values for random test dataset:
lm.model_fourth_conv.pred_random = predict(lm.model_fourth_conv, newdata = dat_fourth_conv_random_test)

# Prediction accuracy with random test data:
cor(lm.model_fourth_conv.pred_random, dat_random_test$C0_new, method="pearson")
# 0.7148306
mean((lm.model_fourth_conv.pred_random - dat_random_test$C0_new)^2)
# 0.07597848
```

We get test prediction correlation of 0.7040543 and MSE of 0.1215889

## Second in Parallel Line 2 (48 features with a 21x1 kernel)

```{r}
dat_fifth_conv = readRDS("data/Created/tiling_tiling_fifth_conv_output_train.rds")
dat_fifth_conv_test = readRDS("data/Created/tiling_tiling_fifth_conv_output_test.rds")
dat_fifth_conv_random_test = readRDS("data/Created/tiling_random_fifth_conv_output_test.rds")
```

```{r}
dat_fifth_conv$Y = y
dat_fifth_conv_test$Y = y_test

lm.model_fifth_conv = lm(Y~., data = dat_fifth_conv)

# Prediction accuracy with train data:
cor(lm.model_fifth_conv$fitted.values, y, method="pearson")
# 0.9144672
mean((lm.model_fifth_conv$fitted.values - y)^2)
# 0.03968418

# Predict values for test dataset:
lm.model_fifth_conv.pred = predict(lm.model_fifth_conv, newdata = dat_fifth_conv_test)

# Prediction accuracy with test data:
cor(lm.model_fifth_conv.pred, y_test, method="pearson")
# 0.9175075
mean((lm.model_fifth_conv.pred - y_test)^2)
# 0.03812457

# Predict values for random test dataset:
lm.model_fifth_conv.pred_random = predict(lm.model_fifth_conv, newdata = dat_fifth_conv_random_test)

# Prediction accuracy with random test data:
cor(lm.model_fifth_conv.pred_random, dat_random_test$C0_new, method="pearson")
# 0.9182415
mean((lm.model_fifth_conv.pred_random - dat_random_test$C0_new)^2)
# 0.02452094
```

We get test prediction correlation of 0.9175075 and MSE of 0.03812457

## Combined outputs of first layer and of 2 parallel lines

```{r}
dat_add = readRDS("data/Created/tiling_tiling_add_output_train.rds")
dat_add_test = readRDS("data/Created/tiling_tiling_add_output_test.rds")
dat_add_random_test = readRDS("data/Created/tiling_random_add_output_test.rds")
```

```{r}
dat_add$Y = y
dat_add_test$Y = y_test

lm.model_add = lm(Y~., data = dat_add)

# Prediction accuracy with train data:
cor(lm.model_add$fitted.values, y, method="pearson")
# 0.9337672
mean((lm.model_add$fitted.values - y)^2)
# 0.03103945

# Predict values for test dataset:
lm.model_add.pred = predict(lm.model_add, newdata = dat_add_test)

# Prediction accuracy with test data:
cor(lm.model_add.pred, y_test, method="pearson")
# 0.9330006
mean((lm.model_add.pred - y_test)^2)
# 0.03122084

# Predict values for random test dataset:
lm.model_add.pred_random = predict(lm.model_add, newdata = dat_add_random_test)

# Prediction accuracy with random test data:
cor(lm.model_add.pred_random, dat_random_test$C0_new, method="pearson")
# 0.9363862
mean((lm.model_add.pred_random - dat_random_test$C0_new)^2)
# 0.01944545
```

We get test prediction correlation of 0.9330006 and MSE of 0.03122084

## LSTM

### Full IR+LSTM

```{r}
dat_lstm = readRDS("data/Created/tiling_tiling_lstm_output_train.rds")
dat_lstm_test = readRDS("data/Created/tiling_tiling_lstm_output_test.rds")
dat_lstm_random_test = readRDS("data/Created/tiling_random_lstm_output_test.rds")
```

```{r}
dat_lstm$Y = y
dat_lstm_test$Y = y_test

lm.model_lstm = lm(Y~., data = dat_lstm)

# Prediction accuracy with train data:
cor(lm.model_lstm$fitted.values, y, method="pearson")
# 0.942942
mean((lm.model_lstm$fitted.values - y)^2)
# 0.02686664

# Predict values for test dataset:
lm.model_lstm.pred = predict(lm.model_lstm, newdata = dat_lstm_test)

# Prediction accuracy with test data:
cor(lm.model_lstm.pred, y_test, method="pearson")
# 0.9446882
mean((lm.model_lstm.pred - y_test)^2)
# 0.02593145

# Predict values for random test dataset:
lm.model_lstm.pred_random = predict(lm.model_lstm, newdata = dat_lstm_random_test)

# Prediction accuracy with random test data:
cor(lm.model_lstm.pred_random, dat_random_test$C0_new, method="pearson")
# 0.9446138
mean((lm.model_lstm.pred_random - dat_random_test$C0_new)^2)
# 0.0166276
```

We get test prediction correlation of 0.942942 and MSE of 0.02593145

### 1 Convolutional Layer + LSTM

```{r}
dat_lstm.1conv_lstm = readRDS("data/Created/tiling_tiling_lstm_output_train_1conv_lstm.rds")
dat_lstm_test.1conv_lstm = readRDS("data/Created/tiling_tiling_lstm_output_test_1conv_lstm.rds")
dat_lstm_random_test.1conv_lstm = readRDS("data/Created/tiling_random_lstm_output_test_1conv_lstm.rds")
```

```{r}
dat_lstm.1conv_lstm$Y = y
dat_lstm_test.1conv_lstm$Y = y_test

lm.model_lstm.1conv_lstm = lm(Y~., data = dat_lstm.1conv_lstm)

# Prediction accuracy with train data:
cor(lm.model_lstm.1conv_lstm$fitted.values, y, method="pearson")
# 0.8817153
mean((lm.model_lstm.1conv_lstm$fitted.values - y)^2)
# 0.05394104

# Predict values for test dataset:
lm.model_lstm.1conv_lstm.pred = predict(lm.model_lstm.1conv_lstm, newdata = dat_lstm_test.1conv_lstm)

# Prediction accuracy with test data:
cor(lm.model_lstm.1conv_lstm.pred, y_test, method="pearson")
# 0.887275
mean((lm.model_lstm.1conv_lstm.pred - y_test)^2)
# 0.05129932

# Predict values for random test dataset:
lm.model_lstm.1conv_lstm.pred_random = predict(lm.model_lstm.1conv_lstm, newdata = dat_lstm_random_test.1conv_lstm)

# Prediction accuracy with random test data:
cor(lm.model_lstm.1conv_lstm.pred_random, dat_random_test$C0_new, method="pearson")
# 0.8971553
mean((lm.model_lstm.1conv_lstm.pred_random - dat_random_test$C0_new)^2)
# 0.03058749
```

We get test prediction correlation of 0.887275 and MSE of 0.05129932


## First Convolutional Layer with Dinucleotide input (8 features with a 21x16 kernel)

```{r}
dat_first_conv.conv_only_di_5 = readRDS("data/Created/tiling_tiling_first_conv_output_train_conv_only_di_5.rds")
dat_test_first_conv.conv_only_di_5 = readRDS("data/Created/tiling_tiling_first_conv_output_test_conv_only_di_5.rds")
dat_first_conv_random_test.conv_only_di_5 = readRDS("data/Created/tiling_random_first_conv_output_test_conv_only_di_5.rds")
```

### Simple Linear Model 

```{r}
dat_first_conv.conv_only_di_5$C0_new = y
dat_test_first_conv.conv_only_di_5$C0_new = y_test

lm.model_first_conv.conv_only_di_5 = lm(C0_new~., data = dat_first_conv.conv_only_di_5)

# Prediction accuracy with train data:
cor(lm.model_first_conv.conv_only_di_5$fitted.values, y, method="pearson")
# 0.7100876
mean((lm.model_first_conv.conv_only_di_5$fitted.values - y)^2)
# 0.1201495

# Predict values for test dataset:
lm.model_first_conv.conv_only_di_5.pred = predict(lm.model_first_conv.conv_only_di_5, newdata = dat_test_first_conv.conv_only_di_5)

# Prediction accuracy with test data:
cor(lm.model_first_conv.conv_only_di_5.pred, y_test, method="pearson")
# 0.7132879
mean((lm.model_first_conv.conv_only_di_5.pred - y_test)^2)
# 0.1184233

# Predict values for random test dataset:
lm.model_first_conv.conv_only_di_5.pred_random = predict(lm.model_first_conv.conv_only_di_5, newdata = dat_first_conv_random_test.conv_only_di_5)

# Prediction accuracy with random test data:
cor(lm.model_first_conv.conv_only_di_5.pred_random, dat_random_test$C0_new, method="pearson")
# 0.6794341
mean((lm.model_first_conv.conv_only_di_5.pred_random - dat_random_test$C0_new)^2)
# 0.08289014
```

We get test prediction correlation of 0.7132879 and MSE of 0.1184233

### LightGBM (tree-based) Model

```{r}
library(lightgbm)
source("scripts/functions/lgbm-helper-functions.R")
set.seed(50)
dat_first_conv.conv_only_di_5.lgb_train_set = dat_first_conv.conv_only_di_5 %>%
  select(-C0_new)
dat_first_conv.conv_only_di_5.lgb_train_rules = lgb.convert_with_rules(data = dat_first_conv.conv_only_di_5.lgb_train_set)
dat_first_conv.conv_only_di_5.lgb_train_data = lgb.Dataset(data = as.matrix(dat_first_conv.conv_only_di_5.lgb_train_rules$data),
                                                          label = dat_first_conv.conv_only_di_5$C0_new)
dat_first_conv.conv_only_di_5.lgb_test_set = dat_test_first_conv.conv_only_di_5 %>%
  select(-C0_new)
dat_first_conv.conv_only_di_5.lgb_test_matrix = as.matrix(lgb.convert_with_rules(data = dat_first_conv.conv_only_di_5.lgb_test_set, rules = dat_first_conv.conv_only_di_5.lgb_train_rules$rules)$data)
dat_first_conv.conv_only_di_5.lgb_test_data = lgb.Dataset(data = dat_first_conv.conv_only_di_5.lgb_test_matrix,
                                                         label = dat_test_first_conv.conv_only_di_5$C0_new,
                                                         categorical_feature = handle_categorical(colnames(dat_first_conv.conv_only_di_5.lgb_test_matrix)))
dat_first_conv.conv_only_di_5.lgb_obj = lightgbm(data = dat_first_conv.conv_only_di_5.lgb_train_data,
                                                params = list(learning_rate = c(0.1),
                                                              objective = c("regression"),
                                                              min_data_in_leaf = 100,
                                                              max_depth = c(5),
                                                              num_leaves = c(1000),
                                                              lambda_l2 = c(1),
                                                              boosting = c("gbdt")),
                                                valids = list(valid = dat_first_conv.conv_only_di_5.lgb_test_data),
                                                nrounds = 4000,
                                                early_stopping_rounds = 50)

dat_first_conv.conv_only_di_5.lgb_train_pred = predict(dat_first_conv.conv_only_di_5.lgb_obj, data = as.matrix(dat_first_conv.conv_only_di_5.lgb_train_rules$data))
cor(dat_first_conv.conv_only_di_5.lgb_train_pred, y, method="pearson")
# 0.8649133 (nrounds = 953)

dat_first_conv.conv_only_di_5.lgb_test_pred = predict(dat_first_conv.conv_only_di_5.lgb_obj, data = dat_first_conv.conv_only_di_5.lgb_test_matrix)

cor(dat_first_conv.conv_only_di_5.lgb_test_pred, y_test, method="pearson")
# 0.7709318 (nround = 953)

mean((dat_first_conv.conv_only_di_5.lgb_test_pred - y_test)^2)
# 0.09780124 (nround = 953)
```

We get test prediction correlation of 0.7709318 and MSE of 0.09780124

```{r}
as.data.frame(lgb.importance(dat_first_conv.conv_only_di_5.lgb_obj)) %>%
  mutate(Feature = fct_rev(fct_inorder(Feature))) %>%
  dplyr::slice(1:50) %>%
  ggplot(aes(x = Feature, y = Gain)) +
  geom_col(fill = "dodgerblue") +
  coord_flip() +
  theme_bw()
```

## First Convolutional Layer with 48 Dinucleotide input (48 features with a 21x16 kernel)

```{r}
dat_first_conv.conv_only_di = readRDS("data/Created/tiling_tiling_first_conv_output_train_conv_only_di.rds")
dat_test_first_conv.conv_only_di = readRDS("data/Created/tiling_tiling_first_conv_output_test_conv_only_di.rds")
dat_first_conv_random_test.conv_only_di = readRDS("data/Created/tiling_random_first_conv_output_test_conv_only_di.rds")
```

### Simple Linear Model 

```{r}
dat_first_conv.conv_only_di$C0_new = y
dat_test_first_conv.conv_only_di$C0_new = y_test

lm.model_first_conv.conv_only_di = lm(C0_new~., data = dat_first_conv.conv_only_di)

# Prediction accuracy with train data:
cor(lm.model_first_conv.conv_only_di$fitted.values, y, method="pearson")
# 0.7457505
mean((lm.model_first_conv.conv_only_di$fitted.values - y)^2)
# 0.1070929

# Predict values for test dataset:
lm.model_first_conv.conv_only_di.pred = predict(lm.model_first_conv.conv_only_di, newdata = dat_test_first_conv.conv_only_di)

# Prediction accuracy with test data:
cor(lm.model_first_conv.conv_only_di.pred, y_test, method="pearson")
# 0.7455629
mean((lm.model_first_conv.conv_only_di.pred - y_test)^2)
# 0.1070929

# Predict values for random test dataset:
lm.model_first_conv.conv_only_di.pred_random = predict(lm.model_first_conv.conv_only_di, newdata = dat_first_conv_random_test.conv_only_di)

# Prediction accuracy with random test data:
cor(lm.model_first_conv.conv_only_di.pred_random, dat_random_test$C0_new, method="pearson")
# 0.7045775
mean((lm.model_first_conv.conv_only_di.pred_random - dat_random_test$C0_new)^2)
# 0.07756058
```

We get test prediction correlation of 0.7455629 and MSE of 0.1070929

### LightGBM (tree-based) Model

```{r}
library(lightgbm)
source("scripts/functions/lgbm-helper-functions.R")
set.seed(50)
dat_first_conv.conv_only_di.lgb_train_set = dat_first_conv.conv_only_di %>%
  select(-C0_new)
dat_first_conv.conv_only_di.lgb_train_rules = lgb.convert_with_rules(data = dat_first_conv.conv_only_di.lgb_train_set)
dat_first_conv.conv_only_di.lgb_train_data = lgb.Dataset(data = as.matrix(dat_first_conv.conv_only_di.lgb_train_rules$data),
                                                          label = dat_first_conv.conv_only_di$C0_new)
dat_first_conv.conv_only_di.lgb_test_set = dat_test_first_conv.conv_only_di %>%
  select(-C0_new)
dat_first_conv.conv_only_di.lgb_test_matrix = as.matrix(lgb.convert_with_rules(data = dat_first_conv.conv_only_di.lgb_test_set, rules = dat_first_conv.conv_only_di.lgb_train_rules$rules)$data)
dat_first_conv.conv_only_di.lgb_test_data = lgb.Dataset(data = dat_first_conv.conv_only_di.lgb_test_matrix,
                                                         label = dat_test_first_conv.conv_only_di$C0_new,
                                                         categorical_feature = handle_categorical(colnames(dat_first_conv.conv_only_di.lgb_test_matrix)))
dat_first_conv.conv_only_di.lgb_obj = lightgbm(data = dat_first_conv.conv_only_di.lgb_train_data,
                                                params = list(learning_rate = c(0.1),
                                                              objective = c("regression"),
                                                              min_data_in_leaf = 100,
                                                              max_depth = c(5),
                                                              num_leaves = c(1000),
                                                              lambda_l2 = c(1),
                                                              boosting = c("gbdt")),
                                                valids = list(valid = dat_first_conv.conv_only_di.lgb_test_data),
                                                nrounds = 4000,
                                                early_stopping_rounds = 50)

dat_first_conv.conv_only_di.lgb_train_pred = predict(dat_first_conv.conv_only_di.lgb_obj, data = as.matrix(dat_first_conv.conv_only_di.lgb_train_rules$data))
cor(dat_first_conv.conv_only_di.lgb_train_pred, y, method="pearson")
# 0.8915386 (nrounds = 1437)

dat_first_conv.conv_only_di.lgb_test_pred = predict(dat_first_conv.conv_only_di.lgb_obj, data = dat_first_conv.conv_only_di.lgb_test_matrix)

cor(dat_first_conv.conv_only_di.lgb_test_pred, y_test, method="pearson")
# 0.7918154 (nround = 1437)

mean((dat_first_conv.conv_only_di.lgb_test_pred - y_test)^2)
# 0.08990496 (nround = 1437)
```

We get test prediction correlation of 0.7918154 and MSE of 0.08990496

```{r}
as.data.frame(lgb.importance(dat_first_conv.conv_only_di.lgb_obj)) %>%
  mutate(Feature = fct_rev(fct_inorder(Feature))) %>%
  dplyr::slice(1:50) %>%
  ggplot(aes(x = Feature, y = Gain)) +
  geom_col(fill = "dodgerblue") +
  coord_flip() +
  theme_bw()
```

## First Convolutional Layer with Trinucleotide input (4 features with a 21x64 kernel)

```{r}
dat_first_conv.conv_only_tri_4 = readRDS("data/Created/tiling_tiling_first_conv_output_train_conv_only_tri_4.rds")
dat_test_first_conv.conv_only_tri_4 = readRDS("data/Created/tiling_tiling_first_conv_output_test_conv_only_tri_4.rds")
dat_first_conv_random_test.conv_only_tri_4 = readRDS("data/Created/tiling_random_first_conv_output_test_conv_only_tri_4.rds")
```

### Simple Linear Model 

```{r}
dat_first_conv.conv_only_tri_4$C0_new = y
dat_test_first_conv.conv_only_tri_4$C0_new = y_test

lm.model_first_conv.conv_only_tri_4 = lm(C0_new~., data = dat_first_conv.conv_only_tri_4)

# Prediction accuracy with train data:
cor(lm.model_first_conv.conv_only_tri_4$fitted.values, y, method="pearson")
# 0.4491145
mean((lm.model_first_conv.conv_only_tri_4$fitted.values - y)^2)
# 0.1934644

# Predict values for test dataset:
lm.model_first_conv.conv_only_tri_4.pred = predict(lm.model_first_conv.conv_only_tri_4, newdata = dat_test_first_conv.conv_only_tri_4)

# Prediction accuracy with test data:
cor(lm.model_first_conv.conv_only_tri_4.pred, y_test, method="pearson")
# 0.4602752
mean((lm.model_first_conv.conv_only_tri_4.pred - y_test)^2)
# 0.1899904

# Predict values for random test dataset:
lm.model_first_conv.conv_only_tri_4.pred_random = predict(lm.model_first_conv.conv_only_tri_4, newdata = dat_first_conv_random_test.conv_only_tri_4)

# Prediction accuracy with random test data:
cor(lm.model_first_conv.conv_only_tri_4.pred_random, dat_random_test$C0_new, method="pearson")
# 0.3633067
mean((lm.model_first_conv.conv_only_tri_4.pred_random - dat_random_test$C0_new)^2)
# 0.1359698
```

We get test prediction correlation of 0.4602752 and MSE of 0.1899904

### LightGBM (tree-based) Model

```{r}
library(lightgbm)
source("scripts/functions/lgbm-helper-functions.R")
set.seed(50)
dat_first_conv.conv_only_tri_4.lgb_train_set = dat_first_conv.conv_only_tri_4 %>%
  select(-C0_new)
dat_first_conv.conv_only_tri_4.lgb_train_rules = lgb.convert_with_rules(data = dat_first_conv.conv_only_tri_4.lgb_train_set)
dat_first_conv.conv_only_tri_4.lgb_train_data = lgb.Dataset(data = as.matrix(dat_first_conv.conv_only_tri_4.lgb_train_rules$data),
                                                          label = dat_first_conv.conv_only_tri_4$C0_new)
dat_first_conv.conv_only_tri_4.lgb_test_set = dat_test_first_conv.conv_only_tri_4 %>%
  select(-C0_new)
dat_first_conv.conv_only_tri_4.lgb_test_matrix = as.matrix(lgb.convert_with_rules(data = dat_first_conv.conv_only_tri_4.lgb_test_set, rules = dat_first_conv.conv_only_tri_4.lgb_train_rules$rules)$data)
dat_first_conv.conv_only_tri_4.lgb_test_data = lgb.Dataset(data = dat_first_conv.conv_only_tri_4.lgb_test_matrix,
                                                         label = dat_test_first_conv.conv_only_tri_4$C0_new,
                                                         categorical_feature = handle_categorical(colnames(dat_first_conv.conv_only_tri_4.lgb_test_matrix)))
dat_first_conv.conv_only_tri_4.lgb_obj = lightgbm(data = dat_first_conv.conv_only_tri_4.lgb_train_data,
                                                params = list(learning_rate = c(0.1),
                                                              objective = c("regression"),
                                                              min_data_in_leaf = 100,
                                                              max_depth = c(5),
                                                              num_leaves = c(1000),
                                                              lambda_l2 = c(1),
                                                              boosting = c("gbdt")),
                                                valids = list(valid = dat_first_conv.conv_only_tri_4.lgb_test_data),
                                                nrounds = 4000,
                                                early_stopping_rounds = 50)

dat_first_conv.conv_only_tri_4.lgb_train_pred = predict(dat_first_conv.conv_only_tri_4.lgb_obj, data = as.matrix(dat_first_conv.conv_only_tri_4.lgb_train_rules$data))
cor(dat_first_conv.conv_only_tri_4.lgb_train_pred, y, method="pearson")
# 0.5222736 (nrounds = 245)

dat_first_conv.conv_only_tri_4.lgb_test_pred = predict(dat_first_conv.conv_only_tri_4.lgb_obj, data = dat_first_conv.conv_only_tri_4.lgb_test_matrix)

cor(dat_first_conv.conv_only_tri_4.lgb_test_pred, y_test, method="pearson")
# 0.4647871 (nround = 245)

mean((dat_first_conv.conv_only_tri_4.lgb_test_pred - y_test)^2)
# 0.1889594 (nround = 245)
```

We get test prediction correlation of 0.4647871 and MSE of 0.1889594

```{r}
as.data.frame(lgb.importance(dat_first_conv.conv_only_tri_4.lgb_obj)) %>%
  mutate(Feature = fct_rev(fct_inorder(Feature))) %>%
  dplyr::slice(1:50) %>%
  ggplot(aes(x = Feature, y = Gain)) +
  geom_col(fill = "dodgerblue") +
  coord_flip() +
  theme_bw()
```

## First Convolutional Layer with Trinucleotide input (8 features with a 21x64 kernel)

```{r}
dat_first_conv.conv_only_tri_5 = readRDS("data/Created/tiling_tiling_first_conv_output_train_conv_only_tri_5.rds")
dat_test_first_conv.conv_only_tri_5 = readRDS("data/Created/tiling_tiling_first_conv_output_test_conv_only_tri_5.rds")
dat_first_conv_random_test.conv_only_tri_5 = readRDS("data/Created/tiling_random_first_conv_output_test_conv_only_tri_5.rds")
```

### Simple Linear Model 

```{r}
dat_first_conv.conv_only_tri_5$C0_new = y
dat_test_first_conv.conv_only_tri_5$C0_new = y_test

lm.model_first_conv.conv_only_tri_5 = lm(C0_new~., data = dat_first_conv.conv_only_tri_5)

# Prediction accuracy with train data:
cor(lm.model_first_conv.conv_only_tri_5$fitted.values, y, method="pearson")
# 0.7432655
mean((lm.model_first_conv.conv_only_tri_5$fitted.values - y)^2)
# 0.1084638

# Predict values for test dataset:
lm.model_first_conv.conv_only_tri_5.pred = predict(lm.model_first_conv.conv_only_tri_5, newdata = dat_test_first_conv.conv_only_tri_5)

# Prediction accuracy with test data:
cor(lm.model_first_conv.conv_only_tri_5.pred, y_test, method="pearson")
# 0.7431094
mean((lm.model_first_conv.conv_only_tri_5.pred - y_test)^2)
# 0.1079593

# Predict values for random test dataset:
lm.model_first_conv.conv_only_tri_5.pred_random = predict(lm.model_first_conv.conv_only_tri_5, newdata = dat_first_conv_random_test.conv_only_tri_5)

# Prediction accuracy with random test data:
cor(lm.model_first_conv.conv_only_tri_5.pred_random, dat_random_test$C0_new, method="pearson")
# 0.7255019
mean((lm.model_first_conv.conv_only_tri_5.pred_random - dat_random_test$C0_new)^2)
# 0.07401434
```

We get test prediction correlation of 0.7431094 and MSE of 0.1079593

### LightGBM (tree-based) Model

```{r}
library(lightgbm)
source("scripts/functions/lgbm-helper-functions.R")
set.seed(50)
dat_first_conv.conv_only_tri_5.lgb_train_set = dat_first_conv.conv_only_tri_5 %>%
  select(-C0_new)
dat_first_conv.conv_only_tri_5.lgb_train_rules = lgb.convert_with_rules(data = dat_first_conv.conv_only_tri_5.lgb_train_set)
dat_first_conv.conv_only_tri_5.lgb_train_data = lgb.Dataset(data = as.matrix(dat_first_conv.conv_only_tri_5.lgb_train_rules$data),
                                                          label = dat_first_conv.conv_only_tri_5$C0_new)
dat_first_conv.conv_only_tri_5.lgb_test_set = dat_test_first_conv.conv_only_tri_5 %>%
  select(-C0_new)
dat_first_conv.conv_only_tri_5.lgb_test_matrix = as.matrix(lgb.convert_with_rules(data = dat_first_conv.conv_only_tri_5.lgb_test_set, rules = dat_first_conv.conv_only_tri_5.lgb_train_rules$rules)$data)
dat_first_conv.conv_only_tri_5.lgb_test_data = lgb.Dataset(data = dat_first_conv.conv_only_tri_5.lgb_test_matrix,
                                                         label = dat_test_first_conv.conv_only_tri_5$C0_new,
                                                         categorical_feature = handle_categorical(colnames(dat_first_conv.conv_only_tri_5.lgb_test_matrix)))
dat_first_conv.conv_only_tri_5.lgb_obj = lightgbm(data = dat_first_conv.conv_only_tri_5.lgb_train_data,
                                                params = list(learning_rate = c(0.1),
                                                              objective = c("regression"),
                                                              min_data_in_leaf = 100,
                                                              max_depth = c(5),
                                                              num_leaves = c(1000),
                                                              lambda_l2 = c(1),
                                                              boosting = c("gbdt")),
                                                valids = list(valid = dat_first_conv.conv_only_tri_5.lgb_test_data),
                                                nrounds = 4000,
                                                early_stopping_rounds = 50)

dat_first_conv.conv_only_tri_5.lgb_train_pred = predict(dat_first_conv.conv_only_tri_5.lgb_obj, data = as.matrix(dat_first_conv.conv_only_tri_5.lgb_train_rules$data))
cor(dat_first_conv.conv_only_tri_5.lgb_train_pred, y, method="pearson")
# 0.859598 (nrounds = 1123)

dat_first_conv.conv_only_tri_5.lgb_test_pred = predict(dat_first_conv.conv_only_tri_5.lgb_obj, data = dat_first_conv.conv_only_tri_5.lgb_test_matrix)

cor(dat_first_conv.conv_only_tri_5.lgb_test_pred, y_test, method="pearson")
# 0.7987128 (nround = 1123)

mean((dat_first_conv.conv_only_tri_5.lgb_test_pred - y_test)^2)
# 0.08727349 (nround = 1123)
```

We get test prediction correlation of 0.7987128 and MSE of 0.08727349

```{r}
as.data.frame(lgb.importance(dat_first_conv.conv_only_tri_5.lgb_obj)) %>%
  mutate(Feature = fct_rev(fct_inorder(Feature))) %>%
  dplyr::slice(1:50) %>%
  ggplot(aes(x = Feature, y = Gain)) +
  geom_col(fill = "dodgerblue") +
  coord_flip() +
  theme_bw()
```

## First Convolutional Layer with 48 Trinucleotide input (48 features with a 21x64 kernel)

```{r}
dat_first_conv.conv_only_tri = readRDS("data/Created/tiling_tiling_first_conv_output_train_conv_only_tri.rds")
dat_test_first_conv.conv_only_tri = readRDS("data/Created/tiling_tiling_first_conv_output_test_conv_only_tri.rds")
dat_first_conv_random_test.conv_only_tri = readRDS("data/Created/tiling_random_first_conv_output_test_conv_only_tri.rds")
```

### Simple Linear Model 

```{r}
dat_first_conv.conv_only_tri$C0_new = y
dat_test_first_conv.conv_only_tri$C0_new = y_test

lm.model_first_conv.conv_only_tri = lm(C0_new~., data = dat_first_conv.conv_only_tri)

# Prediction accuracy with train data:
cor(lm.model_first_conv.conv_only_tri$fitted.values, y, method="pearson")
# 0.8275571
mean((lm.model_first_conv.conv_only_tri$fitted.values - y)^2)
# 0.07637533

# Predict values for test dataset:
lm.model_first_conv.conv_only_tri.pred = predict(lm.model_first_conv.conv_only_tri, newdata = dat_test_first_conv.conv_only_tri)

# Prediction accuracy with test data:
cor(lm.model_first_conv.conv_only_tri.pred, y_test, method="pearson")
# 0.8165551
mean((lm.model_first_conv.conv_only_tri.pred - y_test)^2)
# 0.08041748

# Predict values for random test dataset:
lm.model_first_conv.conv_only_tri.pred_random = predict(lm.model_first_conv.conv_only_tri, newdata = dat_first_conv_random_test.conv_only_tri)

# Prediction accuracy with random test data:
cor(lm.model_first_conv.conv_only_tri.pred_random, dat_random_test$C0_new, method="pearson")
# 0.7485627
mean((lm.model_first_conv.conv_only_tri.pred_random - dat_random_test$C0_new)^2)
# 0.06762247
```

We get test prediction correlation of 0.8165551 and MSE of 0.08041748

### LightGBM (tree-based) Model

```{r}
library(lightgbm)
source("scripts/functions/lgbm-helper-functions.R")
set.seed(50)
dat_first_conv.conv_only_tri.lgb_train_set = dat_first_conv.conv_only_tri %>%
  select(-C0_new)
dat_first_conv.conv_only_tri.lgb_train_rules = lgb.convert_with_rules(data = dat_first_conv.conv_only_tri.lgb_train_set)
dat_first_conv.conv_only_tri.lgb_train_data = lgb.Dataset(data = as.matrix(dat_first_conv.conv_only_tri.lgb_train_rules$data),
                                                          label = dat_first_conv.conv_only_tri$C0_new)
dat_first_conv.conv_only_tri.lgb_test_set = dat_test_first_conv.conv_only_tri %>%
  select(-C0_new)
dat_first_conv.conv_only_tri.lgb_test_matrix = as.matrix(lgb.convert_with_rules(data = dat_first_conv.conv_only_tri.lgb_test_set, rules = dat_first_conv.conv_only_tri.lgb_train_rules$rules)$data)
dat_first_conv.conv_only_tri.lgb_test_data = lgb.Dataset(data = dat_first_conv.conv_only_tri.lgb_test_matrix,
                                                         label = dat_test_first_conv.conv_only_tri$C0_new,
                                                         categorical_feature = handle_categorical(colnames(dat_first_conv.conv_only_tri.lgb_test_matrix)))
dat_first_conv.conv_only_tri.lgb_obj = lightgbm(data = dat_first_conv.conv_only_tri.lgb_train_data,
                                                params = list(learning_rate = c(0.1),
                                                              objective = c("regression"),
                                                              min_data_in_leaf = 100,
                                                              max_depth = c(5),
                                                              num_leaves = c(1000),
                                                              lambda_l2 = c(1),
                                                              boosting = c("gbdt")),
                                                valids = list(valid = dat_first_conv.conv_only_tri.lgb_test_data),
                                                nrounds = 4000,
                                                early_stopping_rounds = 50)

dat_first_conv.conv_only_tri.lgb_train_pred = predict(dat_first_conv.conv_only_tri.lgb_obj, data = as.matrix(dat_first_conv.conv_only_tri.lgb_train_rules$data))
cor(dat_first_conv.conv_only_tri.lgb_train_pred, y, method="pearson")
# 0.9235915 (nrounds = 1924)

dat_first_conv.conv_only_tri.lgb_test_pred = predict(dat_first_conv.conv_only_tri.lgb_obj, data = dat_first_conv.conv_only_tri.lgb_test_matrix)

cor(dat_first_conv.conv_only_tri.lgb_test_pred, y_test, method="pearson")
# 0.8563706 (nround = 1924)

mean((dat_first_conv.conv_only_tri.lgb_test_pred - y_test)^2)
# 0.06427395 (nround = 1924)
```

We get test prediction correlation of 0.8563706 and MSE of 0.06427395

```{r}
as.data.frame(lgb.importance(dat_first_conv.conv_only_tri.lgb_obj)) %>%
  mutate(Feature = fct_rev(fct_inorder(Feature))) %>%
  dplyr::slice(1:50) %>%
  ggplot(aes(x = Feature, y = Gain)) +
  geom_col(fill = "dodgerblue") +
  coord_flip() +
  theme_bw()
```

## First Convolutional Layer with 48 Trinucleotide input (48 features with a 31x64 kernel)

```{r}
dat_first_conv.conv_only_tri_2 = readRDS("data/Created/tiling_tiling_first_conv_output_train_conv_only_tri_2.rds")
dat_test_first_conv.conv_only_tri_2 = readRDS("data/Created/tiling_tiling_first_conv_output_test_conv_only_tri_2.rds")
dat_first_conv_random_test.conv_only_tri_2 = readRDS("data/Created/tiling_random_first_conv_output_test_conv_only_tri_2.rds")
```

### Simple Linear Model 

```{r}
dat_first_conv.conv_only_tri_2$C0_new = y
dat_test_first_conv.conv_only_tri_2$C0_new = y_test

lm.model_first_conv.conv_only_tri_2 = lm(C0_new~., data = dat_first_conv.conv_only_tri_2)

# Prediction accuracy with train data:
cor(lm.model_first_conv.conv_only_tri_2$fitted.values, y, method="pearson")
# 0.8540491
mean((lm.model_first_conv.conv_only_tri_2$fitted.values - y)^2)
# 0.06557902

# Predict values for test dataset:
lm.model_first_conv.conv_only_tri_2.pred = predict(lm.model_first_conv.conv_only_tri_2, newdata = dat_test_first_conv.conv_only_tri_2)

# Prediction accuracy with test data:
cor(lm.model_first_conv.conv_only_tri_2.pred, y_test, method="pearson")
# 0.8535066
mean((lm.model_first_conv.conv_only_tri_2.pred - y_test)^2)
# 0.06551867

# Predict values for random test dataset:
lm.model_first_conv.conv_only_tri_2.pred_random = predict(lm.model_first_conv.conv_only_tri_2, newdata = dat_first_conv_random_test.conv_only_tri_2)

# Prediction accuracy with random test data:
cor(lm.model_first_conv.conv_only_tri_2.pred_random, dat_random_test$C0_new, method="pearson")
# 0.8022272
mean((lm.model_first_conv.conv_only_tri_2.pred_random - dat_random_test$C0_new)^2)
# 0.0556215
```

We get test prediction correlation of 0.8535066 and MSE of 0.06551867

### LightGBM (tree-based) Model

```{r}
library(lightgbm)
source("scripts/functions/lgbm-helper-functions.R")
set.seed(50)
dat_first_conv.conv_only_tri_2.lgb_train_set = dat_first_conv.conv_only_tri_2 %>%
  select(-C0_new)
dat_first_conv.conv_only_tri_2.lgb_train_rules = lgb.convert_with_rules(data = dat_first_conv.conv_only_tri_2.lgb_train_set)
dat_first_conv.conv_only_tri_2.lgb_train_data = lgb.Dataset(data = as.matrix(dat_first_conv.conv_only_tri_2.lgb_train_rules$data),
                                                          label = dat_first_conv.conv_only_tri_2$C0_new)
dat_first_conv.conv_only_tri_2.lgb_test_set = dat_test_first_conv.conv_only_tri_2 %>%
  select(-C0_new)
dat_first_conv.conv_only_tri_2.lgb_test_matrix = as.matrix(lgb.convert_with_rules(data = dat_first_conv.conv_only_tri_2.lgb_test_set, rules = dat_first_conv.conv_only_tri_2.lgb_train_rules$rules)$data)
dat_first_conv.conv_only_tri_2.lgb_test_data = lgb.Dataset(data = dat_first_conv.conv_only_tri_2.lgb_test_matrix,
                                                         label = dat_test_first_conv.conv_only_tri_2$C0_new,
                                                         categorical_feature = handle_categorical(colnames(dat_first_conv.conv_only_tri_2.lgb_test_matrix)))
dat_first_conv.conv_only_tri_2.lgb_obj = lightgbm(data = dat_first_conv.conv_only_tri_2.lgb_train_data,
                                                params = list(learning_rate = c(0.1),
                                                              objective = c("regression"),
                                                              min_data_in_leaf = 100,
                                                              max_depth = c(5),
                                                              num_leaves = c(1000),
                                                              lambda_l2 = c(1),
                                                              boosting = c("gbdt")),
                                                valids = list(valid = dat_first_conv.conv_only_tri_2.lgb_test_data),
                                                nrounds = 4000,
                                                early_stopping_rounds = 50)

dat_first_conv.conv_only_tri_2.lgb_train_pred = predict(dat_first_conv.conv_only_tri_2.lgb_obj, data = as.matrix(dat_first_conv.conv_only_tri_2.lgb_train_rules$data))
cor(dat_first_conv.conv_only_tri_2.lgb_train_pred, y, method="pearson")
# 0.9163813 (nrounds = 1259)

dat_first_conv.conv_only_tri_2.lgb_test_pred = predict(dat_first_conv.conv_only_tri_2.lgb_obj, data = dat_first_conv.conv_only_tri_2.lgb_test_matrix)

cor(dat_first_conv.conv_only_tri_2.lgb_test_pred, y_test, method="pearson")
# 0.8663849 (nround = 1259)

mean((dat_first_conv.conv_only_tri_2.lgb_test_pred - y_test)^2)
# 0.06010141 (nround = 1259)
```

We get test prediction correlation of 0.8663849 and MSE of 0.06010141

```{r}
as.data.frame(lgb.importance(dat_first_conv.conv_only_tri_2.lgb_obj)) %>%
  mutate(Feature = fct_rev(fct_inorder(Feature))) %>%
  dplyr::slice(1:50) %>%
  ggplot(aes(x = Feature, y = Gain)) +
  geom_col(fill = "dodgerblue") +
  coord_flip() +
  theme_bw()
```


## First Convolutional Layer with 48 Trinucleotide input (48 features with a 41x64 kernel)

```{r}
dat_first_conv.conv_only_tri_3 = readRDS("data/Created/tiling_tiling_first_conv_output_train_conv_only_tri_3.rds")
dat_test_first_conv.conv_only_tri_3 = readRDS("data/Created/tiling_tiling_first_conv_output_test_conv_only_tri_3.rds")
dat_first_conv_random_test.conv_only_tri_3 = readRDS("data/Created/tiling_random_first_conv_output_test_conv_only_tri_3.rds")
```

### Simple Linear Model 

```{r}
dat_first_conv.conv_only_tri_3$C0_new = y
dat_test_first_conv.conv_only_tri_3$C0_new = y_test

lm.model_first_conv.conv_only_tri_3 = lm(C0_new~., data = dat_first_conv.conv_only_tri_3)

# Prediction accuracy with train data:
cor(lm.model_first_conv.conv_only_tri_3$fitted.values, y, method="pearson")
# 0.8764394
mean((lm.model_first_conv.conv_only_tri_3$fitted.values - y)^2)
# 0.05618903

# Predict values for test dataset:
lm.model_first_conv.conv_only_tri_3.pred = predict(lm.model_first_conv.conv_only_tri_3, newdata = dat_test_first_conv.conv_only_tri_3)

# Prediction accuracy with test data:
cor(lm.model_first_conv.conv_only_tri_3.pred, y_test, method="pearson")
# 0.8783388
mean((lm.model_first_conv.conv_only_tri_3.pred - y_test)^2)
# 0.05507851

# Predict values for random test dataset:
lm.model_first_conv.conv_only_tri_3.pred_random = predict(lm.model_first_conv.conv_only_tri_3, newdata = dat_first_conv_random_test.conv_only_tri_3)

# Prediction accuracy with random test data:
cor(lm.model_first_conv.conv_only_tri_3.pred_random, dat_random_test$C0_new, method="pearson")
# 0.8458942
mean((lm.model_first_conv.conv_only_tri_3.pred_random - dat_random_test$C0_new)^2)
# 0.04418136
```

We get test prediction correlation of 0.8783388 and MSE of 0.05507851

### LightGBM (tree-based) Model

```{r}
library(lightgbm)
source("scripts/functions/lgbm-helper-functions.R")
set.seed(50)
dat_first_conv.conv_only_tri_3.lgb_train_set = dat_first_conv.conv_only_tri_3 %>%
  select(-C0_new)
dat_first_conv.conv_only_tri_3.lgb_train_rules = lgb.convert_with_rules(data = dat_first_conv.conv_only_tri_3.lgb_train_set)
dat_first_conv.conv_only_tri_3.lgb_train_data = lgb.Dataset(data = as.matrix(dat_first_conv.conv_only_tri_3.lgb_train_rules$data),
                                                          label = dat_first_conv.conv_only_tri_3$C0_new)
dat_first_conv.conv_only_tri_3.lgb_test_set = dat_test_first_conv.conv_only_tri_3 %>%
  select(-C0_new)
dat_first_conv.conv_only_tri_3.lgb_test_matrix = as.matrix(lgb.convert_with_rules(data = dat_first_conv.conv_only_tri_3.lgb_test_set, rules = dat_first_conv.conv_only_tri_3.lgb_train_rules$rules)$data)
dat_first_conv.conv_only_tri_3.lgb_test_data = lgb.Dataset(data = dat_first_conv.conv_only_tri_3.lgb_test_matrix,
                                                         label = dat_test_first_conv.conv_only_tri_3$C0_new,
                                                         categorical_feature = handle_categorical(colnames(dat_first_conv.conv_only_tri_3.lgb_test_matrix)))
dat_first_conv.conv_only_tri_3.lgb_obj = lightgbm(data = dat_first_conv.conv_only_tri_3.lgb_train_data,
                                                params = list(learning_rate = c(0.1),
                                                              objective = c("regression"),
                                                              min_data_in_leaf = 100,
                                                              max_depth = c(5),
                                                              num_leaves = c(1000),
                                                              lambda_l2 = c(1),
                                                              boosting = c("gbdt")),
                                                valids = list(valid = dat_first_conv.conv_only_tri_3.lgb_test_data),
                                                nrounds = 4000,
                                                early_stopping_rounds = 50)

dat_first_conv.conv_only_tri_3.lgb_train_pred = predict(dat_first_conv.conv_only_tri_3.lgb_obj, data = as.matrix(dat_first_conv.conv_only_tri_3.lgb_train_rules$data))
cor(dat_first_conv.conv_only_tri_3.lgb_train_pred, y, method="pearson")
# 0.9313132 (nrounds = 1597)

dat_first_conv.conv_only_tri_3.lgb_test_pred = predict(dat_first_conv.conv_only_tri_3.lgb_obj, data = dat_first_conv.conv_only_tri_3.lgb_test_matrix)

cor(dat_first_conv.conv_only_tri_3.lgb_test_pred, y_test, method="pearson")
# 0.8863763 (nround = 1597)

mean((dat_first_conv.conv_only_tri_3.lgb_test_pred - y_test)^2)
# 0.05165826 (nround = 1597)
```

We get test prediction correlation of 0.8863763 and MSE of 0.05165826

```{r}
as.data.frame(lgb.importance(dat_first_conv.conv_only_tri_3.lgb_obj)) %>%
  mutate(Feature = fct_rev(fct_inorder(Feature))) %>%
  dplyr::slice(1:50) %>%
  ggplot(aes(x = Feature, y = Gain)) +
  geom_col(fill = "dodgerblue") +
  coord_flip() +
  theme_bw()
```





## Prediction on Residuals of model trained on Fourier features, First Convolutional Layer with Trinucleotide input (8 features with a 21x64 kernel)

```{r}
dat_first_conv.conv_only_tri_5_fourier_resid = readRDS("data/Created/tiling_tiling_first_conv_output_train_conv_only_tri_5_fourier_resid.rds")
dat_test_first_conv.conv_only_tri_5_fourier_resid = readRDS("data/Created/tiling_tiling_first_conv_output_test_conv_only_tri_5_fourier_resid.rds")
dat_first_conv_random_test.conv_only_tri_5_fourier_resid = readRDS("data/Created/tiling_random_first_conv_output_test_conv_only_tri_5_fourier_resid.rds")
```

### Simple Linear Model 

```{r}
dat_first_conv.conv_only_tri_5_fourier_resid$C0_new = y
dat_test_first_conv.conv_only_tri_5_fourier_resid$C0_new = y_test

lm.model_first_conv.conv_only_tri_5_fourier_resid = lm(C0_new~., data = dat_first_conv.conv_only_tri_5_fourier_resid)

# Prediction accuracy with train data:
cor(lm.model_first_conv.conv_only_tri_5_fourier_resid$fitted.values, y, method="pearson")
# 0.04504332
mean((lm.model_first_conv.conv_only_tri_5_fourier_resid$fitted.values - y)^2)
# 0.2418549

# Predict values for test dataset:
lm.model_first_conv.conv_only_tri_5_fourier_resid.pred = predict(lm.model_first_conv.conv_only_tri_5_fourier_resid, newdata = dat_test_first_conv.conv_only_tri_5_fourier_resid)

# Prediction accuracy with test data:
cor(lm.model_first_conv.conv_only_tri_5_fourier_resid.pred, y_test, method="pearson")
# -0.007551102
mean((lm.model_first_conv.conv_only_tri_5_fourier_resid.pred - y_test)^2)
# 0.2417656

# Predict values for random test dataset:
lm.model_first_conv.conv_only_tri_5_fourier_resid.pred_random = predict(lm.model_first_conv.conv_only_tri_5_fourier_resid, newdata = dat_first_conv_random_test.conv_only_tri_5_fourier_resid)

# Prediction accuracy with random test data:
cor(lm.model_first_conv.conv_only_tri_5_fourier_resid.pred_random, dat_random_test$C0_new, method="pearson")
# 0.03689507
mean((lm.model_first_conv.conv_only_tri_5_fourier_resid.pred_random - dat_random_test$C0_new)^2)
# 0.1570851
```

We get test prediction correlation of -0.007551102 and MSE of 0.2417656

### LightGBM (tree-based) Model

```{r}
library(lightgbm)
source("scripts/functions/lgbm-helper-functions.R")
set.seed(50)
dat_first_conv.conv_only_tri_5_fourier_resid.lgb_train_set = dat_first_conv.conv_only_tri_5_fourier_resid %>%
  select(-C0_new)
dat_first_conv.conv_only_tri_5_fourier_resid.lgb_train_rules = lgb.convert_with_rules(data = dat_first_conv.conv_only_tri_5_fourier_resid.lgb_train_set)
dat_first_conv.conv_only_tri_5_fourier_resid.lgb_train_data = lgb.Dataset(data = as.matrix(dat_first_conv.conv_only_tri_5_fourier_resid.lgb_train_rules$data),
                                                          label = dat_first_conv.conv_only_tri_5_fourier_resid$C0_new)
dat_first_conv.conv_only_tri_5_fourier_resid.lgb_test_set = dat_test_first_conv.conv_only_tri_5_fourier_resid %>%
  select(-C0_new)
dat_first_conv.conv_only_tri_5_fourier_resid.lgb_test_matrix = as.matrix(lgb.convert_with_rules(data = dat_first_conv.conv_only_tri_5_fourier_resid.lgb_test_set, rules = dat_first_conv.conv_only_tri_5_fourier_resid.lgb_train_rules$rules)$data)
dat_first_conv.conv_only_tri_5_fourier_resid.lgb_test_data = lgb.Dataset(data = dat_first_conv.conv_only_tri_5_fourier_resid.lgb_test_matrix,
                                                         label = dat_test_first_conv.conv_only_tri_5_fourier_resid$C0_new,
                                                         categorical_feature = handle_categorical(colnames(dat_first_conv.conv_only_tri_5_fourier_resid.lgb_test_matrix)))
dat_first_conv.conv_only_tri_5_fourier_resid.lgb_obj = lightgbm(data = dat_first_conv.conv_only_tri_5_fourier_resid.lgb_train_data,
                                                params = list(learning_rate = c(0.1),
                                                              objective = c("regression"),
                                                              min_data_in_leaf = 100,
                                                              max_depth = c(5),
                                                              num_leaves = c(1000),
                                                              lambda_l2 = c(1),
                                                              boosting = c("gbdt")),
                                                valids = list(valid = dat_first_conv.conv_only_tri_5_fourier_resid.lgb_test_data),
                                                nrounds = 4000,
                                                early_stopping_rounds = 50)

dat_first_conv.conv_only_tri_5_fourier_resid.lgb_train_pred = predict(dat_first_conv.conv_only_tri_5_fourier_resid.lgb_obj, data = as.matrix(dat_first_conv.conv_only_tri_5_fourier_resid.lgb_train_rules$data))
cor(dat_first_conv.conv_only_tri_5_fourier_resid.lgb_train_pred, y, method="pearson")
#  (nrounds = )

dat_first_conv.conv_only_tri_5_fourier_resid.lgb_test_pred = predict(dat_first_conv.conv_only_tri_5_fourier_resid.lgb_obj, data = dat_first_conv.conv_only_tri_5_fourier_resid.lgb_test_matrix)

cor(dat_first_conv.conv_only_tri_5_fourier_resid.lgb_test_pred, y_test, method="pearson")
#  (nround = )

mean((dat_first_conv.conv_only_tri_5_fourier_resid.lgb_test_pred - y_test)^2)
#  (nround = )
```

We get test prediction correlation of  and MSE of 

```{r}
as.data.frame(lgb.importance(dat_first_conv.conv_only_tri_5_fourier_resid.lgb_obj)) %>%
  mutate(Feature = fct_rev(fct_inorder(Feature))) %>%
  dplyr::slice(1:50) %>%
  ggplot(aes(x = Feature, y = Gain)) +
  geom_col(fill = "dodgerblue") +
  coord_flip() +
  theme_bw()
```

# Inputs: Deep Learning Outputs + Fourier Features

```{r}
Xone_AT_fourier_cos = readRDS("data/Created/tiling_Xone_AT_fourier_cos.rds")
Xone_AT_fourier_sin = readRDS("data/Created/tiling_Xone_AT_fourier_sin.rds")
Xone_AT_fourier_cos_test = readRDS("data/Created/tiling_Xone_AT_fourier_cos_test.rds")
Xone_AT_fourier_sin_test = readRDS("data/Created/tiling_Xone_AT_fourier_sin_test.rds")

Xone_AT_fourier_cos_random = readRDS("data/Created/random_Xone_AT_fourier_cos.rds")
Xone_AT_fourier_sin_random = readRDS("data/Created/random_Xone_AT_fourier_sin.rds")
Xone_AT_fourier_cos_random_test = readRDS("data/Created/random_Xone_AT_fourier_cos_test.rds")
Xone_AT_fourier_sin_random_test = readRDS("data/Created/random_Xone_AT_fourier_sin_test.rds")

Xtwo_AT_fourier_cos = readRDS("data/Created/tiling_Xtwo_AT_fourier_cos.rds")
Xtwo_AT_fourier_sin = readRDS("data/Created/tiling_Xtwo_AT_fourier_sin.rds")
Xtwo_AT_fourier_cos_test = readRDS("data/Created/tiling_Xtwo_AT_fourier_cos_test.rds")
Xtwo_AT_fourier_sin_test = readRDS("data/Created/tiling_Xtwo_AT_fourier_sin_test.rds")

Xtwo_AT_fourier_cos_random = readRDS("data/Created/random_Xtwo_AT_fourier_cos.rds")
Xtwo_AT_fourier_sin_random = readRDS("data/Created/random_Xtwo_AT_fourier_sin.rds")
Xtwo_AT_fourier_cos_random_test = readRDS("data/Created/random_Xtwo_AT_fourier_cos_test.rds")
Xtwo_AT_fourier_sin_random_test = readRDS("data/Created/random_Xtwo_AT_fourier_sin_test.rds")

Xone_CG_fourier_cos = readRDS("data/Created/tiling_Xone_CG_fourier_cos.rds")
Xone_CG_fourier_sin = readRDS("data/Created/tiling_Xone_CG_fourier_sin.rds")
Xone_CG_fourier_cos_test = readRDS("data/Created/tiling_Xone_CG_fourier_cos_test.rds")
Xone_CG_fourier_sin_test = readRDS("data/Created/tiling_Xone_CG_fourier_sin_test.rds")

Xone_CG_fourier_cos_random = readRDS("data/Created/random_Xone_CG_fourier_cos.rds")
Xone_CG_fourier_sin_random = readRDS("data/Created/random_Xone_CG_fourier_sin.rds")
Xone_CG_fourier_cos_random_test = readRDS("data/Created/random_Xone_CG_fourier_cos_test.rds")
Xone_CG_fourier_sin_random_test = readRDS("data/Created/random_Xone_CG_fourier_sin_test.rds")

Xtwo_CG_fourier_cos = readRDS("data/Created/tiling_Xtwo_CG_fourier_cos.rds")
Xtwo_CG_fourier_sin = readRDS("data/Created/tiling_Xtwo_CG_fourier_sin.rds")
Xtwo_CG_fourier_cos_test = readRDS("data/Created/tiling_Xtwo_CG_fourier_cos_test.rds")
Xtwo_CG_fourier_sin_test = readRDS("data/Created/tiling_Xtwo_CG_fourier_sin_test.rds")

Xtwo_CG_fourier_cos_random = readRDS("data/Created/random_Xtwo_CG_fourier_cos.rds")
Xtwo_CG_fourier_sin_random = readRDS("data/Created/random_Xtwo_CG_fourier_sin.rds")
Xtwo_CG_fourier_cos_random_test = readRDS("data/Created/random_Xtwo_CG_fourier_cos_test.rds")
Xtwo_CG_fourier_sin_random_test = readRDS("data/Created/random_Xtwo_CG_fourier_sin_test.rds")
```

FIXME

## First Convolutional Layer (48 features with a 3x4 kernel)

### Fourier Features Based on A/T Nucleotides

#### Full IR+LSTM

```{r}
dat_first_conv = readRDS("data/Created/tiling_tiling_first_conv_output_train.rds")
dat_first_conv_test = readRDS("data/Created/tiling_tiling_first_conv_output_test.rds")
dat_first_conv_random_test = readRDS("data/Created/tiling_random_first_conv_output_test.rds")
```

```{r}
dat_first_conv$Y = y
dat_first_conv_test$Y = y_test
dat_first_conv_fourier_sq.1 = bind_cols(dat_first_conv, Xone_AT_fourier_cos^2, Xone_AT_fourier_sin^2)

lm.model_first_conv_fourier_sq.1 = lm(Y~., data = dat_first_conv_fourier_sq.1)

# Prediction accuracy with train data:
cor(lm.model_first_conv_fourier_sq.1$fitted.values, y, method="pearson")
# 0.5850556
mean((lm.model_first_conv_fourier_sq.1$fitted.values - y)^2)
# 0.1593938

# Set up test data
dat_first_conv_test.fourier_sq.1 = bind_cols(dat_first_conv_test, Xone_AT_fourier_cos_test^2, Xone_AT_fourier_sin_test^2)

# Predict values for test dataset:
lm.model_first_conv_test.fourier_sq.1.pred = predict(lm.model_first_conv_fourier_sq.1, newdata = dat_first_conv_test.fourier_sq.1)

# Prediction accuracy with test data:
cor(lm.model_first_conv_test.fourier_sq.1.pred, y_test, method="pearson")
# 0.5582504
mean((lm.model_first_conv_test.fourier_sq.1.pred - y_test)^2)
# 0.1661409

# Set up random test data
dat_first_conv_random_test.fourier_sq.1 = bind_cols(dat_first_conv_random_test, Xone_AT_fourier_cos_random_test^2, Xone_AT_fourier_sin_random_test^2)

# Predict values for random test dataset:
lm.model_first_conv.fourier_sq.1.pred_random = predict(lm.model_first_conv_fourier_sq.1, newdata = dat_first_conv_random_test.fourier_sq.1)

# Prediction accuracy with random test data:
cor(lm.model_first_conv.fourier_sq.1.pred_random, dat_random_test$C0_new, method="pearson")
# 0.5257918
mean((lm.model_first_conv.fourier_sq.1.pred_random - dat_random_test$C0_new)^2)
# 0.1182379
```

We get test prediction correlation of  and MSE of 

#### 1 Convolutional Layer Only

```{r}
dat_first_conv.conv_only = readRDS("data/Created/tiling_tiling_first_conv_output_train_conv_only.rds")
dat_first_conv_test.conv_only = readRDS("data/Created/tiling_tiling_first_conv_output_test_conv_only.rds")
dat_first_conv_random_test.conv_only = readRDS("data/Created/tiling_random_first_conv_output_test_conv_only.rds")
```

```{r}
dat_first_conv.conv_only$Y = y
dat_first_conv_test.conv_only$Y = y_test
dat_first_conv.conv_only_fourier_sq.1 = bind_cols(dat_first_conv.conv_only, Xone_AT_fourier_cos^2, Xone_AT_fourier_sin^2)

lm.model_first_conv.conv_only_fourier_sq.1 = lm(Y~., data = dat_first_conv.conv_only_fourier_sq.1)

# Prediction accuracy with train data:
cor(lm.model_first_conv.conv_only_fourier_sq.1$fitted.values, y, method="pearson")
# 0.560766
mean((lm.model_first_conv.conv_only_fourier_sq.1$fitted.values - y)^2)
# 0.1661386

# Set up test data
dat_first_conv_test.conv_only_fourier_sq.1 = bind_cols(dat_first_conv_test.conv_only, Xone_AT_fourier_cos_test^2, Xone_AT_fourier_sin_test^2)

# Predict values for test dataset:
lm.model_first_conv.conv_only_fourier_sq.1.pred = predict(lm.model_first_conv.conv_only_fourier_sq.1, newdata = dat_first_conv_test.conv_only_fourier_sq.1)

# Prediction accuracy with test data:
cor(lm.model_first_conv.conv_only_fourier_sq.1.pred, y_test, method="pearson")
# 0.5499149
mean((lm.model_first_conv.conv_only_fourier_sq.1.pred - y_test)^2)
# 0.1681648

# Set up random test data
dat_first_conv_random_test.conv_only_fourier_sq.1 = bind_cols(dat_first_conv_random_test.conv_only, Xone_AT_fourier_cos_random_test^2, Xone_AT_fourier_sin_random_test^2)

# Predict values for random test dataset:
lm.model_first_conv.conv_only_fourier_sq.1.pred_random = predict(lm.model_first_conv.conv_only_fourier_sq.1, newdata = dat_first_conv_random_test.conv_only_fourier_sq.1)

# Prediction accuracy with random test data:
cor(lm.model_first_conv.conv_only_fourier_sq.1.pred_random, dat_random_test$C0_new, method="pearson")
# 0.5137014
mean((lm.model_first_conv.conv_only_fourier_sq.1.pred_random - dat_random_test$C0_new)^2)
# 0.1190525
```

We get test prediction correlation of  and MSE of 

### Fourier Features Based on AA/TT/AT/TA Dinucleotides

FIXME

### Fourier Features Based on CC/GG/CG/GC Dinucleotides

FIXME

### Fourier Features Based on AA/TT/AT/TA and CC/GG/CG/GC Dinucleotides

FIXME


## First Convolutional Layer (16 features with a 3x4 kernel)

### Fourier Features Based on A/T Nucleotides

#### 1 Convolutional Layer Only


```{r}
dat_first_conv.conv_only_2 = readRDS("data/Created/tiling_tiling_first_conv_output_train_conv_only_2.rds")
dat_first_conv_test.conv_only_2 = readRDS("data/Created/tiling_tiling_first_conv_output_test_conv_only_2.rds")
dat_first_conv_random_test.conv_only_2 = readRDS("data/Created/tiling_random_first_conv_output_test_conv_only_2.rds")
```

##### Simple Linear Model

```{r}
dat_first_conv.conv_only_2$C0_new = y
dat_first_conv_test.conv_only_2$C0_new = y_test
dat_first_conv.conv_only_2_fourier_sq.1 = bind_cols(dat_first_conv.conv_only_2, Xone_AT_fourier_cos^2, Xone_AT_fourier_sin^2)

lm.model_first_conv.conv_only_2_fourier_sq.1 = lm(Y~., data = dat_first_conv.conv_only_2_fourier_sq.1)

# Prediction accuracy with train data:
cor(lm.model_first_conv.conv_only_2_fourier_sq.1$fitted.values, y, method="pearson")
# 0.5589223
mean((lm.model_first_conv.conv_only_2_fourier_sq.1$fitted.values - y)^2)
# 0.166639

# Set up test data
dat_test_first_conv.conv_only_2_fourier_sq.1 = bind_cols(dat_test_first_conv.conv_only_2, Xone_AT_fourier_cos_test^2, Xone_AT_fourier_sin_test^2)

# Predict values for test dataset:
lm.model_first_conv.conv_only_2_fourier_sq.1.pred = predict(lm.model_first_conv.conv_only_2_fourier_sq.1, newdata = dat_first_conv_test.conv_only_2_fourier_sq.1)

# Prediction accuracy with test data:
cor(lm.model_first_conv.conv_only_2_fourier_sq.1.pred, y_test, method="pearson")
# 0.5500898
mean((lm.model_first_conv.conv_only_2_fourier_sq.1.pred - y_test)^2)
# 0.1681023

# Set up random test data
dat_first_conv_random_test.conv_only_2_fourier_sq.1 = bind_cols(dat_first_conv_random_test.conv_only_2, Xone_AT_fourier_cos_random_test^2, Xone_AT_fourier_sin_random_test^2)

# Predict values for random test dataset:
lm.model_first_conv.conv_only_2_fourier_sq.1.pred_random = predict(lm.model_first_conv.conv_only_2_fourier_sq.1, newdata = dat_first_conv_random_test.conv_only_2_fourier_sq.1)

# Prediction accuracy with random test data:
cor(lm.model_first_conv.conv_only_2_fourier_sq.1.pred_random, dat_random_test$C0_new, method="pearson")
# 0.5148304
mean((lm.model_first_conv.conv_only_2_fourier_sq.1.pred_random - dat_random_test$C0_new)^2)
# 0.119102
```

We get test prediction correlation of  and MSE of 

##### LightGBM (tree-based) Model

```{r}
library(lightgbm)
source("scripts/functions/lgbm-helper-functions.R")
dat_first_conv.conv_only_2_fourier_sq.1.lgb_train_set = dat_first_conv.conv_only_2_fourier_sq.1 %>%
  select(-C0_new)
dat_first_conv.conv_only_2_fourier_sq.1.lgb_train_rules = lgb.convert_with_rules(data = dat_first_conv.conv_only_2_fourier_sq.1.lgb_train_set)
dat_first_conv.conv_only_2_fourier_sq.1.lgb_train_data = lgb.Dataset(data = as.matrix(dat_first_conv.conv_only_2_fourier_sq.1.lgb_train_rules$data),
                                                                     label = dat_first_conv.conv_only_2_fourier_sq.1$C0_new)
dat_first_conv.conv_only_2_fourier_sq.1.lgb_test_set = dat_test_first_conv.conv_only_2_fourier_sq.1 %>%
  select(-C0_new)
dat_first_conv.conv_only_2_fourier_sq.1.lgb_test_matrix = as.matrix(lgb.convert_with_rules(data = dat_first_conv.conv_only_2_fourier_sq.1.lgb_test_set, rules = dat_first_conv.conv_only_2_fourier_sq.1.lgb_train_rules$rules)$data)
dat_first_conv.conv_only_2_fourier_sq.1.lgb_test_data = lgb.Dataset(data = dat_first_conv.conv_only_2_fourier_sq.1.lgb_test_matrix,
                                                                    label = dat_test_first_conv.conv_only_2_fourier_sq.1$C0_new,
                                                                    categorical_feature = handle_categorical(colnames(dat_first_conv.conv_only_2_fourier_sq.1.lgb_test_matrix)))
dat_first_conv.conv_only_2_fourier_sq.1.lgb_obj = lightgbm(data = dat_first_conv.conv_only_2_fourier_sq.1.lgb_train_data,
                                                           params = list(learning_rate = c(0.1),
                                                                         objective = c("regression"),
                                                                         min_data_in_leaf = 100,
                                                                         max_depth = c(5),
                                                                         num_leaves = c(1000),
                                                                         lambda_l2 = c(1),
                                                                         boosting = c("gbdt")),
                                                           valids = list(valid = dat_first_conv.conv_only_2_fourier_sq.1.lgb_test_data),
                                                           nrounds = 4000,
                                                           early_stopping_rounds = 50)

dat_first_conv.conv_only_2_fourier_sq.1.lgb_train_pred = predict(dat_first_conv.conv_only_2_fourier_sq.1.lgb_obj, data = as.matrix(dat_first_conv.conv_only_2_fourier_sq.1.lgb_train_rules$data))
cor(dat_first_conv.conv_only_2_fourier_sq.1.lgb_train_pred, y, method="pearson")
# 0.9828647 (nrounds = 3817)

dat_first_conv.conv_only_2_fourier_sq.1.lgb_test_pred = predict(dat_first_conv.conv_only_2_fourier_sq.1.lgb_obj, data = dat_first_conv.conv_only_2_fourier_sq.1.lgb_test_matrix)

cor(dat_first_conv.conv_only_2_fourier_sq.1.lgb_test_pred, y_test, method="pearson")
# 0.6909936 (nround = 3817)

mean((dat_first_conv.conv_only_2_fourier_sq.1.lgb_test_pred - y_test)^2)
# 0.126217
```

We get test prediction correlation of  and MSE of 

### Fourier Features Based on AA/TT/AT/TA Dinucleotides

#### 1 Convolutional Layer Only

```{r}
dat_first_conv.conv_only_2 = readRDS("data/Created/tiling_tiling_first_conv_output_train_conv_only_2.rds")
dat_first_conv_test.conv_only_2 = readRDS("data/Created/tiling_tiling_first_conv_output_test_conv_only_2.rds")
dat_first_conv_random_test.conv_only_2 = readRDS("data/Created/tiling_random_first_conv_output_test_conv_only_2.rds")
```

##### Simple Linear Model

```{r}
dat_first_conv.conv_only_2$C0_new = y
dat_first_conv_test.conv_only_2$C0_new = y_test
dat_first_conv.conv_only_2_fourier_sq.2 = bind_cols(dat_first_conv.conv_only_2, Xtwo_AT_fourier_cos^2, Xtwo_AT_fourier_sin^2)

lm.model_first_conv.conv_only_2_fourier_sq.2 = lm(C0_new~., data = dat_first_conv.conv_only_2_fourier_sq.2)

# Prediction accuracy with train data:
cor(lm.model_first_conv.conv_only_2_fourier_sq.2$fitted.values, y, method="pearson")
# 0.5334231
mean((lm.model_first_conv.conv_only_2_fourier_sq.2$fitted.values - y)^2)
# 0.1733892

# Set up test data
dat_test_first_conv.conv_only_2_fourier_sq.2 = bind_cols(dat_test_first_conv.conv_only_2, Xtwo_AT_fourier_cos_test^2, Xtwo_AT_fourier_sin_test^2)

# Predict values for test dataset:
lm.model_first_conv.conv_only_2_fourier_sq.2.pred = predict(lm.model_first_conv.conv_only_2_fourier_sq.2, newdata = dat_first_conv_test.conv_only_2_fourier_sq.2)

# Prediction accuracy with test data:
cor(lm.model_first_conv.conv_only_2_fourier_sq.2.pred, y_test, method="pearson")
# 0.5317166
mean((lm.model_first_conv.conv_only_2_fourier_sq.2.pred - y_test)^2)
# 0.172868

# Set up random test data
dat_first_conv_random_test.conv_only_2_fourier_sq.2 = bind_cols(dat_first_conv_random_test.conv_only_2, Xtwo_AT_fourier_cos_random_test^2, Xtwo_AT_fourier_sin_random_test^2)

# Predict values for random test dataset:
lm.model_first_conv.conv_only_2_fourier_sq.2.pred_random = predict(lm.model_first_conv.conv_only_2_fourier_sq.2, newdata = dat_first_conv_random_test.conv_only_2_fourier_sq.2)

# Prediction accuracy with random test data:
cor(lm.model_first_conv.conv_only_2_fourier_sq.2.pred_random, dat_random_test$C0_new, method="pearson")
# 0.4779607
mean((lm.model_first_conv.conv_only_2_fourier_sq.2.pred_random - dat_random_test$C0_new)^2)
# 0.1204049
```

We get test prediction correlation of  and MSE of 

##### LightGBM (tree-based) Model

```{r}
library(lightgbm)
source("scripts/functions/lgbm-helper-functions.R")
dat_first_conv.conv_only_2_fourier_sq.2.lgb_train_set = dat_first_conv.conv_only_2_fourier_sq.2 %>%
  select(-C0_new)
dat_first_conv.conv_only_2_fourier_sq.2.lgb_train_rules = lgb.convert_with_rules(data = dat_first_conv.conv_only_2_fourier_sq.2.lgb_train_set)
dat_first_conv.conv_only_2_fourier_sq.2.lgb_train_data = lgb.Dataset(data = as.matrix(dat_first_conv.conv_only_2_fourier_sq.2.lgb_train_rules$data),
                                                                     label = dat_first_conv.conv_only_2_fourier_sq.2$C0_new)
dat_first_conv.conv_only_2_fourier_sq.2.lgb_test_set = dat_test_first_conv.conv_only_2_fourier_sq.2 %>%
  select(-C0_new)
dat_first_conv.conv_only_2_fourier_sq.2.lgb_test_matrix = as.matrix(lgb.convert_with_rules(data = dat_first_conv.conv_only_2_fourier_sq.2.lgb_test_set, rules = dat_first_conv.conv_only_2_fourier_sq.2.lgb_train_rules$rules)$data)
dat_first_conv.conv_only_2_fourier_sq.2.lgb_test_data = lgb.Dataset(data = dat_first_conv.conv_only_2_fourier_sq.2.lgb_test_matrix,
                                                                    label = dat_test_first_conv.conv_only_2_fourier_sq.2$C0_new,
                                                                    categorical_feature = handle_categorical(colnames(dat_first_conv.conv_only_2_fourier_sq.2.lgb_test_matrix)))
dat_first_conv.conv_only_2_fourier_sq.2.lgb_obj = lightgbm(data = dat_first_conv.conv_only_2_fourier_sq.2.lgb_train_data,
                                                           params = list(learning_rate = c(0.1),
                                                                         objective = c("regression"),
                                                                         min_data_in_leaf = 100,
                                                                         max_depth = c(5),
                                                                         num_leaves = c(1000),
                                                                         lambda_l2 = c(1),
                                                                         boosting = c("gbdt")),
                                                           valids = list(valid = dat_first_conv.conv_only_2_fourier_sq.2.lgb_test_data),
                                                           nrounds = 4000,
                                                           early_stopping_rounds = 50)

dat_first_conv.conv_only_2_fourier_sq.2.lgb_train_pred = predict(dat_first_conv.conv_only_2_fourier_sq.2.lgb_obj, data = as.matrix(dat_first_conv.conv_only_2_fourier_sq.2.lgb_train_rules$data))
cor(dat_first_conv.conv_only_2_fourier_sq.2.lgb_train_pred, y, method="pearson")
# 0.9725789 (nrounds = 3038)

dat_first_conv.conv_only_2_fourier_sq.2.lgb_test_pred = predict(dat_first_conv.conv_only_2_fourier_sq.2.lgb_obj, data = dat_first_conv.conv_only_2_fourier_sq.2.lgb_test_matrix)

cor(dat_first_conv.conv_only_2_fourier_sq.2.lgb_test_pred, y_test, method="pearson")
# 0.6891932 (nround 3038)

mean((dat_first_conv.conv_only_2_fourier_sq.2.lgb_test_pred - y_test)^2)
# 0.1269142
```

We get test prediction correlation of  and MSE of 

### Fourier Features Based on C/G Nucleotides

#### 1 Convolutional Layer Only

```{r}
dat_first_conv.conv_only_2 = readRDS("data/Created/tiling_tiling_first_conv_output_train_conv_only_2.rds")
dat_first_conv_test.conv_only_2 = readRDS("data/Created/tiling_tiling_first_conv_output_test_conv_only_2.rds")
dat_first_conv_random_test.conv_only_2 = readRDS("data/Created/tiling_random_first_conv_output_test_conv_only_2.rds")
```

```{r}
dat_first_conv.conv_only_2$Y = y
dat_first_conv_test.conv_only_2$Y = y_test
dat_first_conv.conv_only_2_fourier_sq.3 = bind_cols(dat_first_conv.conv_only_2, Xone_CG_fourier_cos^2, Xone_CG_fourier_sin^2)

lm.model_first_conv.conv_only_2_fourier_sq.3 = lm(Y~., data = dat_first_conv.conv_only_2_fourier_sq.3)

# Prediction accuracy with train data:
cor(lm.model_first_conv.conv_only_2_fourier_sq.3$fitted.values, y, method="pearson")
# 0.5589203
mean((lm.model_first_conv.conv_only_2_fourier_sq.3$fitted.values - y)^2)
# 0.1666395

# Set up test data
dat_first_conv_test.conv_only_2_fourier_sq.3 = bind_cols(dat_first_conv_test.conv_only_2, Xone_CG_fourier_cos_test^2, Xone_CG_fourier_sin_test^2)

# Predict values for test dataset:
lm.model_first_conv.conv_only_2_fourier_sq.3.pred = predict(lm.model_first_conv.conv_only_2_fourier_sq.3, newdata = dat_first_conv_test.conv_only_2_fourier_sq.3)

# Prediction accuracy with test data:
cor(lm.model_first_conv.conv_only_2_fourier_sq.3.pred, y_test, method="pearson")
# 0.5501346
mean((lm.model_first_conv.conv_only_2_fourier_sq.3.pred - y_test)^2)
# 0.1680903

# Set up random test data
dat_first_conv_random_test.conv_only_2_fourier_sq.3 = bind_cols(dat_first_conv_random_test.conv_only_2, Xone_CG_fourier_cos_random_test^2, Xone_CG_fourier_sin_random_test^2)

# Predict values for random test dataset:
lm.model_first_conv.conv_only_2_fourier_sq.3.pred_random = predict(lm.model_first_conv.conv_only_2_fourier_sq.3, newdata = dat_first_conv_random_test.conv_only_2_fourier_sq.3)

# Prediction accuracy with random test data:
cor(lm.model_first_conv.conv_only_2_fourier_sq.3.pred_random, dat_random_test$C0_new, method="pearson")
# 0.5147154
mean((lm.model_first_conv.conv_only_2_fourier_sq.3.pred_random - dat_random_test$C0_new)^2)
# 0.1191346
```

We get test prediction correlation of  and MSE of 

### Fourier Features Based on CC/GG/CG/GC Dinucleotides

#### 1 Convolutional Layer Only

```{r}
dat_first_conv.conv_only_2 = readRDS("data/Created/tiling_tiling_first_conv_output_train_conv_only_2.rds")
dat_first_conv_test.conv_only_2 = readRDS("data/Created/tiling_tiling_first_conv_output_test_conv_only_2.rds")
dat_first_conv_random_test.conv_only_2 = readRDS("data/Created/tiling_random_first_conv_output_test_conv_only_2.rds")
```

```{r}
dat_first_conv.conv_only_2$Y = y
dat_first_conv_test.conv_only_2$Y = y_test
dat_first_conv.conv_only_2_fourier_sq.4 = bind_cols(dat_first_conv.conv_only_2, Xtwo_CG_fourier_cos^2, Xtwo_CG_fourier_sin^2)

lm.model_first_conv.conv_only_2_fourier_sq.4 = lm(Y~., data = dat_first_conv.conv_only_2_fourier_sq.4)

# Prediction accuracy with train data:
cor(lm.model_first_conv.conv_only_2_fourier_sq.4$fitted.values, y, method="pearson")
# 0.4207978
mean((lm.model_first_conv.conv_only_2_fourier_sq.4$fitted.values - y)^2)
# 0.1994341

# Set up test data
dat_first_conv_test.conv_only_2_fourier_sq.4 = bind_cols(dat_first_conv_test.conv_only_2, Xtwo_CG_fourier_cos_test^2, Xtwo_CG_fourier_sin_test^2)

# Predict values for test dataset:
lm.model_first_conv.conv_only_2_fourier_sq.4.pred = predict(lm.model_first_conv.conv_only_2_fourier_sq.4, newdata = dat_first_conv_test.conv_only_2_fourier_sq.4)

# Prediction accuracy with test data:
cor(lm.model_first_conv.conv_only_2_fourier_sq.4.pred, y_test, method="pearson")
# 0.4061322
mean((lm.model_first_conv.conv_only_2_fourier_sq.4.pred - y_test)^2)
# 0.2013736

# Set up random test data
dat_first_conv_random_test.conv_only_2_fourier_sq.4 = bind_cols(dat_first_conv_random_test.conv_only_2, Xtwo_CG_fourier_cos_random_test^2, Xtwo_CG_fourier_sin_random_test^2)

# Predict values for random test dataset:
lm.model_first_conv.conv_only_2_fourier_sq.4.pred_random = predict(lm.model_first_conv.conv_only_2_fourier_sq.4, newdata = dat_first_conv_random_test.conv_only_2_fourier_sq.4)

# Prediction accuracy with random test data:
cor(lm.model_first_conv.conv_only_2_fourier_sq.4.pred_random, dat_random_test$C0_new, method="pearson")
# 0.4210632
mean((lm.model_first_conv.conv_only_2_fourier_sq.4.pred_random - dat_random_test$C0_new)^2)
# 0.1297992
```

We get test prediction correlation of  and MSE of 

### Fourier Features Based on AA/TT/AT/TA and CC/GG/CG/GC Dinucleotides

#### 1 Convolutional Layer Only

```{r}
dat_first_conv.conv_only_2 = readRDS("data/Created/tiling_tiling_first_conv_output_train_conv_only_2.rds")
dat_first_conv_test.conv_only_2 = readRDS("data/Created/tiling_tiling_first_conv_output_test_conv_only_2.rds")
dat_first_conv_random_test.conv_only_2 = readRDS("data/Created/tiling_random_first_conv_output_test_conv_only_2.rds")
```

```{r}
dat_first_conv.conv_only_2$C0_new = y
dat_first_conv_test.conv_only_2$C0_new = y_test
dat_first_conv.conv_only_2_fourier_sq.5 = bind_cols(dat_first_conv.conv_only_2, 
                                                    Xtwo_AT_fourier_cos^2, Xtwo_AT_fourier_sin^2, 
                                                    Xtwo_CG_fourier_cos^2, Xtwo_CG_fourier_sin^2)

dat_test_first_conv.conv_only_2_fourier_sq.5 = bind_cols(dat_test_first_conv.conv_only_2, 
                                                         Xtwo_AT_fourier_cos_test^2, 
                                                         Xtwo_AT_fourier_sin_test^2, 
                                                         Xtwo_CG_fourier_cos_test^2, 
                                                         Xtwo_CG_fourier_sin_test^2)
dat_first_conv_random_test.conv_only_2_fourier_sq.5 = bind_cols(dat_first_conv_random_test.conv_only_2, 
                                                                Xtwo_AT_fourier_cos_random_test^2, 
                                                                Xtwo_AT_fourier_sin_random_test^2, 
                                                                Xtwo_CG_fourier_cos_random_test^2, 
                                                                Xtwo_CG_fourier_sin_random_test^2)
```

##### Simple Linear Model

```{r}
lm.model_first_conv.conv_only_2_fourier_sq.5 = lm(Y~., data = dat_first_conv.conv_only_2_fourier_sq.5)

# Prediction accuracy with train data:
cor(lm.model_first_conv.conv_only_2_fourier_sq.5$fitted.values, y, method="pearson")
# 0.5382848
mean((lm.model_first_conv.conv_only_2_fourier_sq.5$fitted.values - y)^2)
# 0.1721265

# Predict values for test dataset:
lm.model_first_conv.conv_only_2_fourier_sq.5.pred = predict(lm.model_first_conv.conv_only_2_fourier_sq.5, newdata = dat_first_conv_test.conv_only_2_fourier_sq.5)

# Prediction accuracy with test data:
cor(lm.model_first_conv.conv_only_2_fourier_sq.5.pred, y_test, method="pearson")
# 0.5348621
mean((lm.model_first_conv.conv_only_2_fourier_sq.5.pred - y_test)^2)
# 0.1720627

# Predict values for random test dataset:
lm.model_first_conv.conv_only_2_fourier_sq.5.pred_random = predict(lm.model_first_conv.conv_only_2_fourier_sq.5, newdata = dat_first_conv_random_test.conv_only_2_fourier_sq.5)

# Prediction accuracy with random test data:
cor(lm.model_first_conv.conv_only_2_fourier_sq.5.pred_random, dat_random_test$C0_new, method="pearson")
# 0.4956422
mean((lm.model_first_conv.conv_only_2_fourier_sq.5.pred_random - dat_random_test$C0_new)^2)
# 0.1180861
```

We get test prediction correlation of  and MSE of 

##### LightGBM (tree-based) Model

```{r}
library(lightgbm)
source("scripts/functions/lgbm-helper-functions.R")
dat_first_conv.conv_only_2_fourier_sq.5.lgb_train_set = dat_first_conv.conv_only_2_fourier_sq.5 %>%
  select(-C0_new)
dat_first_conv.conv_only_2_fourier_sq.5.lgb_train_rules = lgb.convert_with_rules(data = dat_first_conv.conv_only_2_fourier_sq.5.lgb_train_set)
dat_first_conv.conv_only_2_fourier_sq.5.lgb_train_data = lgb.Dataset(data = as.matrix(dat_first_conv.conv_only_2_fourier_sq.5.lgb_train_rules$data),
                                                                     label = dat_first_conv.conv_only_2_fourier_sq.5$C0_new)
dat_first_conv.conv_only_2_fourier_sq.5.lgb_test_set = dat_test_first_conv.conv_only_2_fourier_sq.5 %>%
  select(-C0_new)
dat_first_conv.conv_only_2_fourier_sq.5.lgb_test_matrix = as.matrix(lgb.convert_with_rules(data = dat_first_conv.conv_only_2_fourier_sq.5.lgb_test_set, rules = dat_first_conv.conv_only_2_fourier_sq.5.lgb_train_rules$rules)$data)
dat_first_conv.conv_only_2_fourier_sq.5.lgb_test_data = lgb.Dataset(data = dat_first_conv.conv_only_2_fourier_sq.5.lgb_test_matrix,
                                                                    label = dat_test_first_conv.conv_only_2_fourier_sq.5$C0_new,
                                                                    categorical_feature = handle_categorical(colnames(dat_first_conv.conv_only_2_fourier_sq.5.lgb_test_matrix)))
dat_first_conv.conv_only_2_fourier_sq.5.lgb_obj = lightgbm(data = dat_first_conv.conv_only_2_fourier_sq.5.lgb_train_data,
                                                           params = list(learning_rate = c(0.1),
                                                                         objective = c("regression"),
                                                                         min_data_in_leaf = 100,
                                                                         max_depth = c(5),
                                                                         num_leaves = c(1000),
                                                                         lambda_l2 = c(1),
                                                                         boosting = c("gbdt")),
                                                           valids = list(valid = dat_first_conv.conv_only_2_fourier_sq.5.lgb_test_data),
                                                           nrounds = 4000,
                                                           early_stopping_rounds = 50)

dat_first_conv.conv_only_2_fourier_sq.5.lgb_train_pred = predict(dat_first_conv.conv_only_2_fourier_sq.5.lgb_obj, data = as.matrix(dat_first_conv.conv_only_2_fourier_sq.5.lgb_train_rules$data))
cor(dat_first_conv.conv_only_2_fourier_sq.5.lgb_train_pred, y, method="pearson")
# 0.9298592 (nrounds = 1668)

dat_first_conv.conv_only_2_fourier_sq.5.lgb_test_pred = predict(dat_first_conv.conv_only_2_fourier_sq.5.lgb_obj, data = dat_first_conv.conv_only_2_fourier_sq.5.lgb_test_matrix)

cor(dat_first_conv.conv_only_2_fourier_sq.5.lgb_test_pred, y_test, method="pearson")
# 0.6591082 (nround = 1668)

mean((dat_first_conv.conv_only_2_fourier_sq.5.lgb_test_pred - y_test)^2)
# 0.136539
```

We get test prediction correlation of  and MSE of 







